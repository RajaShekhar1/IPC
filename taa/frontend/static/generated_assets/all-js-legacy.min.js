+function($){"use strict";var dismiss='[data-dismiss="alert"]'
var Alert=function(el){$(el).on('click',dismiss,this.close)}
Alert.prototype.close=function(e){var $this=$(this)
var selector=$this.attr('data-target')
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
var $parent=$(selector)
if(e)e.preventDefault()
if(!$parent.length){$parent=$this.hasClass('alert')?$this:$this.parent()}
$parent.trigger(e=$.Event('close.bs.alert'))
if(e.isDefaultPrevented())return
$parent.removeClass('in')
function removeElement(){$parent.trigger('closed.bs.alert').remove()}
$.support.transition&&$parent.hasClass('fade')?$parent.one($.support.transition.end,removeElement).emulateTransitionEnd(150):removeElement()}
var old=$.fn.alert
$.fn.alert=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.alert')
if(!data)$this.data('bs.alert',(data=new Alert(this)))
if(typeof option=='string')data[option].call($this)})}
$.fn.alert.Constructor=Alert
$.fn.alert.noConflict=function(){$.fn.alert=old
return this}
$(document).on('click.bs.alert.data-api',dismiss,Alert.prototype.close)}(jQuery);+function($){"use strict";var Button=function(element,options){this.$element=$(element)
this.options=$.extend({},Button.DEFAULTS,options)}
Button.DEFAULTS={loadingText:'loading...'}
Button.prototype.setState=function(state){var d='disabled'
var $el=this.$element
var val=$el.is('input')?'val':'html'
var data=$el.data()
state=state+'Text'
if(!data.resetText)$el.data('resetText',$el[val]())
$el[val](data[state]||this.options[state])
setTimeout(function(){state=='loadingText'?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d);},0)}
Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons"]')
var changed=true
if($parent.length){var $input=this.$element.find('input')
if($input.prop('type')==='radio'){if($input.prop('checked')&&this.$element.hasClass('active'))
changed=false
else
$parent.find('.active').removeClass('active')}
if(changed)$input.prop('checked',!this.$element.hasClass('active')).trigger('change')}
if(changed)this.$element.toggleClass('active')}
var old=$.fn.button
$.fn.button=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.button')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.button',(data=new Button(this,options)))
if(option=='toggle')data.toggle()
else if(option)data.setState(option)})}
$.fn.button.Constructor=Button
$.fn.button.noConflict=function(){$.fn.button=old
return this}
$(document).on('click.bs.button.data-api','[data-toggle^=button]',function(e){var $btn=$(e.target)
if(!$btn.hasClass('btn'))$btn=$btn.closest('.btn')
$btn.button('toggle')
e.preventDefault()})}(jQuery);+function($){"use strict";var Carousel=function(element,options){this.$element=$(element)
this.$indicators=this.$element.find('.carousel-indicators')
this.options=options
this.paused=this.sliding=this.interval=this.$active=this.$items=null
this.options.pause=='hover'&&this.$element.on('mouseenter',$.proxy(this.pause,this)).on('mouseleave',$.proxy(this.cycle,this))}
Carousel.DEFAULTS={interval:5000,pause:'hover',wrap:true}
Carousel.prototype.cycle=function(e){e||(this.paused=false)
this.interval&&clearInterval(this.interval)
this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval))
return this}
Carousel.prototype.getActiveIndex=function(){this.$active=this.$element.find('.item.active')
this.$items=this.$active.parent().children()
return this.$items.index(this.$active)}
Carousel.prototype.to=function(pos){var that=this
var activeIndex=this.getActiveIndex()
if(pos>(this.$items.length-1)||pos<0)return
if(this.sliding)return this.$element.one('slid.bs.carousel',function(){that.to(pos)})
if(activeIndex==pos)return this.pause().cycle()
return this.slide(pos>activeIndex?'next':'prev',$(this.$items[pos]))}
Carousel.prototype.pause=function(e){e||(this.paused=true)
if(this.$element.find('.next, .prev').length&&$.support.transition.end){this.$element.trigger($.support.transition.end)
this.cycle(true)}
this.interval=clearInterval(this.interval)
return this}
Carousel.prototype.next=function(){if(this.sliding)return
return this.slide('next')}
Carousel.prototype.prev=function(){if(this.sliding)return
return this.slide('prev')}
Carousel.prototype.slide=function(type,next){var $active=this.$element.find('.item.active')
var $next=next||$active[type]()
var isCycling=this.interval
var direction=type=='next'?'left':'right'
var fallback=type=='next'?'first':'last'
var that=this
if(!$next.length){if(!this.options.wrap)return
$next=this.$element.find('.item')[fallback]()}
this.sliding=true
isCycling&&this.pause()
var e=$.Event('slide.bs.carousel',{relatedTarget:$next[0],direction:direction})
if($next.hasClass('active'))return
if(this.$indicators.length){this.$indicators.find('.active').removeClass('active')
this.$element.one('slid.bs.carousel',function(){var $nextIndicator=$(that.$indicators.children()[that.getActiveIndex()])
$nextIndicator&&$nextIndicator.addClass('active')})}
if($.support.transition&&this.$element.hasClass('slide')){this.$element.trigger(e)
if(e.isDefaultPrevented())return
$next.addClass(type)
$next[0].offsetWidth
$active.addClass(direction)
$next.addClass(direction)
$active.one($.support.transition.end,function(){$next.removeClass([type,direction].join(' ')).addClass('active')
$active.removeClass(['active',direction].join(' '))
that.sliding=false
setTimeout(function(){that.$element.trigger('slid.bs.carousel')},0)}).emulateTransitionEnd(600)}else{this.$element.trigger(e)
if(e.isDefaultPrevented())return
$active.removeClass('active')
$next.addClass('active')
this.sliding=false
this.$element.trigger('slid.bs.carousel')}
isCycling&&this.cycle()
return this}
var old=$.fn.carousel
$.fn.carousel=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.carousel')
var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=='object'&&option)
var action=typeof option=='string'?option:options.slide
if(!data)$this.data('bs.carousel',(data=new Carousel(this,options)))
if(typeof option=='number')data.to(option)
else if(action)data[action]()
else if(options.interval)data.pause().cycle()})}
$.fn.carousel.Constructor=Carousel
$.fn.carousel.noConflict=function(){$.fn.carousel=old
return this}
$(document).on('click.bs.carousel.data-api','[data-slide], [data-slide-to]',function(e){var $this=$(this),href
var $target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))
var options=$.extend({},$target.data(),$this.data())
var slideIndex=$this.attr('data-slide-to')
if(slideIndex)options.interval=false
$target.carousel(options)
if(slideIndex=$this.attr('data-slide-to')){$target.data('bs.carousel').to(slideIndex)}
e.preventDefault()})
$(window).on('load',function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this)
$carousel.carousel($carousel.data())})})}(jQuery);+function($){"use strict";var backdrop='.dropdown-backdrop'
var toggle='[data-toggle=dropdown]'
var Dropdown=function(element){$(element).on('click.bs.dropdown',this.toggle)}
Dropdown.prototype.toggle=function(e){var $this=$(this)
if($this.is('.disabled, :disabled'))return
var $parent=getParent($this)
var isActive=$parent.hasClass('open')
clearMenus()
if(!isActive){if('ontouchstart'in document.documentElement&&!$parent.closest('.navbar-nav').length){$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click',clearMenus)}
$parent.trigger(e=$.Event('show.bs.dropdown'))
if(e.isDefaultPrevented())return
$parent.toggleClass('open').trigger('shown.bs.dropdown')
$this.focus()}
return false}
Dropdown.prototype.keydown=function(e){if(!/(38|40|27)/.test(e.keyCode))return
var $this=$(this)
e.preventDefault()
e.stopPropagation()
if($this.is('.disabled, :disabled'))return
var $parent=getParent($this)
var isActive=$parent.hasClass('open')
if(!isActive||(isActive&&e.keyCode==27)){if(e.which==27)$parent.find(toggle).focus()
return $this.click()}
var $items=$('[role=menu] li:not(.divider):visible a',$parent)
if(!$items.length)return
var index=$items.index($items.filter(':focus'))
if(e.keyCode==38&&index>0)index--
if(e.keyCode==40&&index<$items.length-1)index++
if(!~index)index=0
$items.eq(index).focus()}
function clearMenus(){$(backdrop).remove()
$(toggle).each(function(e){var $parent=getParent($(this))
if(!$parent.hasClass('open'))return
$parent.trigger(e=$.Event('hide.bs.dropdown'))
if(e.isDefaultPrevented())return
$parent.removeClass('open').trigger('hidden.bs.dropdown')})}
function getParent($this){var selector=$this.attr('data-target')
if(!selector){selector=$this.attr('href')
selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,'')}
var $parent=selector&&$(selector)
return $parent&&$parent.length?$parent:$this.parent()}
var old=$.fn.dropdown
$.fn.dropdown=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.dropdown')
if(!data)$this.data('bs.dropdown',(data=new Dropdown(this)))
if(typeof option=='string')data[option].call($this)})}
$.fn.dropdown.Constructor=Dropdown
$.fn.dropdown.noConflict=function(){$.fn.dropdown=old
return this}
$(document).on('click.bs.dropdown.data-api',clearMenus).on('click.bs.dropdown.data-api','.dropdown form',function(e){e.stopPropagation()}).on('click.bs.dropdown.data-api',toggle,Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api',toggle+', [role=menu]',Dropdown.prototype.keydown)}(jQuery);+function($){"use strict";var Modal=function(element,options){this.options=options
this.$element=$(element)
this.$backdrop=this.isShown=null
if(this.options.remote)this.$element.load(this.options.remote)}
Modal.DEFAULTS={backdrop:true,keyboard:true,show:true}
Modal.prototype.toggle=function(_relatedTarget){return this[!this.isShown?'show':'hide'](_relatedTarget)}
Modal.prototype.show=function(_relatedTarget){var that=this
var e=$.Event('show.bs.modal',{relatedTarget:_relatedTarget})
this.$element.trigger(e)
if(this.isShown||e.isDefaultPrevented())return
this.isShown=true
this.escape()
this.$element.on('click.dismiss.modal','[data-dismiss="modal"]',$.proxy(this.hide,this))
this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass('fade')
if(!that.$element.parent().length){that.$element.appendTo(document.body)}
that.$element.show()
if(transition){that.$element[0].offsetWidth}
that.$element.addClass('in').attr('aria-hidden',false)
that.enforceFocus()
var e=$.Event('shown.bs.modal',{relatedTarget:_relatedTarget})
transition?that.$element.find('.modal-dialog').one($.support.transition.end,function(){that.$element.focus().trigger(e)}).emulateTransitionEnd(300):that.$element.focus().trigger(e)})}
Modal.prototype.hide=function(e){if(e)e.preventDefault()
e=$.Event('hide.bs.modal')
this.$element.trigger(e)
if(!this.isShown||e.isDefaultPrevented())return
this.isShown=false
this.escape()
$(document).off('focusin.bs.modal')
this.$element.removeClass('in').attr('aria-hidden',true).off('click.dismiss.modal')
$.support.transition&&this.$element.hasClass('fade')?this.$element.one($.support.transition.end,$.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()}
Modal.prototype.enforceFocus=function(){$(document).off('focusin.bs.modal').on('focusin.bs.modal',$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length){this.$element.focus()}},this))}
Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on('keyup.dismiss.bs.modal',$.proxy(function(e){e.which==27&&this.hide()},this))}else if(!this.isShown){this.$element.off('keyup.dismiss.bs.modal')}}
Modal.prototype.hideModal=function(){var that=this
this.$element.hide()
this.backdrop(function(){that.removeBackdrop()
that.$element.trigger('hidden.bs.modal')})}
Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove()
this.$backdrop=null}
Modal.prototype.backdrop=function(callback){var that=this
var animate=this.$element.hasClass('fade')?'fade':''
if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate
this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body)
this.$element.on('click.dismiss.modal',$.proxy(function(e){if(e.target!==e.currentTarget)return
this.options.backdrop=='static'?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this))
if(doAnimate)this.$backdrop[0].offsetWidth
this.$backdrop.addClass('in')
if(!callback)return
doAnimate?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in')
$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback()}else if(callback){callback()}}
var old=$.fn.modal
$.fn.modal=function(option,_relatedTarget){return this.each(function(){var $this=$(this)
var data=$this.data('bs.modal')
var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=='object'&&option)
if(!data)$this.data('bs.modal',(data=new Modal(this,options)))
if(typeof option=='string')data[option](_relatedTarget)
else if(options.show)data.show(_relatedTarget)})}
$.fn.modal.Constructor=Modal
$.fn.modal.noConflict=function(){$.fn.modal=old
return this}
$(document).on('click.bs.modal.data-api','[data-toggle="modal"]',function(e){var $this=$(this)
var href=$this.attr('href')
var $target=$($this.attr('data-target')||(href&&href.replace(/.*(?=#[^\s]+$)/,'')))
var option=$target.data('modal')?'toggle':$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data())
e.preventDefault()
$target.modal(option,this).one('hide',function(){$this.is(':visible')&&$this.focus()})})
$(document).on('show.bs.modal','.modal',function(){$(document.body).addClass('modal-open')}).on('hidden.bs.modal','.modal',function(){$(document.body).removeClass('modal-open')})}(jQuery);+function($){"use strict";var Tooltip=function(element,options){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null
this.init('tooltip',element,options)}
Tooltip.DEFAULTS={animation:true,placement:'top',selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:'hover focus',title:'',delay:0,html:false,container:false}
Tooltip.prototype.init=function(type,element,options){this.enabled=true
this.type=type
this.$element=$(element)
this.options=this.getOptions(options)
var triggers=this.options.trigger.split(' ')
for(var i=triggers.length;i--;){var trigger=triggers[i]
if(trigger=='click'){this.$element.on('click.'+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!='manual'){var eventIn=trigger=='hover'?'mouseenter':'focus'
var eventOut=trigger=='hover'?'mouseleave':'blur'
this.$element.on(eventIn+'.'+this.type,this.options.selector,$.proxy(this.enter,this))
this.$element.on(eventOut+'.'+this.type,this.options.selector,$.proxy(this.leave,this))}}
this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle()}
Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS}
Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options)
if(options.delay&&typeof options.delay=='number'){options.delay={show:options.delay,hide:options.delay}}
return options}
Tooltip.prototype.getDelegateOptions=function(){var options={}
var defaults=this.getDefaults()
this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value})
return options}
Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.'+this.type)
clearTimeout(self.timeout)
self.hoverState='in'
if(!self.options.delay||!self.options.delay.show)return self.show()
self.timeout=setTimeout(function(){if(self.hoverState=='in')self.show()},self.options.delay.show)}
Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.'+this.type)
clearTimeout(self.timeout)
self.hoverState='out'
if(!self.options.delay||!self.options.delay.hide)return self.hide()
self.timeout=setTimeout(function(){if(self.hoverState=='out')self.hide()},self.options.delay.hide)}
Tooltip.prototype.show=function(){var e=$.Event('show.bs.'+this.type)
if(this.hasContent()&&this.enabled){this.$element.trigger(e)
if(e.isDefaultPrevented())return
var $tip=this.tip()
this.setContent()
if(this.options.animation)$tip.addClass('fade')
var placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement
var autoToken=/\s?auto?\s?/i
var autoPlace=autoToken.test(placement)
if(autoPlace)placement=placement.replace(autoToken,'')||'top'
$tip.detach().css({top:0,left:0,display:'block'}).addClass(placement)
this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element)
var pos=this.getPosition()
var actualWidth=$tip[0].offsetWidth
var actualHeight=$tip[0].offsetHeight
if(autoPlace){var $parent=this.$element.parent()
var orgPlacement=placement
var docScroll=document.documentElement.scrollTop||document.body.scrollTop
var parentWidth=this.options.container=='body'?window.innerWidth:$parent.outerWidth()
var parentHeight=this.options.container=='body'?window.innerHeight:$parent.outerHeight()
var parentLeft=this.options.container=='body'?0:$parent.offset().left
placement=placement=='bottom'&&pos.top+pos.height+actualHeight-docScroll>parentHeight?'top':placement=='top'&&pos.top-docScroll-actualHeight<0?'bottom':placement=='right'&&pos.right+actualWidth>parentWidth?'left':placement=='left'&&pos.left-actualWidth<parentLeft?'right':placement
$tip.removeClass(orgPlacement).addClass(placement)}
var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight)
this.applyPlacement(calculatedOffset,placement)
this.$element.trigger('shown.bs.'+this.type)}}
Tooltip.prototype.applyPlacement=function(offset,placement){var replace
var $tip=this.tip()
var width=$tip[0].offsetWidth
var height=$tip[0].offsetHeight
var marginTop=parseInt($tip.css('margin-top'),10)
var marginLeft=parseInt($tip.css('margin-left'),10)
if(isNaN(marginTop))marginTop=0
if(isNaN(marginLeft))marginLeft=0
offset.top=offset.top+marginTop
offset.left=offset.left+marginLeft
$tip.offset(offset).addClass('in')
var actualWidth=$tip[0].offsetWidth
var actualHeight=$tip[0].offsetHeight
if(placement=='top'&&actualHeight!=height){replace=true
offset.top=offset.top+height-actualHeight}
if(/bottom|top/.test(placement)){var delta=0
if(offset.left<0){delta=offset.left*-2
offset.left=0
$tip.offset(offset)
actualWidth=$tip[0].offsetWidth
actualHeight=$tip[0].offsetHeight}
this.replaceArrow(delta-width+actualWidth,actualWidth,'left')}else{this.replaceArrow(actualHeight-height,actualHeight,'top')}
if(replace)$tip.offset(offset)}
Tooltip.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?(50*(1-delta/dimension)+"%"):'')}
Tooltip.prototype.setContent=function(){var $tip=this.tip()
var title=this.getTitle()
$tip.find('.tooltip-inner')[this.options.html?'html':'text'](title)
$tip.removeClass('fade in top bottom left right')}
Tooltip.prototype.hide=function(){var that=this
var $tip=this.tip()
var e=$.Event('hide.bs.'+this.type)
function complete(){if(that.hoverState!='in')$tip.detach()}
this.$element.trigger(e)
if(e.isDefaultPrevented())return
$tip.removeClass('in')
$.support.transition&&this.$tip.hasClass('fade')?$tip.one($.support.transition.end,complete).emulateTransitionEnd(150):complete()
this.$element.trigger('hidden.bs.'+this.type)
return this}
Tooltip.prototype.fixTitle=function(){var $e=this.$element
if($e.attr('title')||typeof($e.attr('data-original-title'))!='string'){$e.attr('data-original-title',$e.attr('title')||'').attr('title','')}}
Tooltip.prototype.hasContent=function(){return this.getTitle()}
Tooltip.prototype.getPosition=function(){var el=this.$element[0]
return $.extend({},(typeof el.getBoundingClientRect=='function')?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset())}
Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=='bottom'?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=='top'?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=='left'?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}
Tooltip.prototype.getTitle=function(){var title
var $e=this.$element
var o=this.options
title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title)
return title}
Tooltip.prototype.tip=function(){return this.$tip=this.$tip||$(this.options.template)}
Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find('.tooltip-arrow')}
Tooltip.prototype.validate=function(){if(!this.$element[0].parentNode){this.hide()
this.$element=null
this.options=null}}
Tooltip.prototype.enable=function(){this.enabled=true}
Tooltip.prototype.disable=function(){this.enabled=false}
Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled}
Tooltip.prototype.toggle=function(e){var self=e?$(e.currentTarget)[this.type](this.getDelegateOptions()).data('bs.'+this.type):this
self.tip().hasClass('in')?self.leave(self):self.enter(self)}
Tooltip.prototype.destroy=function(){this.hide().$element.off('.'+this.type).removeData('bs.'+this.type)}
var old=$.fn.tooltip
$.fn.tooltip=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.tooltip')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.tooltip',(data=new Tooltip(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.tooltip.Constructor=Tooltip
$.fn.tooltip.noConflict=function(){$.fn.tooltip=old
return this}}(jQuery);+function($){"use strict";var Popover=function(element,options){this.init('popover',element,options)}
if(!$.fn.tooltip)throw new Error('Popover requires tooltip.js')
Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:'right',trigger:'click',content:'',template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})
Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype)
Popover.prototype.constructor=Popover
Popover.prototype.getDefaults=function(){return Popover.DEFAULTS}
Popover.prototype.setContent=function(){var $tip=this.tip()
var title=this.getTitle()
var content=this.getContent()
$tip.find('.popover-title')[this.options.html?'html':'text'](title)
$tip.find('.popover-content')[this.options.html?'html':'text'](content)
$tip.removeClass('fade top bottom left right in')
if(!$tip.find('.popover-title').html())$tip.find('.popover-title').hide()}
Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()}
Popover.prototype.getContent=function(){var $e=this.$element
var o=this.options
return $e.attr('data-content')||(typeof o.content=='function'?o.content.call($e[0]):o.content)}
Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find('.arrow')}
Popover.prototype.tip=function(){if(!this.$tip)this.$tip=$(this.options.template)
return this.$tip}
var old=$.fn.popover
$.fn.popover=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.popover')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.popover',(data=new Popover(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.popover.Constructor=Popover
$.fn.popover.noConflict=function(){$.fn.popover=old
return this}}(jQuery);+function($){"use strict";var Tab=function(element){this.element=$(element)}
Tab.prototype.show=function(){var $this=this.element
var $ul=$this.closest('ul:not(.dropdown-menu)')
var selector=$this.data('target')
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
if($this.parent('li').hasClass('active'))return
var previous=$ul.find('.active:last a')[0]
var e=$.Event('show.bs.tab',{relatedTarget:previous})
$this.trigger(e)
if(e.isDefaultPrevented())return
var $target=$(selector)
this.activate($this.parent('li'),$ul)
this.activate($target,$target.parent(),function(){$this.trigger({type:'shown.bs.tab',relatedTarget:previous})})}
Tab.prototype.activate=function(element,container,callback){var $active=container.find('> .active')
var transition=callback&&$.support.transition&&$active.hasClass('fade')
function next(){$active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active')
element.addClass('active')
if(transition){element[0].offsetWidth
element.addClass('in')}else{element.removeClass('fade')}
if(element.parent('.dropdown-menu')){element.closest('li.dropdown').addClass('active')}
callback&&callback()}
transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next()
$active.removeClass('in')}
var old=$.fn.tab
$.fn.tab=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.tab')
if(!data)$this.data('bs.tab',(data=new Tab(this)))
if(typeof option=='string')data[option]()})}
$.fn.tab.Constructor=Tab
$.fn.tab.noConflict=function(){$.fn.tab=old
return this}
$(document).on('click.bs.tab.data-api','[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault()
$(this).tab('show')})}(jQuery);+function($){"use strict";var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options)
this.$window=$(window).on('scroll.bs.affix.data-api',$.proxy(this.checkPosition,this)).on('click.bs.affix.data-api',$.proxy(this.checkPositionWithEventLoop,this))
this.$element=$(element)
this.affixed=this.unpin=null
this.checkPosition()}
Affix.RESET='affix affix-top affix-bottom'
Affix.DEFAULTS={offset:0}
Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1)}
Affix.prototype.checkPosition=function(){if(!this.$element.is(':visible'))return
var scrollHeight=$(document).height()
var scrollTop=this.$window.scrollTop()
var position=this.$element.offset()
var offset=this.options.offset
var offsetTop=offset.top
var offsetBottom=offset.bottom
if(typeof offset!='object')offsetBottom=offsetTop=offset
if(typeof offsetTop=='function')offsetTop=offset.top()
if(typeof offsetBottom=='function')offsetBottom=offset.bottom()
var affix=this.unpin!=null&&(scrollTop+this.unpin<=position.top)?false:offsetBottom!=null&&(position.top+this.$element.height()>=scrollHeight-offsetBottom)?'bottom':offsetTop!=null&&(scrollTop<=offsetTop)?'top':false
if(this.affixed===affix)return
if(this.unpin)this.$element.css('top','')
this.affixed=affix
this.unpin=affix=='bottom'?position.top-scrollTop:null
this.$element.removeClass(Affix.RESET).addClass('affix'+(affix?'-'+affix:''))
if(affix=='bottom'){this.$element.offset({top:document.body.offsetHeight-offsetBottom-this.$element.height()})}}
var old=$.fn.affix
$.fn.affix=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.affix')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.affix',(data=new Affix(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.affix.Constructor=Affix
$.fn.affix.noConflict=function(){$.fn.affix=old
return this}
$(window).on('load',function(){$('[data-spy="affix"]').each(function(){var $spy=$(this)
var data=$spy.data()
data.offset=data.offset||{}
if(data.offsetBottom)data.offset.bottom=data.offsetBottom
if(data.offsetTop)data.offset.top=data.offsetTop
$spy.affix(data)})})}(jQuery);+function($){"use strict";var Collapse=function(element,options){this.$element=$(element)
this.options=$.extend({},Collapse.DEFAULTS,options)
this.transitioning=null
if(this.options.parent)this.$parent=$(this.options.parent)
if(this.options.toggle)this.toggle()}
Collapse.DEFAULTS={toggle:true}
Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass('width')
return hasWidth?'width':'height'}
Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass('in'))return
var startEvent=$.Event('show.bs.collapse')
this.$element.trigger(startEvent)
if(startEvent.isDefaultPrevented())return
var actives=this.$parent&&this.$parent.find('> .panel > .in')
if(actives&&actives.length){var hasData=actives.data('bs.collapse')
if(hasData&&hasData.transitioning)return
actives.collapse('hide')
hasData||actives.data('bs.collapse',null)}
var dimension=this.dimension()
this.$element.removeClass('collapse').addClass('collapsing')
[dimension](0)
this.transitioning=1
var complete=function(){this.$element.removeClass('collapsing').addClass('in')
[dimension]('auto')
this.transitioning=0
this.$element.trigger('shown.bs.collapse')}
if(!$.support.transition)return complete.call(this)
var scrollSize=$.camelCase(['scroll',dimension].join('-'))
this.$element.one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)
[dimension](this.$element[0][scrollSize])}
Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass('in'))return
var startEvent=$.Event('hide.bs.collapse')
this.$element.trigger(startEvent)
if(startEvent.isDefaultPrevented())return
var dimension=this.dimension()
this.$element
[dimension](this.$element[dimension]())
[0].offsetHeight
this.$element.addClass('collapsing').removeClass('collapse').removeClass('in')
this.transitioning=1
var complete=function(){this.transitioning=0
this.$element.trigger('hidden.bs.collapse').removeClass('collapsing').addClass('collapse')}
if(!$.support.transition)return complete.call(this)
this.$element
[dimension](0).one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)}
Collapse.prototype.toggle=function(){this[this.$element.hasClass('in')?'hide':'show']()}
var old=$.fn.collapse
$.fn.collapse=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.collapse')
var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=='object'&&option)
if(!data)$this.data('bs.collapse',(data=new Collapse(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.collapse.Constructor=Collapse
$.fn.collapse.noConflict=function(){$.fn.collapse=old
return this}
$(document).on('click.bs.collapse.data-api','[data-toggle=collapse]',function(e){var $this=$(this),href
var target=$this.attr('data-target')||e.preventDefault()||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,'')
var $target=$(target)
var data=$target.data('bs.collapse')
var option=data?'toggle':$this.data()
var parent=$this.attr('data-parent')
var $parent=parent&&$(parent)
if(!data||!data.transitioning){if($parent)$parent.find('[data-toggle=collapse][data-parent="'+parent+'"]').not($this).addClass('collapsed')
$this[$target.hasClass('in')?'addClass':'removeClass']('collapsed')}
$target.collapse(option)})}(jQuery);+function($){"use strict";function ScrollSpy(element,options){var href
var process=$.proxy(this.process,this)
this.$element=$(element).is('body')?$(window):$(element)
this.$body=$('body')
this.$scrollElement=this.$element.on('scroll.bs.scroll-spy.data-api',process)
this.options=$.extend({},ScrollSpy.DEFAULTS,options)
this.selector=(this.options.target||((href=$(element).attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))||'')+' .nav li > a'
this.offsets=$([])
this.targets=$([])
this.activeTarget=null
this.refresh()
this.process()}
ScrollSpy.DEFAULTS={offset:10}
ScrollSpy.prototype.refresh=function(){var offsetMethod=this.$element[0]==window?'offset':'position'
this.offsets=$([])
this.targets=$([])
var self=this
var $targets=this.$body.find(this.selector).map(function(){var $el=$(this)
var href=$el.data('target')||$el.attr('href')
var $href=/^#\w/.test(href)&&$(href)
return($href&&$href.length&&[[$href[offsetMethod]().top+(!$.isWindow(self.$scrollElement.get(0))&&self.$scrollElement.scrollTop()),href]])||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){self.offsets.push(this[0])
self.targets.push(this[1])})}
ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset
var scrollHeight=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight
var maxScroll=scrollHeight-this.$scrollElement.height()
var offsets=this.offsets
var targets=this.targets
var activeTarget=this.activeTarget
var i
if(scrollTop>=maxScroll){return activeTarget!=(i=targets.last()[0])&&this.activate(i)}
for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i])}}
ScrollSpy.prototype.activate=function(target){this.activeTarget=target
$(this.selector).parents('.active').removeClass('active')
var selector=this.selector
+'[data-target="'+target+'"],'
+this.selector+'[href="'+target+'"]'
var active=$(selector).parents('li').addClass('active')
if(active.parent('.dropdown-menu').length){active=active.closest('li.dropdown').addClass('active')}
active.trigger('activate.bs.scrollspy')}
var old=$.fn.scrollspy
$.fn.scrollspy=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.scrollspy')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.scrollspy',(data=new ScrollSpy(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.scrollspy.Constructor=ScrollSpy
$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old
return this}
$(window).on('load',function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this)
$spy.scrollspy($spy.data())})})}(jQuery);+function($){"use strict";function transitionEnd(){var el=document.createElement('bootstrap')
var transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd otransitionend','transition':'transitionend'}
for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}}
$.fn.emulateTransitionEnd=function(duration){var called=false,$el=this
$(this).one($.support.transition.end,function(){called=true})
var callback=function(){if(!called)$($el).trigger($.support.transition.end)}
setTimeout(callback,duration)
return this}
$(function(){$.support.transition=transitionEnd()})}(jQuery);
/*
 * File:        jquery.dataTables.min.js
 * Version:     1.9.4
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * Info:        www.datatables.net
 * 
 * Copyright 2008-2012 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, available at:
 *   http://datatables.net/license_gpl2
 *   http://datatables.net/license_bsd
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
(function(X,l,n){var L=function(h){var j=function(e){function o(a,b){var c=j.defaults.columns,d=a.aoColumns.length,c=h.extend({},j.models.oColumn,c,{sSortingClass:a.oClasses.sSortable,sSortingClassJUI:a.oClasses.sSortJUI,nTh:b?b:l.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[d],mData:c.mData?c.oDefaults:d});a.aoColumns.push(c);if(a.aoPreSearchCols[d]===n||null===a.aoPreSearchCols[d])a.aoPreSearchCols[d]=h.extend({},j.models.oSearch);else if(c=a.aoPreSearchCols[d],
c.bRegex===n&&(c.bRegex=!0),c.bSmart===n&&(c.bSmart=!0),c.bCaseInsensitive===n)c.bCaseInsensitive=!0;m(a,d,null)}function m(a,b,c){var d=a.aoColumns[b];c!==n&&null!==c&&(c.mDataProp&&!c.mData&&(c.mData=c.mDataProp),c.sType!==n&&(d.sType=c.sType,d._bAutoType=!1),h.extend(d,c),p(d,c,"sWidth","sWidthOrig"),c.iDataSort!==n&&(d.aDataSort=[c.iDataSort]),p(d,c,"aDataSort"));var i=d.mRender?Q(d.mRender):null,f=Q(d.mData);d.fnGetData=function(a,b){var c=f(a,b);return d.mRender&&b&&""!==b?i(c,b,a):c};d.fnSetData=
L(d.mData);a.oFeatures.bSort||(d.bSortable=!1);!d.bSortable||-1==h.inArray("asc",d.asSorting)&&-1==h.inArray("desc",d.asSorting)?(d.sSortingClass=a.oClasses.sSortableNone,d.sSortingClassJUI=""):-1==h.inArray("asc",d.asSorting)&&-1==h.inArray("desc",d.asSorting)?(d.sSortingClass=a.oClasses.sSortable,d.sSortingClassJUI=a.oClasses.sSortJUI):-1!=h.inArray("asc",d.asSorting)&&-1==h.inArray("desc",d.asSorting)?(d.sSortingClass=a.oClasses.sSortableAsc,d.sSortingClassJUI=a.oClasses.sSortJUIAscAllowed):-1==
h.inArray("asc",d.asSorting)&&-1!=h.inArray("desc",d.asSorting)&&(d.sSortingClass=a.oClasses.sSortableDesc,d.sSortingClassJUI=a.oClasses.sSortJUIDescAllowed)}function k(a){if(!1===a.oFeatures.bAutoWidth)return!1;da(a);for(var b=0,c=a.aoColumns.length;b<c;b++)a.aoColumns[b].nTh.style.width=a.aoColumns[b].sWidth}function G(a,b){var c=r(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function R(a,b){var c=r(a,"bVisible"),c=h.inArray(b,c);return-1!==c?c:null}function t(a){return r(a,"bVisible").length}
function r(a,b){var c=[];h.map(a.aoColumns,function(a,i){a[b]&&c.push(i)});return c}function B(a){for(var b=j.ext.aTypes,c=b.length,d=0;d<c;d++){var i=b[d](a);if(null!==i)return i}return"string"}function u(a,b){for(var c=b.split(","),d=[],i=0,f=a.aoColumns.length;i<f;i++)for(var g=0;g<f;g++)if(a.aoColumns[i].sName==c[g]){d.push(g);break}return d}function M(a){for(var b="",c=0,d=a.aoColumns.length;c<d;c++)b+=a.aoColumns[c].sName+",";return b.length==d?"":b.slice(0,-1)}function ta(a,b,c,d){var i,f,
g,e,w;if(b)for(i=b.length-1;0<=i;i--){var j=b[i].aTargets;h.isArray(j)||D(a,1,"aTargets must be an array of targets, not a "+typeof j);f=0;for(g=j.length;f<g;f++)if("number"===typeof j[f]&&0<=j[f]){for(;a.aoColumns.length<=j[f];)o(a);d(j[f],b[i])}else if("number"===typeof j[f]&&0>j[f])d(a.aoColumns.length+j[f],b[i]);else if("string"===typeof j[f]){e=0;for(w=a.aoColumns.length;e<w;e++)("_all"==j[f]||h(a.aoColumns[e].nTh).hasClass(j[f]))&&d(e,b[i])}}if(c){i=0;for(a=c.length;i<a;i++)d(i,c[i])}}function H(a,
b){var c;c=h.isArray(b)?b.slice():h.extend(!0,{},b);var d=a.aoData.length,i=h.extend(!0,{},j.models.oRow);i._aData=c;a.aoData.push(i);for(var f,i=0,g=a.aoColumns.length;i<g;i++)c=a.aoColumns[i],"function"===typeof c.fnRender&&c.bUseRendered&&null!==c.mData?F(a,d,i,S(a,d,i)):F(a,d,i,v(a,d,i)),c._bAutoType&&"string"!=c.sType&&(f=v(a,d,i,"type"),null!==f&&""!==f&&(f=B(f),null===c.sType?c.sType=f:c.sType!=f&&"html"!=c.sType&&(c.sType="string")));a.aiDisplayMaster.push(d);a.oFeatures.bDeferRender||ea(a,
d);return d}function ua(a){var b,c,d,i,f,g,e;if(a.bDeferLoading||null===a.sAjaxSource)for(b=a.nTBody.firstChild;b;){if("TR"==b.nodeName.toUpperCase()){c=a.aoData.length;b._DT_RowIndex=c;a.aoData.push(h.extend(!0,{},j.models.oRow,{nTr:b}));a.aiDisplayMaster.push(c);f=b.firstChild;for(d=0;f;){g=f.nodeName.toUpperCase();if("TD"==g||"TH"==g)F(a,c,d,h.trim(f.innerHTML)),d++;f=f.nextSibling}}b=b.nextSibling}i=T(a);d=[];b=0;for(c=i.length;b<c;b++)for(f=i[b].firstChild;f;)g=f.nodeName.toUpperCase(),("TD"==
g||"TH"==g)&&d.push(f),f=f.nextSibling;c=0;for(i=a.aoColumns.length;c<i;c++){e=a.aoColumns[c];null===e.sTitle&&(e.sTitle=e.nTh.innerHTML);var w=e._bAutoType,o="function"===typeof e.fnRender,k=null!==e.sClass,n=e.bVisible,m,p;if(w||o||k||!n){g=0;for(b=a.aoData.length;g<b;g++)f=a.aoData[g],m=d[g*i+c],w&&"string"!=e.sType&&(p=v(a,g,c,"type"),""!==p&&(p=B(p),null===e.sType?e.sType=p:e.sType!=p&&"html"!=e.sType&&(e.sType="string"))),e.mRender?m.innerHTML=v(a,g,c,"display"):e.mData!==c&&(m.innerHTML=v(a,
g,c,"display")),o&&(p=S(a,g,c),m.innerHTML=p,e.bUseRendered&&F(a,g,c,p)),k&&(m.className+=" "+e.sClass),n?f._anHidden[c]=null:(f._anHidden[c]=m,m.parentNode.removeChild(m)),e.fnCreatedCell&&e.fnCreatedCell.call(a.oInstance,m,v(a,g,c,"display"),f._aData,g,c)}}if(0!==a.aoRowCreatedCallback.length){b=0;for(c=a.aoData.length;b<c;b++)f=a.aoData[b],A(a,"aoRowCreatedCallback",null,[f.nTr,f._aData,b])}}function I(a,b){return b._DT_RowIndex!==n?b._DT_RowIndex:null}function fa(a,b,c){for(var b=J(a,b),d=0,a=
a.aoColumns.length;d<a;d++)if(b[d]===c)return d;return-1}function Y(a,b,c,d){for(var i=[],f=0,g=d.length;f<g;f++)i.push(v(a,b,d[f],c));return i}function v(a,b,c,d){var i=a.aoColumns[c];if((c=i.fnGetData(a.aoData[b]._aData,d))===n)return a.iDrawError!=a.iDraw&&null===i.sDefaultContent&&(D(a,0,"Requested unknown parameter "+("function"==typeof i.mData?"{mData function}":"'"+i.mData+"'")+" from the data source for row "+b),a.iDrawError=a.iDraw),i.sDefaultContent;if(null===c&&null!==i.sDefaultContent)c=
i.sDefaultContent;else if("function"===typeof c)return c();return"display"==d&&null===c?"":c}function F(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d)}function Q(a){if(null===a)return function(){return null};if("function"===typeof a)return function(b,d,i){return a(b,d,i)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("["))){var b=function(a,d,i){var f=i.split("."),g;if(""!==i){var e=0;for(g=f.length;e<g;e++){if(i=f[e].match(U)){f[e]=f[e].replace(U,"");""!==f[e]&&(a=a[f[e]]);
g=[];f.splice(0,e+1);for(var f=f.join("."),e=0,h=a.length;e<h;e++)g.push(b(a[e],d,f));a=i[0].substring(1,i[0].length-1);a=""===a?g:g.join(a);break}if(null===a||a[f[e]]===n)return n;a=a[f[e]]}}return a};return function(c,d){return b(c,d,a)}}return function(b){return b[a]}}function L(a){if(null===a)return function(){};if("function"===typeof a)return function(b,d){a(b,"set",d)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("["))){var b=function(a,d,i){var i=i.split("."),f,g,e=0;for(g=
i.length-1;e<g;e++){if(f=i[e].match(U)){i[e]=i[e].replace(U,"");a[i[e]]=[];f=i.slice();f.splice(0,e+1);g=f.join(".");for(var h=0,j=d.length;h<j;h++)f={},b(f,d[h],g),a[i[e]].push(f);return}if(null===a[i[e]]||a[i[e]]===n)a[i[e]]={};a=a[i[e]]}a[i[i.length-1].replace(U,"")]=d};return function(c,d){return b(c,d,a)}}return function(b,d){b[a]=d}}function Z(a){for(var b=[],c=a.aoData.length,d=0;d<c;d++)b.push(a.aoData[d]._aData);return b}function ga(a){a.aoData.splice(0,a.aoData.length);a.aiDisplayMaster.splice(0,
a.aiDisplayMaster.length);a.aiDisplay.splice(0,a.aiDisplay.length);y(a)}function ha(a,b){for(var c=-1,d=0,i=a.length;d<i;d++)a[d]==b?c=d:a[d]>b&&a[d]--; -1!=c&&a.splice(c,1)}function S(a,b,c){var d=a.aoColumns[c];return d.fnRender({iDataRow:b,iDataColumn:c,oSettings:a,aData:a.aoData[b]._aData,mDataProp:d.mData},v(a,b,c,"display"))}function ea(a,b){var c=a.aoData[b],d;if(null===c.nTr){c.nTr=l.createElement("tr");c.nTr._DT_RowIndex=b;c._aData.DT_RowId&&(c.nTr.id=c._aData.DT_RowId);c._aData.DT_RowClass&&
(c.nTr.className=c._aData.DT_RowClass);for(var i=0,f=a.aoColumns.length;i<f;i++){var g=a.aoColumns[i];d=l.createElement(g.sCellType);d.innerHTML="function"===typeof g.fnRender&&(!g.bUseRendered||null===g.mData)?S(a,b,i):v(a,b,i,"display");null!==g.sClass&&(d.className=g.sClass);g.bVisible?(c.nTr.appendChild(d),c._anHidden[i]=null):c._anHidden[i]=d;g.fnCreatedCell&&g.fnCreatedCell.call(a.oInstance,d,v(a,b,i,"display"),c._aData,b,i)}A(a,"aoRowCreatedCallback",null,[c.nTr,c._aData,b])}}function va(a){var b,
c,d;if(0!==h("th, td",a.nTHead).length){b=0;for(d=a.aoColumns.length;b<d;b++)if(c=a.aoColumns[b].nTh,c.setAttribute("role","columnheader"),a.aoColumns[b].bSortable&&(c.setAttribute("tabindex",a.iTabIndex),c.setAttribute("aria-controls",a.sTableId)),null!==a.aoColumns[b].sClass&&h(c).addClass(a.aoColumns[b].sClass),a.aoColumns[b].sTitle!=c.innerHTML)c.innerHTML=a.aoColumns[b].sTitle}else{var i=l.createElement("tr");b=0;for(d=a.aoColumns.length;b<d;b++)c=a.aoColumns[b].nTh,c.innerHTML=a.aoColumns[b].sTitle,
c.setAttribute("tabindex","0"),null!==a.aoColumns[b].sClass&&h(c).addClass(a.aoColumns[b].sClass),i.appendChild(c);h(a.nTHead).html("")[0].appendChild(i);V(a.aoHeader,a.nTHead)}h(a.nTHead).children("tr").attr("role","row");if(a.bJUI){b=0;for(d=a.aoColumns.length;b<d;b++){c=a.aoColumns[b].nTh;i=l.createElement("div");i.className=a.oClasses.sSortJUIWrapper;h(c).contents().appendTo(i);var f=l.createElement("span");f.className=a.oClasses.sSortIcon;i.appendChild(f);c.appendChild(i)}}if(a.oFeatures.bSort)for(b=
0;b<a.aoColumns.length;b++)!1!==a.aoColumns[b].bSortable?ia(a,a.aoColumns[b].nTh,b):h(a.aoColumns[b].nTh).addClass(a.oClasses.sSortableNone);""!==a.oClasses.sFooterTH&&h(a.nTFoot).children("tr").children("th").addClass(a.oClasses.sFooterTH);if(null!==a.nTFoot){c=N(a,null,a.aoFooter);b=0;for(d=a.aoColumns.length;b<d;b++)c[b]&&(a.aoColumns[b].nTf=c[b],a.aoColumns[b].sClass&&h(c[b]).addClass(a.aoColumns[b].sClass))}}function W(a,b,c){var d,i,f,g=[],e=[],h=a.aoColumns.length,j;c===n&&(c=!1);d=0;for(i=
b.length;d<i;d++){g[d]=b[d].slice();g[d].nTr=b[d].nTr;for(f=h-1;0<=f;f--)!a.aoColumns[f].bVisible&&!c&&g[d].splice(f,1);e.push([])}d=0;for(i=g.length;d<i;d++){if(a=g[d].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(b=g[d].length;f<b;f++)if(j=h=1,e[d][f]===n){a.appendChild(g[d][f].cell);for(e[d][f]=1;g[d+h]!==n&&g[d][f].cell==g[d+h][f].cell;)e[d+h][f]=1,h++;for(;g[d][f+j]!==n&&g[d][f].cell==g[d][f+j].cell;){for(c=0;c<h;c++)e[d+c][f+j]=1;j++}g[d][f].cell.rowSpan=h;g[d][f].cell.colSpan=j}}}function x(a){var b=
A(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==h.inArray(!1,b))E(a,!1);else{var c,d,b=[],i=0,f=a.asStripeClasses.length;c=a.aoOpenRows.length;a.bDrawing=!0;a.iInitDisplayStart!==n&&-1!=a.iInitDisplayStart&&(a._iDisplayStart=a.oFeatures.bServerSide?a.iInitDisplayStart:a.iInitDisplayStart>=a.fnRecordsDisplay()?0:a.iInitDisplayStart,a.iInitDisplayStart=-1,y(a));if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++;else if(a.oFeatures.bServerSide){if(!a.bDestroying&&!wa(a))return}else a.iDraw++;if(0!==a.aiDisplay.length){var g=
a._iDisplayStart;d=a._iDisplayEnd;a.oFeatures.bServerSide&&(g=0,d=a.aoData.length);for(;g<d;g++){var e=a.aoData[a.aiDisplay[g]];null===e.nTr&&ea(a,a.aiDisplay[g]);var j=e.nTr;if(0!==f){var o=a.asStripeClasses[i%f];e._sRowStripe!=o&&(h(j).removeClass(e._sRowStripe).addClass(o),e._sRowStripe=o)}A(a,"aoRowCallback",null,[j,a.aoData[a.aiDisplay[g]]._aData,i,g]);b.push(j);i++;if(0!==c)for(e=0;e<c;e++)if(j==a.aoOpenRows[e].nParent){b.push(a.aoOpenRows[e].nTr);break}}}else b[0]=l.createElement("tr"),a.asStripeClasses[0]&&
(b[0].className=a.asStripeClasses[0]),c=a.oLanguage,f=c.sZeroRecords,1==a.iDraw&&null!==a.sAjaxSource&&!a.oFeatures.bServerSide?f=c.sLoadingRecords:c.sEmptyTable&&0===a.fnRecordsTotal()&&(f=c.sEmptyTable),c=l.createElement("td"),c.setAttribute("valign","top"),c.colSpan=t(a),c.className=a.oClasses.sRowEmpty,c.innerHTML=ja(a,f),b[i].appendChild(c);A(a,"aoHeaderCallback","header",[h(a.nTHead).children("tr")[0],Z(a),a._iDisplayStart,a.fnDisplayEnd(),a.aiDisplay]);A(a,"aoFooterCallback","footer",[h(a.nTFoot).children("tr")[0],
Z(a),a._iDisplayStart,a.fnDisplayEnd(),a.aiDisplay]);i=l.createDocumentFragment();c=l.createDocumentFragment();if(a.nTBody){f=a.nTBody.parentNode;c.appendChild(a.nTBody);if(!a.oScroll.bInfinite||!a._bInitComplete||a.bSorted||a.bFiltered)for(;c=a.nTBody.firstChild;)a.nTBody.removeChild(c);c=0;for(d=b.length;c<d;c++)i.appendChild(b[c]);a.nTBody.appendChild(i);null!==f&&f.appendChild(a.nTBody)}A(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1;a.oFeatures.bServerSide&&(E(a,!1),
a._bInitComplete||$(a))}}function aa(a){a.oFeatures.bSort?O(a,a.oPreviousSearch):a.oFeatures.bFilter?K(a,a.oPreviousSearch):(y(a),x(a))}function xa(a){var b=h("<div></div>")[0];a.nTable.parentNode.insertBefore(b,a.nTable);a.nTableWrapper=h('<div id="'+a.sTableId+'_wrapper" class="'+a.oClasses.sWrapper+'" role="grid"></div>')[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var c=a.nTableWrapper,d=a.sDom.split(""),i,f,g,e,w,o,k,m=0;m<d.length;m++){f=0;g=d[m];if("<"==g){e=h("<div></div>")[0];w=d[m+
1];if("'"==w||'"'==w){o="";for(k=2;d[m+k]!=w;)o+=d[m+k],k++;"H"==o?o=a.oClasses.sJUIHeader:"F"==o&&(o=a.oClasses.sJUIFooter);-1!=o.indexOf(".")?(w=o.split("."),e.id=w[0].substr(1,w[0].length-1),e.className=w[1]):"#"==o.charAt(0)?e.id=o.substr(1,o.length-1):e.className=o;m+=k}c.appendChild(e);c=e}else if(">"==g)c=c.parentNode;else if("l"==g&&a.oFeatures.bPaginate&&a.oFeatures.bLengthChange)i=ya(a),f=1;else if("f"==g&&a.oFeatures.bFilter)i=za(a),f=1;else if("r"==g&&a.oFeatures.bProcessing)i=Aa(a),f=
1;else if("t"==g)i=Ba(a),f=1;else if("i"==g&&a.oFeatures.bInfo)i=Ca(a),f=1;else if("p"==g&&a.oFeatures.bPaginate)i=Da(a),f=1;else if(0!==j.ext.aoFeatures.length){e=j.ext.aoFeatures;k=0;for(w=e.length;k<w;k++)if(g==e[k].cFeature){(i=e[k].fnInit(a))&&(f=1);break}}1==f&&null!==i&&("object"!==typeof a.aanFeatures[g]&&(a.aanFeatures[g]=[]),a.aanFeatures[g].push(i),c.appendChild(i))}b.parentNode.replaceChild(a.nTableWrapper,b)}function V(a,b){var c=h(b).children("tr"),d,i,f,g,e,j,o,k,m,p;a.splice(0,a.length);
f=0;for(j=c.length;f<j;f++)a.push([]);f=0;for(j=c.length;f<j;f++){d=c[f];for(i=d.firstChild;i;){if("TD"==i.nodeName.toUpperCase()||"TH"==i.nodeName.toUpperCase()){k=1*i.getAttribute("colspan");m=1*i.getAttribute("rowspan");k=!k||0===k||1===k?1:k;m=!m||0===m||1===m?1:m;g=0;for(e=a[f];e[g];)g++;o=g;p=1===k?!0:!1;for(e=0;e<k;e++)for(g=0;g<m;g++)a[f+g][o+e]={cell:i,unique:p},a[f+g].nTr=d}i=i.nextSibling}}}function N(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],V(c,b)));for(var b=0,i=c.length;b<i;b++)for(var f=
0,g=c[b].length;f<g;f++)if(c[b][f].unique&&(!d[f]||!a.bSortCellsTop))d[f]=c[b][f].cell;return d}function wa(a){if(a.bAjaxDataGet){a.iDraw++;E(a,!0);var b=Ea(a);ka(a,b);a.fnServerData.call(a.oInstance,a.sAjaxSource,b,function(b){Fa(a,b)},a);return!1}return!0}function Ea(a){var b=a.aoColumns.length,c=[],d,i,f,g;c.push({name:"sEcho",value:a.iDraw});c.push({name:"iColumns",value:b});c.push({name:"sColumns",value:M(a)});c.push({name:"iDisplayStart",value:a._iDisplayStart});c.push({name:"iDisplayLength",
value:!1!==a.oFeatures.bPaginate?a._iDisplayLength:-1});for(f=0;f<b;f++)d=a.aoColumns[f].mData,c.push({name:"mDataProp_"+f,value:"function"===typeof d?"function":d});if(!1!==a.oFeatures.bFilter){c.push({name:"sSearch",value:a.oPreviousSearch.sSearch});c.push({name:"bRegex",value:a.oPreviousSearch.bRegex});for(f=0;f<b;f++)c.push({name:"sSearch_"+f,value:a.aoPreSearchCols[f].sSearch}),c.push({name:"bRegex_"+f,value:a.aoPreSearchCols[f].bRegex}),c.push({name:"bSearchable_"+f,value:a.aoColumns[f].bSearchable})}if(!1!==
a.oFeatures.bSort){var e=0;d=null!==a.aaSortingFixed?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(f=0;f<d.length;f++){i=a.aoColumns[d[f][0]].aDataSort;for(g=0;g<i.length;g++)c.push({name:"iSortCol_"+e,value:i[g]}),c.push({name:"sSortDir_"+e,value:d[f][1]}),e++}c.push({name:"iSortingCols",value:e});for(f=0;f<b;f++)c.push({name:"bSortable_"+f,value:a.aoColumns[f].bSortable})}return c}function ka(a,b){A(a,"aoServerParams","serverParams",[b])}function Fa(a,b){if(b.sEcho!==n){if(1*b.sEcho<
a.iDraw)return;a.iDraw=1*b.sEcho}(!a.oScroll.bInfinite||a.oScroll.bInfinite&&(a.bSorted||a.bFiltered))&&ga(a);a._iRecordsTotal=parseInt(b.iTotalRecords,10);a._iRecordsDisplay=parseInt(b.iTotalDisplayRecords,10);var c=M(a),c=b.sColumns!==n&&""!==c&&b.sColumns!=c,d;c&&(d=u(a,b.sColumns));for(var i=Q(a.sAjaxDataProp)(b),f=0,g=i.length;f<g;f++)if(c){for(var e=[],h=0,j=a.aoColumns.length;h<j;h++)e.push(i[f][d[h]]);H(a,e)}else H(a,i[f]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;x(a);a.bAjaxDataGet=
!0;E(a,!1)}function za(a){var b=a.oPreviousSearch,c=a.oLanguage.sSearch,c=-1!==c.indexOf("_INPUT_")?c.replace("_INPUT_",'<input type="text" />'):""===c?'<input type="text" />':c+' <input type="text" />',d=l.createElement("div");d.className=a.oClasses.sFilter;d.innerHTML="<label>"+c+"</label>";a.aanFeatures.f||(d.id=a.sTableId+"_filter");c=h('input[type="text"]',d);d._DT_Input=c[0];c.val(b.sSearch.replace('"',"&quot;"));c.bind("keyup.DT",function(){for(var c=a.aanFeatures.f,d=this.value===""?"":this.value,
g=0,e=c.length;g<e;g++)c[g]!=h(this).parents("div.dataTables_filter")[0]&&h(c[g]._DT_Input).val(d);d!=b.sSearch&&K(a,{sSearch:d,bRegex:b.bRegex,bSmart:b.bSmart,bCaseInsensitive:b.bCaseInsensitive})});c.attr("aria-controls",a.sTableId).bind("keypress.DT",function(a){if(a.keyCode==13)return false});return d}function K(a,b,c){var d=a.oPreviousSearch,i=a.aoPreSearchCols,f=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive};if(a.oFeatures.bServerSide)f(b);
else{Ga(a,b.sSearch,c,b.bRegex,b.bSmart,b.bCaseInsensitive);f(b);for(b=0;b<a.aoPreSearchCols.length;b++)Ha(a,i[b].sSearch,b,i[b].bRegex,i[b].bSmart,i[b].bCaseInsensitive);Ia(a)}a.bFiltered=!0;h(a.oInstance).trigger("filter",a);a._iDisplayStart=0;y(a);x(a);la(a,0)}function Ia(a){for(var b=j.ext.afnFiltering,c=r(a,"bSearchable"),d=0,i=b.length;d<i;d++)for(var f=0,g=0,e=a.aiDisplay.length;g<e;g++){var h=a.aiDisplay[g-f];b[d](a,Y(a,h,"filter",c),h)||(a.aiDisplay.splice(g-f,1),f++)}}function Ha(a,b,c,
d,i,f){if(""!==b)for(var g=0,b=ma(b,d,i,f),d=a.aiDisplay.length-1;0<=d;d--)i=Ja(v(a,a.aiDisplay[d],c,"filter"),a.aoColumns[c].sType),b.test(i)||(a.aiDisplay.splice(d,1),g++)}function Ga(a,b,c,d,i,f){d=ma(b,d,i,f);i=a.oPreviousSearch;c||(c=0);0!==j.ext.afnFiltering.length&&(c=1);if(0>=b.length)a.aiDisplay.splice(0,a.aiDisplay.length),a.aiDisplay=a.aiDisplayMaster.slice();else if(a.aiDisplay.length==a.aiDisplayMaster.length||i.sSearch.length>b.length||1==c||0!==b.indexOf(i.sSearch)){a.aiDisplay.splice(0,
a.aiDisplay.length);la(a,1);for(b=0;b<a.aiDisplayMaster.length;b++)d.test(a.asDataSearch[b])&&a.aiDisplay.push(a.aiDisplayMaster[b])}else for(b=c=0;b<a.asDataSearch.length;b++)d.test(a.asDataSearch[b])||(a.aiDisplay.splice(b-c,1),c++)}function la(a,b){if(!a.oFeatures.bServerSide){a.asDataSearch=[];for(var c=r(a,"bSearchable"),d=1===b?a.aiDisplayMaster:a.aiDisplay,i=0,f=d.length;i<f;i++)a.asDataSearch[i]=na(a,Y(a,d[i],"filter",c))}}function na(a,b){var c=b.join("  ");-1!==c.indexOf("&")&&(c=h("<div>").html(c).text());
return c.replace(/[\n\r]/g," ")}function ma(a,b,c,d){if(c)return a=b?a.split(" "):oa(a).split(" "),a="^(?=.*?"+a.join(")(?=.*?")+").*$",RegExp(a,d?"i":"");a=b?a:oa(a);return RegExp(a,d?"i":"")}function Ja(a,b){return"function"===typeof j.ext.ofnSearch[b]?j.ext.ofnSearch[b](a):null===a?"":"html"==b?a.replace(/[\r\n]/g," ").replace(/<.*?>/g,""):"string"===typeof a?a.replace(/[\r\n]/g," "):a}function oa(a){return a.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),
"\\$1")}function Ca(a){var b=l.createElement("div");b.className=a.oClasses.sInfo;a.aanFeatures.i||(a.aoDrawCallback.push({fn:Ka,sName:"information"}),b.id=a.sTableId+"_info");a.nTable.setAttribute("aria-describedby",a.sTableId+"_info");return b}function Ka(a){if(a.oFeatures.bInfo&&0!==a.aanFeatures.i.length){var b=a.oLanguage,c=a._iDisplayStart+1,d=a.fnDisplayEnd(),i=a.fnRecordsTotal(),f=a.fnRecordsDisplay(),g;g=0===f?b.sInfoEmpty:b.sInfo;f!=i&&(g+=" "+b.sInfoFiltered);g+=b.sInfoPostFix;g=ja(a,g);
null!==b.fnInfoCallback&&(g=b.fnInfoCallback.call(a.oInstance,a,c,d,i,f,g));a=a.aanFeatures.i;b=0;for(c=a.length;b<c;b++)h(a[b]).html(g)}}function ja(a,b){var c=a.fnFormatNumber(a._iDisplayStart+1),d=a.fnDisplayEnd(),d=a.fnFormatNumber(d),i=a.fnRecordsDisplay(),i=a.fnFormatNumber(i),f=a.fnRecordsTotal(),f=a.fnFormatNumber(f);a.oScroll.bInfinite&&(c=a.fnFormatNumber(1));return b.replace(/_START_/g,c).replace(/_END_/g,d).replace(/_TOTAL_/g,i).replace(/_MAX_/g,f)}function ba(a){var b,c,d=a.iInitDisplayStart;
if(!1===a.bInitialised)setTimeout(function(){ba(a)},200);else{xa(a);va(a);W(a,a.aoHeader);a.nTFoot&&W(a,a.aoFooter);E(a,!0);a.oFeatures.bAutoWidth&&da(a);b=0;for(c=a.aoColumns.length;b<c;b++)null!==a.aoColumns[b].sWidth&&(a.aoColumns[b].nTh.style.width=q(a.aoColumns[b].sWidth));a.oFeatures.bSort?O(a):a.oFeatures.bFilter?K(a,a.oPreviousSearch):(a.aiDisplay=a.aiDisplayMaster.slice(),y(a),x(a));null!==a.sAjaxSource&&!a.oFeatures.bServerSide?(c=[],ka(a,c),a.fnServerData.call(a.oInstance,a.sAjaxSource,
c,function(c){var f=a.sAjaxDataProp!==""?Q(a.sAjaxDataProp)(c):c;for(b=0;b<f.length;b++)H(a,f[b]);a.iInitDisplayStart=d;if(a.oFeatures.bSort)O(a);else{a.aiDisplay=a.aiDisplayMaster.slice();y(a);x(a)}E(a,false);$(a,c)},a)):a.oFeatures.bServerSide||(E(a,!1),$(a))}}function $(a,b){a._bInitComplete=!0;A(a,"aoInitComplete","init",[a,b])}function pa(a){var b=j.defaults.oLanguage;!a.sEmptyTable&&(a.sZeroRecords&&"No data available in table"===b.sEmptyTable)&&p(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&
(a.sZeroRecords&&"Loading..."===b.sLoadingRecords)&&p(a,a,"sZeroRecords","sLoadingRecords")}function ya(a){if(a.oScroll.bInfinite)return null;var b='<select size="1" '+('name="'+a.sTableId+'_length"')+">",c,d,i=a.aLengthMenu;if(2==i.length&&"object"===typeof i[0]&&"object"===typeof i[1]){c=0;for(d=i[0].length;c<d;c++)b+='<option value="'+i[0][c]+'">'+i[1][c]+"</option>"}else{c=0;for(d=i.length;c<d;c++)b+='<option value="'+i[c]+'">'+i[c]+"</option>"}b+="</select>";i=l.createElement("div");a.aanFeatures.l||
(i.id=a.sTableId+"_length");i.className=a.oClasses.sLength;i.innerHTML="<label>"+a.oLanguage.sLengthMenu.replace("_MENU_",b)+"</label>";h('select option[value="'+a._iDisplayLength+'"]',i).attr("selected",!0);h("select",i).bind("change.DT",function(){var b=h(this).val(),i=a.aanFeatures.l;c=0;for(d=i.length;c<d;c++)i[c]!=this.parentNode&&h("select",i[c]).val(b);a._iDisplayLength=parseInt(b,10);y(a);if(a.fnDisplayEnd()==a.fnRecordsDisplay()){a._iDisplayStart=a.fnDisplayEnd()-a._iDisplayLength;if(a._iDisplayStart<
0)a._iDisplayStart=0}if(a._iDisplayLength==-1)a._iDisplayStart=0;x(a)});h("select",i).attr("aria-controls",a.sTableId);return i}function y(a){a._iDisplayEnd=!1===a.oFeatures.bPaginate?a.aiDisplay.length:a._iDisplayStart+a._iDisplayLength>a.aiDisplay.length||-1==a._iDisplayLength?a.aiDisplay.length:a._iDisplayStart+a._iDisplayLength}function Da(a){if(a.oScroll.bInfinite)return null;var b=l.createElement("div");b.className=a.oClasses.sPaging+a.sPaginationType;j.ext.oPagination[a.sPaginationType].fnInit(a,
b,function(a){y(a);x(a)});a.aanFeatures.p||a.aoDrawCallback.push({fn:function(a){j.ext.oPagination[a.sPaginationType].fnUpdate(a,function(a){y(a);x(a)})},sName:"pagination"});return b}function qa(a,b){var c=a._iDisplayStart;if("number"===typeof b)a._iDisplayStart=b*a._iDisplayLength,a._iDisplayStart>a.fnRecordsDisplay()&&(a._iDisplayStart=0);else if("first"==b)a._iDisplayStart=0;else if("previous"==b)a._iDisplayStart=0<=a._iDisplayLength?a._iDisplayStart-a._iDisplayLength:0,0>a._iDisplayStart&&(a._iDisplayStart=
0);else if("next"==b)0<=a._iDisplayLength?a._iDisplayStart+a._iDisplayLength<a.fnRecordsDisplay()&&(a._iDisplayStart+=a._iDisplayLength):a._iDisplayStart=0;else if("last"==b)if(0<=a._iDisplayLength){var d=parseInt((a.fnRecordsDisplay()-1)/a._iDisplayLength,10)+1;a._iDisplayStart=(d-1)*a._iDisplayLength}else a._iDisplayStart=0;else D(a,0,"Unknown paging action: "+b);h(a.oInstance).trigger("page",a);return c!=a._iDisplayStart}function Aa(a){var b=l.createElement("div");a.aanFeatures.r||(b.id=a.sTableId+
"_processing");b.innerHTML=a.oLanguage.sProcessing;b.className=a.oClasses.sProcessing;a.nTable.parentNode.insertBefore(b,a.nTable);return b}function E(a,b){if(a.oFeatures.bProcessing)for(var c=a.aanFeatures.r,d=0,i=c.length;d<i;d++)c[d].style.visibility=b?"visible":"hidden";h(a.oInstance).trigger("processing",[a,b])}function Ba(a){if(""===a.oScroll.sX&&""===a.oScroll.sY)return a.nTable;var b=l.createElement("div"),c=l.createElement("div"),d=l.createElement("div"),i=l.createElement("div"),f=l.createElement("div"),
g=l.createElement("div"),e=a.nTable.cloneNode(!1),j=a.nTable.cloneNode(!1),o=a.nTable.getElementsByTagName("thead")[0],k=0===a.nTable.getElementsByTagName("tfoot").length?null:a.nTable.getElementsByTagName("tfoot")[0],m=a.oClasses;c.appendChild(d);f.appendChild(g);i.appendChild(a.nTable);b.appendChild(c);b.appendChild(i);d.appendChild(e);e.appendChild(o);null!==k&&(b.appendChild(f),g.appendChild(j),j.appendChild(k));b.className=m.sScrollWrapper;c.className=m.sScrollHead;d.className=m.sScrollHeadInner;
i.className=m.sScrollBody;f.className=m.sScrollFoot;g.className=m.sScrollFootInner;a.oScroll.bAutoCss&&(c.style.overflow="hidden",c.style.position="relative",f.style.overflow="hidden",i.style.overflow="auto");c.style.border="0";c.style.width="100%";f.style.border="0";d.style.width=""!==a.oScroll.sXInner?a.oScroll.sXInner:"100%";e.removeAttribute("id");e.style.marginLeft="0";a.nTable.style.marginLeft="0";null!==k&&(j.removeAttribute("id"),j.style.marginLeft="0");d=h(a.nTable).children("caption");0<
d.length&&(d=d[0],"top"===d._captionSide?e.appendChild(d):"bottom"===d._captionSide&&k&&j.appendChild(d));""!==a.oScroll.sX&&(c.style.width=q(a.oScroll.sX),i.style.width=q(a.oScroll.sX),null!==k&&(f.style.width=q(a.oScroll.sX)),h(i).scroll(function(){c.scrollLeft=this.scrollLeft;if(k!==null)f.scrollLeft=this.scrollLeft}));""!==a.oScroll.sY&&(i.style.height=q(a.oScroll.sY));a.aoDrawCallback.push({fn:La,sName:"scrolling"});a.oScroll.bInfinite&&h(i).scroll(function(){if(!a.bDrawing&&h(this).scrollTop()!==
0&&h(this).scrollTop()+h(this).height()>h(a.nTable).height()-a.oScroll.iLoadGap&&a.fnDisplayEnd()<a.fnRecordsDisplay()){qa(a,"next");y(a);x(a)}});a.nScrollHead=c;a.nScrollFoot=f;return b}function La(a){var b=a.nScrollHead.getElementsByTagName("div")[0],c=b.getElementsByTagName("table")[0],d=a.nTable.parentNode,i,f,g,e,j,o,k,m,p=[],n=[],l=null!==a.nTFoot?a.nScrollFoot.getElementsByTagName("div")[0]:null,R=null!==a.nTFoot?l.getElementsByTagName("table")[0]:null,r=a.oBrowser.bScrollOversize,s=function(a){k=
a.style;k.paddingTop="0";k.paddingBottom="0";k.borderTopWidth="0";k.borderBottomWidth="0";k.height=0};h(a.nTable).children("thead, tfoot").remove();i=h(a.nTHead).clone()[0];a.nTable.insertBefore(i,a.nTable.childNodes[0]);g=a.nTHead.getElementsByTagName("tr");e=i.getElementsByTagName("tr");null!==a.nTFoot&&(j=h(a.nTFoot).clone()[0],a.nTable.insertBefore(j,a.nTable.childNodes[1]),o=a.nTFoot.getElementsByTagName("tr"),j=j.getElementsByTagName("tr"));""===a.oScroll.sX&&(d.style.width="100%",b.parentNode.style.width=
"100%");var t=N(a,i);i=0;for(f=t.length;i<f;i++)m=G(a,i),t[i].style.width=a.aoColumns[m].sWidth;null!==a.nTFoot&&C(function(a){a.style.width=""},j);a.oScroll.bCollapse&&""!==a.oScroll.sY&&(d.style.height=d.offsetHeight+a.nTHead.offsetHeight+"px");i=h(a.nTable).outerWidth();if(""===a.oScroll.sX){if(a.nTable.style.width="100%",r&&(h("tbody",d).height()>d.offsetHeight||"scroll"==h(d).css("overflow-y")))a.nTable.style.width=q(h(a.nTable).outerWidth()-a.oScroll.iBarWidth)}else""!==a.oScroll.sXInner?a.nTable.style.width=
q(a.oScroll.sXInner):i==h(d).width()&&h(d).height()<h(a.nTable).height()?(a.nTable.style.width=q(i-a.oScroll.iBarWidth),h(a.nTable).outerWidth()>i-a.oScroll.iBarWidth&&(a.nTable.style.width=q(i))):a.nTable.style.width=q(i);i=h(a.nTable).outerWidth();C(s,e);C(function(a){p.push(q(h(a).width()))},e);C(function(a,b){a.style.width=p[b]},g);h(e).height(0);null!==a.nTFoot&&(C(s,j),C(function(a){n.push(q(h(a).width()))},j),C(function(a,b){a.style.width=n[b]},o),h(j).height(0));C(function(a,b){a.innerHTML=
"";a.style.width=p[b]},e);null!==a.nTFoot&&C(function(a,b){a.innerHTML="";a.style.width=n[b]},j);if(h(a.nTable).outerWidth()<i){g=d.scrollHeight>d.offsetHeight||"scroll"==h(d).css("overflow-y")?i+a.oScroll.iBarWidth:i;if(r&&(d.scrollHeight>d.offsetHeight||"scroll"==h(d).css("overflow-y")))a.nTable.style.width=q(g-a.oScroll.iBarWidth);d.style.width=q(g);a.nScrollHead.style.width=q(g);null!==a.nTFoot&&(a.nScrollFoot.style.width=q(g));""===a.oScroll.sX?D(a,1,"The table cannot fit into the current element which will cause column misalignment. The table has been drawn at its minimum possible width."):
""!==a.oScroll.sXInner&&D(a,1,"The table cannot fit into the current element which will cause column misalignment. Increase the sScrollXInner value or remove it to allow automatic calculation")}else d.style.width=q("100%"),a.nScrollHead.style.width=q("100%"),null!==a.nTFoot&&(a.nScrollFoot.style.width=q("100%"));""===a.oScroll.sY&&r&&(d.style.height=q(a.nTable.offsetHeight+a.oScroll.iBarWidth));""!==a.oScroll.sY&&a.oScroll.bCollapse&&(d.style.height=q(a.oScroll.sY),r=""!==a.oScroll.sX&&a.nTable.offsetWidth>
d.offsetWidth?a.oScroll.iBarWidth:0,a.nTable.offsetHeight<d.offsetHeight&&(d.style.height=q(a.nTable.offsetHeight+r)));r=h(a.nTable).outerWidth();c.style.width=q(r);b.style.width=q(r);c=h(a.nTable).height()>d.clientHeight||"scroll"==h(d).css("overflow-y");b.style.paddingRight=c?a.oScroll.iBarWidth+"px":"0px";null!==a.nTFoot&&(R.style.width=q(r),l.style.width=q(r),l.style.paddingRight=c?a.oScroll.iBarWidth+"px":"0px");h(d).scroll();if(a.bSorted||a.bFiltered)d.scrollTop=0}function C(a,b,c){for(var d=
0,i=0,f=b.length,g,e;i<f;){g=b[i].firstChild;for(e=c?c[i].firstChild:null;g;)1===g.nodeType&&(c?a(g,e,d):a(g,d),d++),g=g.nextSibling,e=c?e.nextSibling:null;i++}}function Ma(a,b){if(!a||null===a||""===a)return 0;b||(b=l.body);var c,d=l.createElement("div");d.style.width=q(a);b.appendChild(d);c=d.offsetWidth;b.removeChild(d);return c}function da(a){var b=0,c,d=0,i=a.aoColumns.length,f,e,j=h("th",a.nTHead),o=a.nTable.getAttribute("width");e=a.nTable.parentNode;for(f=0;f<i;f++)a.aoColumns[f].bVisible&&
(d++,null!==a.aoColumns[f].sWidth&&(c=Ma(a.aoColumns[f].sWidthOrig,e),null!==c&&(a.aoColumns[f].sWidth=q(c)),b++));if(i==j.length&&0===b&&d==i&&""===a.oScroll.sX&&""===a.oScroll.sY)for(f=0;f<a.aoColumns.length;f++)c=h(j[f]).width(),null!==c&&(a.aoColumns[f].sWidth=q(c));else{b=a.nTable.cloneNode(!1);f=a.nTHead.cloneNode(!0);d=l.createElement("tbody");c=l.createElement("tr");b.removeAttribute("id");b.appendChild(f);null!==a.nTFoot&&(b.appendChild(a.nTFoot.cloneNode(!0)),C(function(a){a.style.width=
""},b.getElementsByTagName("tr")));b.appendChild(d);d.appendChild(c);d=h("thead th",b);0===d.length&&(d=h("tbody tr:eq(0)>td",b));j=N(a,f);for(f=d=0;f<i;f++){var k=a.aoColumns[f];k.bVisible&&null!==k.sWidthOrig&&""!==k.sWidthOrig?j[f-d].style.width=q(k.sWidthOrig):k.bVisible?j[f-d].style.width="":d++}for(f=0;f<i;f++)a.aoColumns[f].bVisible&&(d=Na(a,f),null!==d&&(d=d.cloneNode(!0),""!==a.aoColumns[f].sContentPadding&&(d.innerHTML+=a.aoColumns[f].sContentPadding),c.appendChild(d)));e.appendChild(b);
""!==a.oScroll.sX&&""!==a.oScroll.sXInner?b.style.width=q(a.oScroll.sXInner):""!==a.oScroll.sX?(b.style.width="",h(b).width()<e.offsetWidth&&(b.style.width=q(e.offsetWidth))):""!==a.oScroll.sY?b.style.width=q(e.offsetWidth):o&&(b.style.width=q(o));b.style.visibility="hidden";Oa(a,b);i=h("tbody tr:eq(0)",b).children();0===i.length&&(i=N(a,h("thead",b)[0]));if(""!==a.oScroll.sX){for(f=d=e=0;f<a.aoColumns.length;f++)a.aoColumns[f].bVisible&&(e=null===a.aoColumns[f].sWidthOrig?e+h(i[d]).outerWidth():
e+(parseInt(a.aoColumns[f].sWidth.replace("px",""),10)+(h(i[d]).outerWidth()-h(i[d]).width())),d++);b.style.width=q(e);a.nTable.style.width=q(e)}for(f=d=0;f<a.aoColumns.length;f++)a.aoColumns[f].bVisible&&(e=h(i[d]).width(),null!==e&&0<e&&(a.aoColumns[f].sWidth=q(e)),d++);i=h(b).css("width");a.nTable.style.width=-1!==i.indexOf("%")?i:q(h(b).outerWidth());b.parentNode.removeChild(b)}o&&(a.nTable.style.width=q(o))}function Oa(a,b){""===a.oScroll.sX&&""!==a.oScroll.sY?(h(b).width(),b.style.width=q(h(b).outerWidth()-
a.oScroll.iBarWidth)):""!==a.oScroll.sX&&(b.style.width=q(h(b).outerWidth()))}function Na(a,b){var c=Pa(a,b);if(0>c)return null;if(null===a.aoData[c].nTr){var d=l.createElement("td");d.innerHTML=v(a,c,b,"");return d}return J(a,c)[b]}function Pa(a,b){for(var c=-1,d=-1,i=0;i<a.aoData.length;i++){var e=v(a,i,b,"display")+"",e=e.replace(/<.*?>/g,"");e.length>c&&(c=e.length,d=i)}return d}function q(a){if(null===a)return"0px";if("number"==typeof a)return 0>a?"0px":a+"px";var b=a.charCodeAt(a.length-1);
return 48>b||57<b?a:a+"px"}function Qa(){var a=l.createElement("p"),b=a.style;b.width="100%";b.height="200px";b.padding="0px";var c=l.createElement("div"),b=c.style;b.position="absolute";b.top="0px";b.left="0px";b.visibility="hidden";b.width="200px";b.height="150px";b.padding="0px";b.overflow="hidden";c.appendChild(a);l.body.appendChild(c);b=a.offsetWidth;c.style.overflow="scroll";a=a.offsetWidth;b==a&&(a=c.clientWidth);l.body.removeChild(c);return b-a}function O(a,b){var c,d,i,e,g,k,o=[],m=[],p=
j.ext.oSort,l=a.aoData,q=a.aoColumns,G=a.oLanguage.oAria;if(!a.oFeatures.bServerSide&&(0!==a.aaSorting.length||null!==a.aaSortingFixed)){o=null!==a.aaSortingFixed?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(c=0;c<o.length;c++)if(d=o[c][0],i=R(a,d),e=a.aoColumns[d].sSortDataType,j.ext.afnSortData[e])if(g=j.ext.afnSortData[e].call(a.oInstance,a,d,i),g.length===l.length){i=0;for(e=l.length;i<e;i++)F(a,i,d,g[i])}else D(a,0,"Returned data sort array (col "+d+") is the wrong length");c=
0;for(d=a.aiDisplayMaster.length;c<d;c++)m[a.aiDisplayMaster[c]]=c;var r=o.length,s;c=0;for(d=l.length;c<d;c++)for(i=0;i<r;i++){s=q[o[i][0]].aDataSort;g=0;for(k=s.length;g<k;g++)e=q[s[g]].sType,e=p[(e?e:"string")+"-pre"],l[c]._aSortData[s[g]]=e?e(v(a,c,s[g],"sort")):v(a,c,s[g],"sort")}a.aiDisplayMaster.sort(function(a,b){var c,d,e,i,f;for(c=0;c<r;c++){f=q[o[c][0]].aDataSort;d=0;for(e=f.length;d<e;d++)if(i=q[f[d]].sType,i=p[(i?i:"string")+"-"+o[c][1]](l[a]._aSortData[f[d]],l[b]._aSortData[f[d]]),0!==
i)return i}return p["numeric-asc"](m[a],m[b])})}(b===n||b)&&!a.oFeatures.bDeferRender&&P(a);c=0;for(d=a.aoColumns.length;c<d;c++)e=q[c].sTitle.replace(/<.*?>/g,""),i=q[c].nTh,i.removeAttribute("aria-sort"),i.removeAttribute("aria-label"),q[c].bSortable?0<o.length&&o[0][0]==c?(i.setAttribute("aria-sort","asc"==o[0][1]?"ascending":"descending"),i.setAttribute("aria-label",e+("asc"==(q[c].asSorting[o[0][2]+1]?q[c].asSorting[o[0][2]+1]:q[c].asSorting[0])?G.sSortAscending:G.sSortDescending))):i.setAttribute("aria-label",
e+("asc"==q[c].asSorting[0]?G.sSortAscending:G.sSortDescending)):i.setAttribute("aria-label",e);a.bSorted=!0;h(a.oInstance).trigger("sort",a);a.oFeatures.bFilter?K(a,a.oPreviousSearch,1):(a.aiDisplay=a.aiDisplayMaster.slice(),a._iDisplayStart=0,y(a),x(a))}function ia(a,b,c,d){Ra(b,{},function(b){if(!1!==a.aoColumns[c].bSortable){var e=function(){var d,e;if(b.shiftKey){for(var f=!1,h=0;h<a.aaSorting.length;h++)if(a.aaSorting[h][0]==c){f=!0;d=a.aaSorting[h][0];e=a.aaSorting[h][2]+1;a.aoColumns[d].asSorting[e]?
(a.aaSorting[h][1]=a.aoColumns[d].asSorting[e],a.aaSorting[h][2]=e):a.aaSorting.splice(h,1);break}!1===f&&a.aaSorting.push([c,a.aoColumns[c].asSorting[0],0])}else 1==a.aaSorting.length&&a.aaSorting[0][0]==c?(d=a.aaSorting[0][0],e=a.aaSorting[0][2]+1,a.aoColumns[d].asSorting[e]||(e=0),a.aaSorting[0][1]=a.aoColumns[d].asSorting[e],a.aaSorting[0][2]=e):(a.aaSorting.splice(0,a.aaSorting.length),a.aaSorting.push([c,a.aoColumns[c].asSorting[0],0]));O(a)};a.oFeatures.bProcessing?(E(a,!0),setTimeout(function(){e();
a.oFeatures.bServerSide||E(a,!1)},0)):e();"function"==typeof d&&d(a)}})}function P(a){var b,c,d,e,f,g=a.aoColumns.length,j=a.oClasses;for(b=0;b<g;b++)a.aoColumns[b].bSortable&&h(a.aoColumns[b].nTh).removeClass(j.sSortAsc+" "+j.sSortDesc+" "+a.aoColumns[b].sSortingClass);c=null!==a.aaSortingFixed?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(b=0;b<a.aoColumns.length;b++)if(a.aoColumns[b].bSortable){f=a.aoColumns[b].sSortingClass;e=-1;for(d=0;d<c.length;d++)if(c[d][0]==b){f="asc"==c[d][1]?
j.sSortAsc:j.sSortDesc;e=d;break}h(a.aoColumns[b].nTh).addClass(f);a.bJUI&&(f=h("span."+j.sSortIcon,a.aoColumns[b].nTh),f.removeClass(j.sSortJUIAsc+" "+j.sSortJUIDesc+" "+j.sSortJUI+" "+j.sSortJUIAscAllowed+" "+j.sSortJUIDescAllowed),f.addClass(-1==e?a.aoColumns[b].sSortingClassJUI:"asc"==c[e][1]?j.sSortJUIAsc:j.sSortJUIDesc))}else h(a.aoColumns[b].nTh).addClass(a.aoColumns[b].sSortingClass);f=j.sSortColumn;if(a.oFeatures.bSort&&a.oFeatures.bSortClasses){a=J(a);e=[];for(b=0;b<g;b++)e.push("");b=0;
for(d=1;b<c.length;b++)j=parseInt(c[b][0],10),e[j]=f+d,3>d&&d++;f=RegExp(f+"[123]");var o;b=0;for(c=a.length;b<c;b++)j=b%g,d=a[b].className,o=e[j],j=d.replace(f,o),j!=d?a[b].className=h.trim(j):0<o.length&&-1==d.indexOf(o)&&(a[b].className=d+" "+o)}}function ra(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b,c;b=a.oScroll.bInfinite;var d={iCreate:(new Date).getTime(),iStart:b?0:a._iDisplayStart,iEnd:b?a._iDisplayLength:a._iDisplayEnd,iLength:a._iDisplayLength,aaSorting:h.extend(!0,[],a.aaSorting),
oSearch:h.extend(!0,{},a.oPreviousSearch),aoSearchCols:h.extend(!0,[],a.aoPreSearchCols),abVisCols:[]};b=0;for(c=a.aoColumns.length;b<c;b++)d.abVisCols.push(a.aoColumns[b].bVisible);A(a,"aoStateSaveParams","stateSaveParams",[a,d]);a.fnStateSave.call(a.oInstance,a,d)}}function Sa(a,b){if(a.oFeatures.bStateSave){var c=a.fnStateLoad.call(a.oInstance,a);if(c){var d=A(a,"aoStateLoadParams","stateLoadParams",[a,c]);if(-1===h.inArray(!1,d)){a.oLoadedState=h.extend(!0,{},c);a._iDisplayStart=c.iStart;a.iInitDisplayStart=
c.iStart;a._iDisplayEnd=c.iEnd;a._iDisplayLength=c.iLength;a.aaSorting=c.aaSorting.slice();a.saved_aaSorting=c.aaSorting.slice();h.extend(a.oPreviousSearch,c.oSearch);h.extend(!0,a.aoPreSearchCols,c.aoSearchCols);b.saved_aoColumns=[];for(d=0;d<c.abVisCols.length;d++)b.saved_aoColumns[d]={},b.saved_aoColumns[d].bVisible=c.abVisCols[d];A(a,"aoStateLoaded","stateLoaded",[a,c])}}}}function s(a){for(var b=0;b<j.settings.length;b++)if(j.settings[b].nTable===a)return j.settings[b];return null}function T(a){for(var b=
[],a=a.aoData,c=0,d=a.length;c<d;c++)null!==a[c].nTr&&b.push(a[c].nTr);return b}function J(a,b){var c=[],d,e,f,g,h,j;e=0;var o=a.aoData.length;b!==n&&(e=b,o=b+1);for(f=e;f<o;f++)if(j=a.aoData[f],null!==j.nTr){e=[];for(d=j.nTr.firstChild;d;)g=d.nodeName.toLowerCase(),("td"==g||"th"==g)&&e.push(d),d=d.nextSibling;g=d=0;for(h=a.aoColumns.length;g<h;g++)a.aoColumns[g].bVisible?c.push(e[g-d]):(c.push(j._anHidden[g]),d++)}return c}function D(a,b,c){a=null===a?"DataTables warning: "+c:"DataTables warning (table id = '"+
a.sTableId+"'): "+c;if(0===b)if("alert"==j.ext.sErrMode)alert(a);else throw Error(a);else X.console&&console.log&&console.log(a)}function p(a,b,c,d){d===n&&(d=c);b[c]!==n&&(a[d]=b[c])}function Ta(a,b){var c,d;for(d in b)b.hasOwnProperty(d)&&(c=b[d],"object"===typeof e[d]&&null!==c&&!1===h.isArray(c)?h.extend(!0,a[d],c):a[d]=c);return a}function Ra(a,b,c){h(a).bind("click.DT",b,function(b){a.blur();c(b)}).bind("keypress.DT",b,function(a){13===a.which&&c(a)}).bind("selectstart.DT",function(){return!1})}
function z(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function A(a,b,c,d){for(var b=a[b],e=[],f=b.length-1;0<=f;f--)e.push(b[f].fn.apply(a.oInstance,d));null!==c&&h(a.oInstance).trigger(c,d);return e}function Ua(a){var b=h('<div style="position:absolute; top:0; left:0; height:1px; width:1px; overflow:hidden"><div style="position:absolute; top:1px; left:1px; width:100px; overflow:scroll;"><div id="DT_BrowserTest" style="width:100%; height:10px;"></div></div></div>')[0];l.body.appendChild(b);a.oBrowser.bScrollOversize=
100===h("#DT_BrowserTest",b)[0].offsetWidth?!0:!1;l.body.removeChild(b)}function Va(a){return function(){var b=[s(this[j.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return j.ext.oApi[a].apply(this,b)}}var U=/\[.*?\]$/,Wa=X.JSON?JSON.stringify:function(a){var b=typeof a;if("object"!==b||null===a)return"string"===b&&(a='"'+a+'"'),a+"";var c,d,e=[],f=h.isArray(a);for(c in a)d=a[c],b=typeof d,"string"===b?d='"'+d+'"':"object"===b&&null!==d&&(d=Wa(d)),e.push((f?"":'"'+c+'":')+d);return(f?
"[":"{")+e+(f?"]":"}")};this.$=function(a,b){var c,d,e=[],f;d=s(this[j.ext.iApiIndex]);var g=d.aoData,o=d.aiDisplay,k=d.aiDisplayMaster;b||(b={});b=h.extend({},{filter:"none",order:"current",page:"all"},b);if("current"==b.page){c=d._iDisplayStart;for(d=d.fnDisplayEnd();c<d;c++)(f=g[o[c]].nTr)&&e.push(f)}else if("current"==b.order&&"none"==b.filter){c=0;for(d=k.length;c<d;c++)(f=g[k[c]].nTr)&&e.push(f)}else if("current"==b.order&&"applied"==b.filter){c=0;for(d=o.length;c<d;c++)(f=g[o[c]].nTr)&&e.push(f)}else if("original"==
b.order&&"none"==b.filter){c=0;for(d=g.length;c<d;c++)(f=g[c].nTr)&&e.push(f)}else if("original"==b.order&&"applied"==b.filter){c=0;for(d=g.length;c<d;c++)f=g[c].nTr,-1!==h.inArray(c,o)&&f&&e.push(f)}else D(d,1,"Unknown selection options");e=h(e);c=e.filter(a);e=e.find(a);return h([].concat(h.makeArray(c),h.makeArray(e)))};this._=function(a,b){var c=[],d,e,f=this.$(a,b);d=0;for(e=f.length;d<e;d++)c.push(this.fnGetData(f[d]));return c};this.fnAddData=function(a,b){if(0===a.length)return[];var c=[],
d,e=s(this[j.ext.iApiIndex]);if("object"===typeof a[0]&&null!==a[0])for(var f=0;f<a.length;f++){d=H(e,a[f]);if(-1==d)return c;c.push(d)}else{d=H(e,a);if(-1==d)return c;c.push(d)}e.aiDisplay=e.aiDisplayMaster.slice();(b===n||b)&&aa(e);return c};this.fnAdjustColumnSizing=function(a){var b=s(this[j.ext.iApiIndex]);k(b);a===n||a?this.fnDraw(!1):(""!==b.oScroll.sX||""!==b.oScroll.sY)&&this.oApi._fnScrollDraw(b)};this.fnClearTable=function(a){var b=s(this[j.ext.iApiIndex]);ga(b);(a===n||a)&&x(b)};this.fnClose=
function(a){for(var b=s(this[j.ext.iApiIndex]),c=0;c<b.aoOpenRows.length;c++)if(b.aoOpenRows[c].nParent==a)return(a=b.aoOpenRows[c].nTr.parentNode)&&a.removeChild(b.aoOpenRows[c].nTr),b.aoOpenRows.splice(c,1),0;return 1};this.fnDeleteRow=function(a,b,c){var d=s(this[j.ext.iApiIndex]),e,f,a="object"===typeof a?I(d,a):a,g=d.aoData.splice(a,1);e=0;for(f=d.aoData.length;e<f;e++)null!==d.aoData[e].nTr&&(d.aoData[e].nTr._DT_RowIndex=e);e=h.inArray(a,d.aiDisplay);d.asDataSearch.splice(e,1);ha(d.aiDisplayMaster,
a);ha(d.aiDisplay,a);"function"===typeof b&&b.call(this,d,g);d._iDisplayStart>=d.fnRecordsDisplay()&&(d._iDisplayStart-=d._iDisplayLength,0>d._iDisplayStart&&(d._iDisplayStart=0));if(c===n||c)y(d),x(d);return g};this.fnDestroy=function(a){var b=s(this[j.ext.iApiIndex]),c=b.nTableWrapper.parentNode,d=b.nTBody,i,f,a=a===n?!1:a;b.bDestroying=!0;A(b,"aoDestroyCallback","destroy",[b]);if(!a){i=0;for(f=b.aoColumns.length;i<f;i++)!1===b.aoColumns[i].bVisible&&this.fnSetColumnVis(i,!0)}h(b.nTableWrapper).find("*").andSelf().unbind(".DT");
h("tbody>tr>td."+b.oClasses.sRowEmpty,b.nTable).parent().remove();b.nTable!=b.nTHead.parentNode&&(h(b.nTable).children("thead").remove(),b.nTable.appendChild(b.nTHead));b.nTFoot&&b.nTable!=b.nTFoot.parentNode&&(h(b.nTable).children("tfoot").remove(),b.nTable.appendChild(b.nTFoot));b.nTable.parentNode.removeChild(b.nTable);h(b.nTableWrapper).remove();b.aaSorting=[];b.aaSortingFixed=[];P(b);h(T(b)).removeClass(b.asStripeClasses.join(" "));h("th, td",b.nTHead).removeClass([b.oClasses.sSortable,b.oClasses.sSortableAsc,
b.oClasses.sSortableDesc,b.oClasses.sSortableNone].join(" "));b.bJUI&&(h("th span."+b.oClasses.sSortIcon+", td span."+b.oClasses.sSortIcon,b.nTHead).remove(),h("th, td",b.nTHead).each(function(){var a=h("div."+b.oClasses.sSortJUIWrapper,this),c=a.contents();h(this).append(c);a.remove()}));!a&&b.nTableReinsertBefore?c.insertBefore(b.nTable,b.nTableReinsertBefore):a||c.appendChild(b.nTable);i=0;for(f=b.aoData.length;i<f;i++)null!==b.aoData[i].nTr&&d.appendChild(b.aoData[i].nTr);!0===b.oFeatures.bAutoWidth&&
(b.nTable.style.width=q(b.sDestroyWidth));if(f=b.asDestroyStripes.length){a=h(d).children("tr");for(i=0;i<f;i++)a.filter(":nth-child("+f+"n + "+i+")").addClass(b.asDestroyStripes[i])}i=0;for(f=j.settings.length;i<f;i++)j.settings[i]==b&&j.settings.splice(i,1);e=b=null};this.fnDraw=function(a){var b=s(this[j.ext.iApiIndex]);!1===a?(y(b),x(b)):aa(b)};this.fnFilter=function(a,b,c,d,e,f){var g=s(this[j.ext.iApiIndex]);if(g.oFeatures.bFilter){if(c===n||null===c)c=!1;if(d===n||null===d)d=!0;if(e===n||null===
e)e=!0;if(f===n||null===f)f=!0;if(b===n||null===b){if(K(g,{sSearch:a+"",bRegex:c,bSmart:d,bCaseInsensitive:f},1),e&&g.aanFeatures.f){b=g.aanFeatures.f;c=0;for(d=b.length;c<d;c++)try{b[c]._DT_Input!=l.activeElement&&h(b[c]._DT_Input).val(a)}catch(o){h(b[c]._DT_Input).val(a)}}}else h.extend(g.aoPreSearchCols[b],{sSearch:a+"",bRegex:c,bSmart:d,bCaseInsensitive:f}),K(g,g.oPreviousSearch,1)}};this.fnGetData=function(a,b){var c=s(this[j.ext.iApiIndex]);if(a!==n){var d=a;if("object"===typeof a){var e=a.nodeName.toLowerCase();
"tr"===e?d=I(c,a):"td"===e&&(d=I(c,a.parentNode),b=fa(c,d,a))}return b!==n?v(c,d,b,""):c.aoData[d]!==n?c.aoData[d]._aData:null}return Z(c)};this.fnGetNodes=function(a){var b=s(this[j.ext.iApiIndex]);return a!==n?b.aoData[a]!==n?b.aoData[a].nTr:null:T(b)};this.fnGetPosition=function(a){var b=s(this[j.ext.iApiIndex]),c=a.nodeName.toUpperCase();return"TR"==c?I(b,a):"TD"==c||"TH"==c?(c=I(b,a.parentNode),a=fa(b,c,a),[c,R(b,a),a]):null};this.fnIsOpen=function(a){for(var b=s(this[j.ext.iApiIndex]),c=0;c<
b.aoOpenRows.length;c++)if(b.aoOpenRows[c].nParent==a)return!0;return!1};this.fnOpen=function(a,b,c){var d=s(this[j.ext.iApiIndex]),e=T(d);if(-1!==h.inArray(a,e)){this.fnClose(a);var e=l.createElement("tr"),f=l.createElement("td");e.appendChild(f);f.className=c;f.colSpan=t(d);"string"===typeof b?f.innerHTML=b:h(f).html(b);b=h("tr",d.nTBody);-1!=h.inArray(a,b)&&h(e).insertAfter(a);d.aoOpenRows.push({nTr:e,nParent:a});return e}};this.fnPageChange=function(a,b){var c=s(this[j.ext.iApiIndex]);qa(c,a);
y(c);(b===n||b)&&x(c)};this.fnSetColumnVis=function(a,b,c){var d=s(this[j.ext.iApiIndex]),e,f,g=d.aoColumns,h=d.aoData,o,m;if(g[a].bVisible!=b){if(b){for(e=f=0;e<a;e++)g[e].bVisible&&f++;m=f>=t(d);if(!m)for(e=a;e<g.length;e++)if(g[e].bVisible){o=e;break}e=0;for(f=h.length;e<f;e++)null!==h[e].nTr&&(m?h[e].nTr.appendChild(h[e]._anHidden[a]):h[e].nTr.insertBefore(h[e]._anHidden[a],J(d,e)[o]))}else{e=0;for(f=h.length;e<f;e++)null!==h[e].nTr&&(o=J(d,e)[a],h[e]._anHidden[a]=o,o.parentNode.removeChild(o))}g[a].bVisible=
b;W(d,d.aoHeader);d.nTFoot&&W(d,d.aoFooter);e=0;for(f=d.aoOpenRows.length;e<f;e++)d.aoOpenRows[e].nTr.colSpan=t(d);if(c===n||c)k(d),x(d);ra(d)}};this.fnSettings=function(){return s(this[j.ext.iApiIndex])};this.fnSort=function(a){var b=s(this[j.ext.iApiIndex]);b.aaSorting=a;O(b)};this.fnSortListener=function(a,b,c){ia(s(this[j.ext.iApiIndex]),a,b,c)};this.fnUpdate=function(a,b,c,d,e){var f=s(this[j.ext.iApiIndex]),b="object"===typeof b?I(f,b):b;if(h.isArray(a)&&c===n){f.aoData[b]._aData=a.slice();
for(c=0;c<f.aoColumns.length;c++)this.fnUpdate(v(f,b,c),b,c,!1,!1)}else if(h.isPlainObject(a)&&c===n){f.aoData[b]._aData=h.extend(!0,{},a);for(c=0;c<f.aoColumns.length;c++)this.fnUpdate(v(f,b,c),b,c,!1,!1)}else{F(f,b,c,a);var a=v(f,b,c,"display"),g=f.aoColumns[c];null!==g.fnRender&&(a=S(f,b,c),g.bUseRendered&&F(f,b,c,a));null!==f.aoData[b].nTr&&(J(f,b)[c].innerHTML=a)}c=h.inArray(b,f.aiDisplay);f.asDataSearch[c]=na(f,Y(f,b,"filter",r(f,"bSearchable")));(e===n||e)&&k(f);(d===n||d)&&aa(f);return 0};
this.fnVersionCheck=j.ext.fnVersionCheck;this.oApi={_fnExternApiFunc:Va,_fnInitialise:ba,_fnInitComplete:$,_fnLanguageCompat:pa,_fnAddColumn:o,_fnColumnOptions:m,_fnAddData:H,_fnCreateTr:ea,_fnGatherData:ua,_fnBuildHead:va,_fnDrawHead:W,_fnDraw:x,_fnReDraw:aa,_fnAjaxUpdate:wa,_fnAjaxParameters:Ea,_fnAjaxUpdateDraw:Fa,_fnServerParams:ka,_fnAddOptionsHtml:xa,_fnFeatureHtmlTable:Ba,_fnScrollDraw:La,_fnAdjustColumnSizing:k,_fnFeatureHtmlFilter:za,_fnFilterComplete:K,_fnFilterCustom:Ia,_fnFilterColumn:Ha,
_fnFilter:Ga,_fnBuildSearchArray:la,_fnBuildSearchRow:na,_fnFilterCreateSearch:ma,_fnDataToSearch:Ja,_fnSort:O,_fnSortAttachListener:ia,_fnSortingClasses:P,_fnFeatureHtmlPaginate:Da,_fnPageChange:qa,_fnFeatureHtmlInfo:Ca,_fnUpdateInfo:Ka,_fnFeatureHtmlLength:ya,_fnFeatureHtmlProcessing:Aa,_fnProcessingDisplay:E,_fnVisibleToColumnIndex:G,_fnColumnIndexToVisible:R,_fnNodeToDataIndex:I,_fnVisbleColumns:t,_fnCalculateEnd:y,_fnConvertToWidth:Ma,_fnCalculateColumnWidths:da,_fnScrollingWidthAdjust:Oa,_fnGetWidestNode:Na,
_fnGetMaxLenString:Pa,_fnStringToCss:q,_fnDetectType:B,_fnSettingsFromNode:s,_fnGetDataMaster:Z,_fnGetTrNodes:T,_fnGetTdNodes:J,_fnEscapeRegex:oa,_fnDeleteIndex:ha,_fnReOrderIndex:u,_fnColumnOrdering:M,_fnLog:D,_fnClearTable:ga,_fnSaveState:ra,_fnLoadState:Sa,_fnCreateCookie:function(a,b,c,d,e){var f=new Date;f.setTime(f.getTime()+1E3*c);var c=X.location.pathname.split("/"),a=a+"_"+c.pop().replace(/[\/:]/g,"").toLowerCase(),g;null!==e?(g="function"===typeof h.parseJSON?h.parseJSON(b):eval("("+b+")"),
b=e(a,g,f.toGMTString(),c.join("/")+"/")):b=a+"="+encodeURIComponent(b)+"; expires="+f.toGMTString()+"; path="+c.join("/")+"/";a=l.cookie.split(";");e=b.split(";")[0].length;f=[];if(4096<e+l.cookie.length+10){for(var j=0,o=a.length;j<o;j++)if(-1!=a[j].indexOf(d)){var k=a[j].split("=");try{(g=eval("("+decodeURIComponent(k[1])+")"))&&g.iCreate&&f.push({name:k[0],time:g.iCreate})}catch(m){}}for(f.sort(function(a,b){return b.time-a.time});4096<e+l.cookie.length+10;){if(0===f.length)return;d=f.pop();l.cookie=
d.name+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+c.join("/")+"/"}}l.cookie=b},_fnReadCookie:function(a){for(var b=X.location.pathname.split("/"),a=a+"_"+b[b.length-1].replace(/[\/:]/g,"").toLowerCase()+"=",b=l.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return decodeURIComponent(d.substring(a.length,d.length))}return null},_fnDetectHeader:V,_fnGetUniqueThs:N,_fnScrollBarWidth:Qa,_fnApplyToChildren:C,_fnMap:p,_fnGetRowData:Y,
_fnGetCellData:v,_fnSetCellData:F,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:L,_fnApplyColumnDefs:ta,_fnBindAction:Ra,_fnExtend:Ta,_fnCallbackReg:z,_fnCallbackFire:A,_fnJsonString:Wa,_fnRender:S,_fnNodeToColumnIndex:fa,_fnInfoMacros:ja,_fnBrowserDetect:Ua,_fnGetColumns:r};h.extend(j.ext.oApi,this.oApi);for(var sa in j.ext.oApi)sa&&(this[sa]=Va(sa));var ca=this;this.each(function(){var a=0,b,c,d;c=this.getAttribute("id");var i=!1,f=!1;if("table"!=this.nodeName.toLowerCase())D(null,0,"Attempted to initialise DataTables on a node which is not a table: "+
this.nodeName);else{a=0;for(b=j.settings.length;a<b;a++){if(j.settings[a].nTable==this){if(e===n||e.bRetrieve)return j.settings[a].oInstance;if(e.bDestroy){j.settings[a].oInstance.fnDestroy();break}else{D(j.settings[a],0,"Cannot reinitialise DataTable.\n\nTo retrieve the DataTables object for this table, pass no arguments or see the docs for bRetrieve and bDestroy");return}}if(j.settings[a].sTableId==this.id){j.settings.splice(a,1);break}}if(null===c||""===c)this.id=c="DataTables_Table_"+j.ext._oExternConfig.iNextUnique++;
var g=h.extend(!0,{},j.models.oSettings,{nTable:this,oApi:ca.oApi,oInit:e,sDestroyWidth:h(this).width(),sInstance:c,sTableId:c});j.settings.push(g);g.oInstance=1===ca.length?ca:h(this).dataTable();e||(e={});e.oLanguage&&pa(e.oLanguage);e=Ta(h.extend(!0,{},j.defaults),e);p(g.oFeatures,e,"bPaginate");p(g.oFeatures,e,"bLengthChange");p(g.oFeatures,e,"bFilter");p(g.oFeatures,e,"bSort");p(g.oFeatures,e,"bInfo");p(g.oFeatures,e,"bProcessing");p(g.oFeatures,e,"bAutoWidth");p(g.oFeatures,e,"bSortClasses");
p(g.oFeatures,e,"bServerSide");p(g.oFeatures,e,"bDeferRender");p(g.oScroll,e,"sScrollX","sX");p(g.oScroll,e,"sScrollXInner","sXInner");p(g.oScroll,e,"sScrollY","sY");p(g.oScroll,e,"bScrollCollapse","bCollapse");p(g.oScroll,e,"bScrollInfinite","bInfinite");p(g.oScroll,e,"iScrollLoadGap","iLoadGap");p(g.oScroll,e,"bScrollAutoCss","bAutoCss");p(g,e,"asStripeClasses");p(g,e,"asStripClasses","asStripeClasses");p(g,e,"fnServerData");p(g,e,"fnFormatNumber");p(g,e,"sServerMethod");p(g,e,"aaSorting");p(g,
e,"aaSortingFixed");p(g,e,"aLengthMenu");p(g,e,"sPaginationType");p(g,e,"sAjaxSource");p(g,e,"sAjaxDataProp");p(g,e,"iCookieDuration");p(g,e,"sCookiePrefix");p(g,e,"sDom");p(g,e,"bSortCellsTop");p(g,e,"iTabIndex");p(g,e,"oSearch","oPreviousSearch");p(g,e,"aoSearchCols","aoPreSearchCols");p(g,e,"iDisplayLength","_iDisplayLength");p(g,e,"bJQueryUI","bJUI");p(g,e,"fnCookieCallback");p(g,e,"fnStateLoad");p(g,e,"fnStateSave");p(g.oLanguage,e,"fnInfoCallback");z(g,"aoDrawCallback",e.fnDrawCallback,"user");
z(g,"aoServerParams",e.fnServerParams,"user");z(g,"aoStateSaveParams",e.fnStateSaveParams,"user");z(g,"aoStateLoadParams",e.fnStateLoadParams,"user");z(g,"aoStateLoaded",e.fnStateLoaded,"user");z(g,"aoRowCallback",e.fnRowCallback,"user");z(g,"aoRowCreatedCallback",e.fnCreatedRow,"user");z(g,"aoHeaderCallback",e.fnHeaderCallback,"user");z(g,"aoFooterCallback",e.fnFooterCallback,"user");z(g,"aoInitComplete",e.fnInitComplete,"user");z(g,"aoPreDrawCallback",e.fnPreDrawCallback,"user");g.oFeatures.bServerSide&&
g.oFeatures.bSort&&g.oFeatures.bSortClasses?z(g,"aoDrawCallback",P,"server_side_sort_classes"):g.oFeatures.bDeferRender&&z(g,"aoDrawCallback",P,"defer_sort_classes");e.bJQueryUI?(h.extend(g.oClasses,j.ext.oJUIClasses),e.sDom===j.defaults.sDom&&"lfrtip"===j.defaults.sDom&&(g.sDom='<"H"lfr>t<"F"ip>')):h.extend(g.oClasses,j.ext.oStdClasses);h(this).addClass(g.oClasses.sTable);if(""!==g.oScroll.sX||""!==g.oScroll.sY)g.oScroll.iBarWidth=Qa();g.iInitDisplayStart===n&&(g.iInitDisplayStart=e.iDisplayStart,
g._iDisplayStart=e.iDisplayStart);e.bStateSave&&(g.oFeatures.bStateSave=!0,Sa(g,e),z(g,"aoDrawCallback",ra,"state_save"));null!==e.iDeferLoading&&(g.bDeferLoading=!0,a=h.isArray(e.iDeferLoading),g._iRecordsDisplay=a?e.iDeferLoading[0]:e.iDeferLoading,g._iRecordsTotal=a?e.iDeferLoading[1]:e.iDeferLoading);null!==e.aaData&&(f=!0);""!==e.oLanguage.sUrl?(g.oLanguage.sUrl=e.oLanguage.sUrl,h.getJSON(g.oLanguage.sUrl,null,function(a){pa(a);h.extend(true,g.oLanguage,e.oLanguage,a);ba(g)}),i=!0):h.extend(!0,
g.oLanguage,e.oLanguage);null===e.asStripeClasses&&(g.asStripeClasses=[g.oClasses.sStripeOdd,g.oClasses.sStripeEven]);b=g.asStripeClasses.length;g.asDestroyStripes=[];if(b){c=!1;d=h(this).children("tbody").children("tr:lt("+b+")");for(a=0;a<b;a++)d.hasClass(g.asStripeClasses[a])&&(c=!0,g.asDestroyStripes.push(g.asStripeClasses[a]));c&&d.removeClass(g.asStripeClasses.join(" "))}c=[];a=this.getElementsByTagName("thead");0!==a.length&&(V(g.aoHeader,a[0]),c=N(g));if(null===e.aoColumns){d=[];a=0;for(b=
c.length;a<b;a++)d.push(null)}else d=e.aoColumns;a=0;for(b=d.length;a<b;a++)e.saved_aoColumns!==n&&e.saved_aoColumns.length==b&&(null===d[a]&&(d[a]={}),d[a].bVisible=e.saved_aoColumns[a].bVisible),o(g,c?c[a]:null);ta(g,e.aoColumnDefs,d,function(a,b){m(g,a,b)});a=0;for(b=g.aaSorting.length;a<b;a++){g.aaSorting[a][0]>=g.aoColumns.length&&(g.aaSorting[a][0]=0);var k=g.aoColumns[g.aaSorting[a][0]];g.aaSorting[a][2]===n&&(g.aaSorting[a][2]=0);e.aaSorting===n&&g.saved_aaSorting===n&&(g.aaSorting[a][1]=
k.asSorting[0]);c=0;for(d=k.asSorting.length;c<d;c++)if(g.aaSorting[a][1]==k.asSorting[c]){g.aaSorting[a][2]=c;break}}P(g);Ua(g);a=h(this).children("caption").each(function(){this._captionSide=h(this).css("caption-side")});b=h(this).children("thead");0===b.length&&(b=[l.createElement("thead")],this.appendChild(b[0]));g.nTHead=b[0];b=h(this).children("tbody");0===b.length&&(b=[l.createElement("tbody")],this.appendChild(b[0]));g.nTBody=b[0];g.nTBody.setAttribute("role","alert");g.nTBody.setAttribute("aria-live",
"polite");g.nTBody.setAttribute("aria-relevant","all");b=h(this).children("tfoot");if(0===b.length&&0<a.length&&(""!==g.oScroll.sX||""!==g.oScroll.sY))b=[l.createElement("tfoot")],this.appendChild(b[0]);0<b.length&&(g.nTFoot=b[0],V(g.aoFooter,g.nTFoot));if(f)for(a=0;a<e.aaData.length;a++)H(g,e.aaData[a]);else ua(g);g.aiDisplay=g.aiDisplayMaster.slice();g.bInitialised=!0;!1===i&&ba(g)}});ca=null;return this};j.fnVersionCheck=function(e){for(var h=function(e,h){for(;e.length<h;)e+="0";return e},m=j.ext.sVersion.split("."),
e=e.split("."),k="",n="",l=0,t=e.length;l<t;l++)k+=h(m[l],3),n+=h(e[l],3);return parseInt(k,10)>=parseInt(n,10)};j.fnIsDataTable=function(e){for(var h=j.settings,m=0;m<h.length;m++)if(h[m].nTable===e||h[m].nScrollHead===e||h[m].nScrollFoot===e)return!0;return!1};j.fnTables=function(e){var o=[];jQuery.each(j.settings,function(j,k){(!e||!0===e&&h(k.nTable).is(":visible"))&&o.push(k.nTable)});return o};j.version="1.9.4";j.settings=[];j.models={};j.models.ext={afnFiltering:[],afnSortData:[],aoFeatures:[],
aTypes:[],fnVersionCheck:j.fnVersionCheck,iApiIndex:0,ofnSearch:{},oApi:{},oStdClasses:{},oJUIClasses:{},oPagination:{},oSort:{},sVersion:j.version,sErrMode:"alert",_oExternConfig:{iNextUnique:0}};j.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};j.models.oRow={nTr:null,_aData:[],_aSortData:[],_anHidden:[],_sRowStripe:""};j.models.oColumn={aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bUseRendered:null,bVisible:null,_bAutoType:!0,fnCreatedCell:null,fnGetData:null,
fnRender:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};j.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,
bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollAutoCss:!0,bScrollCollapse:!1,bScrollInfinite:!1,bServerSide:!1,bSort:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCookieCallback:null,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(e){if(1E3>e)return e;for(var h=e+"",e=h.split(""),j="",h=h.length,k=0;k<h;k++)0===k%3&&0!==k&&(j=this.oLanguage.sInfoThousands+j),j=e[h-k-1]+j;return j},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,
fnRowCallback:null,fnServerData:function(e,j,m,k){k.jqXHR=h.ajax({url:e,data:j,success:function(e){e.sError&&k.oApi._fnLog(k,0,e.sError);h(k.oInstance).trigger("xhr",[k,e]);m(e)},dataType:"json",cache:!1,type:k.sServerMethod,error:function(e,h){"parsererror"==h&&k.oApi._fnLog(k,0,"DataTables warning: JSON data from server could not be parsed. This is caused by a JSON formatting error.")}})},fnServerParams:null,fnStateLoad:function(e){var e=this.oApi._fnReadCookie(e.sCookiePrefix+e.sInstance),j;try{j=
"function"===typeof h.parseJSON?h.parseJSON(e):eval("("+e+")")}catch(m){j=null}return j},fnStateLoadParams:null,fnStateLoaded:null,fnStateSave:function(e,h){this.oApi._fnCreateCookie(e.sCookiePrefix+e.sInstance,this.oApi._fnJsonString(h),e.iCookieDuration,e.sCookiePrefix,e.fnCookieCallback)},fnStateSaveParams:null,iCookieDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iScrollLoadGap:100,iTabIndex:0,oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},
oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sInfoThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sUrl:"",sZeroRecords:"No matching records found"},oSearch:h.extend({},j.models.oSearch),sAjaxDataProp:"aaData",
sAjaxSource:null,sCookiePrefix:"SpryMedia_DataTables_",sDom:"lfrtip",sPaginationType:"two_button",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET"};j.defaults.columns={aDataSort:null,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bUseRendered:!0,bVisible:!0,fnCreatedCell:null,fnRender:null,iDataSort:-1,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};j.models.oSettings={oFeatures:{bAutoWidth:null,
bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortClasses:null,bStateSave:null},oScroll:{bAutoCss:null,bCollapse:null,bInfinite:null,iBarWidth:0,iLoadGap:null,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1},aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],asDataSearch:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:null,
asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,sPaginationType:"two_button",iCookieDuration:0,sCookiePrefix:"",fnCookieCallback:null,aoStateSave:[],aoStateLoad:[],
oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iDisplayEnd:10,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsTotal,10):this.aiDisplayMaster.length},
fnRecordsDisplay:function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsDisplay,10):this.aiDisplay.length},fnDisplayEnd:function(){return this.oFeatures.bServerSide?!1===this.oFeatures.bPaginate||-1==this._iDisplayLength?this._iDisplayStart+this.aiDisplay.length:Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay):this._iDisplayEnd},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null};j.ext=h.extend(!0,{},j.models.ext);h.extend(j.ext.oStdClasses,
{sTable:"dataTable",sPagePrevEnabled:"paginate_enabled_previous",sPagePrevDisabled:"paginate_disabled_previous",sPageNextEnabled:"paginate_enabled_next",sPageNextDisabled:"paginate_disabled_next",sPageJUINext:"",sPageJUIPrev:"",sPageButton:"paginate_button",sPageButtonActive:"paginate_active",sPageButtonStaticDisabled:"paginate_button paginate_button_disabled",sPageFirst:"first",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",
sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",
sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:"",sJUIHeader:"",sJUIFooter:""});h.extend(j.ext.oJUIClasses,j.ext.oStdClasses,{sPagePrevEnabled:"fg-button ui-button ui-state-default ui-corner-left",sPagePrevDisabled:"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled",sPageNextEnabled:"fg-button ui-button ui-state-default ui-corner-right",
sPageNextDisabled:"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled",sPageJUINext:"ui-icon ui-icon-circle-arrow-e",sPageJUIPrev:"ui-icon ui-icon-circle-arrow-w",sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"fg-button ui-button ui-state-default ui-state-disabled",sPageButtonStaticDisabled:"fg-button ui-button ui-state-default ui-state-disabled",sPageFirst:"first ui-corner-tl ui-corner-bl",sPageLast:"last ui-corner-tr ui-corner-br",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",
sSortAsc:"ui-state-default",sSortDesc:"ui-state-default",sSortable:"ui-state-default",sSortableAsc:"ui-state-default",sSortableDesc:"ui-state-default",sSortableNone:"ui-state-default",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",
sScrollHead:"dataTables_scrollHead ui-state-default",sScrollFoot:"dataTables_scrollFoot ui-state-default",sFooterTH:"ui-state-default",sJUIHeader:"fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix",sJUIFooter:"fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"});h.extend(j.ext.oPagination,{two_button:{fnInit:function(e,j,m){var k=e.oLanguage.oPaginate,n=function(h){e.oApi._fnPageChange(e,h.data.action)&&m(e)},k=!e.bJUI?'<a class="'+
e.oClasses.sPagePrevDisabled+'" tabindex="'+e.iTabIndex+'" role="button">'+k.sPrevious+'</a><a class="'+e.oClasses.sPageNextDisabled+'" tabindex="'+e.iTabIndex+'" role="button">'+k.sNext+"</a>":'<a class="'+e.oClasses.sPagePrevDisabled+'" tabindex="'+e.iTabIndex+'" role="button"><span class="'+e.oClasses.sPageJUIPrev+'"></span></a><a class="'+e.oClasses.sPageNextDisabled+'" tabindex="'+e.iTabIndex+'" role="button"><span class="'+e.oClasses.sPageJUINext+'"></span></a>';h(j).append(k);var l=h("a",j),
k=l[0],l=l[1];e.oApi._fnBindAction(k,{action:"previous"},n);e.oApi._fnBindAction(l,{action:"next"},n);e.aanFeatures.p||(j.id=e.sTableId+"_paginate",k.id=e.sTableId+"_previous",l.id=e.sTableId+"_next",k.setAttribute("aria-controls",e.sTableId),l.setAttribute("aria-controls",e.sTableId))},fnUpdate:function(e){if(e.aanFeatures.p)for(var h=e.oClasses,j=e.aanFeatures.p,k,l=0,n=j.length;l<n;l++)if(k=j[l].firstChild)k.className=0===e._iDisplayStart?h.sPagePrevDisabled:h.sPagePrevEnabled,k=k.nextSibling,
k.className=e.fnDisplayEnd()==e.fnRecordsDisplay()?h.sPageNextDisabled:h.sPageNextEnabled}},iFullNumbersShowPages:5,full_numbers:{fnInit:function(e,j,m){var k=e.oLanguage.oPaginate,l=e.oClasses,n=function(h){e.oApi._fnPageChange(e,h.data.action)&&m(e)};h(j).append('<a  tabindex="'+e.iTabIndex+'" class="'+l.sPageButton+" "+l.sPageFirst+'">'+k.sFirst+'</a><a  tabindex="'+e.iTabIndex+'" class="'+l.sPageButton+" "+l.sPagePrevious+'">'+k.sPrevious+'</a><span></span><a tabindex="'+e.iTabIndex+'" class="'+
l.sPageButton+" "+l.sPageNext+'">'+k.sNext+'</a><a tabindex="'+e.iTabIndex+'" class="'+l.sPageButton+" "+l.sPageLast+'">'+k.sLast+"</a>");var t=h("a",j),k=t[0],l=t[1],r=t[2],t=t[3];e.oApi._fnBindAction(k,{action:"first"},n);e.oApi._fnBindAction(l,{action:"previous"},n);e.oApi._fnBindAction(r,{action:"next"},n);e.oApi._fnBindAction(t,{action:"last"},n);e.aanFeatures.p||(j.id=e.sTableId+"_paginate",k.id=e.sTableId+"_first",l.id=e.sTableId+"_previous",r.id=e.sTableId+"_next",t.id=e.sTableId+"_last")},
fnUpdate:function(e,o){if(e.aanFeatures.p){var m=j.ext.oPagination.iFullNumbersShowPages,k=Math.floor(m/2),l=Math.ceil(e.fnRecordsDisplay()/e._iDisplayLength),n=Math.ceil(e._iDisplayStart/e._iDisplayLength)+1,t="",r,B=e.oClasses,u,M=e.aanFeatures.p,L=function(h){e.oApi._fnBindAction(this,{page:h+r-1},function(h){e.oApi._fnPageChange(e,h.data.page);o(e);h.preventDefault()})};-1===e._iDisplayLength?n=k=r=1:l<m?(r=1,k=l):n<=k?(r=1,k=m):n>=l-k?(r=l-m+1,k=l):(r=n-Math.ceil(m/2)+1,k=r+m-1);for(m=r;m<=k;m++)t+=
n!==m?'<a tabindex="'+e.iTabIndex+'" class="'+B.sPageButton+'">'+e.fnFormatNumber(m)+"</a>":'<a tabindex="'+e.iTabIndex+'" class="'+B.sPageButtonActive+'">'+e.fnFormatNumber(m)+"</a>";m=0;for(k=M.length;m<k;m++)u=M[m],u.hasChildNodes()&&(h("span:eq(0)",u).html(t).children("a").each(L),u=u.getElementsByTagName("a"),u=[u[0],u[1],u[u.length-2],u[u.length-1]],h(u).removeClass(B.sPageButton+" "+B.sPageButtonActive+" "+B.sPageButtonStaticDisabled),h([u[0],u[1]]).addClass(1==n?B.sPageButtonStaticDisabled:
B.sPageButton),h([u[2],u[3]]).addClass(0===l||n===l||-1===e._iDisplayLength?B.sPageButtonStaticDisabled:B.sPageButton))}}}});h.extend(j.ext.oSort,{"string-pre":function(e){"string"!=typeof e&&(e=null!==e&&e.toString?e.toString():"");return e.toLowerCase()},"string-asc":function(e,h){return e<h?-1:e>h?1:0},"string-desc":function(e,h){return e<h?1:e>h?-1:0},"html-pre":function(e){return e.replace(/<.*?>/g,"").toLowerCase()},"html-asc":function(e,h){return e<h?-1:e>h?1:0},"html-desc":function(e,h){return e<
h?1:e>h?-1:0},"date-pre":function(e){e=Date.parse(e);if(isNaN(e)||""===e)e=Date.parse("01/01/1970 00:00:00");return e},"date-asc":function(e,h){return e-h},"date-desc":function(e,h){return h-e},"numeric-pre":function(e){return"-"==e||""===e?0:1*e},"numeric-asc":function(e,h){return e-h},"numeric-desc":function(e,h){return h-e}});h.extend(j.ext.aTypes,[function(e){if("number"===typeof e)return"numeric";if("string"!==typeof e)return null;var h,j=!1;h=e.charAt(0);if(-1=="0123456789-".indexOf(h))return null;
for(var k=1;k<e.length;k++){h=e.charAt(k);if(-1=="0123456789.".indexOf(h))return null;if("."==h){if(j)return null;j=!0}}return"numeric"},function(e){var h=Date.parse(e);return null!==h&&!isNaN(h)||"string"===typeof e&&0===e.length?"date":null},function(e){return"string"===typeof e&&-1!=e.indexOf("<")&&-1!=e.indexOf(">")?"html":null}]);h.fn.DataTable=j;h.fn.dataTable=j;h.fn.dataTableSettings=j.settings;h.fn.dataTableExt=j.ext};"function"===typeof define&&define.amd?define(["jquery"],L):jQuery&&!jQuery.fn.dataTable&&
L(jQuery)})(window,document);

//http://datatables.net/plug-ins/pagination#bootstrap
$.extend( true, $.fn.dataTable.defaults, {
	"sDom": "<'row'<'col-sm-6'l><'col-sm-6'f>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
	"sPaginationType": "bootstrap",
	"oLanguage": {
		"sLengthMenu": "Display _MENU_ records"
	}
} );


/* API method to get paging information */
$.fn.dataTableExt.oApi.fnPagingInfo = function ( oSettings )
{
    return {
        "iStart":         oSettings._iDisplayStart,
        "iEnd":           oSettings.fnDisplayEnd(),
        "iLength":        oSettings._iDisplayLength,
        "iTotal":         oSettings.fnRecordsTotal(),
        "iFilteredTotal": oSettings.fnRecordsDisplay(),
        "iPage":          Math.ceil( oSettings._iDisplayStart / oSettings._iDisplayLength ),
        "iTotalPages":    Math.ceil( oSettings.fnRecordsDisplay() / oSettings._iDisplayLength )
    };
}
 
/* Bootstrap style pagination control */
$.extend( $.fn.dataTableExt.oPagination, {
    "bootstrap": {
        "fnInit": function( oSettings, nPaging, fnDraw ) {
            var oLang = oSettings.oLanguage.oPaginate;
            var fnClickHandler = function ( e ) {
                e.preventDefault();
                if ( oSettings.oApi._fnPageChange(oSettings, e.data.action) ) {
                    fnDraw( oSettings );
                }
            };
 
            $(nPaging).append(
                '<ul class="pagination">'+
                    '<li class="prev disabled"><a href="#"><i class="icon-double-angle-left"></i></a></li>'+
                    '<li class="next disabled"><a href="#"><i class="icon-double-angle-right"></i></a></li>'+
                '</ul>'
            );
            var els = $('a', nPaging);
            $(els[0]).bind( 'click.DT', { action: "previous" }, fnClickHandler );
            $(els[1]).bind( 'click.DT', { action: "next" }, fnClickHandler );
        },
 
        "fnUpdate": function ( oSettings, fnDraw ) {
            var iListLength = 5;
            var oPaging = oSettings.oInstance.fnPagingInfo();
            var an = oSettings.aanFeatures.p;
            var i, j, sClass, iStart, iEnd, iHalf=Math.floor(iListLength/2);
 
            if ( oPaging.iTotalPages < iListLength) {
                iStart = 1;
                iEnd = oPaging.iTotalPages;
            }
            else if ( oPaging.iPage <= iHalf ) {
                iStart = 1;
                iEnd = iListLength;
            } else if ( oPaging.iPage >= (oPaging.iTotalPages-iHalf) ) {
                iStart = oPaging.iTotalPages - iListLength + 1;
                iEnd = oPaging.iTotalPages;
            } else {
                iStart = oPaging.iPage - iHalf + 1;
                iEnd = iStart + iListLength - 1;
            }
 
            for ( i=0, iLen=an.length ; i<iLen ; i++ ) {
                // Remove the middle elements
                $('li:gt(0)', an[i]).filter(':not(:last)').remove();
 
                // Add the new list items and their event handlers
                for ( j=iStart ; j<=iEnd ; j++ ) {
                    sClass = (j==oPaging.iPage+1) ? 'class="active"' : '';
                    $('<li '+sClass+'><a href="#">'+j+'</a></li>')
                        .insertBefore( $('li:last', an[i])[0] )
                        .bind('click', function (e) {
                            e.preventDefault();
                            oSettings._iDisplayStart = (parseInt($('a', this).text(),10)-1) * oPaging.iLength;
                            fnDraw( oSettings );
                        } );
                }
 
                // Add / remove disabled classes from the static elements
                if ( oPaging.iPage === 0 ) {
                    $('li:first', an[i]).addClass('disabled');
                } else {
                    $('li:first', an[i]).removeClass('disabled');
                }
 
                if ( oPaging.iPage === oPaging.iTotalPages-1 || oPaging.iTotalPages === 0 ) {
                    $('li:last', an[i]).addClass('disabled');
                } else {
                    $('li:last', an[i]).removeClass('disabled');
                }
            }
        }
    }
} );
/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2013 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
	Version: 1.3.1
*/
(function(e){function t(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),"function"==typeof e[t]?"paste":"input"}var n,a=t()+".mask",r=navigator.userAgent,i=/iphone/i.test(r),o=/android/i.test(r);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,r){var c,l,s,u,f,h;return!t&&this.length>0?(c=e(this[0]),c.data(e.mask.dataName)()):(r=e.extend({placeholder:e.mask.placeholder,completed:null},r),l=e.mask.definitions,s=[],u=h=t.length,f=null,e.each(t.split(""),function(e,t){"?"==t?(h--,u=e):l[t]?(s.push(RegExp(l[t])),null===f&&(f=s.length-1)):s.push(null)}),this.trigger("unmask").each(function(){function c(e){for(;h>++e&&!s[e];);return e}function d(e){for(;--e>=0&&!s[e];);return e}function m(e,t){var n,a;if(!(0>e)){for(n=e,a=c(t);h>n;n++)if(s[n]){if(!(h>a&&s[n].test(R[a])))break;R[n]=R[a],R[a]=r.placeholder,a=c(a)}b(),x.caret(Math.max(f,e))}}function p(e){var t,n,a,i;for(t=e,n=r.placeholder;h>t;t++)if(s[t]){if(a=c(t),i=R[t],R[t]=n,!(h>a&&s[a].test(i)))break;n=i}}function g(e){var t,n,a,r=e.which;8===r||46===r||i&&127===r?(t=x.caret(),n=t.begin,a=t.end,0===a-n&&(n=46!==r?d(n):a=c(n-1),a=46===r?c(a):a),k(n,a),m(n,a-1),e.preventDefault()):27==r&&(x.val(S),x.caret(0,y()),e.preventDefault())}function v(t){var n,a,i,l=t.which,u=x.caret();t.ctrlKey||t.altKey||t.metaKey||32>l||l&&(0!==u.end-u.begin&&(k(u.begin,u.end),m(u.begin,u.end-1)),n=c(u.begin-1),h>n&&(a=String.fromCharCode(l),s[n].test(a)&&(p(n),R[n]=a,b(),i=c(n),o?setTimeout(e.proxy(e.fn.caret,x,i),0):x.caret(i),r.completed&&i>=h&&r.completed.call(x))),t.preventDefault())}function k(e,t){var n;for(n=e;t>n&&h>n;n++)s[n]&&(R[n]=r.placeholder)}function b(){x.val(R.join(""))}function y(e){var t,n,a=x.val(),i=-1;for(t=0,pos=0;h>t;t++)if(s[t]){for(R[t]=r.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),s[t].test(n)){R[t]=n,i=t;break}if(pos>a.length)break}else R[t]===a.charAt(pos)&&t!==u&&(pos++,i=t);return e?b():u>i+1?(x.val(""),k(0,h)):(b(),x.val(x.val().substring(0,i+1))),u?t:f}var x=e(this),R=e.map(t.split(""),function(e){return"?"!=e?l[e]?r.placeholder:e:void 0}),S=x.val();x.data(e.mask.dataName,function(){return e.map(R,function(e,t){return s[t]&&e!=r.placeholder?e:null}).join("")}),x.attr("readonly")||x.one("unmask",function(){x.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(n);var e;S=x.val(),e=y(),n=setTimeout(function(){b(),e==t.length?x.caret(0,e):x.caret(e)},10)}).bind("blur.mask",function(){y(),x.val()!=S&&x.change()}).bind("keydown.mask",g).bind("keypress.mask",v).bind(a,function(){setTimeout(function(){var e=y(!0);x.caret(e),r.completed&&e==x.val().length&&r.completed.call(x)},0)}),y()}))}})})(jQuery);
/*! jQuery Validation Plugin - v1.11.1 - 3/22/2013\n* https://github.com/jzaefferer/jquery-validation
* Copyright (c) 2013 Jörn Zaefferer; Licensed MIT */(function(t){t.extend(t.fn,{validate:function(e){if(!this.length)return e&&e.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."),void 0;var i=t.data(this[0],"validator");return i?i:(this.attr("novalidate","novalidate"),i=new t.validator(e,this[0]),t.data(this[0],"validator",i),i.settings.onsubmit&&(this.validateDelegate(":submit","click",function(e){i.settings.submitHandler&&(i.submitButton=e.target),t(e.target).hasClass("cancel")&&(i.cancelSubmit=!0),void 0!==t(e.target).attr("formnovalidate")&&(i.cancelSubmit=!0)}),this.submit(function(e){function s(){var s;return i.settings.submitHandler?(i.submitButton&&(s=t("<input type='hidden'/>").attr("name",i.submitButton.name).val(t(i.submitButton).val()).appendTo(i.currentForm)),i.settings.submitHandler.call(i,i.currentForm,e),i.submitButton&&s.remove(),!1):!0}return i.settings.debug&&e.preventDefault(),i.cancelSubmit?(i.cancelSubmit=!1,s()):i.form()?i.pendingRequest?(i.formSubmitted=!0,!1):s():(i.focusInvalid(),!1)})),i)},valid:function(){if(t(this[0]).is("form"))return this.validate().form();var e=!0,i=t(this[0].form).validate();return this.each(function(){e=e&&i.element(this)}),e},removeAttrs:function(e){var i={},s=this;return t.each(e.split(/\s/),function(t,e){i[e]=s.attr(e),s.removeAttr(e)}),i},rules:function(e,i){var s=this[0];if(e){var r=t.data(s.form,"validator").settings,n=r.rules,a=t.validator.staticRules(s);switch(e){case"add":t.extend(a,t.validator.normalizeRule(i)),delete a.messages,n[s.name]=a,i.messages&&(r.messages[s.name]=t.extend(r.messages[s.name],i.messages));break;case"remove":if(!i)return delete n[s.name],a;var u={};return t.each(i.split(/\s/),function(t,e){u[e]=a[e],delete a[e]}),u}}var o=t.validator.normalizeRules(t.extend({},t.validator.classRules(s),t.validator.attributeRules(s),t.validator.dataRules(s),t.validator.staticRules(s)),s);if(o.required){var l=o.required;delete o.required,o=t.extend({required:l},o)}return o}}),t.extend(t.expr[":"],{blank:function(e){return!t.trim(""+t(e).val())},filled:function(e){return!!t.trim(""+t(e).val())},unchecked:function(e){return!t(e).prop("checked")}}),t.validator=function(e,i){this.settings=t.extend(!0,{},t.validator.defaults,e),this.currentForm=i,this.init()},t.validator.format=function(e,i){return 1===arguments.length?function(){var i=t.makeArray(arguments);return i.unshift(e),t.validator.format.apply(this,i)}:(arguments.length>2&&i.constructor!==Array&&(i=t.makeArray(arguments).slice(1)),i.constructor!==Array&&(i=[i]),t.each(i,function(t,i){e=e.replace(RegExp("\\{"+t+"\\}","g"),function(){return i})}),e)},t.extend(t.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:t([]),errorLabelContainer:t([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(t){this.lastActive=t,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,t,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(t)).hide())},onfocusout:function(t){this.checkable(t)||!(t.name in this.submitted)&&this.optional(t)||this.element(t)},onkeyup:function(t,e){(9!==e.which||""!==this.elementValue(t))&&(t.name in this.submitted||t===this.lastElement)&&this.element(t)},onclick:function(t){t.name in this.submitted?this.element(t):t.parentNode.name in this.submitted&&this.element(t.parentNode)},highlight:function(e,i,s){"radio"===e.type?this.findByName(e.name).addClass(i).removeClass(s):t(e).addClass(i).removeClass(s)},unhighlight:function(e,i,s){"radio"===e.type?this.findByName(e.name).removeClass(i).addClass(s):t(e).removeClass(i).addClass(s)}},setDefaults:function(e){t.extend(t.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:t.validator.format("Please enter no more than {0} characters."),minlength:t.validator.format("Please enter at least {0} characters."),rangelength:t.validator.format("Please enter a value between {0} and {1} characters long."),range:t.validator.format("Please enter a value between {0} and {1}."),max:t.validator.format("Please enter a value less than or equal to {0}."),min:t.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function e(e){var i=t.data(this[0].form,"validator"),s="on"+e.type.replace(/^validate/,"");i.settings[s]&&i.settings[s].call(i,this[0],e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var i=this.groups={};t.each(this.settings.groups,function(e,s){"string"==typeof s&&(s=s.split(/\s/)),t.each(s,function(t,s){i[s]=e})});var s=this.settings.rules;t.each(s,function(e,i){s[e]=t.validator.normalizeRule(i)}),t(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",e).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",e),this.settings.invalidHandler&&t(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var t=0,e=this.currentElements=this.elements();e[t];t++)this.check(e[t]);return this.valid()},element:function(e){e=this.validationTargetFor(this.clean(e)),this.lastElement=e,this.prepareElement(e),this.currentElements=t(e);var i=this.check(e)!==!1;return i?delete this.invalid[e.name]:this.invalid[e.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),i},showErrors:function(e){if(e){t.extend(this.errorMap,e),this.errorList=[];for(var i in e)this.errorList.push({message:e[i],element:this.findByName(i)[0]});this.successList=t.grep(this.successList,function(t){return!(t.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){t.fn.resetForm&&t(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(t){var e=0;for(var i in t)e++;return e},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{t(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var e=this.lastActive;return e&&1===t.grep(this.errorList,function(t){return t.element.name===e.name}).length&&e},elements:function(){var e=this,i={};return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in i||!e.objectLength(t(this).rules())?!1:(i[this.name]=!0,!0)})},clean:function(e){return t(e)[0]},errors:function(){var e=this.settings.errorClass.replace(" ",".");return t(this.settings.errorElement+"."+e,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=t([]),this.toHide=t([]),this.currentElements=t([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(t){this.reset(),this.toHide=this.errorsFor(t)},elementValue:function(e){var i=t(e).attr("type"),s=t(e).val();return"radio"===i||"checkbox"===i?t("input[name='"+t(e).attr("name")+"']:checked").val():"string"==typeof s?s.replace(/\r/g,""):s},check:function(e){e=this.validationTargetFor(this.clean(e));var i,s=t(e).rules(),r=!1,n=this.elementValue(e);for(var a in s){var u={method:a,parameters:s[a]};try{if(i=t.validator.methods[a].call(this,n,e,u.parameters),"dependency-mismatch"===i){r=!0;continue}if(r=!1,"pending"===i)return this.toHide=this.toHide.not(this.errorsFor(e)),void 0;if(!i)return this.formatAndAdd(e,u),!1}catch(o){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+e.id+", check the '"+u.method+"' method.",o),o}}return r?void 0:(this.objectLength(s)&&this.successList.push(e),!0)},customDataMessage:function(e,i){return t(e).data("msg-"+i.toLowerCase())||e.attributes&&t(e).attr("data-msg-"+i.toLowerCase())},customMessage:function(t,e){var i=this.settings.messages[t];return i&&(i.constructor===String?i:i[e])},findDefined:function(){for(var t=0;arguments.length>t;t++)if(void 0!==arguments[t])return arguments[t];return void 0},defaultMessage:function(e,i){return this.findDefined(this.customMessage(e.name,i),this.customDataMessage(e,i),!this.settings.ignoreTitle&&e.title||void 0,t.validator.messages[i],"<strong>Warning: No message defined for "+e.name+"</strong>")},formatAndAdd:function(e,i){var s=this.defaultMessage(e,i.method),r=/\$?\{(\d+)\}/g;"function"==typeof s?s=s.call(this,i.parameters,e):r.test(s)&&(s=t.validator.format(s.replace(r,"{$1}"),i.parameters)),this.errorList.push({message:s,element:e}),this.errorMap[e.name]=s,this.submitted[e.name]=s},addWrapper:function(t){return this.settings.wrapper&&(t=t.add(t.parent(this.settings.wrapper))),t},defaultShowErrors:function(){var t,e;for(t=0;this.errorList[t];t++){var i=this.errorList[t];this.settings.highlight&&this.settings.highlight.call(this,i.element,this.settings.errorClass,this.settings.validClass),this.showLabel(i.element,i.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(t=0;this.successList[t];t++)this.showLabel(this.successList[t]);if(this.settings.unhighlight)for(t=0,e=this.validElements();e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return t(this.errorList).map(function(){return this.element})},showLabel:function(e,i){var s=this.errorsFor(e);s.length?(s.removeClass(this.settings.validClass).addClass(this.settings.errorClass),s.html(i)):(s=t("<"+this.settings.errorElement+">").attr("for",this.idOrName(e)).addClass(this.settings.errorClass).html(i||""),this.settings.wrapper&&(s=s.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(s).length||(this.settings.errorPlacement?this.settings.errorPlacement(s,t(e)):s.insertAfter(e))),!i&&this.settings.success&&(s.text(""),"string"==typeof this.settings.success?s.addClass(this.settings.success):this.settings.success(s,e)),this.toShow=this.toShow.add(s)},errorsFor:function(e){var i=this.idOrName(e);return this.errors().filter(function(){return t(this).attr("for")===i})},idOrName:function(t){return this.groups[t.name]||(this.checkable(t)?t.name:t.id||t.name)},validationTargetFor:function(t){return this.checkable(t)&&(t=this.findByName(t.name).not(this.settings.ignore)[0]),t},checkable:function(t){return/radio|checkbox/i.test(t.type)},findByName:function(e){return t(this.currentForm).find("[name='"+e+"']")},getLength:function(e,i){switch(i.nodeName.toLowerCase()){case"select":return t("option:selected",i).length;case"input":if(this.checkable(i))return this.findByName(i.name).filter(":checked").length}return e.length},depend:function(t,e){return this.dependTypes[typeof t]?this.dependTypes[typeof t](t,e):!0},dependTypes:{"boolean":function(t){return t},string:function(e,i){return!!t(e,i.form).length},"function":function(t,e){return t(e)}},optional:function(e){var i=this.elementValue(e);return!t.validator.methods.required.call(this,i,e)&&"dependency-mismatch"},startRequest:function(t){this.pending[t.name]||(this.pendingRequest++,this.pending[t.name]=!0)},stopRequest:function(e,i){this.pendingRequest--,0>this.pendingRequest&&(this.pendingRequest=0),delete this.pending[e.name],i&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(t(this.currentForm).submit(),this.formSubmitted=!1):!i&&0===this.pendingRequest&&this.formSubmitted&&(t(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,i){e.constructor===String?this.classRuleSettings[e]=i:t.extend(this.classRuleSettings,e)},classRules:function(e){var i={},s=t(e).attr("class");return s&&t.each(s.split(" "),function(){this in t.validator.classRuleSettings&&t.extend(i,t.validator.classRuleSettings[this])}),i},attributeRules:function(e){var i={},s=t(e),r=s[0].getAttribute("type");for(var n in t.validator.methods){var a;"required"===n?(a=s.get(0).getAttribute(n),""===a&&(a=!0),a=!!a):a=s.attr(n),/min|max/.test(n)&&(null===r||/number|range|text/.test(r))&&(a=Number(a)),a?i[n]=a:r===n&&"range"!==r&&(i[n]=!0)}return i.maxlength&&/-1|2147483647|524288/.test(i.maxlength)&&delete i.maxlength,i},dataRules:function(e){var i,s,r={},n=t(e);for(i in t.validator.methods)s=n.data("rule-"+i.toLowerCase()),void 0!==s&&(r[i]=s);return r},staticRules:function(e){var i={},s=t.data(e.form,"validator");return s.settings.rules&&(i=t.validator.normalizeRule(s.settings.rules[e.name])||{}),i},normalizeRules:function(e,i){return t.each(e,function(s,r){if(r===!1)return delete e[s],void 0;if(r.param||r.depends){var n=!0;switch(typeof r.depends){case"string":n=!!t(r.depends,i.form).length;break;case"function":n=r.depends.call(i,i)}n?e[s]=void 0!==r.param?r.param:!0:delete e[s]}}),t.each(e,function(s,r){e[s]=t.isFunction(r)?r(i):r}),t.each(["minlength","maxlength"],function(){e[this]&&(e[this]=Number(e[this]))}),t.each(["rangelength","range"],function(){var i;e[this]&&(t.isArray(e[this])?e[this]=[Number(e[this][0]),Number(e[this][1])]:"string"==typeof e[this]&&(i=e[this].split(/[\s,]+/),e[this]=[Number(i[0]),Number(i[1])]))}),t.validator.autoCreateRanges&&(e.min&&e.max&&(e.range=[e.min,e.max],delete e.min,delete e.max),e.minlength&&e.maxlength&&(e.rangelength=[e.minlength,e.maxlength],delete e.minlength,delete e.maxlength)),e},normalizeRule:function(e){if("string"==typeof e){var i={};t.each(e.split(/\s/),function(){i[this]=!0}),e=i}return e},addMethod:function(e,i,s){t.validator.methods[e]=i,t.validator.messages[e]=void 0!==s?s:t.validator.messages[e],3>i.length&&t.validator.addClassRules(e,t.validator.normalizeRule(e))},methods:{required:function(e,i,s){if(!this.depend(s,i))return"dependency-mismatch";if("select"===i.nodeName.toLowerCase()){var r=t(i).val();return r&&r.length>0}return this.checkable(i)?this.getLength(e,i)>0:t.trim(e).length>0},email:function(t,e){return this.optional(e)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(""+new Date(t))},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},creditcard:function(t,e){if(this.optional(e))return"dependency-mismatch";if(/[^0-9 \-]+/.test(t))return!1;var i=0,s=0,r=!1;t=t.replace(/\D/g,"");for(var n=t.length-1;n>=0;n--){var a=t.charAt(n);s=parseInt(a,10),r&&(s*=2)>9&&(s-=9),i+=s,r=!r}return 0===i%10},minlength:function(e,i,s){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),i);return this.optional(i)||r>=s},maxlength:function(e,i,s){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),i);return this.optional(i)||s>=r},rangelength:function(e,i,s){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),i);return this.optional(i)||r>=s[0]&&s[1]>=r},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&i[1]>=t},equalTo:function(e,i,s){var r=t(s);return this.settings.onfocusout&&r.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(i).valid()}),e===r.val()},remote:function(e,i,s){if(this.optional(i))return"dependency-mismatch";var r=this.previousValue(i);if(this.settings.messages[i.name]||(this.settings.messages[i.name]={}),r.originalMessage=this.settings.messages[i.name].remote,this.settings.messages[i.name].remote=r.message,s="string"==typeof s&&{url:s}||s,r.old===e)return r.valid;r.old=e;var n=this;this.startRequest(i);var a={};return a[i.name]=e,t.ajax(t.extend(!0,{url:s,mode:"abort",port:"validate"+i.name,dataType:"json",data:a,success:function(s){n.settings.messages[i.name].remote=r.originalMessage;var a=s===!0||"true"===s;if(a){var u=n.formSubmitted;n.prepareElement(i),n.formSubmitted=u,n.successList.push(i),delete n.invalid[i.name],n.showErrors()}else{var o={},l=s||n.defaultMessage(i,"remote");o[i.name]=r.message=t.isFunction(l)?l(e):l,n.invalid[i.name]=!0,n.showErrors(o)}r.valid=a,n.stopRequest(i,a)}},s)),"pending"}}}),t.format=t.validator.format})(jQuery),function(t){var e={};if(t.ajaxPrefilter)t.ajaxPrefilter(function(t,i,s){var r=t.port;"abort"===t.mode&&(e[r]&&e[r].abort(),e[r]=s)});else{var i=t.ajax;t.ajax=function(s){var r=("mode"in s?s:t.ajaxSettings).mode,n=("port"in s?s:t.ajaxSettings).port;return"abort"===r?(e[n]&&e[n].abort(),e[n]=i.apply(this,arguments),e[n]):i.apply(this,arguments)}}}(jQuery),function(t){t.extend(t.fn,{validateDelegate:function(e,i,s){return this.bind(i,function(i){var r=t(i.target);return r.is(e)?s.apply(r,arguments):void 0})}})}(jQuery);
(function(b,c){var a=function(f,e){var d;this.$element=b(f);this.options=b.extend({},b.fn.wizard.defaults,e);this.currentStep=1;this.numSteps=this.$element.find("li").length;this.$prevBtn=this.$element.find("button.btn-prev");this.$nextBtn=this.$element.find("button.btn-next");d=this.$nextBtn.children().detach();this.nextText=b.trim(this.$nextBtn.text());this.$nextBtn.append(d);this.$prevBtn.on("click",b.proxy(this.previous,this));this.$nextBtn.on("click",b.proxy(this.next,this));this.$element.on("click","li.complete",b.proxy(this.stepclicked,this));this.$stepContainer=this.$element.data("target")||"body";this.$stepContainer=b(this.$stepContainer)};a.prototype={constructor:a,setState:function(){var n=(this.currentStep>1);var o=(this.currentStep===1);var d=(this.currentStep===this.numSteps);this.$prevBtn.attr("disabled",(o===true||n===false));var h=this.$nextBtn.data();if(h&&h.last){this.lastText=h.last;if(typeof this.lastText!=="undefined"){var l=(d!==true)?this.nextText:this.lastText;var f=this.$nextBtn.children().detach();this.$nextBtn.text(l).append(f)}}var j=this.$element.find("li");j.removeClass("active").removeClass("complete");j.find("span.badge").removeClass("badge-info").removeClass("badge-success");var m="li:lt("+(this.currentStep-1)+")";var g=this.$element.find(m);g.addClass("complete");g.find("span.badge").addClass("badge-success");var e="li:eq("+(this.currentStep-1)+")";var k=this.$element.find(e);k.addClass("active");k.find("span.badge").addClass("badge-info");var i=k.data().target;this.$stepContainer.find(".step-pane").removeClass("active");b(i).addClass("active");this.$element.trigger("changed")},stepclicked:function(h){var d=b(h.currentTarget);var g=this.$element.find("li").index(d);var f=b.Event("stepclick");this.$element.trigger(f,{step:g+1});if(f.isDefaultPrevented()){return}this.currentStep=(g+1);this.setState()},previous:function(){var d=(this.currentStep>1);if(d){var f=b.Event("change");this.$element.trigger(f,{step:this.currentStep,direction:"previous"});if(f.isDefaultPrevented()){return}this.currentStep-=1;this.setState()}},next:function(){var g=(this.currentStep+1<=this.numSteps);var d=(this.currentStep===this.numSteps);if(g){var f=b.Event("change");this.$element.trigger(f,{step:this.currentStep,direction:"next"});if(f.isDefaultPrevented()){return}this.currentStep+=1;this.setState()}else{if(d){this.$element.trigger("finished")}}},selectedItem:function(d){return{step:this.currentStep}}};b.fn.wizard=function(e,g){var f;var d=this.each(function(){var j=b(this);var i=j.data("wizard");var h=typeof e==="object"&&e;if(!i){j.data("wizard",(i=new a(this,h)))}if(typeof e==="string"){f=i[e](g)}});return(f===c)?d:f};b.fn.wizard.defaults={};b.fn.wizard.Constructor=a;b(function(){b("body").on("mousedown.wizard.data-api",".wizard",function(){var d=b(this);if(d.data("wizard")){return}d.wizard(d.data())})})})(window.jQuery);
/*! jQuery responsive breadcrumbs plugin - v1.1.0 | https://github.com/cm0s/jquery-rcrumbs | (c) 2014 Nicolas Forney | License MIT */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$element=a(b),this.options=a.extend(!0,{},g,c),this._defaults=g,this._name=f,e.prototype.plugin=this,this._init()}var f="rcrumbs",g={version:"@@version",callback:{preCrumbsListDisplay:a.noop,preCrumbDisplay:a.noop,postCrumbsListDisplay:a.noop,postCrumbDisplay:a.noop},ellipsis:!0,windowResize:!0,nbUncollapsableCrumbs:2,nbFixedCrumbs:0,animation:{activated:!0,speed:400}};e.prototype={version:function(){return this.options.version},_init:function(){if(this.$element.hasClass("rcrumbs")||this.$element.addClass("rcrumbs"),this.nbCrumbDisplayed=0,this.$crumbsList=a("ul",this.element),this.$crumbs=a("li",this.$crumbsList),this.$lastCrumb=this.$crumbs.last(),this.reversedCrumbs=a("li",this.$crumbsList).get().reverse(),this.lastNbCrumbDisplayed=0,this.totalCrumbsWidth=0,this.fixedCrumbsWidth=0,this._initCrumbs(),this.options.nbFixedCrumbs>0){var b=this.$crumbs.length;this.$crumbs=a("li",this.$crumbsList).slice(this.options.nbFixedCrumbs,b),this.reversedCrumbs=a("li",this.$crumbsList).slice(this.options.nbFixedCrumbs,b).get().reverse();var c=this;a("li",this.$crumbsList).slice(0,this.options.nbFixedCrumbs).each(function(b,d){c.totalCrumbsWidth+=a(d).data("width"),a(d).addClass("show")})}this._showOrHideCrumbsList(!0),this.options.windowResize&&this._showOrHideCrumbsListOnWindowResize()},_getHiddenElWidth:function(b){var c,d=a(b).clone(!1);return d.css({visibility:"hidden",position:"absolute"}),d.appendTo(this.$crumbsList),c=d.width(),d.remove(),c},_initCrumbs:function(){var b=this;a(this.$crumbsList).contents().filter(function(){return 3===this.nodeType}).remove(),a.each(this.$crumbs,function(){var c=a(this);b._storeCrumbWidth(c)}),this.options.nbFixedCrumbs>0&&a(this.$crumbs).slice(0,this.options.nbFixedCrumbs).each(function(c,d){b.fixedCrumbsWidth+=a(d).data("width")})},_storeCrumbWidth:function(a){var b=this._getHiddenElWidth(a);return a.data("width",b),b},_showOrHideCrumbsList:function(b){var c=this;this.remainingSpaceToDisplayCrumbs=this.$element.width(),this.nbCrumbDisplayed=0,this.totalCrumbsWidth=0,this.options.nbFixedCrumbs>0&&(this.remainingSpaceToDisplayCrumbs-=this.fixedCrumbsWidth,a("li",this.$crumbsList).slice(0,this.options.nbFixedCrumbs).each(function(b,d){c.totalCrumbsWidth+=a(d).data("width")})),this.nextCrumbToShowWidth=d,this.options.callback.preCrumbsListDisplay(this),a.each(this.reversedCrumbs,function(d){var e=a(this),f=a(c.reversedCrumbs[d+1]);c._showOrHideCrumb(e,f,d,b)}),this.lastNbCrumbDisplayed=this.nbCrumbDisplayed,this.options.callback.postCrumbsListDisplay(this)},_showOrHideCrumb:function(a,b,c,d){function e(){a.addClass("show"),h.lastNbCrumbDisplayed<h.nbCrumbDisplayed+1&&h.options.animation.activated&&!d?(a.width(0),a.animate({width:a.data("width")},h.options.animation.speed,function(){h.options.callback.postCrumbDisplay(a)})):h.options.callback.postCrumbDisplay(a),h.nbCrumbDisplayed+=1}function f(){a.animate({width:0},h.options.animation.speed,function(){a.removeClass("show")})}function g(a){a.css({width:h.remainingSpaceToDisplayCrumbs+a.data("width")+"px"}),a.addClass("ellipsis")}this.options.callback.preCrumbDisplay(a);var h=this;this.remainingSpaceToDisplayCrumbs-=a.data("width"),c<this.options.nbUncollapsableCrumbs?(e(),this.remainingSpaceToDisplayCrumbs<0&&g(this.$lastCrumb),this.totalCrumbsWidth+=a.data("width")):this.remainingSpaceToDisplayCrumbs>=0?(e(),this.totalCrumbsWidth+=a.data("width")):(this.lastNbCrumbDisplayed>this.nbCrumbDisplayed-1&&this.options.animation.activated?f():a.removeClass("show"),this.nextCrumbToShowWidth||(this.nextCrumbToShowWidth=a.data("width")))},_showOrHideCrumbsListOnWindowResize:function(){var c=this;a(b).resize(function(){var b=c.$element.width();(b<c.totalCrumbsWidth||c.totalCrumbsWidth+c.nextCrumbToShowWidth<b)&&(a.each(c.reversedCrumbs,function(){var b=a(this);b.stop(!0,!0)}),c._showOrHideCrumbsList()),b>=c.totalCrumbsWidth&&c.$lastCrumb.hasClass("ellipsis")&&c._disableEllipsis(c.$lastCrumb)})},_disableEllipsis:function(a){a.css({width:"auto"}),a.removeClass("ellipsis")}},a.fn[f]=function(b){if(e.prototype[b]&&-1===b.indexOf("_")){var c=a.data(this[0],"plugin_"+f);if(c)return e.prototype[b].apply(c,Array.prototype.slice.call(arguments,1));a.error("jquery."+f+" plugin must be initialized first on the element")}else{if("object"==typeof b||!b)return this.each(function(){a.data(this,"plugin_"+f)?a.error("jquery."+f+" plugin cannot be instantiated multiple times on same element"):a.data(this,"plugin_"+f,new e(this,b))});a.error("Method "+b+" does not exist on jquery."+f)}}}(jQuery,window,document);
if(!("ace" in window)){window.ace={}}jQuery(function(){window.ace.click_event=$.fn.tap?"tap":"click"});(function(e,c){var d="multiple" in document.createElement("INPUT");var j="FileList" in window;var b="FileReader" in window;var f=function(l,m){var k=this;this.settings=e.extend({},e.fn.ace_file_input.defaults,m);this.$element=e(l);this.element=l;this.disabled=false;this.can_reset=true;this.$element.on("change.ace_inner_call",function(o,n){if(n===true){return}return a.call(k)});this.$element.wrap('<div class="ace-file-input" />');this.apply_settings()};f.error={FILE_LOAD_FAILED:1,IMAGE_LOAD_FAILED:2,THUMBNAIL_FAILED:3};f.prototype.apply_settings=function(){var l=this;var k=!!this.settings.icon_remove;this.multi=this.$element.attr("multiple")&&d;this.well_style=this.settings.style=="well";if(this.well_style){this.$element.parent().addClass("ace-file-multiple")}else{this.$element.parent().removeClass("ace-file-multiple")}this.$element.parent().find(":not(input[type=file])").remove();this.$element.after('<label class="file-label" data-title="'+this.settings.btn_choose+'"><span class="file-name" data-title="'+this.settings.no_file+'">'+(this.settings.no_icon?'<i class="'+this.settings.no_icon+'"></i>':"")+"</span></label>"+(k?'<a class="remove" href="#"><i class="'+this.settings.icon_remove+'"></i></a>':""));this.$label=this.$element.next();this.$label.on("click",function(){if(!this.disabled&&!l.element.disabled&&!l.$element.attr("readonly")){l.$element.click()}});if(k){this.$label.next("a").on(ace.click_event,function(){if(!l.can_reset){return false}var m=true;if(l.settings.before_remove){m=l.settings.before_remove.call(l.element)}if(!m){return false}return l.reset_input()})}if(this.settings.droppable&&j){g.call(this)}};f.prototype.show_file_list=function(k){var n=typeof k==="undefined"?this.$element.data("ace_input_files"):k;if(!n||n.length==0){return}if(this.well_style){this.$label.find(".file-name").remove();if(!this.settings.btn_change){this.$label.addClass("hide-placeholder")}}this.$label.attr("data-title",this.settings.btn_change).addClass("selected");for(var p=0;p<n.length;p++){var l=typeof n[p]==="string"?n[p]:e.trim(n[p].name);var q=l.lastIndexOf("\\")+1;if(q==0){q=l.lastIndexOf("/")+1}l=l.substr(q);var m="icon-file";if((/\.(jpe?g|png|gif|svg|bmp|tiff?)$/i).test(l)){m="icon-picture"}else{if((/\.(mpe?g|flv|mov|avi|swf|mp4|mkv|webm|wmv|3gp)$/i).test(l)){m="icon-film"}else{if((/\.(mp3|ogg|wav|wma|amr|aac)$/i).test(l)){m="icon-music"}}}if(!this.well_style){this.$label.find(".file-name").attr({"data-title":l}).find('[class*="icon-"]').attr("class",m)}else{this.$label.append('<span class="file-name" data-title="'+l+'"><i class="'+m+'"></i></span>');var r=e.trim(n[p].type);var o=b&&this.settings.thumbnail&&((r.length>0&&r.match("image"))||(r.length==0&&m=="icon-picture"));if(o){var s=this;e.when(i.call(this,n[p])).fail(function(t){if(s.settings.preview_error){s.settings.preview_error.call(s,l,t.code)}})}}}return true};f.prototype.reset_input=function(){this.$label.attr({"data-title":this.settings.btn_choose,"class":"file-label"}).find(".file-name:first").attr({"data-title":this.settings.no_file,"class":"file-name"}).find('[class*="icon-"]').attr("class",this.settings.no_icon).prev("img").remove();if(!this.settings.no_icon){this.$label.find('[class*="icon-"]').remove()}this.$label.find(".file-name").not(":first").remove();if(this.$element.data("ace_input_files")){this.$element.removeData("ace_input_files");this.$element.removeData("ace_input_method")}this.reset_input_field();return false};f.prototype.reset_input_field=function(){this.$element.wrap("<form>").closest("form").get(0).reset();this.$element.unwrap()};f.prototype.enable_reset=function(k){this.can_reset=k};f.prototype.disable=function(){this.disabled=true;this.$element.attr("disabled","disabled").addClass("disabled")};f.prototype.enable=function(){this.disabled=false;this.$element.removeAttr("disabled").removeClass("disabled")};f.prototype.files=function(){return e(this).data("ace_input_files")||null};f.prototype.method=function(){return e(this).data("ace_input_method")||""};f.prototype.update_settings=function(k){this.settings=e.extend({},this.settings,k);this.apply_settings()};var g=function(){var l=this;var k=this.element.parentNode;e(k).on("dragenter",function(m){m.preventDefault();m.stopPropagation()}).on("dragover",function(m){m.preventDefault();m.stopPropagation()}).on("drop",function(q){q.preventDefault();q.stopPropagation();var p=q.originalEvent.dataTransfer;var o=p.files;if(!l.multi&&o.length>1){var n=[];n.push(o[0]);o=n}var m=true;if(l.settings.before_change){m=l.settings.before_change.call(l.element,o,true)}if(!m||m.length==0){return false}if(m instanceof Array||(j&&m instanceof FileList)){o=m}l.$element.data("ace_input_files",o);l.$element.data("ace_input_method","drop");l.show_file_list(o);l.$element.triggerHandler("change",[true]);return true})};var a=function(){var l=true;if(this.settings.before_change){l=this.settings.before_change.call(this.element,this.element.files||[this.element.value],false)}if(!l||l.length==0){if(!this.$element.data("ace_input_files")){this.reset_input_field()}return false}var m=!j?null:((l instanceof Array||l instanceof FileList)?l:this.element.files);this.$element.data("ace_input_method","select");if(m&&m.length>0){this.$element.data("ace_input_files",m)}else{var k=e.trim(this.element.value);if(k&&k.length>0){m=[];m.push(k);this.$element.data("ace_input_files",m)}}if(!m||m.length==0){return false}this.show_file_list(m);return true};var i=function(o){var n=this;var l=n.$label.find(".file-name:last");var m=new e.Deferred;var k=new FileReader();k.onload=function(q){l.prepend("<img class='middle' style='display:none;' />");var p=l.find("img:last").get(0);e(p).one("load",function(){var t=50;if(n.settings.thumbnail=="large"){t=150}else{if(n.settings.thumbnail=="fit"){t=l.width()}}l.addClass(t>50?"large":"");var s=h(p,t,o.type);if(s==null){e(this).remove();m.reject({code:f.error.THUMBNAIL_FAILED});return}var r=s.w,u=s.h;if(n.settings.thumbnail=="small"){r=u=t}e(p).css({"background-image":"url("+s.src+")",width:r,height:u}).data("thumb",s.src).attr({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}).show();m.resolve()}).one("error",function(){l.find("img").remove();m.reject({code:f.error.IMAGE_LOAD_FAILED})});p.src=q.target.result};k.onerror=function(p){m.reject({code:f.error.FILE_LOAD_FAILED})};k.readAsDataURL(o);return m.promise()};var h=function(n,s,q){var r=n.width,o=n.height;if(r>s||o>s){if(r>o){o=parseInt(s/r*o);r=s}else{r=parseInt(s/o*r);o=s}}var m;try{var l=document.createElement("canvas");l.width=r;l.height=o;var k=l.getContext("2d");k.drawImage(n,0,0,n.width,n.height,0,0,r,o);m=l.toDataURL()}catch(p){m=null}if(!(/^data\:image\/(png|jpe?g|gif);base64,[0-9A-Za-z\+\/\=]+$/.test(m))){m=null}if(!m){return null}return{src:m,w:r,h:o}};e.fn.ace_file_input=function(m,n){var l;var k=this.each(function(){var q=e(this);var p=q.data("ace_file_input");var o=typeof m==="object"&&m;if(!p){q.data("ace_file_input",(p=new f(this,o)))}if(typeof m==="string"){l=p[m](n)}});return(l===c)?k:l};e.fn.ace_file_input.defaults={style:false,no_file:"No File ...",no_icon:"icon-upload-alt",btn_choose:"Choose",btn_change:"Change",icon_remove:"icon-remove",droppable:false,thumbnail:false,before_change:null,before_remove:null,preview_error:null}})(window.jQuery);(function(a,b){a.fn.ace_spinner=function(c){this.each(function(){var f=c.icon_up||"icon-chevron-up";var j=c.icon_down||"icon-chevron-down";var h=c.on_sides||false;var e=c.btn_up_class||"";var g=c.btn_down_class||"";var d=c.max||999;d=(""+d).length;a(this).addClass("spinner-input form-control").wrap('<div class="ace-spinner">');var k=a(this).closest(".ace-spinner").spinner(c).wrapInner("<div class='input-group'></div>");if(h){a(this).before('<div class="spinner-buttons input-group-btn">							<button type="button" class="btn spinner-down btn-xs '+g+'">								<i class="'+j+'"></i>							</button>						</div>').after('<div class="spinner-buttons input-group-btn">							<button type="button" class="btn spinner-up btn-xs '+e+'">								<i class="'+f+'"></i>							</button>						</div>');k.addClass("touch-spinner");k.css("width",(d*20+40)+"px")}else{a(this).after('<div class="spinner-buttons input-group-btn">							<button type="button" class="btn spinner-up btn-xs '+e+'">								<i class="'+f+'"></i>							</button>							<button type="button" class="btn spinner-down btn-xs '+g+'">								<i class="'+j+'"></i>							</button>						</div>');if("ontouchend" in document||c.touch_spinner){k.addClass("touch-spinner");k.css("width",(d*20+40)+"px")}else{a(this).next().addClass("btn-group-vertical");k.css("width",(d*20+10)+"px")}}a(this).on("mousewheel DOMMouseScroll",function(l){var m=l.originalEvent.detail<0||l.originalEvent.wheelDelta>0?1:-1;k.spinner("step",m>0);k.spinner("triggerChangedEvent");return false});var i=a(this);k.on("changed",function(){i.trigger("change")})});return this}})(window.jQuery);(function(a,b){a.fn.ace_wizard=function(c){this.each(function(){var e=a(this);e.wizard();var d=e.siblings(".wizard-actions").eq(0);var f=e.data("wizard");f.$prevBtn.remove();f.$nextBtn.remove();f.$prevBtn=d.find(".btn-prev").eq(0).on(ace.click_event,function(){e.wizard("previous")}).attr("disabled","disabled");f.$nextBtn=d.find(".btn-next").eq(0).on(ace.click_event,function(){e.wizard("next")}).removeAttr("disabled");f.nextText=f.$nextBtn.text()});return this}})(window.jQuery);(function(a,b){a.fn.ace_colorpicker=function(c){var d=a.extend({pull_right:false,caret:true},c);this.each(function(){var g=a(this);var e="";var f="";a(this).hide().find("option").each(function(){var h="colorpick-btn";if(this.selected){h+=" selected";f=this.value}e+='<li><a class="'+h+'" href="#" style="background-color:'+this.value+';" data-color="'+this.value+'"></a></li>'}).end().on("change.ace_inner_call",function(){a(this).next().find(".btn-colorpicker").css("background-color",this.value)}).after('<div class="dropdown dropdown-colorpicker"><a data-toggle="dropdown" class="dropdown-toggle" href="#"><span class="btn-colorpicker" style="background-color:'+f+'"></span></a><ul class="dropdown-menu'+(d.caret?" dropdown-caret":"")+(d.pull_right?" pull-right":"")+'">'+e+"</ul></div>").next().find(".dropdown-menu").on(ace.click_event,function(j){var h=a(j.target);if(!h.is(".colorpick-btn")){return false}h.closest("ul").find(".selected").removeClass("selected");h.addClass("selected");var i=h.data("color");g.val(i).change();j.preventDefault();return true})});return this}})(window.jQuery);(function(a,b){a.fn.ace_tree=function(d){var c={"open-icon":"icon-folder-open","close-icon":"icon-folder-close",selectable:true,"selected-icon":"icon-ok","unselected-icon":"tree-dot"};c=a.extend({},c,d);this.each(function(){var e=a(this);e.html('<div class = "tree-folder" style="display:none;">				<div class="tree-folder-header">					<i class="'+c["close-icon"]+'"></i>					<div class="tree-folder-name"></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display:none"></div>			</div>			<div class="tree-item" style="display:none;">				'+(c["unselected-icon"]==null?"":'<i class="'+c["unselected-icon"]+'"></i>')+'				<div class="tree-item-name"></div>			</div>');e.addClass(c.selectable==true?"tree-selectable":"tree-unselectable");e.tree(c)});return this}})(window.jQuery);(function(a,b){a.fn.ace_wysiwyg=function(c,h){var d=a.extend({speech_button:true,wysiwyg:{}},c);var e=["#ac725e","#d06b64","#f83a22","#fa573c","#ff7537","#ffad46","#42d692","#16a765","#7bd148","#b3dc6c","#fbe983","#fad165","#92e1c0","#9fe1e7","#9fc6e7","#4986e7","#9a9cff","#b99aff","#c2c2c2","#cabdbf","#cca6ac","#f691b2","#cd74e6","#a47ae2","#444444"];var g={font:{values:["Arial","Courier","Comic Sans MS","Helvetica","Open Sans","Tahoma","Verdana"],icon:"icon-font",title:"Font"},fontSize:{values:{5:"Huge",3:"Normal",1:"Small"},icon:"icon-text-height",title:"Font Size"},bold:{icon:"icon-bold",title:"Bold (Ctrl/Cmd+B)"},italic:{icon:"icon-italic",title:"Italic (Ctrl/Cmd+I)"},strikethrough:{icon:"icon-strikethrough",title:"Strikethrough"},underline:{icon:"icon-underline",title:"Underline"},insertunorderedlist:{icon:"icon-list-ul",title:"Bullet list"},insertorderedlist:{icon:"icon-list-ol",title:"Number list"},outdent:{icon:"icon-indent-left",title:"Reduce indent (Shift+Tab)"},indent:{icon:"icon-indent-right",title:"Indent (Tab)"},justifyleft:{icon:"icon-align-left",title:"Align Left (Ctrl/Cmd+L)"},justifycenter:{icon:"icon-align-center",title:"Center (Ctrl/Cmd+E)"},justifyright:{icon:"icon-align-right",title:"Align Right (Ctrl/Cmd+R)"},justifyfull:{icon:"icon-align-justify",title:"Justify (Ctrl/Cmd+J)"},createLink:{icon:"icon-link",title:"Hyperlink",button_text:"Add",placeholder:"URL",button_class:"btn-primary"},unlink:{icon:"icon-unlink",title:"Remove Hyperlink"},insertImage:{icon:"icon-picture",title:"Insert picture",button_text:'<i class="icon-file"></i> Choose Image &hellip;',placeholder:"Image URL",button_insert:"Insert",button_class:"btn-success",button_insert_class:"btn-primary",choose_file:true},foreColor:{values:e,title:"Change Color"},backColor:{values:e,title:"Change Background Color"},undo:{icon:"icon-undo",title:"Undo (Ctrl/Cmd+Z)"},redo:{icon:"icon-repeat",title:"Redo (Ctrl/Cmd+Y)"},viewSource:{icon:"icon-code",title:"View Source"}};var f=d.toolbar||["font",null,"fontSize",null,"bold","italic","strikethrough","underline",null,"insertunorderedlist","insertorderedlist","outdent","indent",null,"justifyleft","justifycenter","justifyright","justifyfull",null,"createLink","unlink",null,"insertImage",null,"foreColor",null,"undo","redo",null,"viewSource"];this.each(function(){var r=' <div class="wysiwyg-toolbar btn-toolbar center"> <div class="btn-group"> ';for(var n in f){if(f.hasOwnProperty(n)){var p=f[n];if(p===null){r+=' </div> <div class="btn-group"> ';continue}if(typeof p=="string"&&p in g){p=g[p];p.name=f[n]}else{if(typeof p=="object"&&p.name in g){p=a.extend(g[p.name],p)}else{continue}}var q="className" in p?p.className:"";switch(p.name){case"font":r+=' <a class="btn btn-sm '+q+' dropdown-toggle" data-toggle="dropdown" title="'+p.title+'"><i class="'+p.icon+'"></i><i class="icon-angle-down icon-on-right"></i></a> ';r+=' <ul class="dropdown-menu dropdown-light">';for(var j in p.values){if(p.values.hasOwnProperty(j)){r+=' <li><a data-edit="fontName '+p.values[j]+'" style="font-family:\''+p.values[j]+"'\">"+p.values[j]+"</a></li> "}}r+=" </ul>";break;case"fontSize":r+=' <a class="btn btn-sm '+q+' dropdown-toggle" data-toggle="dropdown" title="'+p.title+'"><i class="'+p.icon+'"></i>&nbsp;<i class="icon-angle-down icon-on-right"></i></a> ';r+=' <ul class="dropdown-menu dropdown-light"> ';for(var t in p.values){if(p.values.hasOwnProperty(t)){r+=' <li><a data-edit="fontSize '+t+'"><font size="'+t+'">'+p.values[t]+"</font></a></li> "}}r+=" </ul> ";break;case"createLink":r+=' <div class="inline position-relative"> <a class="btn btn-sm '+q+' dropdown-toggle" data-toggle="dropdown" title="'+p.title+'"><i class="'+p.icon+'"></i></a> ';r+=' <div class="dropdown-menu dropdown-caret pull-right">							<div class="input-group">								<input class="form-control" placeholder="'+p.placeholder+'" type="text" data-edit="'+p.name+'" />								<span class="input-group-btn">									<button class="btn btn-sm '+p.button_class+'" type="button">'+p.button_text+"</button>								</span>							</div>						</div> </div>";break;case"insertImage":r+=' <div class="inline position-relative"> <a class="btn btn-sm '+q+' dropdown-toggle" data-toggle="dropdown" title="'+p.title+'"><i class="'+p.icon+'"></i></a> ';r+=' <div class="dropdown-menu dropdown-caret pull-right">							<div class="input-group">								<input class="form-control" placeholder="'+p.placeholder+'" type="text" data-edit="'+p.name+'" />								<span class="input-group-btn">									<button class="btn btn-sm '+p.button_insert_class+'" type="button">'+p.button_insert+"</button>								</span>							</div>";if(p.choose_file&&"FileReader" in window){r+='<div class="space-2"></div>							 <div class="center">								<button class="btn btn-sm '+p.button_class+' wysiwyg-choose-file" type="button">'+p.button_text+'</button>								<input type="file" data-edit="'+p.name+'" />							  </div>'}r+=" </div> </div>";break;case"foreColor":case"backColor":r+=' <select class="hide wysiwyg_colorpicker" title="'+p.title+'"> ';for(var m in p.values){r+=' <option value="'+p.values[m]+'">'+p.values[m]+"</option> "}r+=" </select> ";r+=' <input style="display:none;" disabled class="hide" type="text" data-edit="'+p.name+'" /> ';break;case"viewSource":r+=' <a class="btn btn-sm '+q+'" data-view="source" title="'+p.title+'"><i class="'+p.icon+'"></i></a> ';break;default:r+=' <a class="btn btn-sm '+q+'" data-edit="'+p.name+'" title="'+p.title+'"><i class="'+p.icon+'"></i></a> ';break}}}r+=" </div> </div> ";if(d.toolbar_place){r=d.toolbar_place.call(this,r)}else{r=a(this).before(r).prev()}r.find("a[title]").tooltip({animation:false,container:"body"});r.find(".dropdown-menu input:not([type=file])").on(ace.click_event,function(){return false}).on("change",function(){a(this).closest(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).on("keydown",function(u){if(u.which==27){this.value="";a(this).change()}});r.find("input[type=file]").prev().on(ace.click_event,function(u){a(this).next().click()});r.find(".wysiwyg_colorpicker").each(function(){a(this).ace_colorpicker({pull_right:true}).change(function(){a(this).nextAll("input").eq(0).val(this.value).change()}).next().find(".btn-colorpicker").tooltip({title:this.title,animation:false,container:"body"})});var k;if(d.speech_button&&"onwebkitspeechchange" in (k=document.createElement("input"))){var i=a(this).offset();r.append(k);a(k).attr({type:"text","data-edit":"inserttext","x-webkit-speech":""}).addClass("wysiwyg-speech-input").css({position:"absolute"}).offset({top:i.top,left:i.left+a(this).innerWidth()-35})}else{k=null}var s=a(this);var l=false;r.find("a[data-view=source]").on("click",function(v){v.preventDefault();if(!l){a("<textarea />").css({width:s.outerWidth(),height:s.outerHeight()}).val(s.html()).insertAfter(s);s.hide();a(this).addClass("active")}else{var u=s.next();s.html(u.val()).show();u.remove();a(this).removeClass("active")}l=!l});var o=a.extend({},{activeToolbarClass:"active",toolbarSelector:r},d.wysiwyg||{});a(this).wysiwyg(o)});return this}})(window.jQuery);
if(!("ace" in window)){window.ace={}}jQuery(function(a){window.ace.click_event=a.fn.tap?"tap":"click"});jQuery(function(a){ace.handle_side_menu(jQuery);ace.enable_search_ahead(jQuery);ace.general_things(jQuery);ace.widget_boxes(jQuery);ace.widget_reload_handler(jQuery)});ace.handle_side_menu=function(a){a("#menu-toggler").on(ace.click_event,function(){a("#sidebar").toggleClass("display");a(this).toggleClass("display");return false});var c=a("#sidebar").hasClass("menu-min");a("#sidebar-collapse").on(ace.click_event,function(){c=a("#sidebar").hasClass("menu-min");ace.settings.sidebar_collapsed(!c)});var b="ontouchend" in document;a(".nav-list").on(ace.click_event,function(h){var g=a(h.target).closest("a");if(!g||g.length==0){return}c=a("#sidebar").hasClass("menu-min");if(!g.hasClass("dropdown-toggle")){if(c&&ace.click_event=="tap"&&g.get(0).parentNode.parentNode==this){var i=g.find(".menu-text").get(0);if(h.target!=i&&!a.contains(i,h.target)){return false}}return}var f=g.next().get(0);if(!a(f).is(":visible")){var d=a(f.parentNode).closest("ul");if(c&&d.hasClass("nav-list")){return}d.find("> .open > .submenu").each(function(){if(this!=f&&!a(this.parentNode).hasClass("active")){a(this).slideUp(200).parent().removeClass("open")}})}else{}if(c&&a(f.parentNode.parentNode).hasClass("nav-list")){return false}a(f).slideToggle(200).parent().toggleClass("open");return false})};ace.general_things=function(a){a('.ace-nav [class*="icon-animated-"]').closest("a").on("click",function(){var d=a(this).find('[class*="icon-animated-"]').eq(0);var c=d.attr("class").match(/icon\-animated\-([\d\w]+)/);d.removeClass(c[0]);a(this).off("click")});a(".nav-list .badge[title],.nav-list .label[title]").tooltip({placement:"right"});a("#ace-settings-btn").on(ace.click_event,function(){a(this).toggleClass("open");a("#ace-settings-box").toggleClass("open")});a("#ace-settings-navbar").on("click",function(){ace.settings.navbar_fixed(this.checked)}).each(function(){this.checked=ace.settings.is("navbar","fixed")});a("#ace-settings-sidebar").on("click",function(){ace.settings.sidebar_fixed(this.checked)}).each(function(){this.checked=ace.settings.is("sidebar","fixed")});a("#ace-settings-breadcrumbs").on("click",function(){ace.settings.breadcrumbs_fixed(this.checked)}).each(function(){this.checked=ace.settings.is("breadcrumbs","fixed")});a("#ace-settings-add-container").on("click",function(){ace.settings.main_container_fixed(this.checked)}).each(function(){this.checked=ace.settings.is("main-container","fixed")});a("#ace-settings-rtl").removeAttr("checked").on("click",function(){ace.switch_direction(jQuery)});a("#btn-scroll-up").on(ace.click_event,function(){var c=Math.min(400,Math.max(100,parseInt(a("html").scrollTop()/3)));a("html,body").animate({scrollTop:0},c);return false});try{a("#skin-colorpicker").ace_colorpicker()}catch(b){}a("#skin-colorpicker").on("change",function(){var d=a(this).find("option:selected").data("skin");var c=a(document.body);c.removeClass("skin-1 skin-2 skin-3");if(d!="default"){c.addClass(d)}if(d=="skin-1"){a(".ace-nav > li.grey").addClass("dark")}else{a(".ace-nav > li.grey").removeClass("dark")}if(d=="skin-2"){a(".ace-nav > li").addClass("no-border margin-1");a(".ace-nav > li:not(:last-child)").addClass("light-pink").find('> a > [class*="icon-"]').addClass("pink").end().eq(0).find(".badge").addClass("badge-warning")}else{a(".ace-nav > li").removeClass("no-border margin-1");a(".ace-nav > li:not(:last-child)").removeClass("light-pink").find('> a > [class*="icon-"]').removeClass("pink").end().eq(0).find(".badge").removeClass("badge-warning")}if(d=="skin-3"){a(".ace-nav > li.grey").addClass("red").find(".badge").addClass("badge-yellow")}else{a(".ace-nav > li.grey").removeClass("red").find(".badge").removeClass("badge-yellow")}})};ace.widget_boxes=function(a){a(document).on("hide.bs.collapse show.bs.collapse",function(c){var b=c.target.getAttribute("id");a('[href*="#'+b+'"]').find('[class*="icon-"]').each(function(){var e=a(this);var d;var f=null;var g=null;if((f=e.attr("data-icon-show"))){g=e.attr("data-icon-hide")}else{if(d=e.attr("class").match(/icon\-(.*)\-(up|down)/)){f="icon-"+d[1]+"-down";g="icon-"+d[1]+"-up"}}if(f){if(c.type=="show"){e.removeClass(f).addClass(g)}else{e.removeClass(g).addClass(f)}return false}})});a(document).on("click.ace.widget","[data-action]",function(o){o.preventDefault();var n=a(this);var p=n.data("action");var b=n.closest(".widget-box");if(b.hasClass("ui-sortable-helper")){return}if(p=="collapse"){var j=b.hasClass("collapsed")?"show":"hide";var f=j=="show"?"shown":"hidden";var c;b.trigger(c=a.Event(j+".ace.widget"));if(c.isDefaultPrevented()){return}var g=b.find(".widget-body");var m=n.find("[class*=icon-]").eq(0);var h=m.attr("class").match(/icon\-(.*)\-(up|down)/);var d="icon-"+h[1]+"-down";var i="icon-"+h[1]+"-up";var l=g.find(".widget-body-inner");if(l.length==0){g=g.wrapInner('<div class="widget-body-inner"></div>').find(":first-child").eq(0)}else{g=l.eq(0)}var e=300;var k=200;if(j=="show"){if(m){m.addClass(i).removeClass(d)}b.removeClass("collapsed");g.slideUp(0,function(){g.slideDown(e,function(){b.trigger(c=a.Event(f+".ace.widget"))})})}else{if(m){m.addClass(d).removeClass(i)}g.slideUp(k,function(){b.addClass("collapsed");b.trigger(c=a.Event(f+".ace.widget"))})}}else{if(p=="close"){var c;b.trigger(c=a.Event("close.ace.widget"));if(c.isDefaultPrevented()){return}var r=parseInt(n.data("close-speed"))||300;b.hide(r,function(){b.trigger(c=a.Event("closed.ace.widget"));b.remove()})}else{if(p=="reload"){var c;b.trigger(c=a.Event("reload.ace.widget"));if(c.isDefaultPrevented()){return}n.blur();var q=false;if(b.css("position")=="static"){q=true;b.addClass("position-relative")}b.append('<div class="widget-box-overlay"><i class="icon-spinner icon-spin icon-2x white"></i></div>');b.one("reloaded.ace.widget",function(){b.find(".widget-box-overlay").remove();if(q){b.removeClass("position-relative")}})}else{if(p=="settings"){var c=a.Event("settings.ace.widget");b.trigger(c)}}}}})};ace.widget_reload_handler=function(a){a(document).on("reload.ace.widget",".widget-box",function(b){var c=a(this);setTimeout(function(){c.trigger("reloaded.ace.widget")},parseInt(Math.random()*1000+1000))})};ace.enable_search_ahead=function(a){ace.variable_US_STATES=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];try{a("#nav-search-input").typeahead({source:ace.variable_US_STATES,updater:function(c){a("#nav-search-input").focus();return c}})}catch(b){}};ace.switch_direction=function(d){var c=d(document.body);c.toggleClass("rtl").find(".dropdown-menu:not(.datepicker-dropdown,.colorpicker)").toggleClass("pull-right").end().find(".pull-right:not(.dropdown-menu,blockquote,.profile-skills .pull-right)").removeClass("pull-right").addClass("tmp-rtl-pull-right").end().find(".pull-left:not(.dropdown-submenu,.profile-skills .pull-left)").removeClass("pull-left").addClass("pull-right").end().find(".tmp-rtl-pull-right").removeClass("tmp-rtl-pull-right").addClass("pull-left").end().find(".chosen-container").toggleClass("chosen-rtl").end();function a(h,g){c.find("."+h).removeClass(h).addClass("tmp-rtl-"+h).end().find("."+g).removeClass(g).addClass(h).end().find(".tmp-rtl-"+h).removeClass("tmp-rtl-"+h).addClass(g)}function b(h,g,i){i.each(function(){var k=d(this);var j=k.css(g);k.css(g,k.css(h));k.css(h,j)})}a("align-left","align-right");a("no-padding-left","no-padding-right");a("arrowed","arrowed-right");a("arrowed-in","arrowed-in-right");a("messagebar-item-left","messagebar-item-right");var e=d("#piechart-placeholder");if(e.size()>0){var f=d(document.body).hasClass("rtl")?"nw":"ne";e.data("draw").call(e.get(0),e,e.data("chart"),f)}};
/*!
 * jQuery Validation Plugin v1.12.0
 *
 * http://jqueryvalidation.org/
 *
 * Copyright (c) 2014 Jörn Zaefferer
 * Released under the MIT license
 */
(function() {

	function stripHtml(value) {
		// remove html tags and space chars
		return value.replace(/<.[^<>]*?>/g, " ").replace(/&nbsp;|&#160;/gi, " ")
		// remove punctuation
		.replace(/[.(),;:!?%#$'\"_+=\/\-“”’]*/g, "");
	}

	jQuery.validator.addMethod("maxWords", function(value, element, params) {
		return this.optional(element) || stripHtml(value).match(/\b\w+\b/g).length <= params;
	}, jQuery.validator.format("Please enter {0} words or less."));

	jQuery.validator.addMethod("minWords", function(value, element, params) {
		return this.optional(element) || stripHtml(value).match(/\b\w+\b/g).length >= params;
	}, jQuery.validator.format("Please enter at least {0} words."));

	jQuery.validator.addMethod("rangeWords", function(value, element, params) {
		var valueStripped = stripHtml(value),
			regex = /\b\w+\b/g;
		return this.optional(element) || valueStripped.match(regex).length >= params[0] && valueStripped.match(regex).length <= params[1];
	}, jQuery.validator.format("Please enter between {0} and {1} words."));

}());

// Accept a value from a file input based on a required mimetype
jQuery.validator.addMethod("accept", function(value, element, param) {
	// Split mime on commas in case we have multiple types we can accept
	var typeParam = typeof param === "string" ? param.replace(/\s/g, "").replace(/,/g, "|") : "image/*",
	optionalValue = this.optional(element),
	i, file;

	// Element is optional
	if (optionalValue) {
		return optionalValue;
	}

	if (jQuery(element).attr("type") === "file") {
		// If we are using a wildcard, make it regex friendly
		typeParam = typeParam.replace(/\*/g, ".*");

		// Check if the element has a FileList before checking each file
		if (element.files && element.files.length) {
			for (i = 0; i < element.files.length; i++) {
				file = element.files[i];

				// Grab the mimetype from the loaded file, verify it matches
				if (!file.type.match(new RegExp( ".?(" + typeParam + ")$", "i"))) {
					return false;
				}
			}
		}
	}

	// Either return true because we've validated each file, or because the
	// browser does not support element.files and the FileList feature
	return true;
}, jQuery.validator.format("Please enter a value with a valid mimetype."));

jQuery.validator.addMethod("alphanumeric", function(value, element) {
	return this.optional(element) || /^\w+$/i.test(value);
}, "Letters, numbers, and underscores only please");

/*
 * Dutch bank account numbers (not 'giro' numbers) have 9 digits
 * and pass the '11 check'.
 * We accept the notation with spaces, as that is common.
 * acceptable: 123456789 or 12 34 56 789
 */
jQuery.validator.addMethod("bankaccountNL", function(value, element) {
	if (this.optional(element)) {
		return true;
	}
	if (!(/^[0-9]{9}|([0-9]{2} ){3}[0-9]{3}$/.test(value))) {
		return false;
	}
	// now '11 check'
	var account = value.replace(/ /g, ""), // remove spaces
		sum = 0,
		len = account.length,
		pos, factor, digit;
	for ( pos = 0; pos < len; pos++ ) {
		factor = len - pos;
		digit = account.substring(pos, pos + 1);
		sum = sum + factor * digit;
	}
	return sum % 11 === 0;
}, "Please specify a valid bank account number");

jQuery.validator.addMethod("bankorgiroaccountNL", function(value, element) {
	return this.optional(element) ||
			($.validator.methods.bankaccountNL.call(this, value, element)) ||
			($.validator.methods.giroaccountNL.call(this, value, element));
}, "Please specify a valid bank or giro account number");

/**
 * BIC is the business identifier code (ISO 9362). This BIC check is not a guarantee for authenticity.
 *
 * BIC pattern: BBBBCCLLbbb (8 or 11 characters long; bbb is optional)
 *
 * BIC definition in detail:
 * - First 4 characters - bank code (only letters)
 * - Next 2 characters - ISO 3166-1 alpha-2 country code (only letters)
 * - Next 2 characters - location code (letters and digits)
 *   a. shall not start with '0' or '1'
 *   b. second character must be a letter ('O' is not allowed) or one of the following digits ('0' for test (therefore not allowed), '1' for passive participant and '2' for active participant)
 * - Last 3 characters - branch code, optional (shall not start with 'X' except in case of 'XXX' for primary office) (letters and digits)
 */
jQuery.validator.addMethod("bic", function(value, element) {
    return this.optional( element ) || /^([A-Z]{6}[A-Z2-9][A-NP-Z1-2])(X{3}|[A-WY-Z0-9][A-Z0-9]{2})?$/.test( value );
}, "Please specify a valid BIC code");

/*
 * Código de identificación fiscal ( CIF ) is the tax identification code for Spanish legal entities
 * Further rules can be found in Spanish on http://es.wikipedia.org/wiki/C%C3%B3digo_de_identificaci%C3%B3n_fiscal
 */
jQuery.validator.addMethod( "cifES", function( value ) {
	"use strict";

	var num = [],
		controlDigit, sum, i, count, tmp, secondDigit;

	value = value.toUpperCase();

	// Quick format test
	if ( !value.match( "((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)" ) ) {
		return false;
	}

	for ( i = 0; i < 9; i++ ) {
		num[ i ] = parseInt( value.charAt( i ), 10 );
	}

	// Algorithm for checking CIF codes
	sum = num[ 2 ] + num[ 4 ] + num[ 6 ];
	for ( count = 1; count < 8; count += 2 ) {
		tmp = ( 2 * num[ count ] ).toString();
		secondDigit = tmp.charAt( 1 );

		sum += parseInt( tmp.charAt( 0 ), 10 ) + ( secondDigit === "" ? 0 : parseInt( secondDigit, 10 ) );
	}

	/* The first (position 1) is a letter following the following criteria:
	 *	A. Corporations
	 *	B. LLCs
	 *	C. General partnerships
	 *	D. Companies limited partnerships
	 *	E. Communities of goods
	 *	F. Cooperative Societies
	 *	G. Associations
	 *	H. Communities of homeowners in horizontal property regime
	 *	J. Civil Societies
	 *	K. Old format
	 *	L. Old format
	 *	M. Old format
	 *	N. Nonresident entities
	 *	P. Local authorities
	 *	Q. Autonomous bodies, state or not, and the like, and congregations and religious institutions
	 *	R. Congregations and religious institutions (since 2008 ORDER EHA/451/2008)
	 *	S. Organs of State Administration and regions
	 *	V. Agrarian Transformation
	 *	W. Permanent establishments of non-resident in Spain
	 */
	if ( /^[ABCDEFGHJNPQRSUVW]{1}/.test( value ) ) {
		sum += "";
		controlDigit = 10 - parseInt( sum.charAt( sum.length - 1 ), 10 );
		value += controlDigit;
		return ( num[ 8 ].toString() === String.fromCharCode( 64 + controlDigit ) || num[ 8 ].toString() === value.charAt( value.length - 1 ) );
	}

	return false;

}, "Please specify a valid CIF number." );

/* NOTICE: Modified version of Castle.Components.Validator.CreditCardValidator
 * Redistributed under the the Apache License 2.0 at http://www.apache.org/licenses/LICENSE-2.0
 * Valid Types: mastercard, visa, amex, dinersclub, enroute, discover, jcb, unknown, all (overrides all other settings)
 */
jQuery.validator.addMethod("creditcardtypes", function(value, element, param) {
	if (/[^0-9\-]+/.test(value)) {
		return false;
	}

	value = value.replace(/\D/g, "");

	var validTypes = 0x0000;

	if (param.mastercard) {
		validTypes |= 0x0001;
	}
	if (param.visa) {
		validTypes |= 0x0002;
	}
	if (param.amex) {
		validTypes |= 0x0004;
	}
	if (param.dinersclub) {
		validTypes |= 0x0008;
	}
	if (param.enroute) {
		validTypes |= 0x0010;
	}
	if (param.discover) {
		validTypes |= 0x0020;
	}
	if (param.jcb) {
		validTypes |= 0x0040;
	}
	if (param.unknown) {
		validTypes |= 0x0080;
	}
	if (param.all) {
		validTypes = 0x0001 | 0x0002 | 0x0004 | 0x0008 | 0x0010 | 0x0020 | 0x0040 | 0x0080;
	}
	if (validTypes & 0x0001 && /^(5[12345])/.test(value)) { //mastercard
		return value.length === 16;
	}
	if (validTypes & 0x0002 && /^(4)/.test(value)) { //visa
		return value.length === 16;
	}
	if (validTypes & 0x0004 && /^(3[47])/.test(value)) { //amex
		return value.length === 15;
	}
	if (validTypes & 0x0008 && /^(3(0[012345]|[68]))/.test(value)) { //dinersclub
		return value.length === 14;
	}
	if (validTypes & 0x0010 && /^(2(014|149))/.test(value)) { //enroute
		return value.length === 15;
	}
	if (validTypes & 0x0020 && /^(6011)/.test(value)) { //discover
		return value.length === 16;
	}
	if (validTypes & 0x0040 && /^(3)/.test(value)) { //jcb
		return value.length === 16;
	}
	if (validTypes & 0x0040 && /^(2131|1800)/.test(value)) { //jcb
		return value.length === 15;
	}
	if (validTypes & 0x0080) { //unknown
		return true;
	}
	return false;
}, "Please enter a valid credit card number.");

/**
 * Validates currencies with any given symbols by @jameslouiz
 * Symbols can be optional or required. Symbols required by default
 *
 * Usage examples:
 *  currency: ["£", false] - Use false for soft currency validation
 *  currency: ["$", false]
 *  currency: ["RM", false] - also works with text based symbols such as "RM" - Malaysia Ringgit etc
 *
 *  <input class="currencyInput" name="currencyInput">
 *
 * Soft symbol checking
 *  currencyInput: {
 *     currency: ["$", false]
 *  }
 *
 * Strict symbol checking (default)
 *  currencyInput: {
 *     currency: "$"
 *     //OR
 *     currency: ["$", true]
 *  }
 *
 * Multiple Symbols
 *  currencyInput: {
 *     currency: "$,£,¢"
 *  }
 */
jQuery.validator.addMethod("currency", function(value, element, param) {
    var isParamString = typeof param === "string",
        symbol = isParamString ? param : param[0],
        soft = isParamString ? true : param[1],
        regex;

    symbol = symbol.replace(/,/g, "");
    symbol = soft ? symbol + "]" : symbol + "]?";
    regex = "^[" + symbol + "([1-9]{1}[0-9]{0,2}(\\,[0-9]{3})*(\\.[0-9]{0,2})?|[1-9]{1}[0-9]{0,}(\\.[0-9]{0,2})?|0(\\.[0-9]{0,2})?|(\\.[0-9]{1,2})?)$";
    regex = new RegExp(regex);
    return this.optional(element) || regex.test(value);

}, "Please specify a valid currency");

/**
 * Return true, if the value is a valid date, also making this formal check dd/mm/yyyy.
 *
 * @example jQuery.validator.methods.date("01/01/1900")
 * @result true
 *
 * @example jQuery.validator.methods.date("01/13/1990")
 * @result false
 *
 * @example jQuery.validator.methods.date("01.01.1900")
 * @result false
 *
 * @example <input name="pippo" class="{dateITA:true}" />
 * @desc Declares an optional input element whose value must be a valid date.
 *
 * @name jQuery.validator.methods.dateITA
 * @type Boolean
 * @cat Plugins/Validate/Methods
 */
jQuery.validator.addMethod("dateITA", function(value, element) {
	var check = false,
		re = /^\d{1,2}\/\d{1,2}\/\d{4}$/,
		adata, gg, mm, aaaa, xdata;
	if ( re.test(value)) {
		adata = value.split("/");
		gg = parseInt(adata[0],10);
		mm = parseInt(adata[1],10);
		aaaa = parseInt(adata[2],10);
		xdata = new Date(aaaa, mm - 1, gg, 12, 0, 0, 0);
		if ( ( xdata.getFullYear() === aaaa ) && ( xdata.getMonth() === mm - 1 ) && ( xdata.getDate() === gg ) ){
			check = true;
		} else {
			check = false;
		}
	} else {
		check = false;
	}
	return this.optional(element) || check;
}, "Please enter a correct date");

jQuery.validator.addMethod("dateNL", function(value, element) {
	return this.optional(element) || /^(0?[1-9]|[12]\d|3[01])[\.\/\-](0?[1-9]|1[012])[\.\/\-]([12]\d)?(\d\d)$/.test(value);
}, "Please enter a correct date");

// Older "accept" file extension method. Old docs: http://docs.jquery.com/Plugins/Validation/Methods/accept
jQuery.validator.addMethod("extension", function(value, element, param) {
	param = typeof param === "string" ? param.replace(/,/g, "|") : "png|jpe?g|gif";
	return this.optional(element) || value.match(new RegExp(".(" + param + ")$", "i"));
}, jQuery.validator.format("Please enter a value with a valid extension."));

/**
 * Dutch giro account numbers (not bank numbers) have max 7 digits
 */
jQuery.validator.addMethod("giroaccountNL", function(value, element) {
	return this.optional(element) || /^[0-9]{1,7}$/.test(value);
}, "Please specify a valid giro account number");

/**
 * IBAN is the international bank account number.
 * It has a country - specific format, that is checked here too
 */
jQuery.validator.addMethod("iban", function(value, element) {
	// some quick simple tests to prevent needless work
	if (this.optional(element)) {
		return true;
	}

	// remove spaces and to upper case
	var iban = value.replace(/ /g,"").toUpperCase(),
		ibancheckdigits = "",
		leadingZeroes = true,
		cRest = "",
		cOperator = "",
		countrycode, ibancheck, charAt, cChar, bbanpattern, bbancountrypatterns, ibanregexp, i, p;

	if (!(/^([a-zA-Z0-9]{4} ){2,8}[a-zA-Z0-9]{1,4}|[a-zA-Z0-9]{12,34}$/.test(iban))) {
		return false;
	}

	// check the country code and find the country specific format
	countrycode = iban.substring(0,2);
	bbancountrypatterns = {
		"AL": "\\d{8}[\\dA-Z]{16}",
		"AD": "\\d{8}[\\dA-Z]{12}",
		"AT": "\\d{16}",
		"AZ": "[\\dA-Z]{4}\\d{20}",
		"BE": "\\d{12}",
		"BH": "[A-Z]{4}[\\dA-Z]{14}",
		"BA": "\\d{16}",
		"BR": "\\d{23}[A-Z][\\dA-Z]",
		"BG": "[A-Z]{4}\\d{6}[\\dA-Z]{8}",
		"CR": "\\d{17}",
		"HR": "\\d{17}",
		"CY": "\\d{8}[\\dA-Z]{16}",
		"CZ": "\\d{20}",
		"DK": "\\d{14}",
		"DO": "[A-Z]{4}\\d{20}",
		"EE": "\\d{16}",
		"FO": "\\d{14}",
		"FI": "\\d{14}",
		"FR": "\\d{10}[\\dA-Z]{11}\\d{2}",
		"GE": "[\\dA-Z]{2}\\d{16}",
		"DE": "\\d{18}",
		"GI": "[A-Z]{4}[\\dA-Z]{15}",
		"GR": "\\d{7}[\\dA-Z]{16}",
		"GL": "\\d{14}",
		"GT": "[\\dA-Z]{4}[\\dA-Z]{20}",
		"HU": "\\d{24}",
		"IS": "\\d{22}",
		"IE": "[\\dA-Z]{4}\\d{14}",
		"IL": "\\d{19}",
		"IT": "[A-Z]\\d{10}[\\dA-Z]{12}",
		"KZ": "\\d{3}[\\dA-Z]{13}",
		"KW": "[A-Z]{4}[\\dA-Z]{22}",
		"LV": "[A-Z]{4}[\\dA-Z]{13}",
		"LB": "\\d{4}[\\dA-Z]{20}",
		"LI": "\\d{5}[\\dA-Z]{12}",
		"LT": "\\d{16}",
		"LU": "\\d{3}[\\dA-Z]{13}",
		"MK": "\\d{3}[\\dA-Z]{10}\\d{2}",
		"MT": "[A-Z]{4}\\d{5}[\\dA-Z]{18}",
		"MR": "\\d{23}",
		"MU": "[A-Z]{4}\\d{19}[A-Z]{3}",
		"MC": "\\d{10}[\\dA-Z]{11}\\d{2}",
		"MD": "[\\dA-Z]{2}\\d{18}",
		"ME": "\\d{18}",
		"NL": "[A-Z]{4}\\d{10}",
		"NO": "\\d{11}",
		"PK": "[\\dA-Z]{4}\\d{16}",
		"PS": "[\\dA-Z]{4}\\d{21}",
		"PL": "\\d{24}",
		"PT": "\\d{21}",
		"RO": "[A-Z]{4}[\\dA-Z]{16}",
		"SM": "[A-Z]\\d{10}[\\dA-Z]{12}",
		"SA": "\\d{2}[\\dA-Z]{18}",
		"RS": "\\d{18}",
		"SK": "\\d{20}",
		"SI": "\\d{15}",
		"ES": "\\d{20}",
		"SE": "\\d{20}",
		"CH": "\\d{5}[\\dA-Z]{12}",
		"TN": "\\d{20}",
		"TR": "\\d{5}[\\dA-Z]{17}",
		"AE": "\\d{3}\\d{16}",
		"GB": "[A-Z]{4}\\d{14}",
		"VG": "[\\dA-Z]{4}\\d{16}"
	};

	bbanpattern = bbancountrypatterns[countrycode];
	// As new countries will start using IBAN in the
	// future, we only check if the countrycode is known.
	// This prevents false negatives, while almost all
	// false positives introduced by this, will be caught
	// by the checksum validation below anyway.
	// Strict checking should return FALSE for unknown
	// countries.
	if (typeof bbanpattern !== "undefined") {
		ibanregexp = new RegExp("^[A-Z]{2}\\d{2}" + bbanpattern + "$", "");
		if (!(ibanregexp.test(iban))) {
			return false; // invalid country specific format
		}
	}

	// now check the checksum, first convert to digits
	ibancheck = iban.substring(4,iban.length) + iban.substring(0,4);
	for (i = 0; i < ibancheck.length; i++) {
		charAt = ibancheck.charAt(i);
		if (charAt !== "0") {
			leadingZeroes = false;
		}
		if (!leadingZeroes) {
			ibancheckdigits += "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(charAt);
		}
	}

	// calculate the result of: ibancheckdigits % 97
	for (p = 0; p < ibancheckdigits.length; p++) {
		cChar = ibancheckdigits.charAt(p);
		cOperator = "" + cRest + "" + cChar;
		cRest = cOperator % 97;
	}
	return cRest === 1;
}, "Please specify a valid IBAN");

jQuery.validator.addMethod("integer", function(value, element) {
	return this.optional(element) || /^-?\d+$/.test(value);
}, "A positive or negative non-decimal number please");

jQuery.validator.addMethod("ipv4", function(value, element) {
	return this.optional(element) || /^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(value);
}, "Please enter a valid IP v4 address.");

jQuery.validator.addMethod("ipv6", function(value, element) {
	return this.optional(element) || /^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i.test(value);
}, "Please enter a valid IP v6 address.");

jQuery.validator.addMethod("lettersonly", function(value, element) {
	return this.optional(element) || /^[a-z]+$/i.test(value);
}, "Letters only please");

jQuery.validator.addMethod("letterswithbasicpunc", function(value, element) {
	return this.optional(element) || /^[a-z\-.,()'"\s]+$/i.test(value);
}, "Letters or punctuation only please");

jQuery.validator.addMethod("mobileNL", function(value, element) {
	return this.optional(element) || /^((\+|00(\s|\s?\-\s?)?)31(\s|\s?\-\s?)?(\(0\)[\-\s]?)?|0)6((\s|\s?\-\s?)?[0-9]){8}$/.test(value);
}, "Please specify a valid mobile number");

/* For UK phone functions, do the following server side processing:
 * Compare original input with this RegEx pattern:
 * ^\(?(?:(?:00\)?[\s\-]?\(?|\+)(44)\)?[\s\-]?\(?(?:0\)?[\s\-]?\(?)?|0)([1-9]\d{1,4}\)?[\s\d\-]+)$
 * Extract $1 and set $prefix to '+44<space>' if $1 is '44', otherwise set $prefix to '0'
 * Extract $2 and remove hyphens, spaces and parentheses. Phone number is combined $prefix and $2.
 * A number of very detailed GB telephone number RegEx patterns can also be found at:
 * http://www.aa-asterisk.org.uk/index.php/Regular_Expressions_for_Validating_and_Formatting_GB_Telephone_Numbers
 */
jQuery.validator.addMethod("mobileUK", function(phone_number, element) {
	phone_number = phone_number.replace(/\(|\)|\s+|-/g, "");
	return this.optional(element) || phone_number.length > 9 &&
		phone_number.match(/^(?:(?:(?:00\s?|\+)44\s?|0)7(?:[1345789]\d{2}|624)\s?\d{3}\s?\d{3})$/);
}, "Please specify a valid mobile number");

/*
 * The número de identidad de extranjero ( NIE )is a code used to identify the non-nationals in Spain
 */
jQuery.validator.addMethod( "nieES", function( value ) {
	"use strict";

	value = value.toUpperCase();

	// Basic format test
	if ( !value.match( "((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)" ) ) {
		return false;
	}

	// Test NIE
	//T
	if ( /^[T]{1}/.test( value ) ) {
		return ( value[ 8 ] === /^[T]{1}[A-Z0-9]{8}$/.test( value ) );
	}

	//XYZ
	if ( /^[XYZ]{1}/.test( value ) ) {
		return (
			value[ 8 ] === "TRWAGMYFPDXBNJZSQVHLCKE".charAt(
				value.replace( "X", "0" )
					.replace( "Y", "1" )
					.replace( "Z", "2" )
					.substring( 0, 8 ) % 23
			)
		);
	}

	return false;

}, "Please specify a valid NIE number." );

/*
 * The Número de Identificación Fiscal ( NIF ) is the way tax identification used in Spain for individuals
 */
jQuery.validator.addMethod( "nifES", function( value ) {
	"use strict";

	value = value.toUpperCase();

	// Basic format test
	if ( !value.match("((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)") ) {
		return false;
	}

	// Test NIF
	if ( /^[0-9]{8}[A-Z]{1}$/.test( value ) ) {
		return ( "TRWAGMYFPDXBNJZSQVHLCKE".charAt( value.substring( 8, 0 ) % 23 ) === value.charAt( 8 ) );
	}
	// Test specials NIF (starts with K, L or M)
	if ( /^[KLM]{1}/.test( value ) ) {
		return ( value[ 8 ] === String.fromCharCode( 64 ) );
	}

	return false;

}, "Please specify a valid NIF number." );

jQuery.validator.addMethod("nowhitespace", function(value, element) {
	return this.optional(element) || /^\S+$/i.test(value);
}, "No white space please");

/**
* Return true if the field value matches the given format RegExp
*
* @example jQuery.validator.methods.pattern("AR1004",element,/^AR\d{4}$/)
* @result true
*
* @example jQuery.validator.methods.pattern("BR1004",element,/^AR\d{4}$/)
* @result false
*
* @name jQuery.validator.methods.pattern
* @type Boolean
* @cat Plugins/Validate/Methods
*/
jQuery.validator.addMethod("pattern", function(value, element, param) {
	if (this.optional(element)) {
		return true;
	}
	if (typeof param === "string") {
		param = new RegExp(param);
	}
	return param.test(value);
}, "Invalid format.");

/**
 * Dutch phone numbers have 10 digits (or 11 and start with +31).
 */
jQuery.validator.addMethod("phoneNL", function(value, element) {
	return this.optional(element) || /^((\+|00(\s|\s?\-\s?)?)31(\s|\s?\-\s?)?(\(0\)[\-\s]?)?|0)[1-9]((\s|\s?\-\s?)?[0-9]){8}$/.test(value);
}, "Please specify a valid phone number.");

/* For UK phone functions, do the following server side processing:
 * Compare original input with this RegEx pattern:
 * ^\(?(?:(?:00\)?[\s\-]?\(?|\+)(44)\)?[\s\-]?\(?(?:0\)?[\s\-]?\(?)?|0)([1-9]\d{1,4}\)?[\s\d\-]+)$
 * Extract $1 and set $prefix to '+44<space>' if $1 is '44', otherwise set $prefix to '0'
 * Extract $2 and remove hyphens, spaces and parentheses. Phone number is combined $prefix and $2.
 * A number of very detailed GB telephone number RegEx patterns can also be found at:
 * http://www.aa-asterisk.org.uk/index.php/Regular_Expressions_for_Validating_and_Formatting_GB_Telephone_Numbers
 */
jQuery.validator.addMethod("phoneUK", function(phone_number, element) {
	phone_number = phone_number.replace(/\(|\)|\s+|-/g, "");
	return this.optional(element) || phone_number.length > 9 &&
		phone_number.match(/^(?:(?:(?:00\s?|\+)44\s?)|(?:\(?0))(?:\d{2}\)?\s?\d{4}\s?\d{4}|\d{3}\)?\s?\d{3}\s?\d{3,4}|\d{4}\)?\s?(?:\d{5}|\d{3}\s?\d{3})|\d{5}\)?\s?\d{4,5})$/);
}, "Please specify a valid phone number");

/**
 * matches US phone number format
 *
 * where the area code may not start with 1 and the prefix may not start with 1
 * allows '-' or ' ' as a separator and allows parens around area code
 * some people may want to put a '1' in front of their number
 *
 * 1(212)-999-2345 or
 * 212 999 2344 or
 * 212-999-0983
 *
 * but not
 * 111-123-5434
 * and not
 * 212 123 4567
 */
jQuery.validator.addMethod("phoneUS", function(phone_number, element) {
	phone_number = phone_number.replace(/\s+/g, "");
	return this.optional(element) || phone_number.length > 9 &&
		phone_number.match(/^(\+?1-?)?(\([2-9]([02-9]\d|1[02-9])\)|[2-9]([02-9]\d|1[02-9]))-?[2-9]([02-9]\d|1[02-9])-?\d{4}$/);
}, "Please specify a valid phone number");

/* For UK phone functions, do the following server side processing:
 * Compare original input with this RegEx pattern:
 * ^\(?(?:(?:00\)?[\s\-]?\(?|\+)(44)\)?[\s\-]?\(?(?:0\)?[\s\-]?\(?)?|0)([1-9]\d{1,4}\)?[\s\d\-]+)$
 * Extract $1 and set $prefix to '+44<space>' if $1 is '44', otherwise set $prefix to '0'
 * Extract $2 and remove hyphens, spaces and parentheses. Phone number is combined $prefix and $2.
 * A number of very detailed GB telephone number RegEx patterns can also be found at:
 * http://www.aa-asterisk.org.uk/index.php/Regular_Expressions_for_Validating_and_Formatting_GB_Telephone_Numbers
 */
//Matches UK landline + mobile, accepting only 01-3 for landline or 07 for mobile to exclude many premium numbers
jQuery.validator.addMethod("phonesUK", function(phone_number, element) {
	phone_number = phone_number.replace(/\(|\)|\s+|-/g, "");
	return this.optional(element) || phone_number.length > 9 &&
		phone_number.match(/^(?:(?:(?:00\s?|\+)44\s?|0)(?:1\d{8,9}|[23]\d{9}|7(?:[1345789]\d{8}|624\d{6})))$/);
}, "Please specify a valid uk phone number");

jQuery.validator.addMethod("postalcodeNL", function(value, element) {
	return this.optional(element) || /^[1-9][0-9]{3}\s?[a-zA-Z]{2}$/.test(value);
}, "Please specify a valid postal code");

// Matches UK postcode. Does not match to UK Channel Islands that have their own postcodes (non standard UK)
jQuery.validator.addMethod("postcodeUK", function(value, element) {
	return this.optional(element) || /^((([A-PR-UWYZ][0-9])|([A-PR-UWYZ][0-9][0-9])|([A-PR-UWYZ][A-HK-Y][0-9])|([A-PR-UWYZ][A-HK-Y][0-9][0-9])|([A-PR-UWYZ][0-9][A-HJKSTUW])|([A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRVWXY]))\s?([0-9][ABD-HJLNP-UW-Z]{2})|(GIR)\s?(0AA))$/i.test(value);
}, "Please specify a valid UK postcode");

/*
 * Lets you say "at least X inputs that match selector Y must be filled."
 *
 * The end result is that neither of these inputs:
 *
 *	<input class="productinfo" name="partnumber">
 *	<input class="productinfo" name="description">
 *
 *	...will validate unless at least one of them is filled.
 *
 * partnumber:	{require_from_group: [1,".productinfo"]},
 * description: {require_from_group: [1,".productinfo"]}
 *
 * options[0]: number of fields that must be filled in the group
 * options[1]: CSS selector that defines the group of conditionally required fields
 */
jQuery.validator.addMethod("require_from_group", function(value, element, options) {
	var $fields = $(options[1], element.form),
		$fieldsFirst = $fields.eq(0),
		validator = $fieldsFirst.data("valid_req_grp") ? $fieldsFirst.data("valid_req_grp") : $.extend({}, this),
		isValid = $fields.filter(function() {
			return validator.elementValue(this);
		}).length >= options[0];

	// Store the cloned validator for future validation
	$fieldsFirst.data("valid_req_grp", validator);

	// If element isn't being validated, run each require_from_group field's validation rules
	if (!$(element).data("being_validated")) {
		$fields.data("being_validated", true);
		$fields.each(function() {
			validator.element(this);
		});
		$fields.data("being_validated", false);
	}
	return isValid;
}, jQuery.validator.format("Please fill at least {0} of these fields."));

/*
 * Lets you say "either at least X inputs that match selector Y must be filled,
 * OR they must all be skipped (left blank)."
 *
 * The end result, is that none of these inputs:
 *
 *	<input class="productinfo" name="partnumber">
 *	<input class="productinfo" name="description">
 *	<input class="productinfo" name="color">
 *
 *	...will validate unless either at least two of them are filled,
 *	OR none of them are.
 *
 * partnumber:	{skip_or_fill_minimum: [2,".productinfo"]},
 * description: {skip_or_fill_minimum: [2,".productinfo"]},
 * color:		{skip_or_fill_minimum: [2,".productinfo"]}
 *
 * options[0]: number of fields that must be filled in the group
 * options[1]: CSS selector that defines the group of conditionally required fields
 *
 */
jQuery.validator.addMethod("skip_or_fill_minimum", function(value, element, options) {
	var $fields = $(options[1], element.form),
		$fieldsFirst = $fields.eq(0),
		validator = $fieldsFirst.data("valid_skip") ? $fieldsFirst.data("valid_skip") : $.extend({}, this),
		numberFilled = $fields.filter(function() {
			return validator.elementValue(this);
		}).length,
		isValid = numberFilled === 0 || numberFilled >= options[0];

	// Store the cloned validator for future validation
	$fieldsFirst.data("valid_skip", validator);

	// If element isn't being validated, run each skip_or_fill_minimum field's validation rules
	if (!$(element).data("being_validated")) {
		$fields.data("being_validated", true);
		$fields.each(function() {
			validator.element(this);
		});
		$fields.data("being_validated", false);
	}
	return isValid;
}, jQuery.validator.format("Please either skip these fields or fill at least {0} of them."));

// TODO check if value starts with <, otherwise don't try stripping anything
jQuery.validator.addMethod("strippedminlength", function(value, element, param) {
	return jQuery(value).text().length >= param;
}, jQuery.validator.format("Please enter at least {0} characters"));

jQuery.validator.addMethod("time", function(value, element) {
	return this.optional(element) || /^([01]\d|2[0-3])(:[0-5]\d){1,2}$/.test(value);
}, "Please enter a valid time, between 00:00 and 23:59");

jQuery.validator.addMethod("time12h", function(value, element) {
	return this.optional(element) || /^((0?[1-9]|1[012])(:[0-5]\d){1,2}(\ ?[AP]M))$/i.test(value);
}, "Please enter a valid time in 12-hour am/pm format");

// same as url, but TLD is optional
jQuery.validator.addMethod("url2", function(value, element) {
	return this.optional(element) || /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)*(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);
}, jQuery.validator.messages.url);

/**
 * Return true, if the value is a valid vehicle identification number (VIN).
 *
 * Works with all kind of text inputs.
 *
 * @example <input type="text" size="20" name="VehicleID" class="{required:true,vinUS:true}" />
 * @desc Declares a required input element whose value must be a valid vehicle identification number.
 *
 * @name jQuery.validator.methods.vinUS
 * @type Boolean
 * @cat Plugins/Validate/Methods
 */
jQuery.validator.addMethod("vinUS", function(v) {
	if (v.length !== 17) {
		return false;
	}

	var LL = [ "A", "B", "C", "D", "E", "F", "G", "H", "J", "K", "L", "M", "N", "P", "R", "S", "T", "U", "V", "W", "X", "Y", "Z" ],
		VL = [ 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4, 5, 7, 9, 2, 3, 4, 5, 6, 7, 8, 9 ],
		FL = [ 8, 7, 6, 5, 4, 3, 2, 10, 0, 9, 8, 7, 6, 5, 4, 3, 2 ],
		rs = 0,
		i, n, d, f, cd, cdv;

	for (i = 0; i < 17; i++){
		f = FL[i];
		d = v.slice(i,i + 1);
		if (i === 8) {
			cdv = d;
		}
		if (!isNaN(d)) {
			d *= f;
		} else {
			for (n = 0; n < LL.length; n++) {
				if (d.toUpperCase() === LL[n]) {
					d = VL[n];
					d *= f;
					if (isNaN(cdv) && n === 8) {
						cdv = LL[n];
					}
					break;
				}
			}
		}
		rs += d;
	}
	cd = rs % 11;
	if (cd === 10) {
		cd = "X";
	}
	if (cd === cdv) {
		return true;
	}
	return false;
}, "The specified vehicle identification number (VIN) is invalid.");

jQuery.validator.addMethod("zipcodeUS", function(value, element) {
	return this.optional(element) || /^\d{5}-\d{4}$|^\d{5}$/.test(value);
}, "The specified US ZIP Code is invalid");

jQuery.validator.addMethod("ziprange", function(value, element) {
	return this.optional(element) || /^90[2-5]\d\{2\}-\d{4}$/.test(value);
}, "Your ZIP-code must be in the range 902xx-xxxx to 905-xx-xxxx");

//! moment.js
//! version : 2.11.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return Uc.apply(null,arguments)}function b(a){Uc=a}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function e(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function f(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function g(a,b){for(var c in b)f(b,c)&&(a[c]=b[c]);return f(b,"toString")&&(a.toString=b.toString),f(b,"valueOf")&&(a.valueOf=b.valueOf),a}function h(a,b,c,d){return Da(a,b,c,d,!0).utc()}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function j(a){return null==a._pf&&(a._pf=i()),a._pf}function k(a){if(null==a._isValid){var b=j(a);a._isValid=!(isNaN(a._d.getTime())||!(b.overflow<0)||b.empty||b.invalidMonth||b.invalidWeekday||b.nullInput||b.invalidFormat||b.userInvalidated),a._strict&&(a._isValid=a._isValid&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour)}return a._isValid}function l(a){var b=h(NaN);return null!=a?g(j(b),a):j(b).userInvalidated=!0,b}function m(a){return void 0===a}function n(a,b){var c,d,e;if(m(b._isAMomentObject)||(a._isAMomentObject=b._isAMomentObject),m(b._i)||(a._i=b._i),m(b._f)||(a._f=b._f),m(b._l)||(a._l=b._l),m(b._strict)||(a._strict=b._strict),m(b._tzm)||(a._tzm=b._tzm),m(b._isUTC)||(a._isUTC=b._isUTC),m(b._offset)||(a._offset=b._offset),m(b._pf)||(a._pf=j(b)),m(b._locale)||(a._locale=b._locale),Wc.length>0)for(c in Wc)d=Wc[c],e=b[d],m(e)||(a[d]=e);return a}function o(b){n(this,b),this._d=new Date(null!=b._d?b._d.getTime():NaN),Xc===!1&&(Xc=!0,a.updateOffset(this),Xc=!1)}function p(a){return a instanceof o||null!=a&&null!=a._isAMomentObject}function q(a){return 0>a?Math.ceil(a):Math.floor(a)}function r(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=q(b)),c}function s(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&r(a[d])!==r(b[d]))&&g++;return g+f}function t(){}function u(a){return a?a.toLowerCase().replace("_","-"):a}function v(a){for(var b,c,d,e,f=0;f<a.length;){for(e=u(a[f]).split("-"),b=e.length,c=u(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=w(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&s(e,c,!0)>=b-1)break;b--}f++}return null}function w(a){var b=null;if(!Yc[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Vc._abbr,require("./locale/"+a),x(b)}catch(c){}return Yc[a]}function x(a,b){var c;return a&&(c=m(b)?z(a):y(a,b),c&&(Vc=c)),Vc._abbr}function y(a,b){return null!==b?(b.abbr=a,Yc[a]=Yc[a]||new t,Yc[a].set(b),x(a),Yc[a]):(delete Yc[a],null)}function z(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Vc;if(!c(a)){if(b=w(a))return b;a=[a]}return v(a)}function A(a,b){var c=a.toLowerCase();Zc[c]=Zc[c+"s"]=Zc[b]=a}function B(a){return"string"==typeof a?Zc[a]||Zc[a.toLowerCase()]:void 0}function C(a){var b,c,d={};for(c in a)f(a,c)&&(b=B(c),b&&(d[b]=a[c]));return d}function D(a){return a instanceof Function||"[object Function]"===Object.prototype.toString.call(a)}function E(b,c){return function(d){return null!=d?(G(this,b,d),a.updateOffset(this,c),this):F(this,b)}}function F(a,b){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+b]():NaN}function G(a,b,c){a.isValid()&&a._d["set"+(a._isUTC?"UTC":"")+b](c)}function H(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=B(a),D(this[a]))return this[a](b);return this}function I(a,b,c){var d=""+Math.abs(a),e=b-d.length,f=a>=0;return(f?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function J(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(bd[a]=e),b&&(bd[b[0]]=function(){return I(e.apply(this,arguments),b[1],b[2])}),c&&(bd[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function K(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function L(a){var b,c,d=a.match($c);for(b=0,c=d.length;c>b;b++)bd[d[b]]?d[b]=bd[d[b]]:d[b]=K(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function M(a,b){return a.isValid()?(b=N(b,a.localeData()),ad[b]=ad[b]||L(b),ad[b](a)):a.localeData().invalidDate()}function N(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(_c.lastIndex=0;d>=0&&_c.test(a);)a=a.replace(_c,c),_c.lastIndex=0,d-=1;return a}function O(a,b,c){td[a]=D(b)?b:function(a,d){return a&&c?c:b}}function P(a,b){return f(td,a)?td[a](b._strict,b._locale):new RegExp(Q(a))}function Q(a){return R(a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}))}function R(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function S(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=r(a)}),c=0;c<a.length;c++)ud[a[c]]=d}function T(a,b){S(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function U(a,b,c){null!=b&&f(ud,a)&&ud[a](b,c._a,c,a)}function V(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function W(a,b){return c(this._months)?this._months[a.month()]:this._months[Ed.test(b)?"format":"standalone"][a.month()]}function X(a,b){return c(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[Ed.test(b)?"format":"standalone"][a.month()]}function Y(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=h([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function Z(a,b){var c;return a.isValid()?"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),V(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a):a}function $(b){return null!=b?(Z(this,b),a.updateOffset(this,!0),this):F(this,"Month")}function _(){return V(this.year(),this.month())}function aa(a){return this._monthsParseExact?(f(this,"_monthsRegex")||ca.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex):this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex}function ba(a){return this._monthsParseExact?(f(this,"_monthsRegex")||ca.call(this),a?this._monthsStrictRegex:this._monthsRegex):this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex}function ca(){function a(a,b){return b.length-a.length}var b,c,d=[],e=[],f=[];for(b=0;12>b;b++)c=h([2e3,b]),d.push(this.monthsShort(c,"")),e.push(this.months(c,"")),f.push(this.months(c,"")),f.push(this.monthsShort(c,""));for(d.sort(a),e.sort(a),f.sort(a),b=0;12>b;b++)d[b]=R(d[b]),e[b]=R(e[b]),f[b]=R(f[b]);this._monthsRegex=new RegExp("^("+f.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+e.join("|")+")$","i"),this._monthsShortStrictRegex=new RegExp("^("+d.join("|")+")$","i")}function da(a){var b,c=a._a;return c&&-2===j(a).overflow&&(b=c[wd]<0||c[wd]>11?wd:c[xd]<1||c[xd]>V(c[vd],c[wd])?xd:c[yd]<0||c[yd]>24||24===c[yd]&&(0!==c[zd]||0!==c[Ad]||0!==c[Bd])?yd:c[zd]<0||c[zd]>59?zd:c[Ad]<0||c[Ad]>59?Ad:c[Bd]<0||c[Bd]>999?Bd:-1,j(a)._overflowDayOfYear&&(vd>b||b>xd)&&(b=xd),j(a)._overflowWeeks&&-1===b&&(b=Cd),j(a)._overflowWeekday&&-1===b&&(b=Dd),j(a).overflow=b),a}function ea(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function fa(a,b){var c=!0;return g(function(){return c&&(ea(a+"\nArguments: "+Array.prototype.slice.call(arguments).join(", ")+"\n"+(new Error).stack),c=!1),b.apply(this,arguments)},b)}function ga(a,b){Jd[a]||(ea(b),Jd[a]=!0)}function ha(a){var b,c,d,e,f,g,h=a._i,i=Kd.exec(h)||Ld.exec(h);if(i){for(j(a).iso=!0,b=0,c=Nd.length;c>b;b++)if(Nd[b][1].exec(i[1])){e=Nd[b][0],d=Nd[b][2]!==!1;break}if(null==e)return void(a._isValid=!1);if(i[3]){for(b=0,c=Od.length;c>b;b++)if(Od[b][1].exec(i[3])){f=(i[2]||" ")+Od[b][0];break}if(null==f)return void(a._isValid=!1)}if(!d&&null!=f)return void(a._isValid=!1);if(i[4]){if(!Md.exec(i[4]))return void(a._isValid=!1);g="Z"}a._f=e+(f||"")+(g||""),wa(a)}else a._isValid=!1}function ia(b){var c=Pd.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(ha(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ja(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 100>a&&a>=0&&isFinite(h.getFullYear())&&h.setFullYear(a),h}function ka(a){var b=new Date(Date.UTC.apply(null,arguments));return 100>a&&a>=0&&isFinite(b.getUTCFullYear())&&b.setUTCFullYear(a),b}function la(a){return ma(a)?366:365}function ma(a){return a%4===0&&a%100!==0||a%400===0}function na(){return ma(this.year())}function oa(a,b,c){var d=7+b-c,e=(7+ka(a,0,d).getUTCDay()-b)%7;return-e+d-1}function pa(a,b,c,d,e){var f,g,h=(7+c-d)%7,i=oa(a,d,e),j=1+7*(b-1)+h+i;return 0>=j?(f=a-1,g=la(f)+j):j>la(a)?(f=a+1,g=j-la(a)):(f=a,g=j),{year:f,dayOfYear:g}}function qa(a,b,c){var d,e,f=oa(a.year(),b,c),g=Math.floor((a.dayOfYear()-f-1)/7)+1;return 1>g?(e=a.year()-1,d=g+ra(e,b,c)):g>ra(a.year(),b,c)?(d=g-ra(a.year(),b,c),e=a.year()+1):(e=a.year(),d=g),{week:d,year:e}}function ra(a,b,c){var d=oa(a,b,c),e=oa(a+1,b,c);return(la(a)-d+e)/7}function sa(a,b,c){return null!=a?a:null!=b?b:c}function ta(b){var c=new Date(a.now());return b._useUTC?[c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]:[c.getFullYear(),c.getMonth(),c.getDate()]}function ua(a){var b,c,d,e,f=[];if(!a._d){for(d=ta(a),a._w&&null==a._a[xd]&&null==a._a[wd]&&va(a),a._dayOfYear&&(e=sa(a._a[vd],d[vd]),a._dayOfYear>la(e)&&(j(a)._overflowDayOfYear=!0),c=ka(e,0,a._dayOfYear),a._a[wd]=c.getUTCMonth(),a._a[xd]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[yd]&&0===a._a[zd]&&0===a._a[Ad]&&0===a._a[Bd]&&(a._nextDay=!0,a._a[yd]=0),a._d=(a._useUTC?ka:ja).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[yd]=24)}}function va(a){var b,c,d,e,f,g,h,i;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=sa(b.GG,a._a[vd],qa(Ea(),1,4).year),d=sa(b.W,1),e=sa(b.E,1),(1>e||e>7)&&(i=!0)):(f=a._locale._week.dow,g=a._locale._week.doy,c=sa(b.gg,a._a[vd],qa(Ea(),f,g).year),d=sa(b.w,1),null!=b.d?(e=b.d,(0>e||e>6)&&(i=!0)):null!=b.e?(e=b.e+f,(b.e<0||b.e>6)&&(i=!0)):e=f),1>d||d>ra(c,f,g)?j(a)._overflowWeeks=!0:null!=i?j(a)._overflowWeekday=!0:(h=pa(c,d,e,f,g),a._a[vd]=h.year,a._dayOfYear=h.dayOfYear)}function wa(b){if(b._f===a.ISO_8601)return void ha(b);b._a=[],j(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,k=0;for(e=N(b._f,b._locale).match($c)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(P(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&j(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),k+=d.length),bd[f]?(d?j(b).empty=!1:j(b).unusedTokens.push(f),U(f,d,b)):b._strict&&!d&&j(b).unusedTokens.push(f);j(b).charsLeftOver=i-k,h.length>0&&j(b).unusedInput.push(h),j(b).bigHour===!0&&b._a[yd]<=12&&b._a[yd]>0&&(j(b).bigHour=void 0),b._a[yd]=xa(b._locale,b._a[yd],b._meridiem),ua(b),da(b)}function xa(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function ya(a){var b,c,d,e,f;if(0===a._f.length)return j(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=n({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],wa(b),k(b)&&(f+=j(b).charsLeftOver,f+=10*j(b).unusedTokens.length,j(b).score=f,(null==d||d>f)&&(d=f,c=b));g(a,c||b)}function za(a){if(!a._d){var b=C(a._i);a._a=e([b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],function(a){return a&&parseInt(a,10)}),ua(a)}}function Aa(a){var b=new o(da(Ba(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function Ba(a){var b=a._i,e=a._f;return a._locale=a._locale||z(a._l),null===b||void 0===e&&""===b?l({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),p(b)?new o(da(b)):(c(e)?ya(a):e?wa(a):d(b)?a._d=b:Ca(a),k(a)||(a._d=null),a))}function Ca(b){var f=b._i;void 0===f?b._d=new Date(a.now()):d(f)?b._d=new Date(+f):"string"==typeof f?ia(b):c(f)?(b._a=e(f.slice(0),function(a){return parseInt(a,10)}),ua(b)):"object"==typeof f?za(b):"number"==typeof f?b._d=new Date(f):a.createFromInputFallback(b)}function Da(a,b,c,d,e){var f={};return"boolean"==typeof c&&(d=c,c=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=e,f._l=c,f._i=a,f._f=b,f._strict=d,Aa(f)}function Ea(a,b,c,d){return Da(a,b,c,d,!1)}function Fa(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return Ea();for(d=b[0],e=1;e<b.length;++e)(!b[e].isValid()||b[e][a](d))&&(d=b[e]);return d}function Ga(){var a=[].slice.call(arguments,0);return Fa("isBefore",a)}function Ha(){var a=[].slice.call(arguments,0);return Fa("isAfter",a)}function Ia(a){var b=C(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=z(),this._bubble()}function Ja(a){return a instanceof Ia}function Ka(a,b){J(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+I(~~(a/60),2)+b+I(~~a%60,2)})}function La(a,b){var c=(b||"").match(a)||[],d=c[c.length-1]||[],e=(d+"").match(Ud)||["-",0,0],f=+(60*e[1])+r(e[2]);return"+"===e[0]?f:-f}function Ma(b,c){var e,f;return c._isUTC?(e=c.clone(),f=(p(b)||d(b)?+b:+Ea(b))-+e,e._d.setTime(+e._d+f),a.updateOffset(e,!1),e):Ea(b).local()}function Na(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Oa(b,c){var d,e=this._offset||0;return this.isValid()?null!=b?("string"==typeof b?b=La(qd,b):Math.abs(b)<16&&(b=60*b),!this._isUTC&&c&&(d=Na(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?cb(this,Za(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Na(this):null!=b?this:NaN}function Pa(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Qa(a){return this.utcOffset(0,a)}function Ra(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Na(this),"m")),this}function Sa(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(La(pd,this._i)),this}function Ta(a){return this.isValid()?(a=a?Ea(a).utcOffset():0,(this.utcOffset()-a)%60===0):!1}function Ua(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Va(){if(!m(this._isDSTShifted))return this._isDSTShifted;var a={};if(n(a,this),a=Ba(a),a._a){var b=a._isUTC?h(a._a):Ea(a._a);this._isDSTShifted=this.isValid()&&s(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Wa(){return this.isValid()?!this._isUTC:!1}function Xa(){return this.isValid()?this._isUTC:!1}function Ya(){return this.isValid()?this._isUTC&&0===this._offset:!1}function Za(a,b){var c,d,e,g=a,h=null;return Ja(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(g={},b?g[b]=a:g.milliseconds=a):(h=Vd.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:r(h[xd])*c,h:r(h[yd])*c,m:r(h[zd])*c,s:r(h[Ad])*c,ms:r(h[Bd])*c}):(h=Wd.exec(a))?(c="-"===h[1]?-1:1,g={y:$a(h[2],c),M:$a(h[3],c),d:$a(h[4],c),h:$a(h[5],c),m:$a(h[6],c),s:$a(h[7],c),w:$a(h[8],c)}):null==g?g={}:"object"==typeof g&&("from"in g||"to"in g)&&(e=ab(Ea(g.from),Ea(g.to)),g={},g.ms=e.milliseconds,g.M=e.months),d=new Ia(g),Ja(a)&&f(a,"_locale")&&(d._locale=a._locale),d}function $a(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function _a(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function ab(a,b){var c;return a.isValid()&&b.isValid()?(b=Ma(b,a),a.isBefore(b)?c=_a(a,b):(c=_a(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c):{milliseconds:0,months:0}}function bb(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(ga(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Za(c,d),cb(this,e,a),this}}function cb(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;b.isValid()&&(e=null==e?!0:e,f&&b._d.setTime(+b._d+f*d),g&&G(b,"Date",F(b,"Date")+g*d),h&&Z(b,F(b,"Month")+h*d),e&&a.updateOffset(b,g||h))}function db(a,b){var c=a||Ea(),d=Ma(c,this).startOf("day"),e=this.diff(d,"days",!0),f=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse",g=b&&(D(b[f])?b[f]():b[f]);return this.format(g||this.localeData().calendar(f,this,Ea(c)))}function eb(){return new o(this)}function fb(a,b){var c=p(a)?a:Ea(a);return this.isValid()&&c.isValid()?(b=B(m(b)?"millisecond":b),"millisecond"===b?+this>+c:+c<+this.clone().startOf(b)):!1}function gb(a,b){var c=p(a)?a:Ea(a);return this.isValid()&&c.isValid()?(b=B(m(b)?"millisecond":b),"millisecond"===b?+c>+this:+this.clone().endOf(b)<+c):!1}function hb(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function ib(a,b){var c,d=p(a)?a:Ea(a);return this.isValid()&&d.isValid()?(b=B(b||"millisecond"),"millisecond"===b?+this===+d:(c=+d,+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))):!1}function jb(a,b){return this.isSame(a,b)||this.isAfter(a,b)}function kb(a,b){return this.isSame(a,b)||this.isBefore(a,b)}function lb(a,b,c){var d,e,f,g;return this.isValid()?(d=Ma(a,this),d.isValid()?(e=6e4*(d.utcOffset()-this.utcOffset()),b=B(b),"year"===b||"month"===b||"quarter"===b?(g=mb(this,d),"quarter"===b?g/=3:"year"===b&&(g/=12)):(f=this-d,g="second"===b?f/1e3:"minute"===b?f/6e4:"hour"===b?f/36e5:"day"===b?(f-e)/864e5:"week"===b?(f-e)/6048e5:f),c?g:q(g)):NaN):NaN}function mb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function nb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ob(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?D(Date.prototype.toISOString)?this.toDate().toISOString():M(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):M(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function pb(b){var c=M(this,b||a.defaultFormat);return this.localeData().postformat(c)}function qb(a,b){return this.isValid()&&(p(a)&&a.isValid()||Ea(a).isValid())?Za({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function rb(a){return this.from(Ea(),a)}function sb(a,b){return this.isValid()&&(p(a)&&a.isValid()||Ea(a).isValid())?Za({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function tb(a){return this.to(Ea(),a)}function ub(a){var b;return void 0===a?this._locale._abbr:(b=z(a),null!=b&&(this._locale=b),this)}function vb(){return this._locale}function wb(a){switch(a=B(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function xb(a){return a=B(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function yb(){return+this._d-6e4*(this._offset||0)}function zb(){return Math.floor(+this/1e3)}function Ab(){return this._offset?new Date(+this):this._d}function Bb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function Cb(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function Db(){return this.isValid()?this.toISOString():"null"}function Eb(){return k(this)}function Fb(){return g({},j(this))}function Gb(){return j(this).overflow}function Hb(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Ib(a,b){J(0,[a,a.length],0,b)}function Jb(a){return Nb.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function Kb(a){return Nb.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)}function Lb(){return ra(this.year(),1,4)}function Mb(){var a=this.localeData()._week;return ra(this.year(),a.dow,a.doy)}function Nb(a,b,c,d,e){var f;return null==a?qa(this,d,e).year:(f=ra(a,d,e),b>f&&(b=f),Ob.call(this,a,b,c,d,e))}function Ob(a,b,c,d,e){var f=pa(a,b,c,d,e),g=ka(f.year,0,f.dayOfYear);return this.year(g.getUTCFullYear()),this.month(g.getUTCMonth()),this.date(g.getUTCDate()),this}function Pb(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Qb(a){return qa(a,this._week.dow,this._week.doy).week}function Rb(){return this._week.dow}function Sb(){return this._week.doy}function Tb(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function Ub(a){var b=qa(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function Vb(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Wb(a,b){return c(this._weekdays)?this._weekdays[a.day()]:this._weekdays[this._weekdays.isFormat.test(b)?"format":"standalone"][a.day()]}function Xb(a){return this._weekdaysShort[a.day()]}function Yb(a){return this._weekdaysMin[a.day()]}function Zb(a,b,c){var d,e,f;for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),d=0;7>d;d++){if(e=Ea([2e3,1]).day(d),c&&!this._fullWeekdaysParse[d]&&(this._fullWeekdaysParse[d]=new RegExp("^"+this.weekdays(e,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[d]=new RegExp("^"+this.weekdaysShort(e,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[d]=new RegExp("^"+this.weekdaysMin(e,"").replace(".",".?")+"$","i")),this._weekdaysParse[d]||(f="^"+this.weekdays(e,"")+"|^"+this.weekdaysShort(e,"")+"|^"+this.weekdaysMin(e,""),this._weekdaysParse[d]=new RegExp(f.replace(".",""),"i")),c&&"dddd"===b&&this._fullWeekdaysParse[d].test(a))return d;if(c&&"ddd"===b&&this._shortWeekdaysParse[d].test(a))return d;if(c&&"dd"===b&&this._minWeekdaysParse[d].test(a))return d;if(!c&&this._weekdaysParse[d].test(a))return d}}function $b(a){if(!this.isValid())return null!=a?this:NaN;var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Vb(a,this.localeData()),this.add(a-b,"d")):b}function _b(a){if(!this.isValid())return null!=a?this:NaN;var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function ac(a){return this.isValid()?null==a?this.day()||7:this.day(this.day()%7?a:a-7):null!=a?this:NaN}function bc(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function cc(){return this.hours()%12||12}function dc(a,b){J(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function ec(a,b){return b._meridiemParse}function fc(a){return"p"===(a+"").toLowerCase().charAt(0)}function gc(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function hc(a,b){b[Bd]=r(1e3*("0."+a))}function ic(){return this._isUTC?"UTC":""}function jc(){return this._isUTC?"Coordinated Universal Time":""}function kc(a){return Ea(1e3*a)}function lc(){return Ea.apply(null,arguments).parseZone()}function mc(a,b,c){var d=this._calendar[a];return D(d)?d.call(b,c):d}function nc(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function oc(){return this._invalidDate}function pc(a){return this._ordinal.replace("%d",a)}function qc(a){return a}function rc(a,b,c,d){var e=this._relativeTime[c];return D(e)?e(a,b,c,d):e.replace(/%d/i,a)}function sc(a,b){var c=this._relativeTime[a>0?"future":"past"];return D(c)?c(b):c.replace(/%s/i,b)}function tc(a){var b,c;for(c in a)b=a[c],D(b)?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function uc(a,b,c,d){var e=z(),f=h().set(d,b);return e[c](f,a)}function vc(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return uc(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=uc(a,f,c,e);return g}function wc(a,b){return vc(a,b,"months",12,"month")}function xc(a,b){return vc(a,b,"monthsShort",12,"month")}function yc(a,b){return vc(a,b,"weekdays",7,"day")}function zc(a,b){return vc(a,b,"weekdaysShort",7,"day")}function Ac(a,b){return vc(a,b,"weekdaysMin",7,"day")}function Bc(){var a=this._data;return this._milliseconds=se(this._milliseconds),this._days=se(this._days),this._months=se(this._months),a.milliseconds=se(a.milliseconds),a.seconds=se(a.seconds),a.minutes=se(a.minutes),a.hours=se(a.hours),a.months=se(a.months),a.years=se(a.years),this}function Cc(a,b,c,d){var e=Za(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function Dc(a,b){return Cc(this,a,b,1)}function Ec(a,b){return Cc(this,a,b,-1)}function Fc(a){return 0>a?Math.floor(a):Math.ceil(a)}function Gc(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||0>=f&&0>=g&&0>=h||(f+=864e5*Fc(Ic(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=q(f/1e3),i.seconds=a%60,b=q(a/60),i.minutes=b%60,c=q(b/60),i.hours=c%24,g+=q(c/24),e=q(Hc(g)),h+=e,g-=Fc(Ic(e)),d=q(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function Hc(a){return 4800*a/146097}function Ic(a){return 146097*a/4800}function Jc(a){var b,c,d=this._milliseconds;if(a=B(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+Hc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(Ic(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function Kc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*r(this._months/12)}function Lc(a){return function(){return this.as(a)}}function Mc(a){return a=B(a),this[a+"s"]()}function Nc(a){return function(){return this._data[a]}}function Oc(){return q(this.days()/7)}function Pc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function Qc(a,b,c){var d=Za(a).abs(),e=Ie(d.as("s")),f=Ie(d.as("m")),g=Ie(d.as("h")),h=Ie(d.as("d")),i=Ie(d.as("M")),j=Ie(d.as("y")),k=e<Je.s&&["s",e]||1>=f&&["m"]||f<Je.m&&["mm",f]||1>=g&&["h"]||g<Je.h&&["hh",g]||1>=h&&["d"]||h<Je.d&&["dd",h]||1>=i&&["M"]||i<Je.M&&["MM",i]||1>=j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,Pc.apply(null,k)}function Rc(a,b){return void 0===Je[a]?!1:void 0===b?Je[a]:(Je[a]=b,!0)}function Sc(a){var b=this.localeData(),c=Qc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function Tc(){var a,b,c,d=Ke(this._milliseconds)/1e3,e=Ke(this._days),f=Ke(this._months);a=q(d/60),b=q(a/60),d%=60,a%=60,c=q(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(0>m?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var Uc,Vc,Wc=a.momentProperties=[],Xc=!1,Yc={},Zc={},$c=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,_c=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ad={},bd={},cd=/\d/,dd=/\d\d/,ed=/\d{3}/,fd=/\d{4}/,gd=/[+-]?\d{6}/,hd=/\d\d?/,id=/\d\d\d\d?/,jd=/\d\d\d\d\d\d?/,kd=/\d{1,3}/,ld=/\d{1,4}/,md=/[+-]?\d{1,6}/,nd=/\d+/,od=/[+-]?\d+/,pd=/Z|[+-]\d\d:?\d\d/gi,qd=/Z|[+-]\d\d(?::?\d\d)?/gi,rd=/[+-]?\d+(\.\d{1,3})?/,sd=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,td={},ud={},vd=0,wd=1,xd=2,yd=3,zd=4,Ad=5,Bd=6,Cd=7,Dd=8;J("M",["MM",2],"Mo",function(){return this.month()+1}),J("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),J("MMMM",0,0,function(a){return this.localeData().months(this,a)}),A("month","M"),O("M",hd),O("MM",hd,dd),O("MMM",function(a,b){return b.monthsShortRegex(a)}),O("MMMM",function(a,b){return b.monthsRegex(a)}),S(["M","MM"],function(a,b){b[wd]=r(a)-1}),S(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[wd]=e:j(c).invalidMonth=a});var Ed=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/,Fd="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Gd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Hd=sd,Id=sd,Jd={};a.suppressDeprecationWarnings=!1;var Kd=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Ld=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Md=/Z|[+-]\d\d(?::?\d\d)?/,Nd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Od=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Pd=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=fa("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),J("Y",0,0,function(){var a=this.year();return 9999>=a?""+a:"+"+a}),J(0,["YY",2],0,function(){return this.year()%100}),J(0,["YYYY",4],0,"year"),J(0,["YYYYY",5],0,"year"),J(0,["YYYYYY",6,!0],0,"year"),A("year","y"),O("Y",od),O("YY",hd,dd),O("YYYY",ld,fd),O("YYYYY",md,gd),O("YYYYYY",md,gd),S(["YYYYY","YYYYYY"],vd),S("YYYY",function(b,c){c[vd]=2===b.length?a.parseTwoDigitYear(b):r(b)}),S("YY",function(b,c){c[vd]=a.parseTwoDigitYear(b)}),S("Y",function(a,b){b[vd]=parseInt(a,10)}),a.parseTwoDigitYear=function(a){return r(a)+(r(a)>68?1900:2e3)};var Qd=E("FullYear",!1);a.ISO_8601=function(){};var Rd=fa("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=Ea.apply(null,arguments);return this.isValid()&&a.isValid()?this>a?this:a:l()}),Sd=fa("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=Ea.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:a:l()}),Td=function(){return Date.now?Date.now():+new Date};Ka("Z",":"),Ka("ZZ",""),O("Z",qd),O("ZZ",qd),S(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=La(qd,a)});var Ud=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var Vd=/(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Wd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;
Za.fn=Ia.prototype;var Xd=bb(1,"add"),Yd=bb(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Zd=fa("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});J(0,["gg",2],0,function(){return this.weekYear()%100}),J(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Ib("gggg","weekYear"),Ib("ggggg","weekYear"),Ib("GGGG","isoWeekYear"),Ib("GGGGG","isoWeekYear"),A("weekYear","gg"),A("isoWeekYear","GG"),O("G",od),O("g",od),O("GG",hd,dd),O("gg",hd,dd),O("GGGG",ld,fd),O("gggg",ld,fd),O("GGGGG",md,gd),O("ggggg",md,gd),T(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=r(a)}),T(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),J("Q",0,"Qo","quarter"),A("quarter","Q"),O("Q",cd),S("Q",function(a,b){b[wd]=3*(r(a)-1)}),J("w",["ww",2],"wo","week"),J("W",["WW",2],"Wo","isoWeek"),A("week","w"),A("isoWeek","W"),O("w",hd),O("ww",hd,dd),O("W",hd),O("WW",hd,dd),T(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=r(a)});var $d={dow:0,doy:6};J("D",["DD",2],"Do","date"),A("date","D"),O("D",hd),O("DD",hd,dd),O("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),S(["D","DD"],xd),S("Do",function(a,b){b[xd]=r(a.match(hd)[0],10)});var _d=E("Date",!0);J("d",0,"do","day"),J("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),J("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),J("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),J("e",0,0,"weekday"),J("E",0,0,"isoWeekday"),A("day","d"),A("weekday","e"),A("isoWeekday","E"),O("d",hd),O("e",hd),O("E",hd),O("dd",sd),O("ddd",sd),O("dddd",sd),T(["dd","ddd","dddd"],function(a,b,c,d){var e=c._locale.weekdaysParse(a,d,c._strict);null!=e?b.d=e:j(c).invalidWeekday=a}),T(["d","e","E"],function(a,b,c,d){b[d]=r(a)});var ae="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),be="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),ce="Su_Mo_Tu_We_Th_Fr_Sa".split("_");J("DDD",["DDDD",3],"DDDo","dayOfYear"),A("dayOfYear","DDD"),O("DDD",kd),O("DDDD",ed),S(["DDD","DDDD"],function(a,b,c){c._dayOfYear=r(a)}),J("H",["HH",2],0,"hour"),J("h",["hh",2],0,cc),J("hmm",0,0,function(){return""+cc.apply(this)+I(this.minutes(),2)}),J("hmmss",0,0,function(){return""+cc.apply(this)+I(this.minutes(),2)+I(this.seconds(),2)}),J("Hmm",0,0,function(){return""+this.hours()+I(this.minutes(),2)}),J("Hmmss",0,0,function(){return""+this.hours()+I(this.minutes(),2)+I(this.seconds(),2)}),dc("a",!0),dc("A",!1),A("hour","h"),O("a",ec),O("A",ec),O("H",hd),O("h",hd),O("HH",hd,dd),O("hh",hd,dd),O("hmm",id),O("hmmss",jd),O("Hmm",id),O("Hmmss",jd),S(["H","HH"],yd),S(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),S(["h","hh"],function(a,b,c){b[yd]=r(a),j(c).bigHour=!0}),S("hmm",function(a,b,c){var d=a.length-2;b[yd]=r(a.substr(0,d)),b[zd]=r(a.substr(d)),j(c).bigHour=!0}),S("hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[yd]=r(a.substr(0,d)),b[zd]=r(a.substr(d,2)),b[Ad]=r(a.substr(e)),j(c).bigHour=!0}),S("Hmm",function(a,b,c){var d=a.length-2;b[yd]=r(a.substr(0,d)),b[zd]=r(a.substr(d))}),S("Hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[yd]=r(a.substr(0,d)),b[zd]=r(a.substr(d,2)),b[Ad]=r(a.substr(e))});var de=/[ap]\.?m?\.?/i,ee=E("Hours",!0);J("m",["mm",2],0,"minute"),A("minute","m"),O("m",hd),O("mm",hd,dd),S(["m","mm"],zd);var fe=E("Minutes",!1);J("s",["ss",2],0,"second"),A("second","s"),O("s",hd),O("ss",hd,dd),S(["s","ss"],Ad);var ge=E("Seconds",!1);J("S",0,0,function(){return~~(this.millisecond()/100)}),J(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),J(0,["SSS",3],0,"millisecond"),J(0,["SSSS",4],0,function(){return 10*this.millisecond()}),J(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),J(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),J(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),J(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),J(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),A("millisecond","ms"),O("S",kd,cd),O("SS",kd,dd),O("SSS",kd,ed);var he;for(he="SSSS";he.length<=9;he+="S")O(he,nd);for(he="S";he.length<=9;he+="S")S(he,hc);var ie=E("Milliseconds",!1);J("z",0,0,"zoneAbbr"),J("zz",0,0,"zoneName");var je=o.prototype;je.add=Xd,je.calendar=db,je.clone=eb,je.diff=lb,je.endOf=xb,je.format=pb,je.from=qb,je.fromNow=rb,je.to=sb,je.toNow=tb,je.get=H,je.invalidAt=Gb,je.isAfter=fb,je.isBefore=gb,je.isBetween=hb,je.isSame=ib,je.isSameOrAfter=jb,je.isSameOrBefore=kb,je.isValid=Eb,je.lang=Zd,je.locale=ub,je.localeData=vb,je.max=Sd,je.min=Rd,je.parsingFlags=Fb,je.set=H,je.startOf=wb,je.subtract=Yd,je.toArray=Bb,je.toObject=Cb,je.toDate=Ab,je.toISOString=ob,je.toJSON=Db,je.toString=nb,je.unix=zb,je.valueOf=yb,je.creationData=Hb,je.year=Qd,je.isLeapYear=na,je.weekYear=Jb,je.isoWeekYear=Kb,je.quarter=je.quarters=Pb,je.month=$,je.daysInMonth=_,je.week=je.weeks=Tb,je.isoWeek=je.isoWeeks=Ub,je.weeksInYear=Mb,je.isoWeeksInYear=Lb,je.date=_d,je.day=je.days=$b,je.weekday=_b,je.isoWeekday=ac,je.dayOfYear=bc,je.hour=je.hours=ee,je.minute=je.minutes=fe,je.second=je.seconds=ge,je.millisecond=je.milliseconds=ie,je.utcOffset=Oa,je.utc=Qa,je.local=Ra,je.parseZone=Sa,je.hasAlignedHourOffset=Ta,je.isDST=Ua,je.isDSTShifted=Va,je.isLocal=Wa,je.isUtcOffset=Xa,je.isUtc=Ya,je.isUTC=Ya,je.zoneAbbr=ic,je.zoneName=jc,je.dates=fa("dates accessor is deprecated. Use date instead.",_d),je.months=fa("months accessor is deprecated. Use month instead",$),je.years=fa("years accessor is deprecated. Use year instead",Qd),je.zone=fa("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Pa);var ke=je,le={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},me={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},ne="Invalid date",oe="%d",pe=/\d{1,2}/,qe={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},re=t.prototype;re._calendar=le,re.calendar=mc,re._longDateFormat=me,re.longDateFormat=nc,re._invalidDate=ne,re.invalidDate=oc,re._ordinal=oe,re.ordinal=pc,re._ordinalParse=pe,re.preparse=qc,re.postformat=qc,re._relativeTime=qe,re.relativeTime=rc,re.pastFuture=sc,re.set=tc,re.months=W,re._months=Fd,re.monthsShort=X,re._monthsShort=Gd,re.monthsParse=Y,re._monthsRegex=Id,re.monthsRegex=ba,re._monthsShortRegex=Hd,re.monthsShortRegex=aa,re.week=Qb,re._week=$d,re.firstDayOfYear=Sb,re.firstDayOfWeek=Rb,re.weekdays=Wb,re._weekdays=ae,re.weekdaysMin=Yb,re._weekdaysMin=ce,re.weekdaysShort=Xb,re._weekdaysShort=be,re.weekdaysParse=Zb,re.isPM=fc,re._meridiemParse=de,re.meridiem=gc,x("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===r(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=fa("moment.lang is deprecated. Use moment.locale instead.",x),a.langData=fa("moment.langData is deprecated. Use moment.localeData instead.",z);var se=Math.abs,te=Lc("ms"),ue=Lc("s"),ve=Lc("m"),we=Lc("h"),xe=Lc("d"),ye=Lc("w"),ze=Lc("M"),Ae=Lc("y"),Be=Nc("milliseconds"),Ce=Nc("seconds"),De=Nc("minutes"),Ee=Nc("hours"),Fe=Nc("days"),Ge=Nc("months"),He=Nc("years"),Ie=Math.round,Je={s:45,m:45,h:22,d:26,M:11},Ke=Math.abs,Le=Ia.prototype;Le.abs=Bc,Le.add=Dc,Le.subtract=Ec,Le.as=Jc,Le.asMilliseconds=te,Le.asSeconds=ue,Le.asMinutes=ve,Le.asHours=we,Le.asDays=xe,Le.asWeeks=ye,Le.asMonths=ze,Le.asYears=Ae,Le.valueOf=Kc,Le._bubble=Gc,Le.get=Mc,Le.milliseconds=Be,Le.seconds=Ce,Le.minutes=De,Le.hours=Ee,Le.days=Fe,Le.weeks=Oc,Le.months=Ge,Le.years=He,Le.humanize=Sc,Le.toISOString=Tc,Le.toString=Tc,Le.toJSON=Tc,Le.locale=ub,Le.localeData=vb,Le.toIsoString=fa("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Tc),Le.lang=Zd,J("X",0,0,"unix"),J("x",0,0,"valueOf"),O("x",od),O("X",rd),S("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),S("x",function(a,b,c){c._d=new Date(r(a))}),a.version="2.11.1",b(Ea),a.fn=ke,a.min=Ga,a.max=Ha,a.now=Td,a.utc=h,a.unix=kc,a.months=wc,a.isDate=d,a.locale=x,a.invalid=l,a.duration=Za,a.isMoment=p,a.weekdays=yc,a.parseZone=lc,a.localeData=z,a.isDuration=Ja,a.monthsShort=xc,a.weekdaysMin=Ac,a.defineLocale=y,a.weekdaysShort=zc,a.normalizeUnits=B,a.relativeTimeThreshold=Rc,a.prototype=ke;var Me=a;return Me});

/**
 * bootbox.js v4.0.0
 *
 * http://bootboxjs.com/license.txt
 */
window.bootbox=window.bootbox||function a(b,c){"use strict";function d(a){var b=s[q.locale];return b?b[a]:s.en[a]}function e(a,c,d){a.preventDefault();var e=b.isFunction(d)&&d(a)===!1;e||c.modal("hide")}function f(a){var b,c=0;for(b in a)c++;return c}function g(a,c){var d=0;b.each(a,function(a,b){c(a,b,d++)})}function h(a){var c,d;if("object"!=typeof a)throw new Error("Please supply an object of options");if(!a.message)throw new Error("Please specify a message");return a=b.extend({},q,a),a.buttons||(a.buttons={}),a.backdrop=a.backdrop?"static":!1,c=a.buttons,d=f(c),g(c,function(a,e,f){if(b.isFunction(e)&&(e=c[a]={callback:e}),"object"!==b.type(e))throw new Error("button with key "+a+" must be an object");e.label||(e.label=a),e.className||(e.className=2>=d&&f===d-1?"btn-primary":"btn-default")}),a}function i(a,b){var c=a.length,d={};if(1>c||c>2)throw new Error("Invalid argument length");return 2===c||"string"==typeof a[0]?(d[b[0]]=a[0],d[b[1]]=a[1]):d=a[0],d}function j(a,c,d){return b.extend(!0,{},a,i(c,d))}function k(a,b,c){return n(j(m.apply(null,a),b,c),a)}function l(){for(var a={},b=0,c=arguments.length;c>b;b++){var e=arguments[b],f=e.toLowerCase(),g=e.toUpperCase();a[f]={label:d(g)}}return a}function m(){return{buttons:l.apply(null,arguments)}}function n(a,b){var d={};return g(b,function(a,b){d[b]=!0}),g(a.buttons,function(a){if(d[a]===c)throw new Error("button key "+a+" is not allowed (options are "+b.join("\n")+")")}),a}var o={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input form-control' autocomplete=off type=text />"}},p=b("body"),q={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0},r={};r.alert=function(){var a;if(a=k(["ok"],arguments,["message","callback"]),a.callback&&!b.isFunction(a.callback))throw new Error("alert requires callback property to be a function when provided");return a.buttons.ok.callback=a.onEscape=function(){return b.isFunction(a.callback)?a.callback():!0},r.dialog(a)},r.confirm=function(){var a;if(a=k(["cancel","confirm"],arguments,["message","callback"]),a.buttons.cancel.callback=a.onEscape=function(){return a.callback(!1)},a.buttons.confirm.callback=function(){return a.callback(!0)},!b.isFunction(a.callback))throw new Error("confirm requires a callback");return r.dialog(a)},r.prompt=function(){var a,d,e,f,g,h;if(f=b(o.form),d={buttons:l("cancel","confirm"),value:""},a=n(j(d,arguments,["title","callback"]),["cancel","confirm"]),h=a.show===c?!0:a.show,a.message=f,a.buttons.cancel.callback=a.onEscape=function(){return a.callback(null)},a.buttons.confirm.callback=function(){return a.callback(g.val())},a.show=!1,!a.title)throw new Error("prompt requires a title");if(!b.isFunction(a.callback))throw new Error("prompt requires a callback");return g=b(o.inputs.text),g.val(a.value),f.append(g),f.on("submit",function(a){a.preventDefault(),e.find(".btn-primary").click()}),e=r.dialog(a),e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){g.focus()}),h===!0&&e.modal("show"),e},r.dialog=function(a){a=h(a);var c=b(o.dialog),d=c.find(".modal-body"),f=a.buttons,i="",j={onEscape:a.onEscape};if(g(f,function(a,b){i+="<button data-bb-handler='"+a+"' type='button' class='btn "+b.className+"'>"+b.label+"</button>",j[a]=b.callback}),d.find(".bootbox-body").html(a.message),a.animate===!0&&c.addClass("fade"),a.className&&c.addClass(a.className),a.title&&d.before(o.header),a.closeButton){var k=b(o.closeButton);a.title?c.find(".modal-header").prepend(k):k.css("margin-top","-10px").prependTo(d)}return a.title&&c.find(".modal-title").html(a.title),i.length&&(d.after(o.footer),c.find(".modal-footer").html(i)),c.on("hidden.bs.modal",function(a){a.target===this&&c.remove()}),c.on("shown.bs.modal",function(){c.find(".btn-primary:first").focus()}),c.on("escape.close.bb",function(a){j.onEscape&&e(a,c,j.onEscape)}),c.on("click",".modal-footer button",function(a){var d=b(this).data("bb-handler");e(a,c,j[d])}),c.on("click",".bootbox-close-button",function(a){e(a,c,j.onEscape)}),c.on("keyup",function(a){27===a.which&&c.trigger("escape.close.bb")}),p.append(c),c.modal({backdrop:a.backdrop,keyboard:!1,show:!1}),a.show&&c.modal("show"),c},r.setDefaults=function(a){b.extend(q,a)},r.hideAll=function(){b(".bootbox").modal("hide")};var s={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return r.init=function(c){window.bootbox=a(c||b)},r}(window.jQuery);
/*! jQuery Mobile v1.3.2 | Copyright 2010, 2013 jQuery Foundation, Inc. | jquery.org/license */

(function(e,t,n){typeof define=="function"&&define.amd?define(["../../../../../../../../Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pyramid_debugtoolbar-1.0.6-py2.7.egg/pyramid_debugtoolbar/static/js/jquery-1.7.2.min"],function(r){return n(r,e,t),r.mobile}):n(e.jQuery,e,t)})(this,document,function(e,t,n,r){(function(e,t,n,r){function x(e){while(e&&typeof e.originalEvent!="undefined")e=e.originalEvent;return e}function T(t,n){var i=t.type,s,o,a,l,c,h,p,d,v;t=e.Event(t),t.type=n,s=t.originalEvent,o=e.event.props,i.search(/^(mouse|click)/)>-1&&(o=f);if(s)for(p=o.length,l;p;)l=o[--p],t[l]=s[l];i.search(/mouse(down|up)|click/)>-1&&!t.which&&(t.which=1);if(i.search(/^touch/)!==-1){a=x(s),i=a.touches,c=a.changedTouches,h=i&&i.length?i[0]:c&&c.length?c[0]:r;if(h)for(d=0,v=u.length;d<v;d++)l=u[d],t[l]=h[l]}return t}function N(t){var n={},r,s;while(t){r=e.data(t,i);for(s in r)r[s]&&(n[s]=n.hasVirtualBinding=!0);t=t.parentNode}return n}function C(t,n){var r;while(t){r=e.data(t,i);if(r&&(!n||r[n]))return t;t=t.parentNode}return null}function k(){g=!1}function L(){g=!0}function A(){E=0,v.length=0,m=!1,L()}function O(){k()}function M(){_(),c=setTimeout(function(){c=0,A()},e.vmouse.resetTimerDuration)}function _(){c&&(clearTimeout(c),c=0)}function D(t,n,r){var i;if(r&&r[t]||!r&&C(n.target,t))i=T(n,t),e(n.target).trigger(i);return i}function P(t){var n=e.data(t.target,s);if(!m&&(!E||E!==n)){var r=D("v"+t.type,t);r&&(r.isDefaultPrevented()&&t.preventDefault(),r.isPropagationStopped()&&t.stopPropagation(),r.isImmediatePropagationStopped()&&t.stopImmediatePropagation())}}function H(t){var n=x(t).touches,r,i;if(n&&n.length===1){r=t.target,i=N(r);if(i.hasVirtualBinding){E=w++,e.data(r,s,E),_(),O(),d=!1;var o=x(t).touches[0];h=o.pageX,p=o.pageY,D("vmouseover",t,i),D("vmousedown",t,i)}}}function B(e){if(g)return;d||D("vmousecancel",e,N(e.target)),d=!0,M()}function j(t){if(g)return;var n=x(t).touches[0],r=d,i=e.vmouse.moveDistanceThreshold,s=N(t.target);d=d||Math.abs(n.pageX-h)>i||Math.abs(n.pageY-p)>i,d&&!r&&D("vmousecancel",t,s),D("vmousemove",t,s),M()}function F(e){if(g)return;L();var t=N(e.target),n;D("vmouseup",e,t);if(!d){var r=D("vclick",e,t);r&&r.isDefaultPrevented()&&(n=x(e).changedTouches[0],v.push({touchID:E,x:n.clientX,y:n.clientY}),m=!0)}D("vmouseout",e,t),d=!1,M()}function I(t){var n=e.data(t,i),r;if(n)for(r in n)if(n[r])return!0;return!1}function q(){}function R(t){var n=t.substr(1);return{setup:function(r,s){I(this)||e.data(this,i,{});var o=e.data(this,i);o[t]=!0,l[t]=(l[t]||0)+1,l[t]===1&&b.bind(n,P),e(this).bind(n,q),y&&(l.touchstart=(l.touchstart||0)+1,l.touchstart===1&&b.bind("touchstart",H).bind("touchend",F).bind("touchmove",j).bind("scroll",B))},teardown:function(r,s){--l[t],l[t]||b.unbind(n,P),y&&(--l.touchstart,l.touchstart||b.unbind("touchstart",H).unbind("touchmove",j).unbind("touchend",F).unbind("scroll",B));var o=e(this),u=e.data(this,i);u&&(u[t]=!1),o.unbind(n,q),I(this)||o.removeData(i)}}}var i="virtualMouseBindings",s="virtualTouchID",o="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),u="clientX clientY pageX pageY screenX screenY".split(" "),a=e.event.mouseHooks?e.event.mouseHooks.props:[],f=e.event.props.concat(a),l={},c=0,h=0,p=0,d=!1,v=[],m=!1,g=!1,y="addEventListener"in n,b=e(n),w=1,E=0,S;e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500};for(var U=0;U<o.length;U++)e.event.special[o[U]]=R(o[U]);y&&n.addEventListener("click",function(t){var n=v.length,r=t.target,i,o,u,a,f,l;if(n){i=t.clientX,o=t.clientY,S=e.vmouse.clickDistanceThreshold,u=r;while(u){for(a=0;a<n;a++){f=v[a],l=0;if(u===r&&Math.abs(f.x-i)<S&&Math.abs(f.y-o)<S||e.data(u,s)===f.touchID){t.preventDefault(),t.stopPropagation();return}}u=u.parentNode}}},!0)})(e,t,n),function(e){e.mobile={}}(e),function(e,t){var r={touch:"ontouchend"in n};e.mobile.support=e.mobile.support||{},e.extend(e.support,r),e.extend(e.mobile.support,r)}(e),function(e,t,r){function l(t,n,r){var i=r.type;r.type=n,e.event.dispatch.call(t,r),r.type=i}var i=e(n);e.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(t,n){e.fn[n]=function(e){return e?this.bind(n,e):this.trigger(n)},e.attrFn&&(e.attrFn[n]=!0)});var s=e.mobile.support.touch,o="touchmove scroll",u=s?"touchstart":"mousedown",a=s?"touchend":"mouseup",f=s?"touchmove":"mousemove";e.event.special.scrollstart={enabled:!0,setup:function(){function s(e,n){r=n,l(t,r?"scrollstart":"scrollstop",e)}var t=this,n=e(t),r,i;n.bind(o,function(t){if(!e.event.special.scrollstart.enabled)return;r||s(t,!0),clearTimeout(i),i=setTimeout(function(){s(t,!1)},50)})}},e.event.special.tap={tapholdThreshold:750,setup:function(){var t=this,n=e(t);n.bind("vmousedown",function(r){function a(){clearTimeout(u)}function f(){a(),n.unbind("vclick",c).unbind("vmouseup",a),i.unbind("vmousecancel",f)}function c(e){f(),s===e.target&&l(t,"tap",e)}if(r.which&&r.which!==1)return!1;var s=r.target,o=r.originalEvent,u;n.bind("vmouseup",a).bind("vclick",c),i.bind("vmousecancel",f),u=setTimeout(function(){l(t,"taphold",e.Event("taphold",{target:s}))},e.event.special.tap.tapholdThreshold)})}},e.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:75,start:function(t){var n=t.originalEvent.touches?t.originalEvent.touches[0]:t;return{time:(new Date).getTime(),coords:[n.pageX,n.pageY],origin:e(t.target)}},stop:function(e){var t=e.originalEvent.touches?e.originalEvent.touches[0]:e;return{time:(new Date).getTime(),coords:[t.pageX,t.pageY]}},handleSwipe:function(t,n){n.time-t.time<e.event.special.swipe.durationThreshold&&Math.abs(t.coords[0]-n.coords[0])>e.event.special.swipe.horizontalDistanceThreshold&&Math.abs(t.coords[1]-n.coords[1])<e.event.special.swipe.verticalDistanceThreshold&&t.origin.trigger("swipe").trigger(t.coords[0]>n.coords[0]?"swipeleft":"swiperight")},setup:function(){var t=this,n=e(t);n.bind(u,function(t){function o(t){if(!i)return;s=e.event.special.swipe.stop(t),Math.abs(i.coords[0]-s.coords[0])>e.event.special.swipe.scrollSupressionThreshold&&t.preventDefault()}var i=e.event.special.swipe.start(t),s;n.bind(f,o).one(a,function(){n.unbind(f,o),i&&s&&e.event.special.swipe.handleSwipe(i,s),i=s=r})})}},e.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(t,n){e.event.special[t]={setup:function(){e(this).bind(n,e.noop)}}})}(e,this),function(e,t,r){var i={};e.mobile=e.extend(e.mobile,{version:"1.3.2",ns:"",subPageUrlKey:"ui-page",activePageClass:"ui-page-active",activeBtnClass:"ui-btn-active",focusClass:"ui-focus",ajaxEnabled:!0,hashListeningEnabled:!0,linkBindingEnabled:!0,defaultPageTransition:"fade",maxTransitionWidth:!1,minScrollBack:250,touchOverflowEnabled:!1,defaultDialogTransition:"pop",pageLoadErrorMessage:"Error Loading Page",pageLoadErrorMessageTheme:"e",phonegapNavigationEnabled:!1,autoInitializePage:!0,pushStateEnabled:!0,ignoreContentEnabled:!1,orientationChangeEnabled:!0,buttonMarkup:{hoverDelay:200},window:e(t),document:e(n),keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91},behaviors:{},silentScroll:function(n){e.type(n)!=="number"&&(n=e.mobile.defaultHomeScroll),e.event.special.scrollstart.enabled=!1,setTimeout(function(){t.scrollTo(0,n),e.mobile.document.trigger("silentscroll",{x:0,y:n})},20),setTimeout(function(){e.event.special.scrollstart.enabled=!0},150)},nsNormalizeDict:i,nsNormalize:function(t){if(!t)return;return i[t]||(i[t]=e.camelCase(e.mobile.ns+t))},getInheritedTheme:function(e,t){var n=e[0],r="",i=/ui-(bar|body|overlay)-([a-z])\b/,s,o;while(n){s=n.className||"";if(s&&(o=i.exec(s))&&(r=o[2]))break;n=n.parentNode}return r||t||"a"},closestPageData:function(e){return e.closest(':jqmData(role="page"), :jqmData(role="dialog")').data("mobile-page")},enhanceable:function(e){return this.haveParents(e,"enhance")},hijackable:function(e){return this.haveParents(e,"ajax")},haveParents:function(t,n){if(!e.mobile.ignoreContentEnabled)return t;var r=t.length,i=e(),s,o,u;for(var a=0;a<r;a++){o=t.eq(a),u=!1,s=t[a];while(s){var f=s.getAttribute?s.getAttribute("data-"+e.mobile.ns+n):"";if(f==="false"){u=!0;break}s=s.parentNode}u||(i=i.add(o))}return i},getScreenHeight:function(){return t.innerHeight||e.mobile.window.height()}},e.mobile),e.fn.jqmData=function(t,n){var i;return typeof t!="undefined"&&(t&&(t=e.mobile.nsNormalize(t)),arguments.length<2||n===r?i=this.data(t):i=this.data(t,n)),i},e.jqmData=function(t,n,r){var i;return typeof n!="undefined"&&(i=e.data(t,n?e.mobile.nsNormalize(n):n,r)),i},e.fn.jqmRemoveData=function(t){return this.removeData(e.mobile.nsNormalize(t))},e.jqmRemoveData=function(t,n){return e.removeData(t,e.mobile.nsNormalize(n))},e.fn.removeWithDependents=function(){e.removeWithDependents(this)},e.removeWithDependents=function(t){var n=e(t);(n.jqmData("dependents")||e()).remove(),n.remove()},e.fn.addDependents=function(t){e.addDependents(e(this),t)},e.addDependents=function(t,n){var r=e(t).jqmData("dependents")||e();e(t).jqmData("dependents",e.merge(r,n))},e.fn.getEncodedText=function(){return e("<div/>").text(e(this).text()).html()},e.fn.jqmEnhanceable=function(){return e.mobile.enhanceable(this)},e.fn.jqmHijackable=function(){return e.mobile.hijackable(this)};var s=e.find,o=/:jqmData\(([^)]*)\)/g;e.find=function(t,n,r,i){return t=t.replace(o,"[data-"+(e.mobile.ns||"")+"$1]"),s.call(this,t,n,r,i)},e.extend(e.find,s),e.find.matches=function(t,n){return e.find(t,null,null,n)},e.find.matchesSelector=function(t,n){return e.find(n,null,null,[t]).length>0}}(e,this)});
/* =============================================================
 * bootstrap-typeahead.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#typeahead
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */


!function($){

  "use strict"; // jshint ;_;


 /* TYPEAHEAD PUBLIC CLASS DEFINITION
  * ================================= */

  var Typeahead = function (element, options) {
    this.$element = $(element)
    this.options = $.extend({}, $.fn.typeahead.defaults, options)
    this.matcher = this.options.matcher || this.matcher
    this.sorter = this.options.sorter || this.sorter
    this.highlighter = this.options.highlighter || this.highlighter
    this.updater = this.options.updater || this.updater
    this.source = this.options.source
    this.$menu = $(this.options.menu)
    this.shown = false
    this.listen()
  }

  Typeahead.prototype = {

    constructor: Typeahead

  , select: function () {
      var val = this.$menu.find('.active').attr('data-value')
      this.$element
        .val(this.updater(val))
        .change()
      return this.hide()
    }

  , updater: function (item) {
      return item
    }

  , show: function () {
      var pos = $.extend({}, this.$element.position(), {
        height: this.$element[0].offsetHeight
      })

      this.$menu
        .insertAfter(this.$element)
        .css({
          top: pos.top + pos.height
        , left: pos.left
        })
        .show()

      this.shown = true
      return this
    }

  , hide: function () {
      this.$menu.hide()
      this.shown = false
      return this
    }

  , lookup: function (event) {
      var items

      this.query = this.$element.val()

      if (!this.query || this.query.length < this.options.minLength) {
        return this.shown ? this.hide() : this
      }

      items = $.isFunction(this.source) ? this.source(this.query, $.proxy(this.process, this)) : this.source

      return items ? this.process(items) : this
    }

  , process: function (items) {
      var that = this

      items = $.grep(items, function (item) {
        return that.matcher(item)
      })

      items = this.sorter(items)

      if (!items.length) {
        return this.shown ? this.hide() : this
      }

      return this.render(items.slice(0, this.options.items)).show()
    }

  , matcher: function (item) {
      return ~item.toLowerCase().indexOf(this.query.toLowerCase())
    }

  , sorter: function (items) {
      var beginswith = []
        , caseSensitive = []
        , caseInsensitive = []
        , item

      while (item = items.shift()) {
        if (!item.toLowerCase().indexOf(this.query.toLowerCase())) beginswith.push(item)
        else if (~item.indexOf(this.query)) caseSensitive.push(item)
        else caseInsensitive.push(item)
      }

      return beginswith.concat(caseSensitive, caseInsensitive)
    }

  , highlighter: function (item) {
      var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
      return item.replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
        return '<strong>' + match + '</strong>'
      })
    }

  , render: function (items) {
      var that = this

      items = $(items).map(function (i, item) {
        i = $(that.options.item).attr('data-value', item)
        i.find('a').html(that.highlighter(item))
        return i[0]
      })

      items.first().addClass('active')
      this.$menu.html(items)
      return this
    }

  , next: function (event) {
      var active = this.$menu.find('.active').removeClass('active')
        , next = active.next()

      if (!next.length) {
        next = $(this.$menu.find('li')[0])
      }

      next.addClass('active')
    }

  , prev: function (event) {
      var active = this.$menu.find('.active').removeClass('active')
        , prev = active.prev()

      if (!prev.length) {
        prev = this.$menu.find('li').last()
      }

      prev.addClass('active')
    }

  , listen: function () {
      this.$element
        .on('focus',    $.proxy(this.focus, this))
        .on('blur',     $.proxy(this.blur, this))
        .on('keypress', $.proxy(this.keypress, this))
        .on('keyup',    $.proxy(this.keyup, this))

      if (this.eventSupported('keydown')) {
        this.$element.on('keydown', $.proxy(this.keydown, this))
      }

      this.$menu
        .on('click', $.proxy(this.click, this))
        .on('mouseenter', 'li', $.proxy(this.mouseenter, this))
        .on('mouseleave', 'li', $.proxy(this.mouseleave, this))
    }

  , eventSupported: function(eventName) {
      var isSupported = eventName in this.$element
      if (!isSupported) {
        this.$element.setAttribute(eventName, 'return;')
        isSupported = typeof this.$element[eventName] === 'function'
      }
      return isSupported
    }

  , move: function (e) {
      if (!this.shown) return

      switch(e.keyCode) {
        case 9: // tab
        case 13: // enter
        case 27: // escape
          e.preventDefault()
          break

        case 38: // up arrow
          e.preventDefault()
          this.prev()
          break

        case 40: // down arrow
          e.preventDefault()
          this.next()
          break
      }

      e.stopPropagation()
    }

  , keydown: function (e) {
      this.suppressKeyPressRepeat = ~$.inArray(e.keyCode, [40,38,9,13,27])
      this.move(e)
    }

  , keypress: function (e) {
      if (this.suppressKeyPressRepeat) return
      this.move(e)
    }

  , keyup: function (e) {
      switch(e.keyCode) {
        case 40: // down arrow
        case 38: // up arrow
        case 16: // shift
        case 17: // ctrl
        case 18: // alt
          break

        case 9: // tab
        case 13: // enter
          if (!this.shown) return
          this.select()
          break

        case 27: // escape
          if (!this.shown) return
          this.hide()
          break

        default:
          this.lookup()
      }

      e.stopPropagation()
      e.preventDefault()
  }

  , focus: function (e) {
      this.focused = true
    }

  , blur: function (e) {
      this.focused = false
      if (!this.mousedover && this.shown) this.hide()
    }

  , click: function (e) {
      e.stopPropagation()
      e.preventDefault()
      this.select()
      this.$element.focus()
    }

  , mouseenter: function (e) {
      this.mousedover = true
      this.$menu.find('.active').removeClass('active')
      $(e.currentTarget).addClass('active')
    }

  , mouseleave: function (e) {
      this.mousedover = false
      if (!this.focused && this.shown) this.hide()
    }

  }


  /* TYPEAHEAD PLUGIN DEFINITION
   * =========================== */

  var old = $.fn.typeahead

  $.fn.typeahead = function (option) {
    return this.each(function () {
      var $this = $(this)
        , data = $this.data('typeahead')
        , options = typeof option == 'object' && option
      if (!data) $this.data('typeahead', (data = new Typeahead(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  $.fn.typeahead.defaults = {
    source: []
  , items: 8
  , menu: '<ul class="typeahead dropdown-menu"></ul>'
  , item: '<li><a href="#"></a></li>'
  , minLength: 1
  }

  $.fn.typeahead.Constructor = Typeahead


 /* TYPEAHEAD NO CONFLICT
  * =================== */

  $.fn.typeahead.noConflict = function () {
    $.fn.typeahead = old
    return this
  }


 /* TYPEAHEAD DATA-API
  * ================== */

  $(document).on('focus.typeahead.data-api', '[data-provide="typeahead"]', function (e) {
    var $this = $(this)
    if ($this.data('typeahead')) return
    $this.typeahead($this.data())
  })

}(window.jQuery);
(function(){(function(n){var x=this||(0,eval)("this"),u=x.document,M=x.navigator,v=x.jQuery,F=x.JSON;(function(n){"function"===typeof define&&define.amd?define(["exports","require"],n):"object"===typeof exports&&"object"===typeof module?n(module.exports||exports):n(x.ko={})})(function(N,O){function J(a,c){return null===a||typeof a in T?a===c:!1}function U(b,c){var d;return function(){d||(d=a.a.setTimeout(function(){d=n;b()},c))}}function V(b,c){var d;return function(){clearTimeout(d);d=a.a.setTimeout(b,c)}}function W(a,c){c&&c!==I?"beforeChange"===c?this.Kb(a):this.Ha(a,c):this.Lb(a)}function X(a,c){null!==c&&c.k&&c.k()}function Y(a,c){var d=this.Hc,e=d[s];e.R||(this.lb&&this.Ma[c]?(d.Pb(c,a,this.Ma[c]),this.Ma[c]=null,--this.lb):e.r[c]||d.Pb(c,a,e.s?{ia:a}:d.uc(a)))}function K(b,c,d,e){a.d[b]={init:function(b,g,k,l,m){var h,r;a.m(function(){var q=a.a.c(g()),p=!d!==!q,A=!r;if(A||c||p!==h)A&&a.va.Aa()&&(r=a.a.ua(a.f.childNodes(b),!0)),p?(A||a.f.da(b,a.a.ua(r)),a.eb(e?e(m,q):m,b)):a.f.xa(b),h=p},null,{i:b});return{controlsDescendantBindings:!0}}};a.h.ta[b]=!1;a.f.Z[b]=!0}var a="undefined"!==typeof N?N:{};a.b=function(b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++)e=e[d[f]];e[d[d.length-1]]=c};a.G=function(a,c,d){a[c]=d};a.version="3.4.0";a.b("version",a.version);a.options={deferUpdates:!1,useOnlyNativeEvents:!1};a.a=function(){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function c(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a,b){a.__proto__=b;return a}function e(b,c,d,e){var h=b[c].match(r)||[];a.a.q(d.match(r),function(b){a.a.pa(h,b,e)});b[c]=h.join(" ")}var f={__proto__:[]}instanceof Array,g="function"===typeof Symbol,k={},l={};k[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];k.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");b(k,function(a,b){if(b.length)for(var c=0,d=b.length;c<d;c++)l[b[c]]=a});var m={propertychange:!0},h=u&&function(){for(var a=3,b=u.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",c[0];);return 4<a?a:n}(),r=/\S+/g;return{cc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},o:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},Sb:function(a,b,c){for(var d=0,e=a.length;d<e;d++)if(b.call(c,a[d],d))return a[d];return null},La:function(b,c){var d=a.a.o(b,c);0<d?b.splice(d,1):0===d&&b.shift()},Tb:function(b){b=b||[];for(var c=[],d=0,e=b.length;d<e;d++)0>a.a.o(c,b[d])&&c.push(b[d]);return c},fb:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)c.push(b(a[d],d));return c},Ka:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)b(a[d],d)&&c.push(a[d]);return c},ra:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;c<d;c++)a.push(b[c]);return a},pa:function(b,c,d){var e=a.a.o(a.a.zb(b),c);0>e?d&&b.push(c):d||b.splice(e,1)},ka:f,extend:c,Xa:d,Ya:f?d:c,D:b,Ca:function(a,b){if(!a)return a;var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},ob:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},jc:function(b){b=a.a.V(b);for(var c=(b[0]&&b[0].ownerDocument||u).createElement("div"),d=0,e=b.length;d<e;d++)c.appendChild(a.$(b[d]));return c},ua:function(b,c){for(var d=0,e=b.length,h=[];d<e;d++){var m=b[d].cloneNode(!0);h.push(c?a.$(m):m)}return h},da:function(b,c){a.a.ob(b);if(c)for(var d=0,e=c.length;d<e;d++)b.appendChild(c[d])},qc:function(b,c){var d=b.nodeType?[b]:b;if(0<d.length){for(var e=d[0],h=e.parentNode,m=0,l=c.length;m<l;m++)h.insertBefore(c[m],e);m=0;for(l=d.length;m<l;m++)a.removeNode(d[m])}},za:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);for(;1<a.length&&a[a.length-1].parentNode!==b;)a.length--;if(1<a.length){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)a.push(c),c=c.nextSibling;a.push(d)}}return a},sc:function(a,b){7>h?a.setAttribute("selected",b):a.selected=b},$a:function(a){return null===a||a===n?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},nd:function(a,b){a=a||"";return b.length>a.length?!1:a.substring(0,b.length)===b},Mc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(b.compareDocumentPosition(a)&16);for(;a&&a!=b;)a=a.parentNode;return!!a},nb:function(b){return a.a.Mc(b,b.ownerDocument.documentElement)},Qb:function(b){return!!a.a.Sb(b,a.a.nb)},A:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},Wb:function(b){return a.onError?function(){try{return b.apply(this,arguments)}catch(c){throw a.onError&&a.onError(c),c;}}:b},setTimeout:function(b,c){return setTimeout(a.a.Wb(b),c)},$b:function(b){setTimeout(function(){a.onError&&a.onError(b);throw b;},0)},p:function(b,c,d){var e=a.a.Wb(d);d=h&&m[c];if(a.options.useOnlyNativeEvents||d||!v)if(d||"function"!=typeof b.addEventListener)if("undefined"!=typeof b.attachEvent){var l=function(a){e.call(b,a)},f="on"+c;b.attachEvent(f,l);a.a.F.oa(b,function(){b.detachEvent(f,l)})}else throw Error("Browser doesn't support addEventListener or attachEvent");else b.addEventListener(c,e,!1);else v(b).bind(c,e)},Da:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var d;"input"===a.a.A(b)&&b.type&&"click"==c.toLowerCase()?(d=b.type,d="checkbox"==d||"radio"==d):d=!1;if(a.options.useOnlyNativeEvents||!v||d)if("function"==typeof u.createEvent)if("function"==typeof b.dispatchEvent)d=u.createEvent(l[c]||"HTMLEvents"),d.initEvent(c,!0,!0,x,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(d);else throw Error("The supplied element doesn't support dispatchEvent");else if(d&&b.click)b.click();else if("undefined"!=typeof b.fireEvent)b.fireEvent("on"+c);else throw Error("Browser doesn't support triggering events");else v(b).trigger(c)},c:function(b){return a.H(b)?b():b},zb:function(b){return a.H(b)?b.t():b},bb:function(b,c,d){var h;c&&("object"===typeof b.classList?(h=b.classList[d?"add":"remove"],a.a.q(c.match(r),function(a){h.call(b.classList,a)})):"string"===typeof b.className.baseVal?e(b.className,"baseVal",c,d):e(b,"className",c,d))},Za:function(b,c){var d=a.a.c(c);if(null===d||d===n)d="";var e=a.f.firstChild(b);!e||3!=e.nodeType||a.f.nextSibling(e)?a.f.da(b,[b.ownerDocument.createTextNode(d)]):e.data=d;a.a.Rc(b)},rc:function(a,b){a.name=b;if(7>=h)try{a.mergeAttributes(u.createElement("<input name='"+
a.name+"'/>"),!1)}catch(c){}},Rc:function(a){9<=h&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},Nc:function(a){if(h){var b=a.style.width;a.style.width=0;a.style.width=b}},hd:function(b,c){b=a.a.c(b);c=a.a.c(c);for(var d=[],e=b;e<=c;e++)d.push(e);return d},V:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b},Yb:function(a){return g?Symbol(a):a},rd:6===h,sd:7===h,C:h,ec:function(b,c){for(var d=a.a.V(b.getElementsByTagName("input")).concat(a.a.V(b.getElementsByTagName("textarea"))),e="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)},h=[],m=d.length-1;0<=m;m--)e(d[m])&&h.push(d[m]);return h},ed:function(b){return"string"==typeof b&&(b=a.a.$a(b))?F&&F.parse?F.parse(b):(new Function("return "+b))():null},Eb:function(b,c,d){if(!F||!F.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return F.stringify(a.a.c(b),c,d)},fd:function(c,d,e){e=e||{};var h=e.params||{},m=e.includeFields||this.cc,l=c;if("object"==typeof c&&"form"===a.a.A(c))for(var l=c.action,f=m.length-1;0<=f;f--)for(var g=a.a.ec(c,m[f]),k=g.length-1;0<=k;k--)h[g[k].name]=g[k].value;d=a.a.c(d);var r=u.createElement("form");r.style.display="none";r.action=l;r.method="post";for(var n in d)c=u.createElement("input"),c.type="hidden",c.name=n,c.value=a.a.Eb(a.a.c(d[n])),r.appendChild(c);b(h,function(a,b){var c=u.createElement("input");c.type="hidden";c.name=a;c.value=b;r.appendChild(c)});u.body.appendChild(r);e.submitter?e.submitter(r):r.submit();setTimeout(function(){r.parentNode.removeChild(r)},0)}}}();a.b("utils",a.a);a.b("utils.arrayForEach",a.a.q);a.b("utils.arrayFirst",a.a.Sb);a.b("utils.arrayFilter",a.a.Ka);a.b("utils.arrayGetDistinctValues",a.a.Tb);a.b("utils.arrayIndexOf",a.a.o);a.b("utils.arrayMap",a.a.fb);a.b("utils.arrayPushAll",a.a.ra);a.b("utils.arrayRemoveItem",a.a.La);a.b("utils.extend",a.a.extend);a.b("utils.fieldsIncludedWithJsonPost",a.a.cc);a.b("utils.getFormFields",a.a.ec);a.b("utils.peekObservable",a.a.zb);a.b("utils.postJson",a.a.fd);a.b("utils.parseJson",a.a.ed);a.b("utils.registerEventHandler",a.a.p);a.b("utils.stringifyJson",a.a.Eb);a.b("utils.range",a.a.hd);a.b("utils.toggleDomNodeCssClass",a.a.bb);a.b("utils.triggerEvent",a.a.Da);a.b("utils.unwrapObservable",a.a.c);a.b("utils.objectForEach",a.a.D);a.b("utils.addOrRemoveItem",a.a.pa);a.b("utils.setTextContent",a.a.Za);a.b("unwrap",a.a.c);Function.prototype.bind||(Function.prototype.bind=function(a){var c=this;if(1===arguments.length)return function(){return c.apply(a,arguments)};var d=Array.prototype.slice.call(arguments,1);return function(){var e=d.slice(0);e.push.apply(e,arguments);return c.apply(a,e)}});a.a.e=new function(){function a(b,g){var k=b[d];if(!k||"null"===k||!e[k]){if(!g)return n;k=b[d]="ko"+c++;e[k]={}}return e[k]}var c=0,d="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===n?n:e[d]},set:function(c,d,e){if(e!==n||a(c,!1)!==n)a(c,!0)[d]=e},clear:function(a){var b=a[d];return b?(delete e[b],a[d]=null,!0):!1},I:function(){return c++ +d}}};a.b("utils.domData",a.a.e);a.b("utils.domData.clear",a.a.e.clear);a.a.F=new function(){function b(b,c){var e=a.a.e.get(b,d);e===n&&c&&(e=[],a.a.e.set(b,d,e));return e}function c(d){var e=b(d,!1);if(e)for(var e=e.slice(0),l=0;l<e.length;l++)e[l](d);a.a.e.clear(d);a.a.F.cleanExternalData(d);if(f[d.nodeType])for(e=d.firstChild;d=e;)e=d.nextSibling,8===d.nodeType&&c(d)}var d=a.a.e.I(),e={1:!0,8:!0,9:!0},f={1:!0,9:!0};return{oa:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},pc:function(c,e){var l=b(c,!1);l&&(a.a.La(l,e),0==l.length&&a.a.e.set(c,d,n))},$:function(b){if(e[b.nodeType]&&(c(b),f[b.nodeType])){var d=[];a.a.ra(d,b.getElementsByTagName("*"));for(var l=0,m=d.length;l<m;l++)c(d[l])}return b},removeNode:function(b){a.$(b);b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){v&&"function"==typeof v.cleanData&&v.cleanData([a])}}};a.$=a.a.F.$;a.removeNode=a.a.F.removeNode;a.b("cleanNode",a.$);a.b("removeNode",a.removeNode);a.b("utils.domNodeDisposal",a.a.F);a.b("utils.domNodeDisposal.addDisposeCallback",a.a.F.oa);a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.F.pc);(function(){var b=[0,"",""],c=[1,"<table>","</table>"],d=[3,"<table><tbody><tr>","</tr></tbody></table>"],e=[1,"<select multiple='multiple'>","</select>"],f={thead:c,tbody:c,tfoot:c,tr:[2,"<table><tbody>","</tbody></table>"],td:d,th:d,option:e,optgroup:e},g=8>=a.a.C;a.a.ma=function(c,d){var e;if(v)if(v.parseHTML)e=v.parseHTML(c,d)||[];else{if((e=v.clean([c],d))&&e[0]){for(var h=e[0];h.parentNode&&11!==h.parentNode.nodeType;)h=h.parentNode;h.parentNode&&h.parentNode.removeChild(h)}}else{(e=d)||(e=u);var h=e.parentWindow||e.defaultView||x,r=a.a.$a(c).toLowerCase(),q=e.createElement("div"),p;p=(r=r.match(/^<([a-z]+)[ >]/))&&f[r[1]]||b;r=p[0];p="ignored<div>"+p[1]+c+p[2]+"</div>";"function"==typeof h.innerShiv?q.appendChild(h.innerShiv(p)):(g&&e.appendChild(q),q.innerHTML=p,g&&q.parentNode.removeChild(q));for(;r--;)q=q.lastChild;e=a.a.V(q.lastChild.childNodes)}return e};a.a.Cb=function(b,c){a.a.ob(b);c=a.a.c(c);if(null!==c&&c!==n)if("string"!=typeof c&&(c=c.toString()),v)v(b).html(c);else for(var d=a.a.ma(c,b.ownerDocument),e=0;e<d.length;e++)b.appendChild(d[e])}})();a.b("utils.parseHtmlFragment",a.a.ma);a.b("utils.setHtml",a.a.Cb);a.M=function(){function b(c,e){if(c)if(8==c.nodeType){var f=a.M.lc(c.nodeValue);null!=f&&e.push({Lc:c,cd:f})}else if(1==c.nodeType)for(var f=0,g=c.childNodes,k=g.length;f<k;f++)b(g[f],e)}var c={};return{wb:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);c[b]=a;return"\x3c!--[ko_memo:"+b+"]--\x3e"},xc:function(a,b){var f=c[a];if(f===n)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return f.apply(null,b||[]),!0}finally{delete c[a]}},yc:function(c,e){var f=[];b(c,f);for(var g=0,k=f.length;g<k;g++){var l=f[g].Lc,m=[l];e&&a.a.ra(m,e);a.M.xc(f[g].cd,m);l.nodeValue="";l.parentNode&&l.parentNode.removeChild(l)}},lc:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}();a.b("memoization",a.M);a.b("memoization.memoize",a.M.wb);a.b("memoization.unmemoize",a.M.xc);a.b("memoization.parseMemoText",a.M.lc);a.b("memoization.unmemoizeDomNodeAndDescendants",a.M.yc);a.Y=function(){function b(){if(e)for(var b=e,c=0,m;g<e;)if(m=d[g++]){if(g>b){if(5E3<=++c){g=e;a.a.$b(Error("'Too much recursion' after processing "+c+" task groups."));break}b=e}try{m()}catch(h){a.a.$b(h)}}}function c(){b();g=e=d.length=0}var d=[],e=0,f=1,g=0;return{scheduler:x.MutationObserver?function(a){var b=u.createElement("div");(new MutationObserver(a)).observe(b,{attributes:!0});return function(){b.classList.toggle("foo")}}(c):u&&"onreadystatechange"in u.createElement("script")?function(a){var b=u.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=null;u.documentElement.removeChild(b);b=null;a()};u.documentElement.appendChild(b)}:function(a){setTimeout(a,0)},Wa:function(b){e||a.Y.scheduler(c);d[e++]=b;return f++},cancel:function(a){a-=f-e;a>=g&&a<e&&(d[a]=null)},resetForTesting:function(){var a=e-g;g=e=d.length=0;return a},md:b}}();a.b("tasks",a.Y);a.b("tasks.schedule",a.Y.Wa);a.b("tasks.runEarly",a.Y.md);a.ya={throttle:function(b,c){b.throttleEvaluation=c;var d=null;return a.B({read:b,write:function(e){clearTimeout(d);d=a.a.setTimeout(function(){b(e)},c)}})},rateLimit:function(a,c){var d,e,f;"number"==typeof c?d=c:(d=c.timeout,e=c.method);a.cb=!1;f="notifyWhenChangesStop"==e?V:U;a.Ta(function(a){return f(a,d)})},deferred:function(b,c){if(!0!==c)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");b.cb||(b.cb=!0,b.Ta(function(c){var e;return function(){a.Y.cancel(e);e=a.Y.Wa(c);b.notifySubscribers(n,"dirty")}}))},notify:function(a,c){a.equalityComparer="always"==c?null:J}};var T={undefined:1,"boolean":1,number:1,string:1};a.b("extenders",a.ya);a.vc=function(b,c,d){this.ia=b;this.gb=c;this.Kc=d;this.R=!1;a.G(this,"dispose",this.k)};a.vc.prototype.k=function(){this.R=!0;this.Kc()};a.J=function(){a.a.Ya(this,D);D.rb(this)};var I="change",D={rb:function(a){a.K={};a.Nb=1},X:function(b,c,d){var e=this;d=d||I;var f=new a.vc(e,c?b.bind(c):b,function(){a.a.La(e.K[d],f);e.Ia&&e.Ia(d)});e.sa&&e.sa(d);e.K[d]||(e.K[d]=[]);e.K[d].push(f);return f},notifySubscribers:function(b,c){c=c||I;c===I&&this.zc();if(this.Pa(c))try{a.l.Ub();for(var d=this.K[c].slice(0),e=0,f;f=d[e];++e)f.R||f.gb(b)}finally{a.l.end()}},Na:function(){return this.Nb},Uc:function(a){return this.Na()!==a},zc:function(){++this.Nb},Ta:function(b){var c=this,d=a.H(c),e,f,g;c.Ha||(c.Ha=c.notifySubscribers,c.notifySubscribers=W);var k=b(function(){c.Mb=!1;d&&g===c&&(g=c());e=!1;c.tb(f,g)&&c.Ha(f=g)});c.Lb=function(a){c.Mb=e=!0;g=a;k()};c.Kb=function(a){e||(f=a,c.Ha(a,"beforeChange"))}},Pa:function(a){return this.K[a]&&this.K[a].length},Sc:function(b){if(b)return this.K[b]&&this.K[b].length||0;var c=0;a.a.D(this.K,function(a,b){"dirty"!==a&&(c+=b.length)});return c},tb:function(a,c){return!this.equalityComparer||!this.equalityComparer(a,c)},extend:function(b){var c=this;b&&a.a.D(b,function(b,e){var f=a.ya[b];"function"==typeof f&&(c=f(c,e)||c)});return c}};a.G(D,"subscribe",D.X);a.G(D,"extend",D.extend);a.G(D,"getSubscriptionsCount",D.Sc);a.a.ka&&a.a.Xa(D,Function.prototype);a.J.fn=D;a.hc=function(a){return null!=a&&"function"==typeof a.X&&"function"==typeof a.notifySubscribers};a.b("subscribable",a.J);a.b("isSubscribable",a.hc);a.va=a.l=function(){function b(a){d.push(e);e=a}function c(){e=d.pop()}var d=[],e,f=0;return{Ub:b,end:c,oc:function(b){if(e){if(!a.hc(b))throw Error("Only subscribable things can act as dependencies");e.gb.call(e.Gc,b,b.Cc||(b.Cc=++f))}},w:function(a,d,e){try{return b(),a.apply(d,e||[])}finally{c()}},Aa:function(){if(e)return e.m.Aa()},Sa:function(){if(e)return e.Sa}}}();a.b("computedContext",a.va);a.b("computedContext.getDependenciesCount",a.va.Aa);a.b("computedContext.isInitial",a.va.Sa);a.b("ignoreDependencies",a.qd=a.l.w);var E=a.a.Yb("_latestValue");a.N=function(b){function c(){if(0<arguments.length)return c.tb(c[E],arguments[0])&&(c.ga(),c[E]=arguments[0],c.fa()),this;a.l.oc(c);return c[E]}c[E]=b;a.a.ka||a.a.extend(c,a.J.fn);a.J.fn.rb(c);a.a.Ya(c,B);a.options.deferUpdates&&a.ya.deferred(c,!0);return c};var B={equalityComparer:J,t:function(){return this[E]},fa:function(){this.notifySubscribers(this[E])},ga:function(){this.notifySubscribers(this[E],"beforeChange")}};a.a.ka&&a.a.Xa(B,a.J.fn);var H=a.N.gd="__ko_proto__";B[H]=a.N;a.Oa=function(b,c){return null===b||b===n||b[H]===n?!1:b[H]===c?!0:a.Oa(b[H],c)};a.H=function(b){return a.Oa(b,a.N)};a.Ba=function(b){return"function"==typeof b&&b[H]===a.N||"function"==typeof b&&b[H]===a.B&&b.Vc?!0:!1};a.b("observable",a.N);a.b("isObservable",a.H);a.b("isWriteableObservable",a.Ba);a.b("isWritableObservable",a.Ba);a.b("observable.fn",B);a.G(B,"peek",B.t);a.G(B,"valueHasMutated",B.fa);a.G(B,"valueWillMutate",B.ga);a.la=function(b){b=b||[];if("object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");b=a.N(b);a.a.Ya(b,a.la.fn);return b.extend({trackArrayChanges:!0})};a.la.fn={remove:function(b){for(var c=this.t(),d=[],e="function"!=typeof b||a.H(b)?function(a){return a===b}:b,f=0;f<c.length;f++){var g=c[f];e(g)&&(0===d.length&&this.ga(),d.push(g),c.splice(f,1),f--)}d.length&&this.fa();return d},removeAll:function(b){if(b===n){var c=this.t(),d=c.slice(0);this.ga();c.splice(0,c.length);this.fa();return d}return b?this.remove(function(c){return 0<=a.a.o(b,c)}):[]},destroy:function(b){var c=this.t(),d="function"!=typeof b||a.H(b)?function(a){return a===b}:b;this.ga();for(var e=c.length-1;0<=e;e--)d(c[e])&&(c[e]._destroy=!0);this.fa()},destroyAll:function(b){return b===n?this.destroy(function(){return!0}):b?this.destroy(function(c){return 0<=a.a.o(b,c)}):[]},indexOf:function(b){var c=this();return a.a.o(c,b)},replace:function(a,c){var d=this.indexOf(a);0<=d&&(this.ga(),this.t()[d]=c,this.fa())}};a.a.ka&&a.a.Xa(a.la.fn,a.N.fn);a.a.q("pop push reverse shift sort splice unshift".split(" "),function(b){a.la.fn[b]=function(){var a=this.t();this.ga();this.Vb(a,b,arguments);var d=a[b].apply(a,arguments);this.fa();return d===a?this:d}});a.a.q(["slice"],function(b){a.la.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}});a.b("observableArray",a.la);a.ya.trackArrayChanges=function(b,c){function d(){if(!e){e=!0;var c=b.notifySubscribers;b.notifySubscribers=function(a,b){b&&b!==I||++k;return c.apply(this,arguments)};var d=[].concat(b.t()||[]);f=null;g=b.X(function(c){c=[].concat(c||[]);if(b.Pa("arrayChange")){var e;if(!f||1<k)f=a.a.ib(d,c,b.hb);e=f}d=c;f=null;k=0;e&&e.length&&b.notifySubscribers(e,"arrayChange")})}}b.hb={};c&&"object"==typeof c&&a.a.extend(b.hb,c);b.hb.sparse=!0;if(!b.Vb){var e=!1,f=null,g,k=0,l=b.sa,m=b.Ia;b.sa=function(a){l&&l.call(b,a);"arrayChange"===a&&d()};b.Ia=function(a){m&&m.call(b,a);"arrayChange"!==a||b.Pa("arrayChange")||(g.k(),e=!1)};b.Vb=function(b,c,d){function m(a,b,c){return l[l.length]={status:a,value:b,index:c}}if(e&&!k){var l=[],g=b.length,t=d.length,G=0;switch(c){case"push":G=g;case"unshift":for(c=0;c<t;c++)m("added",d[c],G+c);break;case"pop":G=g-1;case"shift":g&&m("deleted",b[G],G);break;case"splice":c=Math.min(Math.max(0,0>d[0]?g+d[0]:d[0]),g);for(var g=1===t?g:Math.min(c+(d[1]||0),g),t=c+t-2,G=Math.max(g,t),P=[],n=[],Q=2;c<G;++c,++Q)c<g&&n.push(m("deleted",b[c],c)),c<t&&P.push(m("added",d[Q],c));a.a.dc(n,P);break;default:return}f=l}}}};var s=a.a.Yb("_state");a.m=a.B=function(b,c,d){function e(){if(0<arguments.length){if("function"===typeof f)f.apply(g.pb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}a.l.oc(e);(g.S||g.s&&e.Qa())&&e.aa();return g.T}"object"===typeof b?d=b:(d=d||{},b&&(d.read=b));if("function"!=typeof d.read)throw Error("Pass a function that returns the value of the ko.computed");var f=d.write,g={T:n,S:!0,Ra:!1,Fb:!1,R:!1,Va:!1,s:!1,jd:d.read,pb:c||d.owner,i:d.disposeWhenNodeIsRemoved||d.i||null,wa:d.disposeWhen||d.wa,mb:null,r:{},L:0,bc:null};e[s]=g;e.Vc="function"===typeof f;a.a.ka||a.a.extend(e,a.J.fn);a.J.fn.rb(e);a.a.Ya(e,z);d.pure?(g.Va=!0,g.s=!0,a.a.extend(e,$)):d.deferEvaluation&&a.a.extend(e,aa);a.options.deferUpdates&&a.ya.deferred(e,!0);g.i&&(g.Fb=!0,g.i.nodeType||(g.i=null));g.s||d.deferEvaluation||e.aa();g.i&&e.ba()&&a.a.F.oa(g.i,g.mb=function(){e.k()});return e};var z={equalityComparer:J,Aa:function(){return this[s].L},Pb:function(a,c,d){if(this[s].Va&&c===this)throw Error("A 'pure' computed must not be called recursively");this[s].r[a]=d;d.Ga=this[s].L++;d.na=c.Na()},Qa:function(){var a,c,d=this[s].r;for(a in d)if(d.hasOwnProperty(a)&&(c=d[a],c.ia.Uc(c.na)))return!0},bd:function(){this.Fa&&!this[s].Ra&&this.Fa()},ba:function(){return this[s].S||0<this[s].L},ld:function(){this.Mb||this.ac()},uc:function(a){if(a.cb&&!this[s].i){var c=a.X(this.bd,this,"dirty"),d=a.X(this.ld,this);return{ia:a,k:function(){c.k();d.k()}}}return a.X(this.ac,this)},ac:function(){var b=this,c=b.throttleEvaluation;c&&0<=c?(clearTimeout(this[s].bc),this[s].bc=a.a.setTimeout(function(){b.aa(!0)},c)):b.Fa?b.Fa():b.aa(!0)},aa:function(b){var c=this[s],d=c.wa;if(!c.Ra&&!c.R){if(c.i&&!a.a.nb(c.i)||d&&d()){if(!c.Fb){this.k();return}}else c.Fb=!1;c.Ra=!0;try{this.Qc(b)}finally{c.Ra=!1}c.L||this.k()}},Qc:function(b){var c=this[s],d=c.Va?n:!c.L,e={Hc:this,Ma:c.r,lb:c.L};a.l.Ub({Gc:e,gb:Y,m:this,Sa:d});c.r={};c.L=0;e=this.Pc(c,e);this.tb(c.T,e)&&(c.s||this.notifySubscribers(c.T,"beforeChange"),c.T=e,c.s?this.zc():b&&this.notifySubscribers(c.T));d&&this.notifySubscribers(c.T,"awake")},Pc:function(b,c){try{var d=b.jd;return b.pb?d.call(b.pb):d()}finally{a.l.end(),c.lb&&!b.s&&a.a.D(c.Ma,X),b.S=!1}},t:function(){var a=this[s];(a.S&&!a.L||a.s&&this.Qa())&&this.aa();return a.T},Ta:function(b){a.J.fn.Ta.call(this,b);this.Fa=function(){this.Kb(this[s].T);this[s].S=!0;this.Lb(this)}},k:function(){var b=this[s];!b.s&&b.r&&a.a.D(b.r,function(a,b){b.k&&b.k()});b.i&&b.mb&&a.a.F.pc(b.i,b.mb);b.r=null;b.L=0;b.R=!0;b.S=!1;b.s=!1;b.i=null}},$={sa:function(b){var c=this,d=c[s];if(!d.R&&d.s&&"change"==b){d.s=!1;if(d.S||c.Qa())d.r=null,d.L=0,d.S=!0,c.aa();else{var e=[];a.a.D(d.r,function(a,b){e[b.Ga]=a});a.a.q(e,function(a,b){var e=d.r[a],l=c.uc(e.ia);l.Ga=b;l.na=e.na;d.r[a]=l})}d.R||c.notifySubscribers(d.T,"awake")}},Ia:function(b){var c=this[s];c.R||"change"!=b||this.Pa("change")||(a.a.D(c.r,function(a,b){b.k&&(c.r[a]={ia:b.ia,Ga:b.Ga,na:b.na},b.k())}),c.s=!0,this.notifySubscribers(n,"asleep"))},Na:function(){var b=this[s];b.s&&(b.S||this.Qa())&&this.aa();return a.J.fn.Na.call(this)}},aa={sa:function(a){"change"!=a&&"beforeChange"!=a||this.t()}};a.a.ka&&a.a.Xa(z,a.J.fn);var R=a.N.gd;a.m[R]=a.N;z[R]=a.m;a.Xc=function(b){return a.Oa(b,a.m)};a.Yc=function(b){return a.Oa(b,a.m)&&b[s]&&b[s].Va};a.b("computed",a.m);a.b("dependentObservable",a.m);a.b("isComputed",a.Xc);a.b("isPureComputed",a.Yc);a.b("computed.fn",z);a.G(z,"peek",z.t);a.G(z,"dispose",z.k);a.G(z,"isActive",z.ba);a.G(z,"getDependenciesCount",z.Aa);a.nc=function(b,c){if("function"===typeof b)return a.m(b,c,{pure:!0});b=a.a.extend({},b);b.pure=!0;return a.m(b,c)};a.b("pureComputed",a.nc);(function(){function b(a,f,g){g=g||new d;a=f(a);if("object"!=typeof a||null===a||a===n||a instanceof RegExp||a instanceof Date||a instanceof String||a instanceof
Number||a instanceof Boolean)return a;var k=a instanceof Array?[]:{};g.save(a,k);c(a,function(c){var d=f(a[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":k[c]=d;break;case"object":case"undefined":var h=g.get(d);k[c]=h!==n?h:b(d,f,g)}});return k}function c(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function d(){this.keys=[];this.Ib=[]}a.wc=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var c=0;a.H(b)&&10>c;c++)b=b();return b})};a.toJSON=function(b,c,d){b=a.wc(b);return a.a.Eb(b,c,d)};d.prototype={save:function(b,c){var d=a.a.o(this.keys,b);0<=d?this.Ib[d]=c:(this.keys.push(b),this.Ib.push(c))},get:function(b){b=a.a.o(this.keys,b);return 0<=b?this.Ib[b]:n}}})();a.b("toJS",a.wc);a.b("toJSON",a.toJSON);(function(){a.j={u:function(b){switch(a.a.A(b)){case"option":return!0===b.__ko__hasDomDataOptionValue__?a.a.e.get(b,a.d.options.xb):7>=a.a.C?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return 0<=b.selectedIndex?a.j.u(b.options[b.selectedIndex]):n;default:return b.value}},ha:function(b,c,d){switch(a.a.A(b)){case"option":switch(typeof c){case"string":a.a.e.set(b,a.d.options.xb,n);"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__;b.value=c;break;default:a.a.e.set(b,a.d.options.xb,c),b.__ko__hasDomDataOptionValue__=!0,b.value="number"===typeof c?c:""}break;case"select":if(""===c||null===c)c=n;for(var e=-1,f=0,g=b.options.length,k;f<g;++f)if(k=a.j.u(b.options[f]),k==c||""==k&&c===n){e=f;break}if(d||0<=e||c===n&&1<b.size)b.selectedIndex=e;break;default:if(null===c||c===n)c="";b.value=c}}}})();a.b("selectExtensions",a.j);a.b("selectExtensions.readValue",a.j.u);a.b("selectExtensions.writeValue",a.j.ha);a.h=function(){function b(b){b=a.a.$a(b);123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c=[],d=b.match(e),r,k=[],p=0;if(d){d.push(",");for(var A=0,y;y=d[A];++A){var t=y.charCodeAt(0);if(44===t){if(0>=p){c.push(r&&k.length?{key:r,value:k.join("")}:{unknown:r||k.join("")});r=p=0;k=[];continue}}else if(58===t){if(!p&&!r&&1===k.length){r=k.pop();continue}}else 47===t&&A&&1<y.length?(t=d[A-1].match(f))&&!g[t[0]]&&(b=b.substr(b.indexOf(y)+1),d=b.match(e),d.push(","),A=-1,y="/"):40===t||123===t||91===t?++p:41===t||125===t||93===t?--p:r||k.length||34!==t&&39!==t||(y=y.slice(1,-1));k.push(y)}}return c}var c=["true","false","null","undefined"],d=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,e=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,g={"in":1,"return":1,"typeof":1},k={};return{ta:[],ea:k,yb:b,Ua:function(e,m){function h(b,e){var m;if(!A){var l=a.getBindingHandler(b);if(l&&l.preprocess&&!(e=l.preprocess(e,b,h)))return;if(l=k[b])m=e,0<=a.a.o(c,m)?m=!1:(l=m.match(d),m=null===l?!1:l[1]?"Object("+l[1]+")"+l[2]:m),l=m;l&&g.push("'"+b+"':function(_z){"+m+"=_z}")}p&&(e="function(){return "+e+" }");f.push("'"+b+"':"+e)}m=m||{};var f=[],g=[],p=m.valueAccessors,A=m.bindingParams,y="string"===typeof e?b(e):e;a.a.q(y,function(a){h(a.key||a.unknown,a.value)});g.length&&h("_ko_property_writers","{"+g.join(",")+" }");return f.join(",")},ad:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},Ea:function(b,c,d,e,f){if(b&&a.H(b))!a.Ba(b)||f&&b.t()===e||b(e);else if((b=c.get("_ko_property_writers"))&&b[d])b[d](e)}}}();a.b("expressionRewriting",a.h);a.b("expressionRewriting.bindingRewriteValidators",a.h.ta);a.b("expressionRewriting.parseObjectLiteral",a.h.yb);a.b("expressionRewriting.preProcessBindings",a.h.Ua);a.b("expressionRewriting._twoWayBindings",a.h.ea);a.b("jsonExpressionRewriting",a.h);a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.Ua);(function(){function b(a){return 8==a.nodeType&&g.test(f?a.text:a.nodeValue)}function c(a){return 8==a.nodeType&&k.test(f?a.text:a.nodeValue)}function d(a,d){for(var e=a,f=1,l=[];e=e.nextSibling;){if(c(e)&&(f--,0===f))return l;l.push(e);b(e)&&f++}if(!d)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function e(a,b){var c=d(a,b);return c?0<c.length?c[c.length-1].nextSibling:a.nextSibling:null}var f=u&&"\x3c!--test--\x3e"===u.createComment("test").text,g=f?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,k=f?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0};a.f={Z:{},childNodes:function(a){return b(a)?d(a):a.childNodes},xa:function(c){if(b(c)){c=a.f.childNodes(c);for(var d=0,e=c.length;d<e;d++)a.removeNode(c[d])}else a.a.ob(c)},da:function(c,d){if(b(c)){a.f.xa(c);for(var e=c.nextSibling,f=0,l=d.length;f<l;f++)e.parentNode.insertBefore(d[f],e)}else a.a.da(c,d)},mc:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},gc:function(c,d,e){e?b(c)?c.parentNode.insertBefore(d,e.nextSibling):e.nextSibling?c.insertBefore(d,e.nextSibling):c.appendChild(d):a.f.mc(c,d)},firstChild:function(a){return b(a)?!a.nextSibling||c(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){b(a)&&(a=e(a));return a.nextSibling&&c(a.nextSibling)?null:a.nextSibling},Tc:b,pd:function(a){return(a=(f?a.text:a.nodeValue).match(g))?a[1]:null},kc:function(d){if(l[a.a.A(d)]){var h=d.firstChild;if(h){do if(1===h.nodeType){var f;f=h.firstChild;var g=null;if(f){do if(g)g.push(f);else if(b(f)){var k=e(f,!0);k?f=k:g=[f]}else c(f)&&(g=[f]);while(f=f.nextSibling)}if(f=g)for(g=h.nextSibling,k=0;k<f.length;k++)g?d.insertBefore(f[k],g):d.appendChild(f[k])}while(h=h.nextSibling)}}}}})();a.b("virtualElements",a.f);a.b("virtualElements.allowedBindings",a.f.Z);a.b("virtualElements.emptyNode",a.f.xa);a.b("virtualElements.insertAfter",a.f.gc);a.b("virtualElements.prepend",a.f.mc);a.b("virtualElements.setDomNodeChildren",a.f.da);(function(){a.Q=function(){this.Fc={}};a.a.extend(a.Q.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);case 8:return a.f.Tc(b);default:return!1}},getBindings:function(b,c){var d=this.getBindingsString(b,c),d=d?this.parseBindingsString(d,c,b):null;return a.g.Ob(d,b,c,!1)},getBindingAccessors:function(b,c){var d=this.getBindingsString(b,c),d=d?this.parseBindingsString(d,c,b,{valueAccessors:!0}):null;return a.g.Ob(d,b,c,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.f.pd(b);default:return null}},parseBindingsString:function(b,c,d,e){try{var f=this.Fc,g=b+(e&&e.valueAccessors||""),k;if(!(k=f[g])){var l,m="with($context){with($data||{}){return{"+a.h.Ua(b,e)+"}}}";l=new Function("$context","$element",m);k=f[g]=l}return k(c,d)}catch(h){throw h.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+h.message,h;}}});a.Q.instance=new a.Q})();a.b("bindingProvider",a.Q);(function(){function b(a){return function(){return a}}function c(a){return a()}function d(b){return a.a.Ca(a.l.w(b),function(a,c){return function(){return b()[c]}})}function e(c,e,h){return"function"===typeof c?d(c.bind(null,e,h)):a.a.Ca(c,b)}function f(a,b){return d(this.getBindings.bind(this,a,b))}function g(b,c,d){var e,h=a.f.firstChild(c),f=a.Q.instance,m=f.preprocessNode;if(m){for(;e=h;)h=a.f.nextSibling(e),m.call(f,e);h=a.f.firstChild(c)}for(;e=h;)h=a.f.nextSibling(e),k(b,e,d)}function k(b,c,d){var e=!0,h=1===c.nodeType;h&&a.f.kc(c);if(h&&d||a.Q.instance.nodeHasBindings(c))e=m(c,null,b,d).shouldBindDescendants;e&&!r[a.a.A(c)]&&g(b,c,!h)}function l(b){var c=[],d={},e=[];a.a.D(b,function Z(h){if(!d[h]){var f=a.getBindingHandler(h);f&&(f.after&&(e.push(h),a.a.q(f.after,function(c){if(b[c]){if(-1!==a.a.o(e,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+e.join(", "));Z(c)}}),e.length--),c.push({key:h,fc:f}));d[h]=!0}});return c}function m(b,d,e,h){var m=a.a.e.get(b,q);if(!d){if(m)throw Error("You cannot apply bindings multiple times to the same element.");a.a.e.set(b,q,!0)}!m&&h&&a.tc(b,e);var g;if(d&&"function"!==typeof d)g=d;else{var k=a.Q.instance,r=k.getBindingAccessors||f,p=a.B(function(){(g=d?d(e,b):r.call(k,b,e))&&e.P&&e.P();return g},null,{i:b});g&&p.ba()||(p=null)}var u;if(g){var v=p?function(a){return function(){return c(p()[a])}}:function(a){return g[a]},s=function(){return a.a.Ca(p?p():g,c)};s.get=function(a){return g[a]&&c(v(a))};s.has=function(a){return a in g};h=l(g);a.a.q(h,function(c){var d=c.fc.init,h=c.fc.update,f=c.key;if(8===b.nodeType&&!a.f.Z[f])throw Error("The binding '"+f+"' cannot be used with virtual elements");try{"function"==typeof d&&a.l.w(function(){var a=d(b,v(f),s,e.$data,e);if(a&&a.controlsDescendantBindings){if(u!==n)throw Error("Multiple bindings ("+u+" and "+f+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");u=f}}),"function"==typeof h&&a.B(function(){h(b,v(f),s,e.$data,e)},null,{i:b})}catch(m){throw m.message='Unable to process binding "'+f+": "+g[f]+'"\nMessage: '+m.message,m;}})}return{shouldBindDescendants:u===n}}function h(b){return b&&b instanceof a.U?b:new a.U(b)}
a.d={};var r={script:!0,textarea:!0,template:!0};a.getBindingHandler=function(b){return a.d[b]};a.U=function(b,c,d,e){var h=this,f="function"==typeof b&&!a.H(b),m,g=a.B(function(){var m=f?b():b,l=a.a.c(m);c?(c.P&&c.P(),a.a.extend(h,c),g&&(h.P=g)):(h.$parents=[],h.$root=l,h.ko=a);h.$rawData=m;h.$data=l;d&&(h[d]=l);e&&e(h,c,l);return h.$data},null,{wa:function(){return m&&!a.a.Qb(m)},i:!0});g.ba()&&(h.P=g,g.equalityComparer=null,m=[],g.Ac=function(b){m.push(b);a.a.F.oa(b,function(b){a.a.La(m,b);m.length||(g.k(),h.P=g=n)})})};a.U.prototype.createChildContext=function(b,c,d){return new a.U(b,this,c,function(a,b){a.$parentContext=b;a.$parent=b.$data;a.$parents=(b.$parents||[]).slice(0);a.$parents.unshift(a.$parent);d&&d(a)})};a.U.prototype.extend=function(b){return new a.U(this.P||this.$data,this,null,function(c,d){c.$rawData=d.$rawData;a.a.extend(c,"function"==typeof b?b():b)})};var q=a.a.e.I(),p=a.a.e.I();a.tc=function(b,c){if(2==arguments.length)a.a.e.set(b,p,c),c.P&&c.P.Ac(b);else return a.a.e.get(b,p)};a.Ja=function(b,c,d){1===b.nodeType&&a.f.kc(b);return m(b,c,h(d),!0)};a.Dc=function(b,c,d){d=h(d);return a.Ja(b,e(c,d,b),d)};a.eb=function(a,b){1!==b.nodeType&&8!==b.nodeType||g(h(a),b,!0)};a.Rb=function(a,b){!v&&x.jQuery&&(v=x.jQuery);if(b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||x.document.body;k(h(a),b,!0)};a.kb=function(b){switch(b.nodeType){case 1:case 8:var c=a.tc(b);if(c)return c;if(b.parentNode)return a.kb(b.parentNode)}return n};a.Jc=function(b){return(b=a.kb(b))?b.$data:n};a.b("bindingHandlers",a.d);a.b("applyBindings",a.Rb);a.b("applyBindingsToDescendants",a.eb);a.b("applyBindingAccessorsToNode",a.Ja);a.b("applyBindingsToNode",a.Dc);a.b("contextFor",a.kb);a.b("dataFor",a.Jc)})();(function(b){function c(c,e){var m=f.hasOwnProperty(c)?f[c]:b,h;m?m.X(e):(m=f[c]=new a.J,m.X(e),d(c,function(b,d){var e=!(!d||!d.synchronous);g[c]={definition:b,Zc:e};delete f[c];h||e?m.notifySubscribers(b):a.Y.Wa(function(){m.notifySubscribers(b)})}),h=!0)}function d(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a,c)}):b(null,null)})}function e(c,d,f,h){h||(h=a.g.loaders.slice(0));var g=h.shift();if(g){var q=g[c];if(q){var p=!1;if(q.apply(g,d.concat(function(a){p?f(null):null!==a?f(a):e(c,d,f,h)}))!==b&&(p=!0,!g.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.");}else e(c,d,f,h)}else f(null)}
var f={},g={};a.g={get:function(d,e){var f=g.hasOwnProperty(d)?g[d]:b;f?f.Zc?a.l.w(function(){e(f.definition)}):a.Y.Wa(function(){e(f.definition)}):c(d,e)},Xb:function(a){delete g[a]},Jb:e};a.g.loaders=[];a.b("components",a.g);a.b("components.get",a.g.get);a.b("components.clearCachedDefinition",a.g.Xb)})();(function(){function b(b,c,d,e){function g(){0===--y&&e(k)}var k={},y=2,t=d.template;d=d.viewModel;t?f(c,t,function(c){a.g.Jb("loadTemplate",[b,c],function(a){k.template=a;g()})}):g();d?f(c,d,function(c){a.g.Jb("loadViewModel",[b,c],function(a){k[l]=a;g()})}):g()}function c(a,b,d){if("function"===typeof b)d(function(a){return new b(a)});else if("function"===typeof b[l])d(b[l]);else if("instance"in b){var e=b.instance;d(function(){return e})}else"viewModel"in b?c(a,b.viewModel,d):a("Unknown viewModel value: "+b)}function d(b){switch(a.a.A(b)){case"script":return a.a.ma(b.text);case"textarea":return a.a.ma(b.value);case"template":if(e(b.content))return a.a.ua(b.content.childNodes)}return a.a.ua(b.childNodes)}function e(a){return x.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function f(a,b,c){"string"===typeof b.require?O||x.require?(O||x.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function g(a){return function(b){throw Error("Component '"+a+"': "+b);}}var k={};a.g.register=function(b,c){if(!c)throw Error("Invalid configuration for "+b);if(a.g.ub(b))throw Error("Component "+b+" is already registered");k[b]=c};a.g.ub=function(a){return k.hasOwnProperty(a)};a.g.od=function(b){delete k[b];a.g.Xb(b)};a.g.Zb={getConfig:function(a,b){b(k.hasOwnProperty(a)?k[a]:null)},loadComponent:function(a,c,d){var e=g(a);f(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,c,f){b=g(b);if("string"===typeof c)f(a.a.ma(c));else if(c instanceof Array)f(c);else if(e(c))f(a.a.V(c.childNodes));else if(c.element)if(c=c.element,x.HTMLElement?c instanceof HTMLElement:c&&c.tagName&&1===c.nodeType)f(d(c));else if("string"===typeof c){var l=u.getElementById(c);l?f(d(l)):b("Cannot find element with ID "+c)}else b("Unknown element type: "+
c);else b("Unknown template value: "+c)},loadViewModel:function(a,b,d){c(g(a),b,d)}};var l="createViewModel";a.b("components.register",a.g.register);a.b("components.isRegistered",a.g.ub);a.b("components.unregister",a.g.od);a.b("components.defaultLoader",a.g.Zb);a.g.loaders.push(a.g.Zb);a.g.Bc=k})();(function(){function b(b,e){var f=b.getAttribute("params");if(f){var f=c.parseBindingsString(f,e,b,{valueAccessors:!0,bindingParams:!0}),f=a.a.Ca(f,function(c){return a.m(c,null,{i:b})}),g=a.a.Ca(f,function(c){var e=c.t();return c.ba()?a.m({read:function(){return a.a.c(c())},write:a.Ba(e)&&function(a){c()(a)},i:b}):e});g.hasOwnProperty("$raw")||(g.$raw=f);return g}return{$raw:{}}}a.g.getComponentNameForNode=function(b){var c=a.a.A(b);if(a.g.ub(c)&&(-1!=c.indexOf("-")||"[object HTMLUnknownElement]"==""+b||8>=a.a.C&&b.tagName===c))return c};a.g.Ob=function(c,e,f,g){if(1===e.nodeType){var k=a.g.getComponentNameForNode(e);if(k){c=c||{};if(c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var l={name:k,params:b(e,f)};c.component=g?function(){return l}:l}}return c};var c=new a.Q;9>a.a.C&&(a.g.register=function(a){return function(b){u.createElement(b);return a.apply(this,arguments)}}(a.g.register),u.createDocumentFragment=function(b){return function(){var c=b(),f=a.g.Bc,g;for(g in f)f.hasOwnProperty(g)&&c.createElement(g);return c}}(u.createDocumentFragment))})();(function(b){function c(b,c,d){c=c.template;if(!c)throw Error("Component '"+b+"' has no template");b=a.a.ua(c);a.f.da(d,b)}
function d(a,b,c,d){var e=a.createViewModel;return e?e.call(a,d,{element:b,templateNodes:c}):d}var e=0;a.d.component={init:function(f,g,k,l,m){function h(){var a=r&&r.dispose;"function"===typeof a&&a.call(r);q=r=null}var r,q,p=a.a.V(a.f.childNodes(f));a.a.F.oa(f,h);a.m(function(){var l=a.a.c(g()),k,t;"string"===typeof l?k=l:(k=a.a.c(l.name),t=a.a.c(l.params));if(!k)throw Error("No component name specified");var n=q=++e;a.g.get(k,function(e){if(q===n){h();if(!e)throw Error("Unknown component '"+k+"'");c(k,e,f);var g=d(e,f,p,t);e=m.createChildContext(g,b,function(a){a.$component=g;a.$componentTemplateNodes=p});r=g;a.eb(e,f)}})},null,{i:f});return{controlsDescendantBindings:!0}}};a.f.Z.component=!0})();var S={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,c){var d=a.a.c(c())||{};a.a.D(d,function(c,d){d=a.a.c(d);var g=!1===d||null===d||d===n;g&&b.removeAttribute(c);8>=a.a.C&&c in S?(c=S[c],g?b.removeAttribute(c):b[c]=d):g||b.setAttribute(c,d.toString());"name"===c&&a.a.rc(b,g?"":d.toString())})}};(function(){a.d.checked={after:["value","attr"],init:function(b,c,d){function e(){var e=b.checked,f=p?g():e;if(!a.va.Sa()&&(!l||e)){var m=a.l.w(c);if(h){var k=r?m.t():m;q!==f?(e&&(a.a.pa(k,f,!0),a.a.pa(k,q,!1)),q=f):a.a.pa(k,f,e);r&&a.Ba(m)&&m(k)}else a.h.Ea(m,d,"checked",f,!0)}}function f(){var d=a.a.c(c());b.checked=h?0<=a.a.o(d,g()):k?d:g()===d}var g=a.nc(function(){return d.has("checkedValue")?a.a.c(d.get("checkedValue")):d.has("value")?a.a.c(d.get("value")):b.value}),k="checkbox"==b.type,l="radio"==b.type;if(k||l){var m=c(),h=k&&a.a.c(m)instanceof Array,r=!(h&&m.push&&m.splice),q=h?g():n,p=l||h;l&&!b.name&&a.d.uniqueName.init(b,function(){return!0});a.m(e,null,{i:b});a.a.p(b,"click",e);a.m(f,null,{i:b});m=n}}};a.h.ea.checked=!0;a.d.checkedValue={update:function(b,c){b.value=a.a.c(c())}}})();a.d.css={update:function(b,c){var d=a.a.c(c());null!==d&&"object"==typeof d?a.a.D(d,function(c,d){d=a.a.c(d);a.a.bb(b,c,d)}):(d=a.a.$a(String(d||"")),a.a.bb(b,b.__ko__cssValue,!1),b.__ko__cssValue=d,a.a.bb(b,d,!0))}};a.d.enable={update:function(b,c){var d=a.a.c(c());d&&b.disabled?b.removeAttribute("disabled"):d||b.disabled||(b.disabled=!0)}};a.d.disable={update:function(b,c){a.d.enable.update(b,function(){return!a.a.c(c())})}};a.d.event={init:function(b,c,d,e,f){var g=c()||{};a.a.D(g,function(g){"string"==typeof g&&a.a.p(b,g,function(b){var m,h=c()[g];if(h){try{var r=a.a.V(arguments);e=f.$data;r.unshift(e);m=h.apply(e,r)}finally{!0!==m&&(b.preventDefault?b.preventDefault():b.returnValue=!1)}!1===d.get(g+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}};a.d.foreach={ic:function(b){return function(){var c=b(),d=a.a.zb(c);if(!d||"number"==typeof d.length)return{foreach:c,templateEngine:a.W.sb};a.a.c(c);return{foreach:d.data,as:d.as,includeDestroyed:d.includeDestroyed,afterAdd:d.afterAdd,beforeRemove:d.beforeRemove,afterRender:d.afterRender,beforeMove:d.beforeMove,afterMove:d.afterMove,templateEngine:a.W.sb}}},init:function(b,c){return a.d.template.init(b,a.d.foreach.ic(c))},update:function(b,c,d,e,f){return a.d.template.update(b,a.d.foreach.ic(c),d,e,f)}};a.h.ta.foreach=!1;a.f.Z.foreach=!0;a.d.hasfocus={init:function(b,c,d){function e(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(h){g=f.body}e=g===b}f=c();a.h.Ea(f,d,"hasfocus",e,!0);b.__ko_hasfocusLastValue=e;b.__ko_hasfocusUpdating=!1}var f=e.bind(null,!0),g=e.bind(null,!1);a.a.p(b,"focus",f);a.a.p(b,"focusin",f);a.a.p(b,"blur",g);a.a.p(b,"focusout",g)},update:function(b,c){var d=!!a.a.c(c());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===d||(d?b.focus():b.blur(),!d&&b.__ko_hasfocusLastValue&&b.ownerDocument.body.focus(),a.l.w(a.a.Da,null,[b,d?"focusin":"focusout"]))}};a.h.ea.hasfocus=!0;a.d.hasFocus=a.d.hasfocus;a.h.ea.hasFocus=!0;a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Cb(b,c())}};K("if");K("ifnot",!1,!0);K("with",!0,!1,function(a,c){return a.createChildContext(c)});var L={};a.d.options={init:function(b){if("select"!==a.a.A(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,c,d){function e(){return a.a.Ka(b.options,function(a){return a.selected})}function f(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function g(c,e){if(A&&h)a.j.ha(b,a.a.c(d.get("value")),!0);else if(p.length){var f=0<=a.a.o(p,a.j.u(e[0]));a.a.sc(e[0],f);A&&!f&&a.l.w(a.a.Da,null,[b,"change"])}}var k=b.multiple,l=0!=b.length&&k?b.scrollTop:null,m=a.a.c(c()),h=d.get("valueAllowUnset")&&d.has("value"),r=d.get("optionsIncludeDestroyed");c={};var q,p=[];h||(k?p=a.a.fb(e(),a.j.u):0<=b.selectedIndex&&p.push(a.j.u(b.options[b.selectedIndex])));m&&("undefined"==typeof m.length&&(m=[m]),q=a.a.Ka(m,function(b){return r||b===n||null===b||!a.a.c(b._destroy)}),d.has("optionsCaption")&&(m=a.a.c(d.get("optionsCaption")),null!==m&&m!==n&&q.unshift(L)));var A=!1;c.beforeRemove=function(a){b.removeChild(a)};m=g;d.has("optionsAfterRender")&&"function"==typeof d.get("optionsAfterRender")&&(m=function(b,c){g(0,c);a.l.w(d.get("optionsAfterRender"),null,[c[0],b!==L?b:n])});a.a.Bb(b,q,function(c,e,g){g.length&&(p=!h&&g[0].selected?[a.j.u(g[0])]:[],A=!0);e=b.ownerDocument.createElement("option");c===L?(a.a.Za(e,d.get("optionsCaption")),a.j.ha(e,n)):(g=f(c,d.get("optionsValue"),c),a.j.ha(e,a.a.c(g)),c=f(c,d.get("optionsText"),g),a.a.Za(e,c));return[e]},c,m);a.l.w(function(){h?a.j.ha(b,a.a.c(d.get("value")),!0):(k?p.length&&e().length<p.length:p.length&&0<=b.selectedIndex?a.j.u(b.options[b.selectedIndex])!==p[0]:p.length||0<=b.selectedIndex)&&a.a.Da(b,"change")});a.a.Nc(b);l&&20<Math.abs(l-b.scrollTop)&&(b.scrollTop=l)}};a.d.options.xb=a.a.e.I();a.d.selectedOptions={after:["options","foreach"],init:function(b,c,d){a.a.p(b,"change",function(){var e=c(),f=[];a.a.q(b.getElementsByTagName("option"),function(b){b.selected&&f.push(a.j.u(b))});a.h.Ea(e,d,"selectedOptions",f)})},update:function(b,c){if("select"!=a.a.A(b))throw Error("values binding applies only to SELECT elements");var d=a.a.c(c()),e=b.scrollTop;d&&"number"==typeof d.length&&a.a.q(b.getElementsByTagName("option"),function(b){var c=0<=a.a.o(d,a.j.u(b));b.selected!=c&&a.a.sc(b,c)});b.scrollTop=e}};a.h.ea.selectedOptions=!0;a.d.style={update:function(b,c){var d=a.a.c(c()||{});a.a.D(d,function(c,d){d=a.a.c(d);if(null===d||d===n||!1===d)d="";b.style[c]=d})}};a.d.submit={init:function(b,c,d,e,f){if("function"!=typeof c())throw Error("The value for a submit binding must be a function");a.a.p(b,"submit",function(a){var d,e=c();try{d=e.call(f.$data,b)}finally{!0!==d&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}};a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Za(b,c())}};a.f.Z.text=!0;(function(){if(x&&x.navigator)var b=function(a){if(a)return parseFloat(a[1])},c=x.opera&&x.opera.version&&parseInt(x.opera.version()),d=x.navigator.userAgent,e=b(d.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),f=b(d.match(/Firefox\/([^ ]*)/));if(10>a.a.C)var g=a.a.e.I(),k=a.a.e.I(),l=function(b){var c=this.activeElement;(c=c&&a.a.e.get(c,k))&&c(b)},m=function(b,c){var d=b.ownerDocument;a.a.e.get(d,g)||(a.a.e.set(d,g,!0),a.a.p(d,"selectionchange",l));a.a.e.set(b,k,c)};a.d.textInput={init:function(b,d,g){function l(c,d){a.a.p(b,c,d)}function k(){var c=a.a.c(d());if(null===c||c===n)c="";v!==n&&c===v?a.a.setTimeout(k,4):b.value!==c&&(u=c,b.value=c)}function y(){s||(v=b.value,s=a.a.setTimeout(t,4))}function t(){clearTimeout(s);v=s=n;var c=b.value;u!==c&&(u=c,a.h.Ea(d(),g,"textInput",c))}var u=b.value,s,v,x=9==a.a.C?y:t;10>a.a.C?(l("propertychange",function(a){"value"===a.propertyName&&x(a)}),8==a.a.C&&(l("keyup",t),l("keydown",t)),8<=a.a.C&&(m(b,x),l("dragend",y))):(l("input",t),5>e&&"textarea"===a.a.A(b)?(l("keydown",y),l("paste",y),l("cut",y)):11>c?l("keydown",y):4>f&&(l("DOMAutoComplete",t),l("dragdrop",t),l("drop",t)));l("change",t);a.m(k,null,{i:b})}};a.h.ea.textInput=!0;a.d.textinput={preprocess:function(a,b,c){c("textInput",a)}}})();a.d.uniqueName={init:function(b,c){if(c()){var d="ko_unique_"+ ++a.d.uniqueName.Ic;a.a.rc(b,d)}}};a.d.uniqueName.Ic=0;a.d.value={after:["options","foreach"],init:function(b,c,d){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e=["change"],f=d.get("valueUpdate"),g=!1,k=null;f&&("string"==typeof f&&(f=[f]),a.a.ra(e,f),e=a.a.Tb(e));var l=function(){k=null;g=!1;var e=c(),f=a.j.u(b);a.h.Ea(e,d,"value",f)};!a.a.C||"input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.o(e,"propertychange")||(a.a.p(b,"propertychange",function(){g=!0}),a.a.p(b,"focus",function(){g=!1}),a.a.p(b,"blur",function(){g&&l()}));a.a.q(e,function(c){var d=l;a.a.nd(c,"after")&&(d=function(){k=a.j.u(b);a.a.setTimeout(l,0)},c=c.substring(5));a.a.p(b,c,d)});var m=function(){var e=a.a.c(c()),f=a.j.u(b);if(null!==k&&e===k)a.a.setTimeout(m,0);else if(e!==f)if("select"===a.a.A(b)){var g=d.get("valueAllowUnset"),f=function(){a.j.ha(b,e,g)};f();g||e===a.j.u(b)?a.a.setTimeout(f,0):a.l.w(a.a.Da,null,[b,"change"])}else a.j.ha(b,e)};a.m(m,null,{i:b})}else a.Ja(b,{checkedValue:c})},update:function(){}};a.h.ea.value=!0;a.d.visible={update:function(b,c){var d=a.a.c(c()),e="none"!=b.style.display;d&&!e?b.style.display="":!d&&e&&(b.style.display="none")}};(function(b){a.d[b]={init:function(c,d,e,f,g){return a.d.event.init.call(this,c,function(){var a={};a[b]=d();return a},e,f,g)}}})("click");a.O=function(){};a.O.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource");};a.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};a.O.prototype.makeTemplateSource=function(b,c){if("string"==typeof b){c=c||u;var d=c.getElementById(b);if(!d)throw Error("Cannot find template with ID "+b);return new a.v.n(d)}if(1==b.nodeType||8==b.nodeType)return new a.v.qa(b);throw Error("Unknown template type: "+b);};a.O.prototype.renderTemplate=function(a,c,d,e){a=this.makeTemplateSource(a,e);return this.renderTemplateSource(a,c,d,e)};a.O.prototype.isTemplateRewritten=function(a,c){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,c).data("isRewritten")};a.O.prototype.rewriteTemplate=function(a,c,d){a=this.makeTemplateSource(a,d);c=c(a.text());a.text(c);a.data("isRewritten",!0)};a.b("templateEngine",a.O);a.Gb=function(){function b(b,c,d,k){b=a.h.yb(b);for(var l=a.h.ta,m=0;m<b.length;m++){var h=b[m].key;if(l.hasOwnProperty(h)){var r=l[h];if("function"===typeof r){if(h=r(b[m].value))throw Error(h);}else if(!r)throw Error("This template engine does not support the '"+h+"' binding within its templates");}}d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.Ua(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')";return k.createJavaScriptEvaluatorBlock(d)+c}var c=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,d=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Oc:function(b,c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.Gb.dd(b,c)},d)},dd:function(a,f){return a.replace(c,function(a,c,d,e,h){return b(h,c,d,f)}).replace(d,function(a,c){return b(c,"\x3c!-- ko --\x3e","#comment",f)})},Ec:function(b,c){return a.M.wb(function(d,k){var l=d.nextSibling;l&&l.nodeName.toLowerCase()===c&&a.Ja(l,b,k)})}}}();a.b("__tr_ambtns",a.Gb.Ec);(function(){a.v={};a.v.n=function(b){if(this.n=b){var c=a.a.A(b);this.ab="script"===c?1:"textarea"===c?2:"template"==c&&b.content&&11===b.content.nodeType?3:4}};a.v.n.prototype.text=function(){var b=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[b];var c=arguments[0];"innerHTML"===b?a.a.Cb(this.n,c):this.n[b]=c};var b=a.a.e.I()+"_";a.v.n.prototype.data=function(c){if(1===arguments.length)return a.a.e.get(this.n,b+c);a.a.e.set(this.n,b+c,arguments[1])};var c=a.a.e.I();a.v.n.prototype.nodes=function(){var b=this.n;if(0==arguments.length)return(a.a.e.get(b,c)||{}).jb||(3===this.ab?b.content:4===this.ab?b:n);a.a.e.set(b,c,{jb:arguments[0]})};a.v.qa=function(a){this.n=a};a.v.qa.prototype=new a.v.n;a.v.qa.prototype.text=function(){if(0==arguments.length){var b=a.a.e.get(this.n,c)||{};b.Hb===n&&b.jb&&(b.Hb=b.jb.innerHTML);return b.Hb}a.a.e.set(this.n,c,{Hb:arguments[0]})};a.b("templateSources",a.v);a.b("templateSources.domElement",a.v.n);a.b("templateSources.anonymousTemplate",a.v.qa)})();(function(){function b(b,c,d){var e;for(c=a.f.nextSibling(c);b&&(e=b)!==c;)b=a.f.nextSibling(e),d(e,b)}function c(c,d){if(c.length){var e=c[0],f=c[c.length-1],g=e.parentNode,k=a.Q.instance,n=k.preprocessNode;if(n){b(e,f,function(a,b){var c=a.previousSibling,d=n.call(k,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))});c.length=0;if(!e)return;e===f?c.push(e):(c.push(e,f),a.a.za(c,g))}b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.Rb(d,b)});b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.M.yc(b,[d])});a.a.za(c,g)}}function d(a){return a.nodeType?a:0<a.length?a[0]:null}function e(b,e,f,k,q){q=q||{};var p=(b&&d(b)||f||{}).ownerDocument,n=q.templateEngine||g;a.Gb.Oc(f,n,p);f=n.renderTemplate(f,k,q,p);if("number"!=typeof f.length||0<f.length&&"number"!=typeof f[0].nodeType)throw Error("Template engine must return an array of DOM nodes");p=!1;switch(e){case"replaceChildren":a.f.da(b,f);p=!0;break;case"replaceNode":a.a.qc(b,f);p=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e);}p&&(c(f,k),q.afterRender&&a.l.w(q.afterRender,null,[f,k.$data]));return f}function f(b,c,d){return a.H(b)?b():"function"===typeof b?b(c,d):b}var g;a.Db=function(b){if(b!=n&&!(b instanceof a.O))throw Error("templateEngine must inherit from ko.templateEngine");g=b};a.Ab=function(b,c,h,k,q){h=h||{};if((h.templateEngine||g)==n)throw Error("Set a template engine before calling renderTemplate");q=q||"replaceChildren";if(k){var p=d(k);return a.B(function(){var g=c&&c instanceof a.U?c:new a.U(a.a.c(c)),n=f(b,g.$data,g),g=e(k,q,n,g,h);"replaceNode"==q&&(k=g,p=d(k))},null,{wa:function(){return!p||!a.a.nb(p)},i:p&&"replaceNode"==q?p.parentNode:p})}return a.M.wb(function(d){a.Ab(b,c,h,d,"replaceNode")})};a.kd=function(b,d,g,k,q){function p(a,b){c(b,s);g.afterRender&&g.afterRender(b,a);s=null}function u(a,c){s=q.createChildContext(a,g.as,function(a){a.$index=c});var d=f(b,a,s);return e(null,"ignoreTargetNode",d,s,g)}var s;return a.B(function(){var b=a.a.c(d)||[];"undefined"==typeof b.length&&(b=[b]);b=a.a.Ka(b,function(b){return g.includeDestroyed||b===n||null===b||!a.a.c(b._destroy)});a.l.w(a.a.Bb,null,[k,b,u,g,p])},null,{i:k})};var k=a.a.e.I();a.d.template={init:function(b,c){var d=a.a.c(c());if("string"==typeof d||d.name)a.f.xa(b);else{if("nodes"in d){if(d=d.nodes||[],a.H(d))throw Error('The "nodes" option must be a plain, non-observable array.');}else d=a.f.childNodes(b);d=a.a.jc(d);(new a.v.qa(b)).nodes(d)}return{controlsDescendantBindings:!0}},update:function(b,c,d,e,f){var g=c(),s;c=a.a.c(g);d=!0;e=null;"string"==typeof c?c={}:(g=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in
c&&(d=!a.a.c(c.ifnot)),s=a.a.c(c.data));"foreach"in c?e=a.kd(g||b,d&&c.foreach||[],c,b,f):d?(f="data"in c?f.createChildContext(s,c.as):f,e=a.Ab(g||b,f,c,b)):a.f.xa(b);f=e;(s=a.a.e.get(b,k))&&"function"==typeof s.k&&s.k();a.a.e.set(b,k,f&&f.ba()?f:n)}};a.h.ta.template=function(b){b=a.h.yb(b);return 1==b.length&&b[0].unknown||a.h.ad(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"};a.f.Z.template=!0})();a.b("setTemplateEngine",a.Db);a.b("renderTemplate",a.Ab);a.a.dc=function(a,c,d){if(a.length&&c.length){var e,f,g,k,l;for(e=f=0;(!d||e<d)&&(k=a[f]);++f){for(g=0;l=c[g];++g)if(k.value===l.value){k.moved=l.index;l.moved=k.index;c.splice(g,1);e=g=0;break}e+=g}}};a.a.ib=function(){function b(b,d,e,f,g){var k=Math.min,l=Math.max,m=[],h,n=b.length,q,p=d.length,s=p-n||1,u=n+p+1,t,v,x;for(h=0;h<=n;h++)for(v=t,m.push(t=[]),x=k(p,h+s),q=l(0,h-1);q<=x;q++)t[q]=q?h?b[h-1]===d[q-1]?v[q-1]:k(v[q]||u,t[q-1]||u)+1:q+1:h+1;k=[];l=[];s=[];h=n;for(q=p;h||q;)p=m[h][q]-
1,q&&p===m[h][q-1]?l.push(k[k.length]={status:e,value:d[--q],index:q}):h&&p===m[h-1][q]?s.push(k[k.length]={status:f,value:b[--h],index:h}):(--q,--h,g.sparse||k.push({status:"retained",value:d[q]}));a.a.dc(s,l,!g.dontLimitMoves&&10*n);return k.reverse()}return function(a,d,e){e="boolean"===typeof e?{dontLimitMoves:e}:e||{};a=a||[];d=d||[];return a.length<d.length?b(a,d,"added","deleted",e):b(d,a,"deleted","added",e)}}();a.b("utils.compareArrays",a.a.ib);(function(){function b(b,c,d,k,l){var m=[],h=a.B(function(){var h=c(d,l,a.a.za(m,b))||[];0<m.length&&(a.a.qc(m,h),k&&a.l.w(k,null,[d,h,l]));m.length=0;a.a.ra(m,h)},null,{i:b,wa:function(){return!a.a.Qb(m)}});return{ca:m,B:h.ba()?h:n}}var c=a.a.e.I(),d=a.a.e.I();a.a.Bb=function(e,f,g,k,l){function m(b,c){w=q[c];v!==c&&(D[b]=w);w.qb(v++);a.a.za(w.ca,e);u.push(w);z.push(w)}function h(b,c){if(b)for(var d=0,e=c.length;d<e;d++)c[d]&&a.a.q(c[d].ca,function(a){b(a,d,c[d].ja)})}f=f||[];k=k||{};var r=a.a.e.get(e,c)===n,q=a.a.e.get(e,c)||[],p=a.a.fb(q,function(a){return a.ja}),s=a.a.ib(p,f,k.dontLimitMoves),u=[],t=0,v=0,x=[],z=[];f=[];for(var D=[],p=[],w,C=0,B,E;B=s[C];C++)switch(E=B.moved,B.status){case"deleted":E===n&&(w=q[t],w.B&&(w.B.k(),w.B=n),a.a.za(w.ca,e).length&&(k.beforeRemove&&(u.push(w),z.push(w),w.ja===d?w=null:f[C]=w),w&&x.push.apply(x,w.ca)));t++;break;case"retained":m(C,t++);break;case"added":E!==n?m(C,E):(w={ja:B.value,qb:a.N(v++)},u.push(w),z.push(w),r||(p[C]=w))}a.a.e.set(e,c,u);h(k.beforeMove,D);a.a.q(x,k.beforeRemove?a.$:a.removeNode);for(var C=0,r=a.f.firstChild(e),F;w=z[C];C++){w.ca||a.a.extend(w,b(e,g,w.ja,l,w.qb));for(t=0;s=w.ca[t];r=s.nextSibling,F=s,t++)s!==r&&a.f.gc(e,s,F);!w.Wc&&l&&(l(w.ja,w.ca,w.qb),w.Wc=!0)}h(k.beforeRemove,f);for(C=0;C<f.length;++C)f[C]&&(f[C].ja=d);h(k.afterMove,D);h(k.afterAdd,p)}})();a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.Bb);a.W=function(){this.allowTemplateRewriting=!1};a.W.prototype=new a.O;a.W.prototype.renderTemplateSource=function(b,c,d,e){if(c=(9>a.a.C?0:b.nodes)?b.nodes():null)return a.a.V(c.cloneNode(!0).childNodes);b=b.text();return a.a.ma(b,e)};a.W.sb=new a.W;a.Db(a.W.sb);a.b("nativeTemplateEngine",a.W);(function(){a.vb=function(){var a=this.$c=function(){if(!v||!v.tmpl)return 0;try{if(0<=v.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,f,g){g=g||u;f=f||{};if(2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var k=b.data("precompiled");k||(k=b.text()||"",k=v.template(null,"{{ko_with $item.koBindingContext}}"+k+"{{/ko_with}}"),b.data("precompiled",k));b=[e.$data];e=v.extend({koBindingContext:e},f.templateOptions);e=v.tmpl(k,b,e);e.appendTo(g.createElement("div"));v.fragments={};return e};this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"};this.addTemplate=function(a,b){u.write("<script type='text/html' id='"+a+"'>"+b+"\x3c/script>")};0<a&&(v.tmpl.tag.ko_code={open:"__.push($1 || '');"},v.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};a.vb.prototype=new a.O;var b=new a.vb;0<b.$c&&a.Db(b);a.b("jqueryTmplTemplateEngine",a.vb)})()})})();})();
/**
 * @license
 * lodash 3.10.1 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash modern -o ./lodash.js`
 */
;(function(){function n(n,t){if(n!==t){var r=null===n,e=n===w,u=n===n,o=null===t,i=t===w,f=t===t;if(n>t&&!o||!u||r&&!i&&f||e&&f)return 1;if(n<t&&!r||!f||o&&!e&&u||i&&u)return-1}return 0}function t(n,t,r){for(var e=n.length,u=r?e:-1;r?u--:++u<e;)if(t(n[u],u,n))return u;return-1}function r(n,t,r){if(t!==t)return p(n,r);r-=1;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function e(n){return typeof n=="function"||false}function u(n){return null==n?"":n+""}function o(n,t){for(var r=-1,e=n.length;++r<e&&-1<t.indexOf(n.charAt(r)););
return r}function i(n,t){for(var r=n.length;r--&&-1<t.indexOf(n.charAt(r)););return r}function f(t,r){return n(t.a,r.a)||t.b-r.b}function a(n){return Nn[n]}function c(n){return Tn[n]}function l(n,t,r){return t?n=Bn[n]:r&&(n=Dn[n]),"\\"+n}function s(n){return"\\"+Dn[n]}function p(n,t,r){var e=n.length;for(t+=r?0:-1;r?t--:++t<e;){var u=n[t];if(u!==u)return t}return-1}function h(n){return!!n&&typeof n=="object"}function _(n){return 160>=n&&9<=n&&13>=n||32==n||160==n||5760==n||6158==n||8192<=n&&(8202>=n||8232==n||8233==n||8239==n||8287==n||12288==n||65279==n);
}function v(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;)n[r]===t&&(n[r]=z,o[++u]=r);return o}function g(n){for(var t=-1,r=n.length;++t<r&&_(n.charCodeAt(t)););return t}function y(n){for(var t=n.length;t--&&_(n.charCodeAt(t)););return t}function d(n){return Ln[n]}function m(_){function Nn(n){if(h(n)&&!(Oo(n)||n instanceof zn)){if(n instanceof Ln)return n;if(nu.call(n,"__chain__")&&nu.call(n,"__wrapped__"))return Mr(n)}return new Ln(n)}function Tn(){}function Ln(n,t,r){this.__wrapped__=n,this.__actions__=r||[],
this.__chain__=!!t}function zn(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=false,this.__iteratees__=[],this.__takeCount__=Ru,this.__views__=[]}function Bn(){this.__data__={}}function Dn(n){var t=n?n.length:0;for(this.data={hash:gu(null),set:new lu};t--;)this.push(n[t])}function Mn(n,t){var r=n.data;return(typeof t=="string"||ge(t)?r.set.has(t):r.hash[t])?0:-1}function qn(n,t){var r=-1,e=n.length;for(t||(t=Be(e));++r<e;)t[r]=n[r];return t}function Pn(n,t){for(var r=-1,e=n.length;++r<e&&false!==t(n[r],r,n););
return n}function Kn(n,t){for(var r=-1,e=n.length;++r<e;)if(!t(n[r],r,n))return false;return true}function Vn(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;){var i=n[r];t(i,r,n)&&(o[++u]=i)}return o}function Gn(n,t){for(var r=-1,e=n.length,u=Be(e);++r<e;)u[r]=t(n[r],r,n);return u}function Jn(n,t){for(var r=-1,e=t.length,u=n.length;++r<e;)n[u+r]=t[r];return n}function Xn(n,t,r,e){var u=-1,o=n.length;for(e&&o&&(r=n[++u]);++u<o;)r=t(r,n[u],u,n);return r}function Hn(n,t){for(var r=-1,e=n.length;++r<e;)if(t(n[r],r,n))return true;
return false}function Qn(n,t,r,e){return n!==w&&nu.call(e,r)?n:t}function nt(n,t,r){for(var e=-1,u=zo(t),o=u.length;++e<o;){var i=u[e],f=n[i],a=r(f,t[i],i,n,t);(a===a?a===f:f!==f)&&(f!==w||i in n)||(n[i]=a)}return n}function tt(n,t){return null==t?n:et(t,zo(t),n)}function rt(n,t){for(var r=-1,e=null==n,u=!e&&Er(n),o=u?n.length:0,i=t.length,f=Be(i);++r<i;){var a=t[r];f[r]=u?Cr(a,o)?n[a]:w:e?w:n[a]}return f}function et(n,t,r){r||(r={});for(var e=-1,u=t.length;++e<u;){var o=t[e];r[o]=n[o]}return r}function ut(n,t,r){
var e=typeof n;return"function"==e?t===w?n:Bt(n,t,r):null==n?Fe:"object"==e?bt(n):t===w?ze(n):xt(n,t)}function ot(n,t,r,e,u,o,i){var f;if(r&&(f=u?r(n,e,u):r(n)),f!==w)return f;if(!ge(n))return n;if(e=Oo(n)){if(f=kr(n),!t)return qn(n,f)}else{var a=ru.call(n),c=a==K;if(a!=Z&&a!=B&&(!c||u))return Fn[a]?Rr(n,a,t):u?n:{};if(f=Ir(c?{}:n),!t)return tt(f,n)}for(o||(o=[]),i||(i=[]),u=o.length;u--;)if(o[u]==n)return i[u];return o.push(n),i.push(f),(e?Pn:_t)(n,function(e,u){f[u]=ot(e,t,r,u,n,o,i)}),f}function it(n,t,r){
if(typeof n!="function")throw new Ge(L);return su(function(){n.apply(w,r)},t)}function ft(n,t){var e=n?n.length:0,u=[];if(!e)return u;var o=-1,i=xr(),f=i===r,a=f&&t.length>=F&&gu&&lu?new Dn(t):null,c=t.length;a&&(i=Mn,f=false,t=a);n:for(;++o<e;)if(a=n[o],f&&a===a){for(var l=c;l--;)if(t[l]===a)continue n;u.push(a)}else 0>i(t,a,0)&&u.push(a);return u}function at(n,t){var r=true;return Su(n,function(n,e,u){return r=!!t(n,e,u)}),r}function ct(n,t,r,e){var u=e,o=u;return Su(n,function(n,i,f){i=+t(n,i,f),(r(i,u)||i===e&&i===o)&&(u=i,
o=n)}),o}function lt(n,t){var r=[];return Su(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function st(n,t,r,e){var u;return r(n,function(n,r,o){return t(n,r,o)?(u=e?r:n,false):void 0}),u}function pt(n,t,r,e){e||(e=[]);for(var u=-1,o=n.length;++u<o;){var i=n[u];h(i)&&Er(i)&&(r||Oo(i)||pe(i))?t?pt(i,t,r,e):Jn(e,i):r||(e[e.length]=i)}return e}function ht(n,t){Nu(n,t,Re)}function _t(n,t){return Nu(n,t,zo)}function vt(n,t){return Tu(n,t,zo)}function gt(n,t){for(var r=-1,e=t.length,u=-1,o=[];++r<e;){var i=t[r];
ve(n[i])&&(o[++u]=i)}return o}function yt(n,t,r){if(null!=n){r!==w&&r in Br(n)&&(t=[r]),r=0;for(var e=t.length;null!=n&&r<e;)n=n[t[r++]];return r&&r==e?n:w}}function dt(n,t,r,e,u,o){if(n===t)n=true;else if(null==n||null==t||!ge(n)&&!h(t))n=n!==n&&t!==t;else n:{var i=dt,f=Oo(n),a=Oo(t),c=D,l=D;f||(c=ru.call(n),c==B?c=Z:c!=Z&&(f=xe(n))),a||(l=ru.call(t),l==B?l=Z:l!=Z&&xe(t));var s=c==Z,a=l==Z,l=c==l;if(!l||f||s){if(!e&&(c=s&&nu.call(n,"__wrapped__"),a=a&&nu.call(t,"__wrapped__"),c||a)){n=i(c?n.value():n,a?t.value():t,r,e,u,o);
break n}if(l){for(u||(u=[]),o||(o=[]),c=u.length;c--;)if(u[c]==n){n=o[c]==t;break n}u.push(n),o.push(t),n=(f?yr:mr)(n,t,i,r,e,u,o),u.pop(),o.pop()}else n=false}else n=dr(n,t,c)}return n}function mt(n,t,r){var e=t.length,u=e,o=!r;if(null==n)return!u;for(n=Br(n);e--;){var i=t[e];if(o&&i[2]?i[1]!==n[i[0]]:!(i[0]in n))return false}for(;++e<u;){var i=t[e],f=i[0],a=n[f],c=i[1];if(o&&i[2]){if(a===w&&!(f in n))return false}else if(i=r?r(a,c,f):w,i===w?!dt(c,a,r,true):!i)return false}return true}function wt(n,t){var r=-1,e=Er(n)?Be(n.length):[];
return Su(n,function(n,u,o){e[++r]=t(n,u,o)}),e}function bt(n){var t=Ar(n);if(1==t.length&&t[0][2]){var r=t[0][0],e=t[0][1];return function(n){return null==n?false:n[r]===e&&(e!==w||r in Br(n))}}return function(n){return mt(n,t)}}function xt(n,t){var r=Oo(n),e=Wr(n)&&t===t&&!ge(t),u=n+"";return n=Dr(n),function(o){if(null==o)return false;var i=u;if(o=Br(o),!(!r&&e||i in o)){if(o=1==n.length?o:yt(o,Et(n,0,-1)),null==o)return false;i=Zr(n),o=Br(o)}return o[i]===t?t!==w||i in o:dt(t,o[i],w,true)}}function At(n,t,r,e,u){
if(!ge(n))return n;var o=Er(t)&&(Oo(t)||xe(t)),i=o?w:zo(t);return Pn(i||t,function(f,a){if(i&&(a=f,f=t[a]),h(f)){e||(e=[]),u||(u=[]);n:{for(var c=a,l=e,s=u,p=l.length,_=t[c];p--;)if(l[p]==_){n[c]=s[p];break n}var p=n[c],v=r?r(p,_,c,n,t):w,g=v===w;g&&(v=_,Er(_)&&(Oo(_)||xe(_))?v=Oo(p)?p:Er(p)?qn(p):[]:me(_)||pe(_)?v=pe(p)?ke(p):me(p)?p:{}:g=false),l.push(_),s.push(v),g?n[c]=At(v,_,r,l,s):(v===v?v!==p:p===p)&&(n[c]=v)}}else c=n[a],l=r?r(c,f,a,n,t):w,(s=l===w)&&(l=f),l===w&&(!o||a in n)||!s&&(l===l?l===c:c!==c)||(n[a]=l);
}),n}function jt(n){return function(t){return null==t?w:t[n]}}function kt(n){var t=n+"";return n=Dr(n),function(r){return yt(r,n,t)}}function It(n,t){for(var r=n?t.length:0;r--;){var e=t[r];if(e!=u&&Cr(e)){var u=e;pu.call(n,e,1)}}}function Rt(n,t){return n+yu(ku()*(t-n+1))}function Ot(n,t,r,e,u){return u(n,function(n,u,o){r=e?(e=false,n):t(r,n,u,o)}),r}function Et(n,t,r){var e=-1,u=n.length;for(t=null==t?0:+t||0,0>t&&(t=-t>u?0:u+t),r=r===w||r>u?u:+r||0,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Be(u);++e<u;)r[e]=n[e+t];
return r}function Ct(n,t){var r;return Su(n,function(n,e,u){return r=t(n,e,u),!r}),!!r}function Ut(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].c;return n}function Wt(t,r,e){var u=wr(),o=-1;return r=Gn(r,function(n){return u(n)}),t=wt(t,function(n){return{a:Gn(r,function(t){return t(n)}),b:++o,c:n}}),Ut(t,function(t,r){var u;n:{for(var o=-1,i=t.a,f=r.a,a=i.length,c=e.length;++o<a;)if(u=n(i[o],f[o])){if(o>=c)break n;o=e[o],u*="asc"===o||true===o?1:-1;break n}u=t.b-r.b}return u})}function $t(n,t){
var r=0;return Su(n,function(n,e,u){r+=+t(n,e,u)||0}),r}function St(n,t){var e=-1,u=xr(),o=n.length,i=u===r,f=i&&o>=F,a=f&&gu&&lu?new Dn(void 0):null,c=[];a?(u=Mn,i=false):(f=false,a=t?[]:c);n:for(;++e<o;){var l=n[e],s=t?t(l,e,n):l;if(i&&l===l){for(var p=a.length;p--;)if(a[p]===s)continue n;t&&a.push(s),c.push(l)}else 0>u(a,s,0)&&((t||f)&&a.push(s),c.push(l))}return c}function Ft(n,t){for(var r=-1,e=t.length,u=Be(e);++r<e;)u[r]=n[t[r]];return u}function Nt(n,t,r,e){for(var u=n.length,o=e?u:-1;(e?o--:++o<u)&&t(n[o],o,n););
return r?Et(n,e?0:o,e?o+1:u):Et(n,e?o+1:0,e?u:o)}function Tt(n,t){var r=n;r instanceof zn&&(r=r.value());for(var e=-1,u=t.length;++e<u;)var o=t[e],r=o.func.apply(o.thisArg,Jn([r],o.args));return r}function Lt(n,t,r){var e=0,u=n?n.length:e;if(typeof t=="number"&&t===t&&u<=Eu){for(;e<u;){var o=e+u>>>1,i=n[o];(r?i<=t:i<t)&&null!==i?e=o+1:u=o}return u}return zt(n,t,Fe,r)}function zt(n,t,r,e){t=r(t);for(var u=0,o=n?n.length:0,i=t!==t,f=null===t,a=t===w;u<o;){var c=yu((u+o)/2),l=r(n[c]),s=l!==w,p=l===l;
(i?p||e:f?p&&s&&(e||null!=l):a?p&&(e||s):null==l?0:e?l<=t:l<t)?u=c+1:o=c}return xu(o,Ou)}function Bt(n,t,r){if(typeof n!="function")return Fe;if(t===w)return n;switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,o){return n.call(t,r,e,u,o)};case 5:return function(r,e,u,o,i){return n.call(t,r,e,u,o,i)}}return function(){return n.apply(t,arguments)}}function Dt(n){var t=new ou(n.byteLength);return new hu(t).set(new hu(n)),
t}function Mt(n,t,r){for(var e=r.length,u=-1,o=bu(n.length-e,0),i=-1,f=t.length,a=Be(f+o);++i<f;)a[i]=t[i];for(;++u<e;)a[r[u]]=n[u];for(;o--;)a[i++]=n[u++];return a}function qt(n,t,r){for(var e=-1,u=r.length,o=-1,i=bu(n.length-u,0),f=-1,a=t.length,c=Be(i+a);++o<i;)c[o]=n[o];for(i=o;++f<a;)c[i+f]=t[f];for(;++e<u;)c[i+r[e]]=n[o++];return c}function Pt(n,t){return function(r,e,u){var o=t?t():{};if(e=wr(e,u,3),Oo(r)){u=-1;for(var i=r.length;++u<i;){var f=r[u];n(o,f,e(f,u,r),r)}}else Su(r,function(t,r,u){
n(o,t,e(t,r,u),u)});return o}}function Kt(n){return le(function(t,r){var e=-1,u=null==t?0:r.length,o=2<u?r[u-2]:w,i=2<u?r[2]:w,f=1<u?r[u-1]:w;for(typeof o=="function"?(o=Bt(o,f,5),u-=2):(o=typeof f=="function"?f:w,u-=o?1:0),i&&Ur(r[0],r[1],i)&&(o=3>u?w:o,u=1);++e<u;)(i=r[e])&&n(t,i,o);return t})}function Vt(n,t){return function(r,e){var u=r?Bu(r):0;if(!Sr(u))return n(r,e);for(var o=t?u:-1,i=Br(r);(t?o--:++o<u)&&false!==e(i[o],o,i););return r}}function Zt(n){return function(t,r,e){var u=Br(t);e=e(t);for(var o=e.length,i=n?o:-1;n?i--:++i<o;){
var f=e[i];if(false===r(u[f],f,u))break}return t}}function Yt(n,t){function r(){return(this&&this!==Zn&&this instanceof r?e:n).apply(t,arguments)}var e=Jt(n);return r}function Gt(n){return function(t){var r=-1;t=$e(Ce(t));for(var e=t.length,u="";++r<e;)u=n(u,t[r],r);return u}}function Jt(n){return function(){var t=arguments;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:
return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=$u(n.prototype),t=n.apply(r,t);return ge(t)?t:r}}function Xt(n){function t(r,e,u){return u&&Ur(r,e,u)&&(e=w),r=gr(r,n,w,w,w,w,w,e),r.placeholder=t.placeholder,r}return t}function Ht(n,t){return le(function(r){var e=r[0];return null==e?e:(r.push(t),n.apply(w,r))})}function Qt(n,t){return function(r,e,u){if(u&&Ur(r,e,u)&&(e=w),e=wr(e,u,3),1==e.length){
u=r=Oo(r)?r:zr(r);for(var o=e,i=-1,f=u.length,a=t,c=a;++i<f;){var l=u[i],s=+o(l);n(s,a)&&(a=s,c=l)}if(u=c,!r.length||u!==t)return u}return ct(r,e,n,t)}}function nr(n,r){return function(e,u,o){return u=wr(u,o,3),Oo(e)?(u=t(e,u,r),-1<u?e[u]:w):st(e,u,n)}}function tr(n){return function(r,e,u){return r&&r.length?(e=wr(e,u,3),t(r,e,n)):-1}}function rr(n){return function(t,r,e){return r=wr(r,e,3),st(t,r,n,true)}}function er(n){return function(){for(var t,r=arguments.length,e=n?r:-1,u=0,o=Be(r);n?e--:++e<r;){
var i=o[u++]=arguments[e];if(typeof i!="function")throw new Ge(L);!t&&Ln.prototype.thru&&"wrapper"==br(i)&&(t=new Ln([],true))}for(e=t?-1:r;++e<r;){var i=o[e],u=br(i),f="wrapper"==u?zu(i):w;t=f&&$r(f[0])&&f[1]==(E|k|R|C)&&!f[4].length&&1==f[9]?t[br(f[0])].apply(t,f[3]):1==i.length&&$r(i)?t[u]():t.thru(i)}return function(){var n=arguments,e=n[0];if(t&&1==n.length&&Oo(e)&&e.length>=F)return t.plant(e).value();for(var u=0,n=r?o[u].apply(this,n):e;++u<r;)n=o[u].call(this,n);return n}}}function ur(n,t){
return function(r,e,u){return typeof e=="function"&&u===w&&Oo(r)?n(r,e):t(r,Bt(e,u,3))}}function or(n){return function(t,r,e){return(typeof r!="function"||e!==w)&&(r=Bt(r,e,3)),n(t,r,Re)}}function ir(n){return function(t,r,e){return(typeof r!="function"||e!==w)&&(r=Bt(r,e,3)),n(t,r)}}function fr(n){return function(t,r,e){var u={};return r=wr(r,e,3),_t(t,function(t,e,o){o=r(t,e,o),e=n?o:e,t=n?t:o,u[e]=t}),u}}function ar(n){return function(t,r,e){return t=u(t),(n?t:"")+pr(t,r,e)+(n?"":t)}}function cr(n){
var t=le(function(r,e){var u=v(e,t.placeholder);return gr(r,n,w,e,u)});return t}function lr(n,t){return function(r,e,u,o){var i=3>arguments.length;return typeof e=="function"&&o===w&&Oo(r)?n(r,e,u,i):Ot(r,wr(e,o,4),u,i,t)}}function sr(n,t,r,e,u,o,i,f,a,c){function l(){for(var m=arguments.length,b=m,j=Be(m);b--;)j[b]=arguments[b];if(e&&(j=Mt(j,e,u)),o&&(j=qt(j,o,i)),_||y){var b=l.placeholder,k=v(j,b),m=m-k.length;if(m<c){var I=f?qn(f):w,m=bu(c-m,0),E=_?k:w,k=_?w:k,C=_?j:w,j=_?w:j;return t|=_?R:O,t&=~(_?O:R),
g||(t&=~(x|A)),j=[n,t,r,C,E,j,k,I,a,m],I=sr.apply(w,j),$r(n)&&Du(I,j),I.placeholder=b,I}}if(b=p?r:this,I=h?b[n]:n,f)for(m=j.length,E=xu(f.length,m),k=qn(j);E--;)C=f[E],j[E]=Cr(C,m)?k[C]:w;return s&&a<j.length&&(j.length=a),this&&this!==Zn&&this instanceof l&&(I=d||Jt(n)),I.apply(b,j)}var s=t&E,p=t&x,h=t&A,_=t&k,g=t&j,y=t&I,d=h?w:Jt(n);return l}function pr(n,t,r){return n=n.length,t=+t,n<t&&mu(t)?(t-=n,r=null==r?" ":r+"",Ue(r,vu(t/r.length)).slice(0,t)):""}function hr(n,t,r,e){function u(){for(var t=-1,f=arguments.length,a=-1,c=e.length,l=Be(c+f);++a<c;)l[a]=e[a];
for(;f--;)l[a++]=arguments[++t];return(this&&this!==Zn&&this instanceof u?i:n).apply(o?r:this,l)}var o=t&x,i=Jt(n);return u}function _r(n){var t=Pe[n];return function(n,r){return(r=r===w?0:+r||0)?(r=au(10,r),t(n*r)/r):t(n)}}function vr(n){return function(t,r,e,u){var o=wr(e);return null==e&&o===ut?Lt(t,r,n):zt(t,r,o(e,u,1),n)}}function gr(n,t,r,e,u,o,i,f){var a=t&A;if(!a&&typeof n!="function")throw new Ge(L);var c=e?e.length:0;if(c||(t&=~(R|O),e=u=w),c-=u?u.length:0,t&O){var l=e,s=u;e=u=w}var p=a?w:zu(n);
return r=[n,t,r,e,u,l,s,o,i,f],p&&(e=r[1],t=p[1],f=e|t,u=t==E&&e==k||t==E&&e==C&&r[7].length<=p[8]||t==(E|C)&&e==k,(f<E||u)&&(t&x&&(r[2]=p[2],f|=e&x?0:j),(e=p[3])&&(u=r[3],r[3]=u?Mt(u,e,p[4]):qn(e),r[4]=u?v(r[3],z):qn(p[4])),(e=p[5])&&(u=r[5],r[5]=u?qt(u,e,p[6]):qn(e),r[6]=u?v(r[5],z):qn(p[6])),(e=p[7])&&(r[7]=qn(e)),t&E&&(r[8]=null==r[8]?p[8]:xu(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=f),t=r[1],f=r[9]),r[9]=null==f?a?0:n.length:bu(f-c,0)||0,(p?Lu:Du)(t==x?Yt(r[0],r[2]):t!=R&&t!=(x|R)||r[4].length?sr.apply(w,r):hr.apply(w,r),r);
}function yr(n,t,r,e,u,o,i){var f=-1,a=n.length,c=t.length;if(a!=c&&(!u||c<=a))return false;for(;++f<a;){var l=n[f],c=t[f],s=e?e(u?c:l,u?l:c,f):w;if(s!==w){if(s)continue;return false}if(u){if(!Hn(t,function(n){return l===n||r(l,n,e,u,o,i)}))return false}else if(l!==c&&!r(l,c,e,u,o,i))return false}return true}function dr(n,t,r){switch(r){case M:case q:return+n==+t;case P:return n.name==t.name&&n.message==t.message;case V:return n!=+n?t!=+t:n==+t;case Y:case G:return n==t+""}return false}function mr(n,t,r,e,u,o,i){var f=zo(n),a=f.length,c=zo(t).length;
if(a!=c&&!u)return false;for(c=a;c--;){var l=f[c];if(!(u?l in t:nu.call(t,l)))return false}for(var s=u;++c<a;){var l=f[c],p=n[l],h=t[l],_=e?e(u?h:p,u?p:h,l):w;if(_===w?!r(p,h,e,u,o,i):!_)return false;s||(s="constructor"==l)}return s||(r=n.constructor,e=t.constructor,!(r!=e&&"constructor"in n&&"constructor"in t)||typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)?true:false}function wr(n,t,r){var e=Nn.callback||Se,e=e===Se?ut:e;return r?e(n,t,r):e}function br(n){for(var t=n.name+"",r=Wu[t],e=r?r.length:0;e--;){
var u=r[e],o=u.func;if(null==o||o==n)return u.name}return t}function xr(n,t,e){var u=Nn.indexOf||Vr,u=u===Vr?r:u;return n?u(n,t,e):u}function Ar(n){n=Oe(n);for(var t=n.length;t--;){var r=n[t][1];n[t][2]=r===r&&!ge(r)}return n}function jr(n,t){var r=null==n?w:n[t];return ye(r)?r:w}function kr(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&nu.call(n,"index")&&(r.index=n.index,r.input=n.input),r}function Ir(n){return n=n.constructor,typeof n=="function"&&n instanceof n||(n=Ve),
new n}function Rr(n,t,r){var e=n.constructor;switch(t){case J:return Dt(n);case M:case q:return new e(+n);case X:case H:case Q:case nn:case tn:case rn:case en:case un:case on:return t=n.buffer,new e(r?Dt(t):t,n.byteOffset,n.length);case V:case G:return new e(n);case Y:var u=new e(n.source,kn.exec(n));u.lastIndex=n.lastIndex}return u}function Or(n,t,r){return null==n||Wr(t,n)||(t=Dr(t),n=1==t.length?n:yt(n,Et(t,0,-1)),t=Zr(t)),t=null==n?n:n[t],null==t?w:t.apply(n,r)}function Er(n){return null!=n&&Sr(Bu(n));
}function Cr(n,t){return n=typeof n=="number"||On.test(n)?+n:-1,t=null==t?Cu:t,-1<n&&0==n%1&&n<t}function Ur(n,t,r){if(!ge(r))return false;var e=typeof t;return("number"==e?Er(r)&&Cr(t,r.length):"string"==e&&t in r)?(t=r[t],n===n?n===t:t!==t):false}function Wr(n,t){var r=typeof n;return"string"==r&&dn.test(n)||"number"==r?true:Oo(n)?false:!yn.test(n)||null!=t&&n in Br(t)}function $r(n){var t=br(n),r=Nn[t];return typeof r=="function"&&t in zn.prototype?n===r?true:(t=zu(r),!!t&&n===t[0]):false}function Sr(n){return typeof n=="number"&&-1<n&&0==n%1&&n<=Cu;
}function Fr(n,t){return n===w?t:Eo(n,t,Fr)}function Nr(n,t){n=Br(n);for(var r=-1,e=t.length,u={};++r<e;){var o=t[r];o in n&&(u[o]=n[o])}return u}function Tr(n,t){var r={};return ht(n,function(n,e,u){t(n,e,u)&&(r[e]=n)}),r}function Lr(n){for(var t=Re(n),r=t.length,e=r&&n.length,u=!!e&&Sr(e)&&(Oo(n)||pe(n)),o=-1,i=[];++o<r;){var f=t[o];(u&&Cr(f,e)||nu.call(n,f))&&i.push(f)}return i}function zr(n){return null==n?[]:Er(n)?ge(n)?n:Ve(n):Ee(n)}function Br(n){return ge(n)?n:Ve(n)}function Dr(n){if(Oo(n))return n;
var t=[];return u(n).replace(mn,function(n,r,e,u){t.push(e?u.replace(An,"$1"):r||n)}),t}function Mr(n){return n instanceof zn?n.clone():new Ln(n.__wrapped__,n.__chain__,qn(n.__actions__))}function qr(n,t,r){return n&&n.length?((r?Ur(n,t,r):null==t)&&(t=1),Et(n,0>t?0:t)):[]}function Pr(n,t,r){var e=n?n.length:0;return e?((r?Ur(n,t,r):null==t)&&(t=1),t=e-(+t||0),Et(n,0,0>t?0:t)):[]}function Kr(n){return n?n[0]:w}function Vr(n,t,e){var u=n?n.length:0;if(!u)return-1;if(typeof e=="number")e=0>e?bu(u+e,0):e;else if(e)return e=Lt(n,t),
e<u&&(t===t?t===n[e]:n[e]!==n[e])?e:-1;return r(n,t,e||0)}function Zr(n){var t=n?n.length:0;return t?n[t-1]:w}function Yr(n){return qr(n,1)}function Gr(n,t,e,u){if(!n||!n.length)return[];null!=t&&typeof t!="boolean"&&(u=e,e=Ur(n,t,u)?w:t,t=false);var o=wr();if((null!=e||o!==ut)&&(e=o(e,u,3)),t&&xr()===r){t=e;var i;e=-1,u=n.length;for(var o=-1,f=[];++e<u;){var a=n[e],c=t?t(a,e,n):a;e&&i===c||(i=c,f[++o]=a)}n=f}else n=St(n,e);return n}function Jr(n){if(!n||!n.length)return[];var t=-1,r=0;n=Vn(n,function(n){
return Er(n)?(r=bu(n.length,r),true):void 0});for(var e=Be(r);++t<r;)e[t]=Gn(n,jt(t));return e}function Xr(n,t,r){return n&&n.length?(n=Jr(n),null==t?n:(t=Bt(t,r,4),Gn(n,function(n){return Xn(n,t,w,true)}))):[]}function Hr(n,t){var r=-1,e=n?n.length:0,u={};for(!e||t||Oo(n[0])||(t=[]);++r<e;){var o=n[r];t?u[o]=t[r]:o&&(u[o[0]]=o[1])}return u}function Qr(n){return n=Nn(n),n.__chain__=true,n}function ne(n,t,r){return t.call(r,n)}function te(n,t,r){var e=Oo(n)?Kn:at;return r&&Ur(n,t,r)&&(t=w),(typeof t!="function"||r!==w)&&(t=wr(t,r,3)),
e(n,t)}function re(n,t,r){var e=Oo(n)?Vn:lt;return t=wr(t,r,3),e(n,t)}function ee(n,t,r,e){var u=n?Bu(n):0;return Sr(u)||(n=Ee(n),u=n.length),r=typeof r!="number"||e&&Ur(t,r,e)?0:0>r?bu(u+r,0):r||0,typeof n=="string"||!Oo(n)&&be(n)?r<=u&&-1<n.indexOf(t,r):!!u&&-1<xr(n,t,r)}function ue(n,t,r){var e=Oo(n)?Gn:wt;return t=wr(t,r,3),e(n,t)}function oe(n,t,r){if(r?Ur(n,t,r):null==t){n=zr(n);var e=n.length;return 0<e?n[Rt(0,e-1)]:w}r=-1,n=je(n);var e=n.length,u=e-1;for(t=xu(0>t?0:+t||0,e);++r<t;){var e=Rt(r,u),o=n[e];
n[e]=n[r],n[r]=o}return n.length=t,n}function ie(n,t,r){var e=Oo(n)?Hn:Ct;return r&&Ur(n,t,r)&&(t=w),(typeof t!="function"||r!==w)&&(t=wr(t,r,3)),e(n,t)}function fe(n,t){var r;if(typeof t!="function"){if(typeof n!="function")throw new Ge(L);var e=n;n=t,t=e}return function(){return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=w),r}}function ae(n,t,r){function e(t,r){r&&iu(r),a=p=h=w,t&&(_=ho(),c=n.apply(s,f),p||a||(f=s=w))}function u(){var n=t-(ho()-l);0>=n||n>t?e(h,a):p=su(u,n)}function o(){e(g,p);
}function i(){if(f=arguments,l=ho(),s=this,h=g&&(p||!y),false===v)var r=y&&!p;else{a||y||(_=l);var e=v-(l-_),i=0>=e||e>v;i?(a&&(a=iu(a)),_=l,c=n.apply(s,f)):a||(a=su(o,e))}return i&&p?p=iu(p):p||t===v||(p=su(u,t)),r&&(i=true,c=n.apply(s,f)),!i||p||a||(f=s=w),c}var f,a,c,l,s,p,h,_=0,v=false,g=true;if(typeof n!="function")throw new Ge(L);if(t=0>t?0:+t||0,true===r)var y=true,g=false;else ge(r)&&(y=!!r.leading,v="maxWait"in r&&bu(+r.maxWait||0,t),g="trailing"in r?!!r.trailing:g);return i.cancel=function(){p&&iu(p),a&&iu(a),
_=0,a=p=h=w},i}function ce(n,t){function r(){var e=arguments,u=t?t.apply(this,e):e[0],o=r.cache;return o.has(u)?o.get(u):(e=n.apply(this,e),r.cache=o.set(u,e),e)}if(typeof n!="function"||t&&typeof t!="function")throw new Ge(L);return r.cache=new ce.Cache,r}function le(n,t){if(typeof n!="function")throw new Ge(L);return t=bu(t===w?n.length-1:+t||0,0),function(){for(var r=arguments,e=-1,u=bu(r.length-t,0),o=Be(u);++e<u;)o[e]=r[t+e];switch(t){case 0:return n.call(this,o);case 1:return n.call(this,r[0],o);
case 2:return n.call(this,r[0],r[1],o)}for(u=Be(t+1),e=-1;++e<t;)u[e]=r[e];return u[t]=o,n.apply(this,u)}}function se(n,t){return n>t}function pe(n){return h(n)&&Er(n)&&nu.call(n,"callee")&&!cu.call(n,"callee")}function he(n,t,r,e){return e=(r=typeof r=="function"?Bt(r,e,3):w)?r(n,t):w,e===w?dt(n,t,r):!!e}function _e(n){return h(n)&&typeof n.message=="string"&&ru.call(n)==P}function ve(n){return ge(n)&&ru.call(n)==K}function ge(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function ye(n){
return null==n?false:ve(n)?uu.test(Qe.call(n)):h(n)&&Rn.test(n)}function de(n){return typeof n=="number"||h(n)&&ru.call(n)==V}function me(n){var t;if(!h(n)||ru.call(n)!=Z||pe(n)||!(nu.call(n,"constructor")||(t=n.constructor,typeof t!="function"||t instanceof t)))return false;var r;return ht(n,function(n,t){r=t}),r===w||nu.call(n,r)}function we(n){return ge(n)&&ru.call(n)==Y}function be(n){return typeof n=="string"||h(n)&&ru.call(n)==G}function xe(n){return h(n)&&Sr(n.length)&&!!Sn[ru.call(n)]}function Ae(n,t){
return n<t}function je(n){var t=n?Bu(n):0;return Sr(t)?t?qn(n):[]:Ee(n)}function ke(n){return et(n,Re(n))}function Ie(n){return gt(n,Re(n))}function Re(n){if(null==n)return[];ge(n)||(n=Ve(n));for(var t=n.length,t=t&&Sr(t)&&(Oo(n)||pe(n))&&t||0,r=n.constructor,e=-1,r=typeof r=="function"&&r.prototype===n,u=Be(t),o=0<t;++e<t;)u[e]=e+"";for(var i in n)o&&Cr(i,t)||"constructor"==i&&(r||!nu.call(n,i))||u.push(i);return u}function Oe(n){n=Br(n);for(var t=-1,r=zo(n),e=r.length,u=Be(e);++t<e;){var o=r[t];
u[t]=[o,n[o]]}return u}function Ee(n){return Ft(n,zo(n))}function Ce(n){return(n=u(n))&&n.replace(En,a).replace(xn,"")}function Ue(n,t){var r="";if(n=u(n),t=+t,1>t||!n||!mu(t))return r;do t%2&&(r+=n),t=yu(t/2),n+=n;while(t);return r}function We(n,t,r){var e=n;return(n=u(n))?(r?Ur(e,t,r):null==t)?n.slice(g(n),y(n)+1):(t+="",n.slice(o(n,t),i(n,t)+1)):n}function $e(n,t,r){return r&&Ur(n,t,r)&&(t=w),n=u(n),n.match(t||Wn)||[]}function Se(n,t,r){return r&&Ur(n,t,r)&&(t=w),h(n)?Ne(n):ut(n,t)}function Fe(n){
return n}function Ne(n){return bt(ot(n,true))}function Te(n,t,r){if(null==r){var e=ge(t),u=e?zo(t):w;((u=u&&u.length?gt(t,u):w)?u.length:e)||(u=false,r=t,t=n,n=this)}u||(u=gt(t,zo(t)));var o=true,e=-1,i=ve(n),f=u.length;false===r?o=false:ge(r)&&"chain"in r&&(o=r.chain);for(;++e<f;){r=u[e];var a=t[r];n[r]=a,i&&(n.prototype[r]=function(t){return function(){var r=this.__chain__;if(o||r){var e=n(this.__wrapped__);return(e.__actions__=qn(this.__actions__)).push({func:t,args:arguments,thisArg:n}),e.__chain__=r,e}return t.apply(n,Jn([this.value()],arguments));
}}(a))}return n}function Le(){}function ze(n){return Wr(n)?jt(n):kt(n)}_=_?Yn.defaults(Zn.Object(),_,Yn.pick(Zn,$n)):Zn;var Be=_.Array,De=_.Date,Me=_.Error,qe=_.Function,Pe=_.Math,Ke=_.Number,Ve=_.Object,Ze=_.RegExp,Ye=_.String,Ge=_.TypeError,Je=Be.prototype,Xe=Ve.prototype,He=Ye.prototype,Qe=qe.prototype.toString,nu=Xe.hasOwnProperty,tu=0,ru=Xe.toString,eu=Zn._,uu=Ze("^"+Qe.call(nu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ou=_.ArrayBuffer,iu=_.clearTimeout,fu=_.parseFloat,au=Pe.pow,cu=Xe.propertyIsEnumerable,lu=jr(_,"Set"),su=_.setTimeout,pu=Je.splice,hu=_.Uint8Array,_u=jr(_,"WeakMap"),vu=Pe.ceil,gu=jr(Ve,"create"),yu=Pe.floor,du=jr(Be,"isArray"),mu=_.isFinite,wu=jr(Ve,"keys"),bu=Pe.max,xu=Pe.min,Au=jr(De,"now"),ju=_.parseInt,ku=Pe.random,Iu=Ke.NEGATIVE_INFINITY,Ru=Ke.POSITIVE_INFINITY,Ou=4294967294,Eu=2147483647,Cu=9007199254740991,Uu=_u&&new _u,Wu={};
Nn.support={},Nn.templateSettings={escape:_n,evaluate:vn,interpolate:gn,variable:"",imports:{_:Nn}};var $u=function(){function n(){}return function(t){if(ge(t)){n.prototype=t;var r=new n;n.prototype=w}return r||{}}}(),Su=Vt(_t),Fu=Vt(vt,true),Nu=Zt(),Tu=Zt(true),Lu=Uu?function(n,t){return Uu.set(n,t),n}:Fe,zu=Uu?function(n){return Uu.get(n)}:Le,Bu=jt("length"),Du=function(){var n=0,t=0;return function(r,e){var u=ho(),o=S-(u-t);if(t=u,0<o){if(++n>=$)return r}else n=0;return Lu(r,e)}}(),Mu=le(function(n,t){
return h(n)&&Er(n)?ft(n,pt(t,false,true)):[]}),qu=tr(),Pu=tr(true),Ku=le(function(n){for(var t=n.length,e=t,u=Be(l),o=xr(),i=o===r,f=[];e--;){var a=n[e]=Er(a=n[e])?a:[];u[e]=i&&120<=a.length&&gu&&lu?new Dn(e&&a):null}var i=n[0],c=-1,l=i?i.length:0,s=u[0];n:for(;++c<l;)if(a=i[c],0>(s?Mn(s,a):o(f,a,0))){for(e=t;--e;){var p=u[e];if(0>(p?Mn(p,a):o(n[e],a,0)))continue n}s&&s.push(a),f.push(a)}return f}),Vu=le(function(t,r){r=pt(r);var e=rt(t,r);return It(t,r.sort(n)),e}),Zu=vr(),Yu=vr(true),Gu=le(function(n){return St(pt(n,false,true));
}),Ju=le(function(n,t){return Er(n)?ft(n,t):[]}),Xu=le(Jr),Hu=le(function(n){var t=n.length,r=2<t?n[t-2]:w,e=1<t?n[t-1]:w;return 2<t&&typeof r=="function"?t-=2:(r=1<t&&typeof e=="function"?(--t,e):w,e=w),n.length=t,Xr(n,r,e)}),Qu=le(function(n){return n=pt(n),this.thru(function(t){t=Oo(t)?t:[Br(t)];for(var r=n,e=-1,u=t.length,o=-1,i=r.length,f=Be(u+i);++e<u;)f[e]=t[e];for(;++o<i;)f[e++]=r[o];return f})}),no=le(function(n,t){return rt(n,pt(t))}),to=Pt(function(n,t,r){nu.call(n,r)?++n[r]:n[r]=1}),ro=nr(Su),eo=nr(Fu,true),uo=ur(Pn,Su),oo=ur(function(n,t){
for(var r=n.length;r--&&false!==t(n[r],r,n););return n},Fu),io=Pt(function(n,t,r){nu.call(n,r)?n[r].push(t):n[r]=[t]}),fo=Pt(function(n,t,r){n[r]=t}),ao=le(function(n,t,r){var e=-1,u=typeof t=="function",o=Wr(t),i=Er(n)?Be(n.length):[];return Su(n,function(n){var f=u?t:o&&null!=n?n[t]:w;i[++e]=f?f.apply(n,r):Or(n,t,r)}),i}),co=Pt(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]}),lo=lr(Xn,Su),so=lr(function(n,t,r,e){var u=n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r},Fu),po=le(function(n,t){
if(null==n)return[];var r=t[2];return r&&Ur(t[0],t[1],r)&&(t.length=1),Wt(n,pt(t),[])}),ho=Au||function(){return(new De).getTime()},_o=le(function(n,t,r){var e=x;if(r.length)var u=v(r,_o.placeholder),e=e|R;return gr(n,e,t,r,u)}),vo=le(function(n,t){t=t.length?pt(t):Ie(n);for(var r=-1,e=t.length;++r<e;){var u=t[r];n[u]=gr(n[u],x,n)}return n}),go=le(function(n,t,r){var e=x|A;if(r.length)var u=v(r,go.placeholder),e=e|R;return gr(t,e,n,r,u)}),yo=Xt(k),mo=Xt(I),wo=le(function(n,t){return it(n,1,t)}),bo=le(function(n,t,r){
return it(n,t,r)}),xo=er(),Ao=er(true),jo=le(function(n,t){if(t=pt(t),typeof n!="function"||!Kn(t,e))throw new Ge(L);var r=t.length;return le(function(e){for(var u=xu(e.length,r);u--;)e[u]=t[u](e[u]);return n.apply(this,e)})}),ko=cr(R),Io=cr(O),Ro=le(function(n,t){return gr(n,C,w,w,w,pt(t))}),Oo=du||function(n){return h(n)&&Sr(n.length)&&ru.call(n)==D},Eo=Kt(At),Co=Kt(function(n,t,r){return r?nt(n,t,r):tt(n,t)}),Uo=Ht(Co,function(n,t){return n===w?t:n}),Wo=Ht(Eo,Fr),$o=rr(_t),So=rr(vt),Fo=or(Nu),No=or(Tu),To=ir(_t),Lo=ir(vt),zo=wu?function(n){
var t=null==n?w:n.constructor;return typeof t=="function"&&t.prototype===n||typeof n!="function"&&Er(n)?Lr(n):ge(n)?wu(n):[]}:Lr,Bo=fr(true),Do=fr(),Mo=le(function(n,t){if(null==n)return{};if("function"!=typeof t[0])return t=Gn(pt(t),Ye),Nr(n,ft(Re(n),t));var r=Bt(t[0],t[1],3);return Tr(n,function(n,t,e){return!r(n,t,e)})}),qo=le(function(n,t){return null==n?{}:"function"==typeof t[0]?Tr(n,Bt(t[0],t[1],3)):Nr(n,pt(t))}),Po=Gt(function(n,t,r){return t=t.toLowerCase(),n+(r?t.charAt(0).toUpperCase()+t.slice(1):t);
}),Ko=Gt(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),Vo=ar(),Zo=ar(true),Yo=Gt(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),Go=Gt(function(n,t,r){return n+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Jo=le(function(n,t){try{return n.apply(w,t)}catch(r){return _e(r)?r:new Me(r)}}),Xo=le(function(n,t){return function(r){return Or(r,n,t)}}),Ho=le(function(n,t){return function(r){return Or(n,r,t)}}),Qo=_r("ceil"),ni=_r("floor"),ti=Qt(se,Iu),ri=Qt(Ae,Ru),ei=_r("round");return Nn.prototype=Tn.prototype,
Ln.prototype=$u(Tn.prototype),Ln.prototype.constructor=Ln,zn.prototype=$u(Tn.prototype),zn.prototype.constructor=zn,Bn.prototype["delete"]=function(n){return this.has(n)&&delete this.__data__[n]},Bn.prototype.get=function(n){return"__proto__"==n?w:this.__data__[n]},Bn.prototype.has=function(n){return"__proto__"!=n&&nu.call(this.__data__,n)},Bn.prototype.set=function(n,t){return"__proto__"!=n&&(this.__data__[n]=t),this},Dn.prototype.push=function(n){var t=this.data;typeof n=="string"||ge(n)?t.set.add(n):t.hash[n]=true;
},ce.Cache=Bn,Nn.after=function(n,t){if(typeof t!="function"){if(typeof n!="function")throw new Ge(L);var r=n;n=t,t=r}return n=mu(n=+n)?n:0,function(){return 1>--n?t.apply(this,arguments):void 0}},Nn.ary=function(n,t,r){return r&&Ur(n,t,r)&&(t=w),t=n&&null==t?n.length:bu(+t||0,0),gr(n,E,w,w,w,w,t)},Nn.assign=Co,Nn.at=no,Nn.before=fe,Nn.bind=_o,Nn.bindAll=vo,Nn.bindKey=go,Nn.callback=Se,Nn.chain=Qr,Nn.chunk=function(n,t,r){t=(r?Ur(n,t,r):null==t)?1:bu(yu(t)||1,1),r=0;for(var e=n?n.length:0,u=-1,o=Be(vu(e/t));r<e;)o[++u]=Et(n,r,r+=t);
return o},Nn.compact=function(n){for(var t=-1,r=n?n.length:0,e=-1,u=[];++t<r;){var o=n[t];o&&(u[++e]=o)}return u},Nn.constant=function(n){return function(){return n}},Nn.countBy=to,Nn.create=function(n,t,r){var e=$u(n);return r&&Ur(n,t,r)&&(t=w),t?tt(e,t):e},Nn.curry=yo,Nn.curryRight=mo,Nn.debounce=ae,Nn.defaults=Uo,Nn.defaultsDeep=Wo,Nn.defer=wo,Nn.delay=bo,Nn.difference=Mu,Nn.drop=qr,Nn.dropRight=Pr,Nn.dropRightWhile=function(n,t,r){return n&&n.length?Nt(n,wr(t,r,3),true,true):[]},Nn.dropWhile=function(n,t,r){
return n&&n.length?Nt(n,wr(t,r,3),true):[]},Nn.fill=function(n,t,r,e){var u=n?n.length:0;if(!u)return[];for(r&&typeof r!="number"&&Ur(n,t,r)&&(r=0,e=u),u=n.length,r=null==r?0:+r||0,0>r&&(r=-r>u?0:u+r),e=e===w||e>u?u:+e||0,0>e&&(e+=u),u=r>e?0:e>>>0,r>>>=0;r<u;)n[r++]=t;return n},Nn.filter=re,Nn.flatten=function(n,t,r){var e=n?n.length:0;return r&&Ur(n,t,r)&&(t=false),e?pt(n,t):[]},Nn.flattenDeep=function(n){return n&&n.length?pt(n,true):[]},Nn.flow=xo,Nn.flowRight=Ao,Nn.forEach=uo,Nn.forEachRight=oo,Nn.forIn=Fo,
Nn.forInRight=No,Nn.forOwn=To,Nn.forOwnRight=Lo,Nn.functions=Ie,Nn.groupBy=io,Nn.indexBy=fo,Nn.initial=function(n){return Pr(n,1)},Nn.intersection=Ku,Nn.invert=function(n,t,r){r&&Ur(n,t,r)&&(t=w),r=-1;for(var e=zo(n),u=e.length,o={};++r<u;){var i=e[r],f=n[i];t?nu.call(o,f)?o[f].push(i):o[f]=[i]:o[f]=i}return o},Nn.invoke=ao,Nn.keys=zo,Nn.keysIn=Re,Nn.map=ue,Nn.mapKeys=Bo,Nn.mapValues=Do,Nn.matches=Ne,Nn.matchesProperty=function(n,t){return xt(n,ot(t,true))},Nn.memoize=ce,Nn.merge=Eo,Nn.method=Xo,Nn.methodOf=Ho,
Nn.mixin=Te,Nn.modArgs=jo,Nn.negate=function(n){if(typeof n!="function")throw new Ge(L);return function(){return!n.apply(this,arguments)}},Nn.omit=Mo,Nn.once=function(n){return fe(2,n)},Nn.pairs=Oe,Nn.partial=ko,Nn.partialRight=Io,Nn.partition=co,Nn.pick=qo,Nn.pluck=function(n,t){return ue(n,ze(t))},Nn.property=ze,Nn.propertyOf=function(n){return function(t){return yt(n,Dr(t),t+"")}},Nn.pull=function(){var n=arguments,t=n[0];if(!t||!t.length)return t;for(var r=0,e=xr(),u=n.length;++r<u;)for(var o=0,i=n[r];-1<(o=e(t,i,o));)pu.call(t,o,1);
return t},Nn.pullAt=Vu,Nn.range=function(n,t,r){r&&Ur(n,t,r)&&(t=r=w),n=+n||0,r=null==r?1:+r||0,null==t?(t=n,n=0):t=+t||0;var e=-1;t=bu(vu((t-n)/(r||1)),0);for(var u=Be(t);++e<t;)u[e]=n,n+=r;return u},Nn.rearg=Ro,Nn.reject=function(n,t,r){var e=Oo(n)?Vn:lt;return t=wr(t,r,3),e(n,function(n,r,e){return!t(n,r,e)})},Nn.remove=function(n,t,r){var e=[];if(!n||!n.length)return e;var u=-1,o=[],i=n.length;for(t=wr(t,r,3);++u<i;)r=n[u],t(r,u,n)&&(e.push(r),o.push(u));return It(n,o),e},Nn.rest=Yr,Nn.restParam=le,
Nn.set=function(n,t,r){if(null==n)return n;var e=t+"";t=null!=n[e]||Wr(t,n)?[e]:Dr(t);for(var e=-1,u=t.length,o=u-1,i=n;null!=i&&++e<u;){var f=t[e];ge(i)&&(e==o?i[f]=r:null==i[f]&&(i[f]=Cr(t[e+1])?[]:{})),i=i[f]}return n},Nn.shuffle=function(n){return oe(n,Ru)},Nn.slice=function(n,t,r){var e=n?n.length:0;return e?(r&&typeof r!="number"&&Ur(n,t,r)&&(t=0,r=e),Et(n,t,r)):[]},Nn.sortBy=function(n,t,r){if(null==n)return[];r&&Ur(n,t,r)&&(t=w);var e=-1;return t=wr(t,r,3),n=wt(n,function(n,r,u){return{a:t(n,r,u),
b:++e,c:n}}),Ut(n,f)},Nn.sortByAll=po,Nn.sortByOrder=function(n,t,r,e){return null==n?[]:(e&&Ur(t,r,e)&&(r=w),Oo(t)||(t=null==t?[]:[t]),Oo(r)||(r=null==r?[]:[r]),Wt(n,t,r))},Nn.spread=function(n){if(typeof n!="function")throw new Ge(L);return function(t){return n.apply(this,t)}},Nn.take=function(n,t,r){return n&&n.length?((r?Ur(n,t,r):null==t)&&(t=1),Et(n,0,0>t?0:t)):[]},Nn.takeRight=function(n,t,r){var e=n?n.length:0;return e?((r?Ur(n,t,r):null==t)&&(t=1),t=e-(+t||0),Et(n,0>t?0:t)):[]},Nn.takeRightWhile=function(n,t,r){
return n&&n.length?Nt(n,wr(t,r,3),false,true):[]},Nn.takeWhile=function(n,t,r){return n&&n.length?Nt(n,wr(t,r,3)):[]},Nn.tap=function(n,t,r){return t.call(r,n),n},Nn.throttle=function(n,t,r){var e=true,u=true;if(typeof n!="function")throw new Ge(L);return false===r?e=false:ge(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),ae(n,t,{leading:e,maxWait:+t,trailing:u})},Nn.thru=ne,Nn.times=function(n,t,r){if(n=yu(n),1>n||!mu(n))return[];var e=-1,u=Be(xu(n,4294967295));for(t=Bt(t,r,1);++e<n;)4294967295>e?u[e]=t(e):t(e);
return u},Nn.toArray=je,Nn.toPlainObject=ke,Nn.transform=function(n,t,r,e){var u=Oo(n)||xe(n);return t=wr(t,e,4),null==r&&(u||ge(n)?(e=n.constructor,r=u?Oo(n)?new e:[]:$u(ve(e)?e.prototype:w)):r={}),(u?Pn:_t)(n,function(n,e,u){return t(r,n,e,u)}),r},Nn.union=Gu,Nn.uniq=Gr,Nn.unzip=Jr,Nn.unzipWith=Xr,Nn.values=Ee,Nn.valuesIn=function(n){return Ft(n,Re(n))},Nn.where=function(n,t){return re(n,bt(t))},Nn.without=Ju,Nn.wrap=function(n,t){return t=null==t?Fe:t,gr(t,R,w,[n],[])},Nn.xor=function(){for(var n=-1,t=arguments.length;++n<t;){
var r=arguments[n];if(Er(r))var e=e?Jn(ft(e,r),ft(r,e)):r}return e?St(e):[]},Nn.zip=Xu,Nn.zipObject=Hr,Nn.zipWith=Hu,Nn.backflow=Ao,Nn.collect=ue,Nn.compose=Ao,Nn.each=uo,Nn.eachRight=oo,Nn.extend=Co,Nn.iteratee=Se,Nn.methods=Ie,Nn.object=Hr,Nn.select=re,Nn.tail=Yr,Nn.unique=Gr,Te(Nn,Nn),Nn.add=function(n,t){return(+n||0)+(+t||0)},Nn.attempt=Jo,Nn.camelCase=Po,Nn.capitalize=function(n){return(n=u(n))&&n.charAt(0).toUpperCase()+n.slice(1)},Nn.ceil=Qo,Nn.clone=function(n,t,r,e){return t&&typeof t!="boolean"&&Ur(n,t,r)?t=false:typeof t=="function"&&(e=r,
r=t,t=false),typeof r=="function"?ot(n,t,Bt(r,e,3)):ot(n,t)},Nn.cloneDeep=function(n,t,r){return typeof t=="function"?ot(n,true,Bt(t,r,3)):ot(n,true)},Nn.deburr=Ce,Nn.endsWith=function(n,t,r){n=u(n),t+="";var e=n.length;return r=r===w?e:xu(0>r?0:+r||0,e),r-=t.length,0<=r&&n.indexOf(t,r)==r},Nn.escape=function(n){return(n=u(n))&&hn.test(n)?n.replace(sn,c):n},Nn.escapeRegExp=function(n){return(n=u(n))&&bn.test(n)?n.replace(wn,l):n||"(?:)"},Nn.every=te,Nn.find=ro,Nn.findIndex=qu,Nn.findKey=$o,Nn.findLast=eo,
Nn.findLastIndex=Pu,Nn.findLastKey=So,Nn.findWhere=function(n,t){return ro(n,bt(t))},Nn.first=Kr,Nn.floor=ni,Nn.get=function(n,t,r){return n=null==n?w:yt(n,Dr(t),t+""),n===w?r:n},Nn.gt=se,Nn.gte=function(n,t){return n>=t},Nn.has=function(n,t){if(null==n)return false;var r=nu.call(n,t);if(!r&&!Wr(t)){if(t=Dr(t),n=1==t.length?n:yt(n,Et(t,0,-1)),null==n)return false;t=Zr(t),r=nu.call(n,t)}return r||Sr(n.length)&&Cr(t,n.length)&&(Oo(n)||pe(n))},Nn.identity=Fe,Nn.includes=ee,Nn.indexOf=Vr,Nn.inRange=function(n,t,r){
return t=+t||0,r===w?(r=t,t=0):r=+r||0,n>=xu(t,r)&&n<bu(t,r)},Nn.isArguments=pe,Nn.isArray=Oo,Nn.isBoolean=function(n){return true===n||false===n||h(n)&&ru.call(n)==M},Nn.isDate=function(n){return h(n)&&ru.call(n)==q},Nn.isElement=function(n){return!!n&&1===n.nodeType&&h(n)&&!me(n)},Nn.isEmpty=function(n){return null==n?true:Er(n)&&(Oo(n)||be(n)||pe(n)||h(n)&&ve(n.splice))?!n.length:!zo(n).length},Nn.isEqual=he,Nn.isError=_e,Nn.isFinite=function(n){return typeof n=="number"&&mu(n)},Nn.isFunction=ve,Nn.isMatch=function(n,t,r,e){
return r=typeof r=="function"?Bt(r,e,3):w,mt(n,Ar(t),r)},Nn.isNaN=function(n){return de(n)&&n!=+n},Nn.isNative=ye,Nn.isNull=function(n){return null===n},Nn.isNumber=de,Nn.isObject=ge,Nn.isPlainObject=me,Nn.isRegExp=we,Nn.isString=be,Nn.isTypedArray=xe,Nn.isUndefined=function(n){return n===w},Nn.kebabCase=Ko,Nn.last=Zr,Nn.lastIndexOf=function(n,t,r){var e=n?n.length:0;if(!e)return-1;var u=e;if(typeof r=="number")u=(0>r?bu(e+r,0):xu(r||0,e-1))+1;else if(r)return u=Lt(n,t,true)-1,n=n[u],(t===t?t===n:n!==n)?u:-1;
if(t!==t)return p(n,u,true);for(;u--;)if(n[u]===t)return u;return-1},Nn.lt=Ae,Nn.lte=function(n,t){return n<=t},Nn.max=ti,Nn.min=ri,Nn.noConflict=function(){return Zn._=eu,this},Nn.noop=Le,Nn.now=ho,Nn.pad=function(n,t,r){n=u(n),t=+t;var e=n.length;return e<t&&mu(t)?(e=(t-e)/2,t=yu(e),e=vu(e),r=pr("",e,r),r.slice(0,t)+n+r):n},Nn.padLeft=Vo,Nn.padRight=Zo,Nn.parseInt=function(n,t,r){return(r?Ur(n,t,r):null==t)?t=0:t&&(t=+t),n=We(n),ju(n,t||(In.test(n)?16:10))},Nn.random=function(n,t,r){r&&Ur(n,t,r)&&(t=r=w);
var e=null==n,u=null==t;return null==r&&(u&&typeof n=="boolean"?(r=n,n=1):typeof t=="boolean"&&(r=t,u=true)),e&&u&&(t=1,u=false),n=+n||0,u?(t=n,n=0):t=+t||0,r||n%1||t%1?(r=ku(),xu(n+r*(t-n+fu("1e-"+((r+"").length-1))),t)):Rt(n,t)},Nn.reduce=lo,Nn.reduceRight=so,Nn.repeat=Ue,Nn.result=function(n,t,r){var e=null==n?w:n[t];return e===w&&(null==n||Wr(t,n)||(t=Dr(t),n=1==t.length?n:yt(n,Et(t,0,-1)),e=null==n?w:n[Zr(t)]),e=e===w?r:e),ve(e)?e.call(n):e},Nn.round=ei,Nn.runInContext=m,Nn.size=function(n){var t=n?Bu(n):0;
return Sr(t)?t:zo(n).length},Nn.snakeCase=Yo,Nn.some=ie,Nn.sortedIndex=Zu,Nn.sortedLastIndex=Yu,Nn.startCase=Go,Nn.startsWith=function(n,t,r){return n=u(n),r=null==r?0:xu(0>r?0:+r||0,n.length),n.lastIndexOf(t,r)==r},Nn.sum=function(n,t,r){if(r&&Ur(n,t,r)&&(t=w),t=wr(t,r,3),1==t.length){n=Oo(n)?n:zr(n),r=n.length;for(var e=0;r--;)e+=+t(n[r])||0;n=e}else n=$t(n,t);return n},Nn.template=function(n,t,r){var e=Nn.templateSettings;r&&Ur(n,t,r)&&(t=r=w),n=u(n),t=nt(tt({},r||t),e,Qn),r=nt(tt({},t.imports),e.imports,Qn);
var o,i,f=zo(r),a=Ft(r,f),c=0;r=t.interpolate||Cn;var l="__p+='";r=Ze((t.escape||Cn).source+"|"+r.source+"|"+(r===gn?jn:Cn).source+"|"+(t.evaluate||Cn).source+"|$","g");var p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(n.replace(r,function(t,r,e,u,f,a){return e||(e=u),l+=n.slice(c,a).replace(Un,s),r&&(o=true,l+="'+__e("+r+")+'"),f&&(i=true,l+="';"+f+";\n__p+='"),e&&(l+="'+((__t=("+e+"))==null?'':__t)+'"),c=a+t.length,t}),l+="';",(t=t.variable)||(l="with(obj){"+l+"}"),l=(i?l.replace(fn,""):l).replace(an,"$1").replace(cn,"$1;"),
l="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(o?",__e=_.escape":"")+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",t=Jo(function(){return qe(f,p+"return "+l).apply(w,a)}),t.source=l,_e(t))throw t;return t},Nn.trim=We,Nn.trimLeft=function(n,t,r){var e=n;return(n=u(n))?n.slice((r?Ur(e,t,r):null==t)?g(n):o(n,t+"")):n},Nn.trimRight=function(n,t,r){var e=n;return(n=u(n))?(r?Ur(e,t,r):null==t)?n.slice(0,y(n)+1):n.slice(0,i(n,t+"")+1):n;
},Nn.trunc=function(n,t,r){r&&Ur(n,t,r)&&(t=w);var e=U;if(r=W,null!=t)if(ge(t)){var o="separator"in t?t.separator:o,e="length"in t?+t.length||0:e;r="omission"in t?u(t.omission):r}else e=+t||0;if(n=u(n),e>=n.length)return n;if(e-=r.length,1>e)return r;if(t=n.slice(0,e),null==o)return t+r;if(we(o)){if(n.slice(e).search(o)){var i,f=n.slice(0,e);for(o.global||(o=Ze(o.source,(kn.exec(o)||"")+"g")),o.lastIndex=0;n=o.exec(f);)i=n.index;t=t.slice(0,null==i?e:i)}}else n.indexOf(o,e)!=e&&(o=t.lastIndexOf(o),
-1<o&&(t=t.slice(0,o)));return t+r},Nn.unescape=function(n){return(n=u(n))&&pn.test(n)?n.replace(ln,d):n},Nn.uniqueId=function(n){var t=++tu;return u(n)+t},Nn.words=$e,Nn.all=te,Nn.any=ie,Nn.contains=ee,Nn.eq=he,Nn.detect=ro,Nn.foldl=lo,Nn.foldr=so,Nn.head=Kr,Nn.include=ee,Nn.inject=lo,Te(Nn,function(){var n={};return _t(Nn,function(t,r){Nn.prototype[r]||(n[r]=t)}),n}(),false),Nn.sample=oe,Nn.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(t){return oe(t,n)}):oe(this.value());
},Nn.VERSION=b,Pn("bind bindKey curry curryRight partial partialRight".split(" "),function(n){Nn[n].placeholder=Nn}),Pn(["drop","take"],function(n,t){zn.prototype[n]=function(r){var e=this.__filtered__;if(e&&!t)return new zn(this);r=null==r?1:bu(yu(r)||0,0);var u=this.clone();return e?u.__takeCount__=xu(u.__takeCount__,r):u.__views__.push({size:r,type:n+(0>u.__dir__?"Right":"")}),u},zn.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),Pn(["filter","map","takeWhile"],function(n,t){
var r=t+1,e=r!=T;zn.prototype[n]=function(n,t){var u=this.clone();return u.__iteratees__.push({iteratee:wr(n,t,1),type:r}),u.__filtered__=u.__filtered__||e,u}}),Pn(["first","last"],function(n,t){var r="take"+(t?"Right":"");zn.prototype[n]=function(){return this[r](1).value()[0]}}),Pn(["initial","rest"],function(n,t){var r="drop"+(t?"":"Right");zn.prototype[n]=function(){return this.__filtered__?new zn(this):this[r](1)}}),Pn(["pluck","where"],function(n,t){var r=t?"filter":"map",e=t?bt:ze;zn.prototype[n]=function(n){
return this[r](e(n))}}),zn.prototype.compact=function(){return this.filter(Fe)},zn.prototype.reject=function(n,t){return n=wr(n,t,1),this.filter(function(t){return!n(t)})},zn.prototype.slice=function(n,t){n=null==n?0:+n||0;var r=this;return r.__filtered__&&(0<n||0>t)?new zn(r):(0>n?r=r.takeRight(-n):n&&(r=r.drop(n)),t!==w&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-n)),r)},zn.prototype.takeRightWhile=function(n,t){return this.reverse().takeWhile(n,t).reverse()},zn.prototype.toArray=function(){return this.take(Ru);
},_t(zn.prototype,function(n,t){var r=/^(?:filter|map|reject)|While$/.test(t),e=/^(?:first|last)$/.test(t),u=Nn[e?"take"+("last"==t?"Right":""):t];u&&(Nn.prototype[t]=function(){function t(n){return e&&i?u(n,1)[0]:u.apply(w,Jn([n],o))}var o=e?[1]:arguments,i=this.__chain__,f=this.__wrapped__,a=!!this.__actions__.length,c=f instanceof zn,l=o[0],s=c||Oo(f);return s&&r&&typeof l=="function"&&1!=l.length&&(c=s=false),l={func:ne,args:[t],thisArg:w},a=c&&!a,e&&!i?a?(f=f.clone(),f.__actions__.push(l),n.call(f)):u.call(w,this.value())[0]:!e&&s?(f=a?f:new zn(this),
f=n.apply(f,o),f.__actions__.push(l),new Ln(f,i)):this.thru(t)})}),Pn("join pop push replace shift sort splice split unshift".split(" "),function(n){var t=(/^(?:replace|split)$/.test(n)?He:Je)[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:join|pop|replace|shift)$/.test(n);Nn.prototype[n]=function(){var n=arguments;return e&&!this.__chain__?t.apply(this.value(),n):this[r](function(r){return t.apply(r,n)})}}),_t(zn.prototype,function(n,t){var r=Nn[t];if(r){var e=r.name+"";(Wu[e]||(Wu[e]=[])).push({
name:t,func:r})}}),Wu[sr(w,A).name]=[{name:"wrapper",func:w}],zn.prototype.clone=function(){var n=new zn(this.__wrapped__);return n.__actions__=qn(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=qn(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=qn(this.__views__),n},zn.prototype.reverse=function(){if(this.__filtered__){var n=new zn(this);n.__dir__=-1,n.__filtered__=true}else n=this.clone(),n.__dir__*=-1;return n},zn.prototype.value=function(){
var n,t=this.__wrapped__.value(),r=this.__dir__,e=Oo(t),u=0>r,o=e?t.length:0;n=o;for(var i=this.__views__,f=0,a=-1,c=i.length;++a<c;){var l=i[a],s=l.size;switch(l.type){case"drop":f+=s;break;case"dropRight":n-=s;break;case"take":n=xu(n,f+s);break;case"takeRight":f=bu(f,n-s)}}if(n={start:f,end:n},i=n.start,f=n.end,n=f-i,u=u?f:i-1,i=this.__iteratees__,f=i.length,a=0,c=xu(n,this.__takeCount__),!e||o<F||o==n&&c==n)return Tt(t,this.__actions__);e=[];n:for(;n--&&a<c;){for(u+=r,o=-1,l=t[u];++o<f;){var p=i[o],s=p.type,p=p.iteratee(l);
if(s==T)l=p;else if(!p){if(s==N)continue n;break n}}e[a++]=l}return e},Nn.prototype.chain=function(){return Qr(this)},Nn.prototype.commit=function(){return new Ln(this.value(),this.__chain__)},Nn.prototype.concat=Qu,Nn.prototype.plant=function(n){for(var t,r=this;r instanceof Tn;){var e=Mr(r);t?u.__wrapped__=e:t=e;var u=e,r=r.__wrapped__}return u.__wrapped__=n,t},Nn.prototype.reverse=function(){function n(n){return n.reverse()}var t=this.__wrapped__;return t instanceof zn?(this.__actions__.length&&(t=new zn(this)),
t=t.reverse(),t.__actions__.push({func:ne,args:[n],thisArg:w}),new Ln(t,this.__chain__)):this.thru(n)},Nn.prototype.toString=function(){return this.value()+""},Nn.prototype.run=Nn.prototype.toJSON=Nn.prototype.valueOf=Nn.prototype.value=function(){return Tt(this.__wrapped__,this.__actions__)},Nn.prototype.collect=Nn.prototype.map,Nn.prototype.head=Nn.prototype.first,Nn.prototype.select=Nn.prototype.filter,Nn.prototype.tail=Nn.prototype.rest,Nn}var w,b="3.10.1",x=1,A=2,j=4,k=8,I=16,R=32,O=64,E=128,C=256,U=30,W="...",$=150,S=16,F=200,N=1,T=2,L="Expected a function",z="__lodash_placeholder__",B="[object Arguments]",D="[object Array]",M="[object Boolean]",q="[object Date]",P="[object Error]",K="[object Function]",V="[object Number]",Z="[object Object]",Y="[object RegExp]",G="[object String]",J="[object ArrayBuffer]",X="[object Float32Array]",H="[object Float64Array]",Q="[object Int8Array]",nn="[object Int16Array]",tn="[object Int32Array]",rn="[object Uint8Array]",en="[object Uint8ClampedArray]",un="[object Uint16Array]",on="[object Uint32Array]",fn=/\b__p\+='';/g,an=/\b(__p\+=)''\+/g,cn=/(__e\(.*?\)|\b__t\))\+'';/g,ln=/&(?:amp|lt|gt|quot|#39|#96);/g,sn=/[&<>"'`]/g,pn=RegExp(ln.source),hn=RegExp(sn.source),_n=/<%-([\s\S]+?)%>/g,vn=/<%([\s\S]+?)%>/g,gn=/<%=([\s\S]+?)%>/g,yn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,dn=/^\w*$/,mn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,wn=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,bn=RegExp(wn.source),xn=/[\u0300-\u036f\ufe20-\ufe23]/g,An=/\\(\\)?/g,jn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,kn=/\w*$/,In=/^0[xX]/,Rn=/^\[object .+?Constructor\]$/,On=/^\d+$/,En=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Cn=/($^)/,Un=/['\n\r\u2028\u2029\\]/g,Wn=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),$n="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout isFinite parseFloat parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap".split(" "),Sn={};
Sn[X]=Sn[H]=Sn[Q]=Sn[nn]=Sn[tn]=Sn[rn]=Sn[en]=Sn[un]=Sn[on]=true,Sn[B]=Sn[D]=Sn[J]=Sn[M]=Sn[q]=Sn[P]=Sn[K]=Sn["[object Map]"]=Sn[V]=Sn[Z]=Sn[Y]=Sn["[object Set]"]=Sn[G]=Sn["[object WeakMap]"]=false;var Fn={};Fn[B]=Fn[D]=Fn[J]=Fn[M]=Fn[q]=Fn[X]=Fn[H]=Fn[Q]=Fn[nn]=Fn[tn]=Fn[V]=Fn[Z]=Fn[Y]=Fn[G]=Fn[rn]=Fn[en]=Fn[un]=Fn[on]=true,Fn[P]=Fn[K]=Fn["[object Map]"]=Fn["[object Set]"]=Fn["[object WeakMap]"]=false;var Nn={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a",
"\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y",
"\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss"},Tn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ln={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},zn={"function":true,object:true},Bn={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Dn={"\\":"\\",
"'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mn=zn[typeof exports]&&exports&&!exports.nodeType&&exports,qn=zn[typeof module]&&module&&!module.nodeType&&module,Pn=zn[typeof self]&&self&&self.Object&&self,Kn=zn[typeof window]&&window&&window.Object&&window,Vn=qn&&qn.exports===Mn&&Mn,Zn=Mn&&qn&&typeof global=="object"&&global&&global.Object&&global||Kn!==(this&&this.window)&&Kn||Pn||this,Yn=m();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Zn._=Yn, define(function(){
return Yn})):Mn&&qn?Vn?(qn.exports=Yn)._=Yn:Mn._=Yn:Zn._=Yn}).call(this);
var AddToCensusViewModel=function AddToCensusViewModel(case_id){var self=this;self.case_id=ko.observable(case_id);self.matched_employees=ko.observableArray([]);self.matched_employees.error=ko.observable("");self.selected_employee=ko.observable(null);self.matched_employee=ko.computed(function(){if(self.matched_employees().length==0){return null;}
return self.matched_employees()[0];});self.loading_message=ko.observable("Loading...");self.ssn=ko.observable(null);self.ssn.error=ko.observable("");self.PANEL_FORM="find_employee";self.PANEL_LOADING="loading";self.PANEL_NOMATCH="no_matches";self.PANEL_ONEMATCH="one_match";self.PANEL_MANYMATCHES="matches";self.current_panel=ko.observable(self.PANEL_FORM);self.show_modal=function(){self.current_panel(self.PANEL_FORM);self.ssn("");self.ssn.error("");self.selected_employee(null);};self.is_match_form_showing=ko.computed(function(){return(self.current_panel()==self.PANEL_NOMATCH||self.current_panel()==self.PANEL_MANYMATCHES||self.current_panel()==self.PANEL_ONEMATCH);});self.add_form_showing=ko.computed(function(){return self.current_panel()==self.PANEL_FORM;});self.is_loading=ko.computed(function(){return self.current_panel()==self.PANEL_LOADING;});self.no_matches_found=ko.computed(function(){return self.current_panel()==self.PANEL_NOMATCH;});self.multiple_matches_found=ko.computed(function(){return self.current_panel()==self.PANEL_MANYMATCHES;});self.one_match_found=ko.computed(function(){return self.current_panel()==self.PANEL_ONEMATCH;});self.one_or_more_matches_found=ko.computed(function(){return self.multiple_matches_found()||self.one_match_found();});self.find_matches=function(){self.ssn.error("");if(!self.is_valid_ssn()){self.ssn.error("A valid SSN is required");return;}
self.loading_message("Checking census for matches...");self.current_panel(self.PANEL_LOADING);$.get("/cases/"+self.case_id()+"/census_records",{filter_ssn:self.ssn()}).success(function(resp){if(resp.data.length>0){self.matched_employees(_.map(resp.data,function(e){return new EmployeeMatchViewModel(e)}));if(resp.data.length==1){self.current_panel(self.PANEL_ONEMATCH);}else{self.current_panel(self.PANEL_MANYMATCHES);}}else{self.matched_employees([]);self.current_panel(self.PANEL_NOMATCH);}}).error(function(resp){console.error(resp);});};self.is_valid_ssn=ko.computed(function(){var ssn_regex=/^\d\d\d-\d\d-\d\d\d\d$/;return ssn_regex.test(self.ssn());});self.add_to_census=function(){self.enroll_without_record();};self.enroll_from_match=function(){if(self.matched_employees().length==1){self.enroll_from_record(self.matched_employees()[0].id);}else{var id=self.selected_employee();if(id===null){self.matched_employees.error("Please select the census record to enroll.");return;}
self.enroll_from_record(id);}};self.enroll_from_record=function(id){self._submit_enrollment({record_id:id});};self.enroll_without_record=function(){self._submit_enrollment({});};self._submit_enrollment=function(options){var data={case_id:self.case_id(),enrollment_city:window.case_settings.get_enrollment_city_override(),enrollment_state:window.case_settings.get_enrollment_state_override()};if(options.record_id){data.record_id=options.record_id;}else{data.ssn=self.ssn();}
self.loading_message("Loading Enrollment Application...");self.current_panel(self.PANEL_LOADING);submit_to_url(urls.get_in_person_enrollment_url(),data);}};var CaseEnrollmentPeriod=function CaseEnrollmentPeriod(period){var self=this;var defaults={period_type:"annual_period",case_id:null,start_date:"",end_date:""};var settings=$.extend({},defaults,period);self.period_type=settings.period_type;self.is_annual=ko.computed(function(){return self.period_type=="annual_period"});self.is_open=ko.computed(function(){return!self.is_annual()});self.case_id=settings.case_id;self.error=ko.observable("");function strip_year(d){var month_day_search=/\d{4}-(\d{2}-\d{2})/;var matches=d.match(month_day_search);if(matches&&matches.length>1){return matches[1];}
return"";}
if(self.is_open()){self.start_date=ko.observable(normalize_date(settings.start_date));self.end_date=ko.observable(normalize_date(settings.end_date));}else{self.start_date=ko.observable(strip_year(settings.start_date));self.end_date=ko.observable(strip_year(settings.end_date));}
self.is_valid_month_day=function(val){return self.get_month_day(val).isValid();};self.get_month_day=function(val){return parse_month_date_input(val);};self.is_valid_date=function(val){return is_valid_date(val);};self.is_valid=ko.computed(function(){if(self.is_open()){if(self.end_date()){return(self.is_valid_date(self.start_date())&&self.is_valid_date(self.end_date())&&parse_date(self.end_date())>=parse_date(self.start_date()));}else{return self.is_valid_date(self.start_date());}}else{return(self.is_valid_month_day(self.start_date())&&self.is_valid_month_day(self.end_date()));}});self.serialize=function(){return{period_type:self.period_type,case_id:self.case_id,start_date:self.start_date(),end_date:self.end_date()}};};var CaseEnrollmentsViewModel=function(case_data){var self=this;self.add_to_census_modal=new AddToCensusViewModel(case_data.id);ko.applyBindings(self.add_to_census_modal,$("#add-to-census-modal")[0]);$("#add-to-census-btn").on('click',function(){$("#add-to-census-modal").modal("show");self.add_to_census_modal.show_modal();});$("#enrollment").on('click',"button.enroll-employee",function(){var record_id=$(this).attr('data-id');submit_to_url(urls.get_in_person_enrollment_url(),{record_id:record_id,enrollment_city:window.case_settings.get_enrollment_city_override(),enrollment_state:window.case_settings.get_enrollment_state_override()});});};var CaseReportsViewModel=function(params){var self=this;self.is_loading=ko.observable(true);self.error_message=ko.observable("");self.company_name=ko.observable({});self.group_number=ko.observable({});self.any_enrollments=ko.observable(false);self.summary_data=ko.observable({});self.product_data=ko.observable([]);self.enrollment_dates=ko.observable({});self.enrollment_methods=ko.observableArray([]);self.case_agents=ko.observableArray([]);self.load_reports=function(){self.is_loading(true);var url=urls.get_case_api_enrollment_report_url(params.settings_viewmodel.case_id);$.get(url).success(function(resp){self.company_name(resp.data.company_name);self.group_number(resp.data.group_number);self.enrollment_dates(resp.data.enrollment_period);self.enrollment_methods(resp.data.enrollment_methods);self.summary_data(resp.data.summary);self.any_enrollments(self.summary_data().processed_enrollments>0);var pdata=[];$.each(resp.data.product_report,function(){var data=this;pdata.push({name:data.product_name,num_taken:data.enrolled_count,percent_taken:(data.enrolled_count/resp.data.summary.total_census*100).toFixed(2),annualized_premium:data.total_annualized_premium});});self.product_data(pdata);var case_agents=[];if(resp.data.case_owner){case_agents.push(resp.data.case_owner.first+" "+resp.data.case_owner.last);}
_.each(resp.data.case_agents,function(agent){case_agents.push(agent.first+" "+agent.last);});self.case_agents(case_agents);self.is_loading(false);}).error(function(e){console.error(e);self.error_message("There was a problem loading the enrollment report data.");self.is_loading(false);});};self.enter_print_preview=function(){$(".header ul").hide();$(".container.page").hide();$("#print-wrap").html($("#reports .report-wrap").clone()).prepend("<div><a class='btn btn-default hidden-print' href='#reports'>"+"<span class='glyphicon glyphicon-chevron-left'></span> Back to report</a></div>").show();};self.exit_print_preview=function(){$(".header ul").show();$(".container.page").show();$("#print-wrap").hide();};self.load_enrollments=function(){case_management.refresh_enrollments_table(params.settings_viewmodel.case_id,urls.get_case_api_enrollment_records_url(params.settings_viewmodel.case_id),"#enrollment-records-table","#enrollment-table-loading",{},function(table){});};self.format_enrollment_methods=ko.computed(function(){var display_map={in_person:'In Person',self_enroll_email:'Self-Enroll by Email'};return _.map(self.enrollment_methods(),function(m){return display_map[m]}).join(",");});self.format_enrollment_dates=ko.computed(function(){var start=self.enrollment_dates().start;var end=self.enrollment_dates().end;if(is_valid_date(end)){return normalize_date(start)+" - "+normalize_date(end);}else{return"Open enrollment starting "+normalize_date(start);}});self.is_census_report=ko.computed(function(){return self.summary_data().is_census_report;});self.only_one_product=ko.computed(function(){return self.summary_data().only_one_product;});self.product_name=ko.computed(function(){return(self.only_one_product())?self.summary_data().product_names[0]:"";});self.format_total_percent_processed=ko.computed(function(){var percent=self.summary_data().processed_enrollments/self.summary_data().total_census*100;return percent.toFixed(2)+"%";});self.format_total_num_census=ko.pureComputed(function(){return self.summary_data().total_census;});self.format_total_num_processed=ko.computed(function(){return self.summary_data().processed_enrollments;});self.format_total_percent_taken=ko.computed(function(){var percent=self.summary_data().taken_enrollments/self.summary_data().total_census*100;return percent.toFixed(2)+"%";});self.format_total_num_taken=ko.computed(function(){return self.summary_data().taken_enrollments;});self.format_total_num_declined=ko.computed(function(){return self.summary_data().declined_enrollments;});self.format_total_percent_declined=ko.computed(function(){var percent=self.summary_data().declined_enrollments/self.summary_data().total_census*100;return percent.toFixed(2)+"%";});self.format_total_annualized_premium=ko.computed(function(){return'$'+self.summary_data().total_annualized_premium;});self.format_case_agents=ko.computed(function(){return self.case_agents().join(", ");});params.settings_viewmodel.report_viewmodel(self);};function CaseRiderConfiguration(case_settings,product,rider,initial_product_settings){var self=this;self.case_settings=case_settings;self.product=product;self.rider=rider;self.name=rider.name;self.code=rider.code;self.is_rider_initially_selected=function(initial_product_settings){if(!initial_product_settings||!initial_product_settings.riders){return false;}
return _.any(initial_product_settings.riders,function(r){return(self.product.id===r.product_id&&self.rider.code===r.rider_code&&r.is_selected)});};self.is_selected=ko.observable(self.is_rider_initially_selected(initial_product_settings));self.can_enable_rider=ko.pureComputed(function(){var is_enabled=true;_.each(case_settings.enabled_case_riders_for_product(self.product),function(r){if(_.includes(rider.disallowed_rider_combinations,r.code)){is_enabled=false;return false;}});return is_enabled;});}
CaseRiderConfiguration.prototype.serialize=function(){return{product_id:this.product.id,rider_code:this.rider.code,is_selected:this.is_selected()}};function add_case_error(errors,field_name,message){if(field_name in errors){errors[field_name].push(message);}else{errors[field_name]=[message];}}
function get_form_data(form){var data=$(form).serializeArray();var data_object={};$.each(data,function(){var key=this.name;var val=this.value;if(key in data_object&&data_object.length===undefined){data_object[key]=[data_object[key]];data_object[key].push(val);}else if(key in data_object){data_object[key].push(val);}else{data_object[key]=val;}});return data_object;}
function show_loading_panel(modal){$(".form-panel",modal).hide("slide");$(".loading-panel",modal).show("slide");$(".processing-buttons",modal).show("fade");$(".form-buttons",modal).hide("fade");}
function show_error_panel(modal){$(".loading-panel",modal).hide("slide");$(".error-panel",modal).show("slide");$(".error-buttons",modal).show("fade");$(".processing-buttons",modal).hide("fade");}
function show_success_panel(modal){$(".loading-panel",modal).hide("slide");$(".success-panel",modal).show("slide");$(".success-buttons",modal).show("fade");$(".processing-buttons",modal).hide("fade");}
function show_form_panel(modal){$(".modal-panel",modal).hide("slide");$(".buttons-panel",modal).hide("slide");$(".form-panel",modal).show("slide");$(".form-buttons",modal).show("slide");}
function reset_upload_modal(){$(".modal-panel").hide();$(".buttons-panel").hide();$(".form-panel").show();$(".form-buttons").show();}
function handle_upload_success(resp,modal){census_errors_panel.error_records(resp.data.errors);census_errors_panel.num_data_records(resp.data.records.length);show_success_panel($(modal));window.case_settings.census_data(resp.data.records);case_management.refresh_census_table(window.case_id,urls.get_case_api_census_records_url(window.case_id),"#census-records-table","#census-table-loading");}
function handle_upload_error(xhr,modal){if(xhr.status>=400&&xhr.status<500){show_error_panel($(modal));var data=$.parseJSON(xhr.responseText).data;census_errors_panel.error_records(data.errors);$('.upload-error-table td.error').tooltip({placement:"auto left"});}else{alert("Sorry, there was a problem communicating with the server.");reset_upload_modal($(modal));}}
function observe_settings_events(settings){$("#upload-btn").on("click",reset_upload_modal);$(".back-btn").on("click",function(){show_form_panel($(this).parents(".modal"));});$('#reset-page-text').click(function(){$('#page_text').html(settings.default_page_text).focus();});$('#self_enrollment_type').change(function(){if($('#self_enrollment_type option:selected').val()=='case-generic'){$('.self-enroll-email').hide();$('.self-enroll-email-off').show();}else{$('.self-enroll-email').show();$('.self-enroll-email-off').hide();}}).change();$('#edit-self-enrollment-form').on('submit',function(){window.case_settings.save_settings();return false;});}
function observe_census_record_form_submit(){$("#census-record-form").on("submit",function(){var form=this;var file_select=$(this).find("input[type=file]").get(0);var files=file_select.files;var form_data=new FormData();if(files.length!==1){alert("Please select a file");return false;}
form_data.append('csv-file',files[0],files[0].name);form_data.append('upload_type',$("input[name=upload_type]:checked").val());send_file_data("POST",urls.get_case_api_census_records_url(window.case_id),form_data,function(data){handle_upload_success(data,form);},function(err){handle_upload_error(err,form);},false);show_loading_panel($(this));return false;});}
function handle_enrollment_upload_success(data,modal){window.enrollment_api_panel.num_records(data.data.num_processed);show_success_panel($(modal));}
function handle_enrollment_upload_error(err,modal){if(err.status>=400&&err.status<500){var data=$.parseJSON(err.responseText).data;window.enrollment_api_panel.error_records(data.errors);show_error_panel($(modal));}else{alert("Sorry, there was a problem communicating with the server.");reset_upload_modal($(modal));}}
function observe_enrollment_upload_form_submit(){$("#enrollment-csv-form").on("submit",function(){var form=this;var file_select=$(this).find("input[type=file]").get(0);var files=file_select.files;var form_data=new FormData();if(files.length!==1){alert("Please select a file");return false;}
form_data.append('api-upload-file',files[0],files[0].name);file_extension=files[0].name.split(".").slice(-1)[0];if(window.case_settings){form_data.append('case_token',window.case_settings.case_token);}
form_data.append('auth_token',window.enrollment_api_panel.user_token);form_data.append('email_errors',false);form_data.append('upload_source','api');form_data.append('format',file_extension);send_file_data("POST",urls.get_submit_enrollment_records_url(),form_data,function success(data){handle_enrollment_upload_success(data,form);},function error(err){handle_enrollment_upload_error(err,form);},false);show_loading_panel($(this));return false;});}
function init_settings_fields(){$('#csv-file-input').ace_file_input({no_file:'No File ...',btn_choose:'Choose File',btn_change:'Change File',droppable:false,onchange:null,thumbnail:false,whitelist:'csv'});$('#csv-file-input-enrollment').ace_file_input({no_file:'No File ...',btn_choose:'Choose File',btn_change:'Change File',droppable:false,onchange:null,thumbnail:false,whitelist:'csv'});$(".input-mask-date").mask("99/99/9999");$(".input-mask-month-day").mask("99/99");$('[data-rel=tooltip]').tooltip();$('#partner-agents').bootstrapDualListbox({infoTextFiltered:'<span class="label label-purple label-lg">Filtered</span>',showFilterInputs:true,moveOnSelect:false,nonSelectedListLabel:'Available Agents:',selectedListLabel:'Case Visible to Agents:'});}
function init_enrollment_import_fields(){$('#csv-file-input-enrollment').ace_file_input({no_file:'No File ...',btn_choose:'Choose File',btn_change:'Change File',droppable:false,onchange:null,thumbnail:false,whitelist:'csv'});}
function apply_default_values(){$.each(['#email_sender_name','#email_sender_email','#email_message','#page_title','#page_text'],function(index,value){if($(value).prop('tagName')=='DIV'){if($(value).html()==''){$(value).html($(value).attr('default'));$(value).trigger('change');}}else{if($(value).val()==''){$(value).val($(value).attr('default'));$(value).trigger('change');}}});}
function handle_url_hashs(){if(window.location.hash=='#success'){window.location.href=window.location.href.replace(/#.*$/,'#');$('#save-success').show();}
if(window.location.hash==""){window.location.hash="setup";}}
var CaseViewModel=function CaseViewModel(case_data,product_choices,can_edit_case,settings){var self=this;self.case_id=case_data.id;self.case_token=case_data.case_token;self.can_edit_case=can_edit_case;self.report_data=ko.observable(null);self.report_viewmodel=ko.observable(null);self.report_viewmodel.subscribe(function(val){if(val&&window.location.hash=="#reports"){val.load_reports();val.load_enrollments();}});self.company_name=ko.observable(case_data.company_name||"").extend({rateLimit:1000});self.group_number=ko.observable(case_data.group_number||"");self.product_choices=ko.observableArray(product_choices);var matched_selected_products=_.chain(self.product_choices()).filter(function(p){return _.includes(_.map(case_data.products,"id"),p.id);}).value();matched_selected_products=_.sortBy(matched_selected_products,function(product){return product.ordinal;});self.products=ko.observableArray(matched_selected_products);self.sort_selected_products=ko.observableArray([]);self.products.subscribe(function(){self.is_data_dirty(true);self.update_product_ordinals();});self.has_product_sort_selections=ko.computed(function(){return!!self.sort_selected_products()&&self.sort_selected_products().length>0;});self.unselected_products=ko.computed(function(){return _.sortBy(_.difference(self.product_choices(),self.products()),function(product){return product.ordinal;});});self.selected_product=ko.observable(null);self.has_selected_product=ko.computed(function(){return!!self.selected_product();});self.add_selected_product=function(){var product=self.selected_product();if(!product){return;}
self.products.push(product);};self.remove_selected_products=function(){var products_to_remove=self.sort_selected_products();var products=self.products();if(!products_to_remove||products_to_remove.length===0){return;}
_.forEach(products_to_remove,function(product){var index=products.indexOf(product);if(index!==-1){products.splice(index,1);}});self.products(products);self.update_product_ordinals();};self.emailSettings={sender_name:ko.observable(case_data.self_enrollment_setup.email_sender_name),sender_email:ko.observable(case_data.self_enrollment_setup.email_sender_email),subject:ko.observable(case_data.self_enrollment_setup.email_subject||settings.default_email_subject),greeting_type:ko.observable(case_data.self_enrollment_setup.email_greeting_type),greeting_salutation:ko.observable(case_data.self_enrollment_setup.email_greeting_salutation),message:ko.observable(case_data.self_enrollment_setup.email_message||settings.default_email_message)};self.resetEmail=function(){self.emailSettings.message(settings.default_email_message);self.emailSettings.subject(settings.default_email_subject);};self.landing={page_title:ko.observable(case_data.self_enrollment_setup.page_title||$("#page_title").html()),page_text:ko.observable(case_data.self_enrollment_setup.page_text||$("#page_text").html())};self.update_product_ordinals=function(){for(var idx=0;idx<self.products().length;idx++){var product=self.products()[idx];product.ordinal=idx;}};self.move_products_up=function(){var productsToSort=self.sort_selected_products();if(!productsToSort||productsToSort.length===0||productsToSort.length===self.products().length){return;}
var selectedProducts=self.products();var startPosition=selectedProducts.indexOf(_.first(productsToSort));if(startPosition===0){return;}
_.forEach(productsToSort,function(product){var position=selectedProducts.indexOf(product);if(position===0||position===-1){return;}
selectedProducts.splice(position,1);selectedProducts.splice(position-1,0,product);self.products(selectedProducts);});self.update_product_ordinals();};self.move_products_down=function(){var productsToSort=self.sort_selected_products();if(!productsToSort||productsToSort.length===0||productsToSort.length===self.products().length){return;}
var selectedProducts=self.products();var endPosition=selectedProducts.indexOf(_.last(productsToSort));if(endPosition===selectedProducts.length-1){return;}
_.chain(productsToSort).reverse().forEach(function(product){var position=selectedProducts.indexOf(product);if(position===-1){return;}
selectedProducts.splice(position,1);selectedProducts.splice(position+1,0,product);self.products(selectedProducts);}).value();self.update_product_ordinals();};self.enrollment_period_type=ko.observable(case_data.enrollment_period_type);self.enrollment_periods=ko.observableArray($.map(case_data.enrollment_periods,function(p){return new CaseEnrollmentPeriod(p);}));self.situs_city=ko.observable(case_data.situs_city);self.state_choices=settings.all_states;self.situs_state=ko.observable(get_state_from_statecode(case_data.situs_state));function get_state_from_statecode(statecode){return _.find(self.state_choices,function(c){return c.statecode==statecode;});}
self.enrollment_city_override=ko.observable(get_storage_or_default('enrollment_city_override.'+self.case_id,self.situs_city()));self.enrollment_state_override=ko.observable(get_default_state_override());self.get_enrollment_city_override=ko.pureComputed(function(){if(!self.enrollment_city_override()){return"";}
return self.enrollment_city_override();});self.get_enrollment_state_override=ko.pureComputed(function(){if(!self.enrollment_state_override()){return"";}
return self.enrollment_state_override().statecode;});set_storage_from_observable('enrollment_city_override.'+self.case_id,self.enrollment_city_override);set_storage_from_observable('enrollment_state_override.'+self.case_id,self.get_enrollment_state_override);function get_default_state_override(){var case_default_statecode=(self.situs_state())?self.situs_state().statecode:"";var statecode=get_storage_or_default('enrollment_state_override.'+self.case_id,case_default_statecode);if(!statecode||!get_state_from_statecode(statecode)){return get_state_from_statecode(case_default_statecode);}else{return get_state_from_statecode(statecode);}}
function get_storage_or_default(key,default_val){if(window.sessionStorage.getItem(key)){return window.sessionStorage.getItem(key);}
return default_val;}
function set_storage_from_observable(key,observable){observable.subscribe(function(new_val){window.sessionStorage.setItem(key,new_val);});}
self.situs_city.subscribe(function(new_val){self.enrollment_city_override(new_val);});self.situs_state.subscribe(function(new_val){self.enrollment_state_override(new_val);});self.selected_statecode=ko.pureComputed(function(){return(self.situs_state())?self.situs_state().statecode:null;});self.is_active=ko.observable(case_data.active);self.owner_agent_id=ko.observable(case_data.agent_id||"");var should_restrict_downloads=false;if(case_data.can_partners_download_enrollments===false){should_restrict_downloads=true;}
self.restrict_download_enrollments_to_owner=ko.observable(should_restrict_downloads);self.can_partners_download_enrollments=ko.pureComputed(function(){return!self.restrict_download_enrollments_to_owner();});self.can_download_enrollments=ko.pureComputed(function(){return self.has_census_data();});self.partner_agents=ko.observable((case_data.partner_agents)?_.map(_.pluck(case_data.partner_agents,"id"),function(id){return id+"";}):[]);self.state_product_limiter=new ProductStatesLimiterViewModel(settings.product_state_mapping,self.situs_state,self.state_choices,self.products,self.product_choices);self.on_products_select_rendered=function(option,item){if(!item){return;}
var is_valid=ko.computed(function(){return self.state_product_limiter.is_valid_product_for_state(item,self.situs_state());});ko.applyBindingAccessorsToNode(option,{enable:is_valid},item);};self.is_editing_products=ko.observable(false);if(case_data.products.length===0){self.is_editing_products(true);}
self.start_editing_products=function(){self.is_editing_products(true);};self.stop_editing_products=function(){self.is_editing_products(false);};self.state_product_override_limiter=new StatesLimiterViewModel(settings.product_state_mapping,self.enrollment_state_override,self.state_choices,self.products);self.on_state_selected=function(){self.selected_product(null);};self.state_product_limiter.selected_state.subscribe(self.on_state_selected);self.state_product_override_limiter.selected_state.subscribe(self.on_state_selected);self.is_open_enrollment=ko.computed(function(){return self.enrollment_period_type()==="open";});self.is_annual_enrollment=ko.computed(function(){return self.enrollment_period_type()==="annual";});self.get_open_enrollment_period=ko.computed(function(){return _.find(self.enrollment_periods(),function(p){return p.is_open();});});self.today_between=ko.computed(function(){if(!self.get_open_enrollment_period()){return false;}
var start=self.get_open_enrollment_period().start_date();var end=self.get_open_enrollment_period().end_date();return today_between(start,end);});self.annual_enrollment_periods=ko.computed(function(){return _.filter(self.enrollment_periods(),function(p){return p.period_type==="annual_period";});});self.annual_today_between=ko.computed(function(){if(self.annual_enrollment_periods().length>=4&&self.annual_enrollment_periods()[0].start_date()!==""){return self.annual_enrollment_periods().reduce(function(a,period){var start_date=moment(period.start_date(),"MM/DD");var end_date=moment(period.end_date(),"MM/DD");return today_between(start_date,end_date)||a;},false);}
return true;});self.payment_mode_choices=settings.payment_modes;self.payment_mode=ko.observable(_.find(self.payment_mode_choices,function(c){return c.mode==case_data.payment_mode;}));self.selected_payment_mode=ko.pureComputed(function(){return(self.payment_mode())?parseInt(self.payment_mode().mode):null;});self.include_bank_draft_form=ko.observable(case_data.include_bank_draft_form);self.can_include_bank_draft_form=ko.pureComputed(function(){return self.selected_payment_mode()===12;});self.can_include_bank_draft_form.subscribe(function(can_include){if(!can_include){self.include_bank_draft_form(false);}});self.should_use_call_center_workflow=ko.observable(case_data.should_use_call_center_workflow);self.occupation_classes=ko.observableArray(case_data.occupation_class_settings);self.new_occupation_class=ko.observable('');self.addOccupationClass=function(){self.occupation_classes.push({label:self.new_occupation_class()});self.new_occupation_class('');};self.removeOccupationClass=function(occupation_class){self.occupation_classes.remove(occupation_class);};self.is_new_occupation_class_valid=ko.computed(function(){var index=_.findIndex(self.occupation_classes(),function(item){return item.label.toLowerCase()===self.new_occupation_class().toLowerCase();});return(self.new_occupation_class()!==''&&index===-1);});self.available_occupation_mappings=[{value:1,label:'1'},{value:2,label:'2'},{value:3,label:'3'}];self.eligible_product_codes=['ACC','HI'];self.is_product_occupation_class_eligible=function(product){return self.eligible_product_codes.indexOf(product.base_product_type)!=-1;};self.is_case_occupation_class_eligible=function(){return _.any(_.map(case_settings.products(),function(p){return self.is_product_occupation_class_eligible(p);}));return _.intersection(_.map(case_settings.products(),function(p){return p.base_product_type;}),self.eligible_product_codes).length;};self.occ_mapping_cache={};self.update_occ_vm=function(product_id,label,value){var is_update=false;if(product_id in self.occ_mapping_cache){if(!(label in self.occ_mapping_cache[product_id])){is_update=true;}}else{self.occ_mapping_cache[product_id]={};self.occ_mapping_cache[product_id][label]={};is_update=true;}
if(is_update){self.occ_mapping_cache[product_id][label]={product_id:product_id,label:label,value:ko.observable(value)};}};function is_product_active(product){for(var i in self.products()){if(i=='first'){continue;}
if(self.products()[i].id==product.id){return true;}}
return false;}
function is_occupation_class_active(label){for(var i in self.occupation_classes()){if(i=='first'){continue;}
if(self.occupation_classes()[i].label==label){return true;}}
return false;}
self.deserialize_occ_mapping=function(){self.occ_mapping_cache={};if(!case_data.product_settings){return;}
var data=case_data.product_settings.classification_mappings;if(!data){return;}
for(var i=0;i<case_data.products.length;i++){for(var j=0;j<self.occupation_classes().length;j++){var product=case_data.products[i];var occ_label=self.occupation_classes()[j].label;var value=null;if(data[product.id]!=undefined&&data[product.id][occ_label]!=undefined){value=data[product.id][occ_label];}
self.update_occ_vm(product.id,occ_label,value);}}};self.deserialize_occ_mapping();self.serialize_occ_mapping=function(){var data={};for(var product_id in self.occ_mapping_cache){if(!is_product_active({id:product_id})){continue;}
if(!(product_id in data)){data[product_id]={};}
for(var label in self.occ_mapping_cache[product_id]){if(!is_occupation_class_active(label)){continue;}
if(!(label in data)){data[product_id][label]=self.occ_mapping_cache[product_id][label].value();}}}
return data;};self.occupation_classes_for_product=function(product){var r=[];if(!(product.id in self.occ_mapping_cache)){for(var i in self.occupation_classes()){if(i=='first'){continue;}
self.update_occ_vm(product.id,self.occupation_classes()[i].label,null);}}
for(var i in self.occupation_classes()){if(i=='first'){continue;}
if(!(self.occupation_classes()[i].label in self.occ_mapping_cache[product.id])){self.update_occ_vm(product.id,self.occupation_classes()[i].label,null);}}
for(var label in self.occ_mapping_cache[product.id]){if(is_product_active(product)&&is_occupation_class_active(label)){r.push(self.occ_mapping_cache[product.id][label]);}}
return r;};self._case_rider_configurations_by_product={};self.case_riders=ko.computed(function(){var _case_rider_configs=[];_.each(self.products(),function(product){if(!_.has(self._case_rider_configurations_by_product,product.id)){self._case_rider_configurations_by_product[product.id]=_.map(product.riders,function(r){return new CaseRiderConfiguration(self,product,r,case_data.product_settings);});}
_case_rider_configs=_case_rider_configs.concat(self._case_rider_configurations_by_product[product.id]);});return _case_rider_configs;});self.case_riders_for_product=function(product){return _.filter(self.case_riders(),function(rider){return rider.product===product;});};self.enabled_case_riders=ko.computed(function(){return _.filter(self.case_riders(),function(rider){return rider.is_selected()===true;});});self.enabled_case_riders_for_product=function(product){return _.filter(self.enabled_case_riders(),function(cr){return cr.product===product;});};if(!Array.prototype.first){Array.prototype.first=function(){if(this.length>0){return this[0];}else{return undefined;}};}
self.owner_agent=ko.computed(function(){return _.find(settings.active_agents,function(elem){return elem.id===parseInt(self.owner_agent_id(),10);});});self.partner_agent_list=ko.computed(function(){return settings.active_agents.filter(function(elem){return self.partner_agents().indexOf(String(elem.id))!==-1;});});self.case_agents=ko.computed(function(){var owner=self.owner_agent();if(owner&&_.pluck(self.partner_agent_list(),"id").indexOf(owner.id)===-1){var all_agents=self.partner_agent_list().concat(owner);all_agents.sort(function(a,b){if(a.last==b.last){return a.first.localeCompare(b.first);}
return a.last.localeCompare(b.last);});return all_agents;}else{return self.partner_agent_list();}});self.has_agent_splits=ko.observable(case_data.is_stp);self.selected_agent_splits=ko.observableArray(get_initial_splits());self.selected_agent=ko.observable();self.selected_agents=ko.observableArray(get_initial_split_agents());self.unused_agents=ko.computed(function(){var selected_ids=self.selected_agents();return self.case_agents().filter(function(i){return!~selected_ids.indexOf(i.id);});});self.show_product_subcount_modal=function(element_id){$('#'+element_id).modal('show');};self.add_agent_split=function(){var selected_agent=self.selected_agent();if(selected_agent){self.selected_agents.push(selected_agent.id);}};self.get_agent_name_from_id=function(agent_id){if(agent_id===null){return"Writing Agent";}
var cur_agent=settings.active_agents.filter(function(elem){return elem.id===agent_id;}).first();if(!cur_agent){return"";}
return cur_agent.first+" "+cur_agent.last;};self.get_agent_splits_for_product=function(product_id){return _.filter(self.selected_agent_splits(),function(split){return!!split.agent_id&&split.product_id===product_id;});};self.are_agent_splits_complete=function(product_id){if(!self.has_agent_splits()){return true;}
var splits=self.selected_agent_splits().filter(function(split){return!!split.agent_id&&split.product_id===product_id;});return _.reduce(splits,function(sum,n){return sum&&!!n.commission_subcount_code();},true);};self.get_agent_splits_completion_status=function(product_id){if(!self.has_agent_splits()){return"Complete";}
var splits=self.selected_agent_splits().filter(function(split){return!!split.agent_id&&split.product_id===product_id;});var success=_.reduce(splits,function(sum,n){return sum&&!!n.commission_subcount_code();},true);if(success){return"Complete";}else{return"Incomplete";}};self.is_data_dirty=ko.observable();self.agent_has_percentage=function(agent_id){var agent=_.find(self.case_agents(),function(item){return item.id===agent_id;});if(!agent){return false;}
return _.some(self.selected_agent_splits(),{agent_id:agent.id});};self.agents_with_percentage=ko.computed(function(){return _.filter(self.case_agents(),function(agent){return self.agent_has_percentage(agent.id);});});self.agents_with_percentage_ids=ko.computed(function(){return _.map(self.agents_with_percentage(),function(item){return item.id;});});function AgentSplit(agent_id,product_id,commission_subcount_code,split_percentage,is_added){this.agent_id=agent_id;this.product_id=product_id;this.commission_subcount_code=ko.observable(commission_subcount_code);this.split_percentage=ko.observable(split_percentage);this.is_added=ko.observable(!!is_added);this.valid=ko.computed(function(){if(this.agent_id===null){return true;}
return self.case_agents().filter(function(elem){return elem.id===this.agent_id;}.bind(this)).length>0;},this);this.product_name=(function(){var cur_product=self.products().filter(function(elem){return elem.id===product_id;}).first();return cur_product.name;})();this.toJson=function(){return{agent_id:this.agent_id,product_id:this.product_id,split_percentage:this.split_percentage(),commission_subcount_code:this.commission_subcount_code()};};this.commission_subcount_code.subscribe(function(){self.is_data_dirty(true);});this.split_percentage.subscribe(function(){self.is_data_dirty(true);});}
self.get_or_create_split=function(agent_id,product_id){var current_split=self.selected_agent_splits().filter(function(elem){return elem.agent_id===agent_id&&elem.product_id===product_id;}).first();if(current_split){return current_split;}else{var split=new AgentSplit(agent_id,product_id);self.selected_agent_splits.push(split);return split;}};0
self.has_products=ko.computed(function(){return!!self.products()&&self.products().length>0;});function get_initial_splits(){return case_data.agent_splits.filter(function(elem){return _.find(self.products(),function(product){return product.id===elem.product_id;})!==undefined;}).map(function(elem){return new AgentSplit(elem.agent_id,elem.product_id,elem.commission_subcount_code,elem.split_percentage);});}
function get_initial_split_agents(){var agentIds=_.chain(case_data.agent_splits).filter(function(split){return!!split.split_percentage&&_.find(self.case_agents(),{id:split.agent_id});}).map(function(split){return split.agent_id;}).uniq().value();if(agentIds.indexOf(null)===-1){agentIds.splice(0,0,null);}
return agentIds;}
self.is_self_enrollment=ko.observable(case_data.is_self_enrollment);self.is_self_enrollment.subscribe(function(){if(!self.is_self_enrollment()){bootbox.confirm('<h3>Any self-enrollment links you have sent out <u class="text-danger">will no longer work</u> if you turn off self-enrollment.</h3><p>Click <em>OK</em> to turn it off, or <em>Cancel</em> to leave it on.</p>',function(result){self.is_self_enrollment(!result);});}});self.self_enrollment_type=ko.observable(case_data.self_enrollment_type);self.enrolling_agent_id=ko.observable(case_data.self_enrollment_setup.enrolling_agent_id);if(!self.get_open_enrollment_period()){self.enrollment_periods.push(new CaseEnrollmentPeriod({case_id:case_data.id,period_type:"open_with_start"}));}
if(self.annual_enrollment_periods().length<4){var num_missing=4-self.annual_enrollment_periods().length;_.each(_.range(num_missing),function(){var p=new CaseEnrollmentPeriod({case_id:case_data.id,period_type:"annual_period"});self.enrollment_periods.push(p);});}
function get_annual_periods_after_period(period){var periods=self.annual_enrollment_periods();return _.filter(periods,function(p){return periods.indexOf(p)>periods.indexOf(period);});}
function compute_next_quarter_start(m){return m.add(3,"months");}
function compute_period_end(start,months){return start.add(months,"months").subtract(1,"day");}
function compute_quarterly_dates(period,val){if(val&&period.is_valid_month_day(val)&&period.end_date()===""){var computed_date=compute_period_end(period.get_month_day(val),2);period.end_date(computed_date.format("MM/DD"));var remaining_periods=get_annual_periods_after_period(period);var previous_period=period;$.each(remaining_periods,function(){var rp=this;if(!rp.is_valid()){var previous_start=previous_period.get_month_day(previous_period.start_date());var computed_start=compute_next_quarter_start(previous_start);rp.start_date(computed_start.format("MM/DD"));var computed_finish=compute_period_end(computed_start,1);rp.end_date(computed_finish.format("MM/DD"));}else{return false;}
previous_period=rp;});}}
var first_period=self.annual_enrollment_periods()[0];first_period.start_date.extend({notify:'always'});first_period.start_date.subscribe(function(val){compute_quarterly_dates(first_period,val);});_.each(self.annual_enrollment_periods(),function(period){_.each([period.start_date,period.end_date],function(date_observable){date_observable.subscribe(function(val){if(val===""){return;}
var val_date=parse_month_date_input(val);if(!val_date.isValid()){date_observable("");bootbox.dialog({title:"Invalid Date",message:"The value '"+val+"' is not a valid start or end date. Provide a month and date formatted as 'MM/DD'.",buttons:{main:{label:"OK"}}});}});});});self.census_data=ko.observable(true);self.has_census_data=ko.pureComputed(function(){return self.census_data();});self.flash_messages=new FlashMessages();if(self.can_edit_case){var fields=[self.company_name,self.group_number,self.products,self.enrollment_period_type,self.enrollment_periods,self.situs_city,self.situs_state,self.payment_mode,self.is_active,self.owner_agent_id,self.can_partners_download_enrollments,self.is_self_enrollment,self.selected_agent_splits,self.has_agent_splits];_.each(self.enrollment_periods(),function(p){fields.push(p.start_date);fields.push(p.end_date);});$.each(fields,function(){var field=this;field.subscribe(function(){self.is_data_dirty(true);});});$("#edit-self-enrollment-form").on("change","input, select, [contenteditable]",function(){if(self.is_self_enrollment()){self.is_data_dirty(true);}});}
self.email_batches=ko.observableArray([]);$.getJSON(urls.get_case_api_census_email_batches(case_data.id),function(data){self.email_batches(data.data);});self.batch_preview=function(batch){window.open(urls.get_case_api_census_email_batch_preview_url(case_data.id,batch.id),"batchView","menubar=no,location=no,resizable=no,width=650,height=600,scrollbars=yes,status=yes");};self.load_logs=function(batch){$("#log"+batch.id).html("Loading Logs...");$.get(urls.get_case_api_census_email_batch_logs_url(case_data.id,batch.id),function(data){$("#log"+batch.id).html(data);$("#log"+batch.id+" .dt-responsive").dataTable();$("#log"+batch.id+" .dt-responsive .status").each(function(){$(this).html(format_enrollment_status_html($(this).text()));});});};self.can_activate_case=ko.computed(function(){var is_valid=(self.enrollment_period_type()!==null&&self.enrollment_periods().length>0&&self.products().length>0&&$.trim(self.company_name())!==""&&$.trim(self.situs_city())!==""&&self.selected_statecode()!==null&&self.selected_payment_mode()!==null&&self.owner_agent_id()>0);return is_valid;});self.is_active.subscribe(function(value){if(value&&!self.can_activate_case()){bootbox.alert("Cannot activate case for enrollment until settings are complete.");self.is_active(false);}
self.toggle_enrollment_buttons();});self.toggle_enrollment_buttons=function(){if(self.is_active()){$("button.enroll-employee").prop('disabled',false);}else{$("button.enroll-employee").prop('disabled',true);}};self.toggle_enrollment_buttons();self.switch_label=ko.computed(function(){if(self.is_active()){return"Case is Active";}else{return"Case is Not Active";}});self.get_form_error=ko.pureComputed(function(){if(self.company_name.is_unique!==undefined&&self.company_name.is_unique()===false){return"The name '"+self.company_name()+"' is already used.";}
return"";});self.check_unique_name=function(current_value,callback){$.get(urls.get_cases_api_url(case_data.id),{by_name:current_value},function(result){var is_unique=(result.data.length===0||current_value===case_data.company_name);callback(is_unique);},"json");};self.validate_splits=function(){if(!self.has_agent_splits()){return true;}
if(!_.all(self.products(),self.has_proper_split_percentage_sum)){var invalid_product=_.find(self.products(),_.negate(self.has_proper_split_percentage_sum));var bad_sum=self.sum_split_percentages_for_product(invalid_product);bootbox.alert("Agent splits for "+invalid_product.name+" must total 100%; the current total percentage is "+bad_sum+"%");return false;}
return true;};self.has_proper_split_percentage_sum=function(product){var product_split_sum=self.sum_split_percentages_for_product(product);return product_split_sum===100;};self.sum_split_percentages_for_product=function(product){var splits=self.selected_agent_splits();var splits_for_product_with_percentage=splits.filter(function(elem){return elem.product_id===product.id&&parseInt(elem.split_percentage())>0;});return splits_for_product_with_percentage.reduce(function(acc,split){return acc+parseInt(split.split_percentage(),0);},0);};self.validate=function(){hide_all_errors();_.invoke(self.annual_enrollment_periods(),"error","");var errors={};var unique_name_error=self.get_form_error();if(unique_name_error!==""){add_case_error(errors,"company_name",unique_name_error);}
if($.trim(self.company_name())===""){add_case_error(errors,"company_name","Company name is required.");}
if(self.is_open_enrollment()&&!self.get_open_enrollment_period().is_valid()){var start=self.get_open_enrollment_period().start_date();var end=self.get_open_enrollment_period().end_date();if(end!==''){if(!is_valid_date(end)){add_case_error(errors,"open_enrollment_end_date","Enter valid End Date");}
else if(start===''){add_case_error(errors,"open_enrollment_start_date","Enter valid Start Date or both dates blank");}}
if(start!==''&&!is_valid_date(start)){add_case_error(errors,"open_enrollment_start_date","Enter valid Start Date");}
if(start!==''&&end!==''&&parse_date(start)>parse_date(end)){add_case_error(errors,"open_enrollment_start_date","Start Date comes after End Date");}}
if(self.is_annual_enrollment()&&self.any_annual_period_missing_a_component()){var missing_observables=_.filter(self.annual_enrollment_periods(),self.missing_annual_period_predicate);_.invoke(missing_observables,"error","Must fill in start and end date");return false;}
if(Object.keys(errors).length>0){show_all_errors(errors);return false;}else{return true;}};self.missing_annual_period_predicate=function(period){var start_date_present=period.start_date()!=="";var end_date_present=period.end_date()!=="";return(start_date_present?!end_date_present:end_date_present);};self.any_annual_period_missing_a_component=function(){return _.any(self.annual_enrollment_periods(),self.missing_annual_period_predicate);};self.serialize_case=function(){var partner_agents=_.map(self.partner_agents(),function(id_str){return parseInt(id_str);});return{company_name:self.company_name(),group_number:self.group_number(),active:self.is_active(),products:self.products(),partner_agents:partner_agents,enrollment_period_type:self.enrollment_period_type(),situs_city:self.situs_city(),situs_state:self.selected_statecode()?self.selected_statecode():"",payment_mode:self.selected_payment_mode()?self.selected_payment_mode():null,agent_id:self.owner_agent_id(),can_partners_download_enrollments:self.can_partners_download_enrollments(),is_self_enrollment:self.is_self_enrollment(),include_bank_draft_form:self.include_bank_draft_form(),should_use_call_center_workflow:self.should_use_call_center_workflow(),product_settings:self.serialize_product_settings(),is_stp:Boolean(self.has_agent_splits()),occupation_class_settings:self.occupation_classes()};};self.serialize_product_settings=function(){return{riders:self.serialize_riders(),classification_mappings:self.serialize_occ_mapping()};};self.serialize_riders=function(){return _.invoke(self.case_riders(),"serialize");};self.serialize_enrollment_periods=function(){if(self.is_annual_enrollment()){return _.invoke(_.filter(self.annual_enrollment_periods(),function(p){return p.is_valid();}),"serialize");}else{var period=self.get_open_enrollment_period();return[period.serialize()];}};function removeHarmfulEmailTags(message){var allowedTags=["br","span","strong","b","i","em","emphasis","img","a"]
var base=$("<div>"+message+"</div>")[0].childNodes;var mapped=Array.prototype.map.call(base,function(elem,a){if(elem.tagName){var tagName=elem.tagName.toLowerCase();if(allowedTags.indexOf(tagName)===-1){elem=$(elem).contents().unwrap()[0]}}
return elem;});var htmlstr=Array.prototype.reduce.call(base,function(html,node){return html+(node.outerHTML||node.nodeValue);},"");return htmlstr;}
self.serialize_self_enroll=function(){self.emailSettings.message(removeHarmfulEmailTags(self.emailSettings.message()));var settings=$.extend({},self.emailSettings,self.landing);for(var key in settings){if(settings.hasOwnProperty(key)){settings[key]=settings[key]();}}
return{self_enrollment_type:self.self_enrollment_type(),enrolling_agent_id:self.enrolling_agent_id(),email_sender_email:settings.sender_email,email_sender_name:settings.sender_name,email_subject:settings.subject,email_greeting_type:settings.greeting_type,email_greeting_salutation:settings.greeting_salutation,email_message:settings.message,page_title:settings.page_title,page_text:settings.page_text};};self.serialize_agent_splits=function(){var serialized_records=self.selected_agent_splits();serialized_records=_.filter(serialized_records,function(split){return _.some(self.case_agents(),{'id':split.agent_id})||split.agent_id===null;});return serialized_records.reduce(function(start,elem){if(elem.split_percentage()||elem.commission_subcount_code()){start.push(elem.toJson());}
return start;},[]);};self.loading_modal=ko.observable(null);self.save_settings=function(cb){self.flash_messages.clear();if(!self.can_save_case()){return;}
self.loading_modal({message:"Saving case..."});if(self.is_active()&&!self.can_activate_case()){self.is_active(false);self.flash_messages.flash_error("The case has been deactivated due to missing settings.");}
var case_request=send_json_data("PUT",urls.get_case_api_url(case_data.id),self.serialize_case());var periods_request=send_json_data("PUT",urls.get_case_api_enrollment_periods_url(case_data.id),self.serialize_enrollment_periods());var self_enroll_request;if(self.is_self_enrollment()){self_enroll_request=send_json_data("PUT",urls.get_case_api_self_enrollment_url(case_data.id),self.serialize_self_enroll());}
var agent_splits_request;if(self.has_agent_splits()){agent_splits_request=send_json_data("PUT",urls.get_case_api_agent_splits_url(case_data.id),self.serialize_agent_splits());}
$('#save-success').hide();$('#save-fail').hide();var on_success=function(case_xhr,periods_xhr,self_enroll_xhr){self.is_data_dirty(false);self.flash_messages.flash_success("Data Saved");$("#save-success").text("Data Saved");self.loading_modal(null);};var on_failure=function(failed_xhr){var errors=failed_xhr.responseJSON.errors||[];show_all_errors(errors);self.loading_modal(null);self.flash_messages.flash_error("Save failed. Please correct any errors below.");};var done;if(!self.is_self_enrollment()){done=$.when(case_request,periods_request);}else{done=$.when(case_request,periods_request,self_enroll_request);}
if(cb&&typeof(cb)==="function"){cb(done);self.loading_modal(null);return;}
done.then(on_success,on_failure);return false;};self.can_save_case=function(){if(!self.can_edit_case){self.flash_messages.flash_error("Only the case owner agent or home office can make changes to the case.");return false;}
if(!self.validate()){self.flash_messages.flash_error("Please correct any errors below before saving.");return false;}
if(!self.validate_splits()){self.flash_messages.flash_error("Please correct any errors below before saving.");return false;}
if(self.is_active()&&!self.can_activate_case()){self.is_active(false);self.flash_messages.flash_error("The case has been deactivated due to missing settings.");}
return true;};self.delete_case=function(){bootbox.confirm("Are you sure you want to the case '"+self.company_name()+"'? This is permanent and cannot be undone!",function(result){if(!result){return;}
self.remote_delete();});};self.remote_delete=function(){var request=send_json_data("DELETE",urls.get_case_api_url(case_data.id));$.when(request).then(function(){bootbox.alert("Case deleted successfully");self.is_data_dirty(false);window.location.href=urls.get_manage_cases_url(case_data.id);},function(){bootbox.alert("There was a problem removing this case.");});};self.is_permanent_delete_modal_showing=ko.observable(false);self.delete_confirmation_text=ko.observable("");self.is_delete_text_valid=ko.pureComputed(function(){return self.delete_confirmation_text()=="DELETE";});self.delete_case_with_enrollments=function(){self.delete_confirmation_text("");self.is_permanent_delete_modal_showing(false);self.is_permanent_delete_modal_showing(true);};if(self.can_edit_case){$(window).bind("beforeunload",function(){return self.has_unsaved_data()?"You have made changes without saving. Do you you wish to leave this page and lose all changes?":undefined;});}
self.show_upload_enrollment_form=function(){var el=$("#enrollment-csv-modal");reset_upload_modal(el);el.modal("show");};self.has_unsaved_data=ko.computed(function(){return self.is_data_dirty();});self.exit_print_mode=function(){if(self.report_viewmodel()){self.report_viewmodel().exit_print_preview();}};var setup_tab=$('#case-nav-tabs a[href="#setup"]');var enrollment_tab=$('#case-nav-tabs a[href="#enrollment"]');var history_tab=$('#case-nav-tabs a[href="#history"]');var reports_tab=$('#case-nav-tabs a[href="#reports"]');var api_tab=$('#case-nav-tabs a[href="#api"]');self.sammy_app=Sammy(function(){this.get("#setup",function(){self.exit_print_mode();setup_tab.tab('show');if(!self.can_edit_case){$("#setup").find("input, select, button").prop("disabled",true);}});this.before({except:{path:'#setup'}},function(){if(self.has_unsaved_data()){bootbox.dialog({title:"Unsaved Changes",message:"You have made changes without saving. Please save your changes or discard before leaving this page.",buttons:{main:{label:"Save",className:'btn-primary',callback:function(){self.save_settings();}},danger:{label:"Discard Changes",className:'btn-danger',callback:function(){self.is_data_dirty(false);window.location.reload();}},cancel:{label:"Cancel",className:'btn-default',callback:function(){}}}});this.redirect("#setup");return false;}});this.get("#enrollment",function(){self.exit_print_mode();enrollment_tab.tab('show');setTimeout(load_initial_census_data,0);function load_initial_census_data(){case_management.refresh_census_table(case_data.id,urls.get_case_api_census_records_url(case_data.id),"#census-records-table","#census-table-loading",handle_census_data_loaded_first_time,handle_no_census_data_loaded,handle_census_data_loaded);}
function handle_census_data_loaded_first_time(table,data){case_management.init_status_filter(table);case_management.init_alphabet_search(table);}
function handle_census_data_loaded(table,data){self.census_data(data);self.toggle_enrollment_buttons();}
function handle_no_census_data_loaded(){self.census_data(false);self.toggle_enrollment_buttons();}});this.get("#history",function(){self.exit_print_mode();history_tab.tab('show');setTimeout(function(){$.getJSON(urls.get_case_api_census_email_batches(case_data.id),function(data){self.email_batches(data.data);});},0);});this.get("#reports",function(){self.exit_print_mode();reports_tab.tab('show');if(self.report_viewmodel()){self.report_viewmodel().load_reports();self.report_viewmodel().load_enrollments();}});this.get("#api",function(){self.exit_print_mode();api_tab.tab('show');});this.get("#print",function(){if(self.report_viewmodel()){self.report_viewmodel().enter_print_preview();window.print();}else{window.location="#reports";}});}).run();};var EmployeeMatchViewModel=function(data){var self=this;self.id=data.id;self.first=data.employee_first||"(No First Name)";self.last=data.employee_last||"(No Last Name)";self.ssn=data.employee_ssn;self.birthdate=data.employee_birthdate;self.formatted_birthdate=function(){return moment(self.birthdate,"YYYY-MM-DD").format("MM/DD/YYYY");};self.is_selected=ko.observable(false);};var EnrollmentAPIPanel=function EnrollmentAPIPanel(user_token){var self=this;self.user_token=user_token;self.error_records=ko.observableArray();self.num_records=ko.observable();self.display_error=function(error_record){var msg="";if(error_record.record_num){msg+="Error in record "+error_record.record_num+": ";}
msg+=error_record.fields+': '+error_record.message;return msg;}};var SendEmailsModalViewModel=function SendEmailsModalViewModel(case_settings_vm,settings){var self=this;self.case_settings_vm=case_settings_vm;self.numbers={not_sent:ko.pureComputed(function(){return 0;return self.case_settings_vm.census_data().reduce(function addNotSent(acc,app){return!app.sent_email?acc+1:acc;},0);}),not_enrolled:ko.pureComputed(function(){return 0;return self.case_settings_vm.census_data().reduce(function addNotApplied(acc,app){return app.enrollment_status===null?acc+1:acc;},0);}),declined:ko.pureComputed(function(){return 0;return self.case_settings_vm.census_data().reduce(function addDeclined(acc,app){return app.enrollment_status==='declined'?acc+1:acc;},0);})};self.send_type=ko.observable("");self.emailSettings=self.case_settings_vm.emailSettings;self.num_emails_to_send=ko.pureComputed(function(){if(!self.send_type())return 0;return self.numbers[self.send_type().replace("-","_")]();});self.resetEmail=function(){self.emailSettings.message(settings.default_email_message);self.emailSettings.subject(settings.default_email_subject);};self.errors=ko.observableArray();self.send_emails=function(){self.errors([]);if(self.num_emails_to_send()==0){self.errors.push("There are no census records that match the selected criteria.");return false;}
if(!confirm("You are about to send "+self.num_emails_to_send()+" emails. Are you sure?")){return false;}
self.show_loading_panel();if(window.case_settings.can_edit_case){window.case_settings.save_settings(save_callback);}else{send_emails({});}
function save_callback(promise){promise.then(send_emails,handle_failed_save);}
function handle_failed_save(){bootbox.alert("Sorry, there was a problem saving the case data before sending the emails. No emails were sent.");}
function send_emails(data){$.ajax({url:urls.get_case_email_self_enrollment_batches_url(self.case_settings_vm.case_id)+'?send_type='+self.send_type(),method:'POST',dataType:'json',success:function(results){self.show_finished_panel();var sent_status_list=results.data;$('#email-target-links-modal #email-status-wrap').html(sent_status_list.join('<br>'));},error:function(xhr){self.show_error_panel();}});}};self.show_form_panel=function(){$('#email-target-links-modal .success-buttons').hide();$('#email-target-links-modal .form-buttons').show();$('#email-target-links-modal .modal-panel').hide();$('#email-target-links-modal .form-panel').show();};self.show_loading_panel=function(){$('#email-target-links-modal .form-panel').hide();$('#email-target-links-modal .form-buttons').hide();$('#email-target-links-modal .loading-panel').show();$('#email-target-links-modal .processing-buttons').show();};self.show_finished_panel=function(){$('#email-target-links-modal .loading-panel').hide();$('#email-target-links-modal .success-panel').show();$('#email-target-links-modal .processing-buttons').hide();$('#email-target-links-modal .success-buttons').show();$("#email-target-links-modal .success-buttons button").click(function(){self.show_form_panel();});};self.show_error_panel=function(){$('#email-target-links-modal .loading-panel').hide();$('#email-target-links-modal .processing-buttons').hide();$('#email-target-links-modal .form-buttons').hide();$('#email-target-links-modal .error-panel').show();$('#email-target-links-modal .error-buttons').show();$("#email-target-links-modal .error-buttons button:not(.back-btn)").click(function(){$('#email-target-links-modal .error-buttons').hide();$('#email-target-links-modal .processing-buttons').show();$('#email-target-links-modal .modal-panel').hide();$('#email-target-links-modal .form-panel').show();});};};var wizard_applicant=(function(){var _applicant_count=0;function Applicant(options){var self=this;var defaults={first:"",last:"",email:"",phone:"",birthdate:null,ssn:"",gender:null,height:null,weight:null,is_smoker:null,street_address:"",street_address2:"",city:"",state:"",zip:"",existing_coverages:[]};var applicant_data=$.extend({},defaults,options);self.type=applicant_data.type;self._id=_applicant_count++;self.first=ko.observable(applicant_data.first);self.last=ko.observable(applicant_data.last);self.email=ko.observable(applicant_data.email);self.phone=ko.observable(applicant_data.phone);self.birthdate=ko.observable(normalize_date_of_birth(applicant_data.birthdate));self.ssn=ko.observable(applicant_data.ssn);self.gender=ko.observable(applicant_data.gender);self.height=ko.observable(parseFloat(applicant_data.height)?parseFloat(applicant_data.height):null);self.weight=ko.observable(applicant_data.weight||null);self.is_smoker=ko.observable(applicant_data.is_smoker);self.height_error=ko.observable(null);self.weight_error=ko.observable(null);self.address1=ko.observable(applicant_data.street_address);self.address2=ko.observable(applicant_data.street_address2);self.city=ko.observable(applicant_data.city);self.state=ko.observable(applicant_data.state);self.zip=ko.observable(applicant_data.zip);self.existing_coverages=applicant_data.existing_coverages||[];self.has_valid_gender=ko.pureComputed(function(){return self.gender()!==null;});self.has_valid_height=ko.computed(function(){return self.height()!=null&&self.height()>0&&self.height_error()==null;});self.has_valid_weight=ko.computed(function(){return self.weight()!=null&&self.weight_error()==null;});self.is_valid=ko.computed(function(){return($.trim(self.first())!=""&&$.trim(self.last())!=""&&$.trim(self.birthdate())!="");});self.any_valid_field=ko.computed(function(){return($.trim(self.first())!==""||$.trim(self.last())!==""||$.trim(self.birthdate())!=="");});self.name=ko.computed(function(){if(self.is_valid()){return self.first();}else{return"";}});self.get_age=ko.computed(function(){return age_for_date(self.birthdate());});self.is_age_in_band=function(min_age,max_age){var is_in_band=true;if(min_age!==null){is_in_band=is_in_band&&self.get_age()>=min_age;}
if(max_age!==null){is_in_band=is_in_band&&self.get_age()<=max_age;}
return is_in_band;};self.serialize_data=function(){var data={};data.first=self.first();data.last=self.last();data.email=self.email();data.age=self.get_age();data.weight=self.weight();data.height=self.height();data.is_smoker=self.is_smoker();data.birthdate=self.birthdate();data.ssn=self.ssn();data.gender=self.gender();data.phone=self.phone();data.address1=self.address1();data.address2=self.address2();data.city=self.city();data.state=self.state();data.zip=self.zip();return data;};self.get_existing_coverage_amount_for_product=function(product_id){var amount=self.get_existing_coverage_amount_by_product()[product_id];if(!amount){return 0;}
return parseFloat(amount);};self.get_existing_coverage_amount_by_product=function(){return _.reduce(self.existing_coverages,function(by_product_id,coverage){if(!(coverage.product.id in by_product_id)){by_product_id[coverage.product.id]=0.0;}
if(coverage.coverage_status==='enrolled'){by_product_id[coverage.product.id]+=parseFloat(coverage.coverage_face_value);}
return by_product_id;},{});};}
Applicant.EmployeeType="employee";Applicant.SpouseType="spouse";Applicant.ChildType="children";var ApplicantGroup=function(options,applicants){var self=this;self.type=options.type;self.applicants=applicants;self._id=_applicant_count++;self.is_valid=ko.computed(function(){return _.all(self.applicants(),function(applicant){return(applicant.any_valid_field()&&applicant.is_valid())||!applicant.any_valid_field();});});self.name=ko.pureComputed(function(){var non_empty_name_applicants=_.filter(self.applicants(),function(applicant){return $.trim(applicant.name())!=="";});return _.invoke(non_empty_name_applicants,"name").join(", ");});self.is_age_in_band=function(min_age,max_age){return self.all_ages_in_band(min_age,max_age);};self.all_ages_in_band=function(min_age,max_age){var is_in_band=true;if(min_age!==null){is_in_band=is_in_band&&_.all(self.applicants(),function(applicant){return applicant.get_age()>=min_age;});}
if(max_age!==null){is_in_band=is_in_band&&_.all(self.applicants(),function(applicant){return applicant.get_age()<=max_age;});}
return is_in_band;};self.any_valid_field=function(){return _.any(self.applicants(),function(applicant){return applicant.any_valid_field();});};self.serialize_data=function(){return{type:self.type,applicants:_.map(self.applicants(),function(applicant){return applicant.serialize_data();})};};self.get_existing_coverage_amount_for_product=function(product_id){if(self.applicants().length===0){return 0;}
return self.applicants()[0].get_existing_coverage_amount_for_product(product_id);};};var ApplicantList=function(initial_list,should_show_spouse,should_show_children){this.applicants=ko.observableArray(initial_list||[]);this.children=ko.pureComputed(this.get_children,this);this._children_group=null;this.should_show_spouse=should_show_spouse;this.should_show_children=should_show_children;this.get_valid_applicants_for_coverage=ko.pureComputed(this._get_valid_applicants_for_coverage,this);this.get_valid_applicants=ko.pureComputed(this._get_valid_applicants,this);if(this.get_employee()===undefined){this.applicants.push(create_applicant({type:Applicant.EmployeeType}));}
if(this.get_spouse()===undefined){this.applicants.push(create_applicant({type:Applicant.SpouseType,last:this.get_employee().last()}));}};ApplicantList.prototype={_get_valid_applicants_for_coverage:function(){var applicants=[];if(this.has_valid_employee()){applicants.push(this.get_employee());}
if(this.should_show_spouse()&&this.has_valid_spouse()){applicants.push(this.get_spouse());}
if(this.should_show_children()&&this.has_valid_children()){applicants.push(this.get_children_group());}
return applicants;},_get_valid_applicants:function(){return _.filter(vm.coverage_vm.applicants.applicants(),function(a){return a.is_valid();});},get_employee:function(){return this._find_applicant_by_type(Applicant.EmployeeType);},get_spouse:function(){return this._find_applicant_by_type(Applicant.SpouseType);},get_children:function(){return _.filter(this.applicants(),function(a){return a.type===Applicant.ChildType;});},get_children_group:function(){if(this._children_group===null){this._children_group=new ApplicantGroup({type:Applicant.ChildType},this.children);}
return this._children_group;},has_valid_employee:function(){return this.get_employee()&&this.get_employee().is_valid();},has_valid_spouse:function(){return this.get_spouse()&&this.get_spouse().is_valid();},has_valid_children:function(){return _.any(this.get_children(),function(c){return c.is_valid();});},get_valid_children:function(){return _.filter(this.get_children(),function(c){return c.is_valid();});},add_applicant:function(applicant){this.applicants.push(applicant);},remove_applicant:function(applicant){this.applicants.remove(applicant);},_find_applicant_by_type:function(applicant_type){return _.find(this.applicants(),function(applicant){return applicant.type===applicant_type;});}};function age_for_date(date){var bd=parse_date(date,"MM/DD/YYYY");if(bd.isValid()){if(bd.isAfter(now())){return-1;}else{return now().diff(bd,"years");}}else{return"";}}
function create_applicant(options){return new Applicant(options);}
return{Applicant:Applicant,ApplicantGroup:ApplicantGroup,ApplicantList:ApplicantList,create_applicant:create_applicant,age_for_date:age_for_date};})();var beneficiary=(function(){"use strict";function Beneficiary(options){var self=this;var defaults={name:"",relationship:"",ssn:"",date_of_birth:"",is_nonperson_entity:false};options=$.merge({},defaults,options);self.name=ko.observable(options.name);self.relationship=ko.observable(options.relationship);self.ssn=ko.observable(options.ssn);self.date_of_birth=ko.observable(options.date_of_birth);self.is_nonperson_entity=ko.observable(options.is_nonperson_entity);self.date_of_birth_validation_error=ko.observable(null);self.date_of_birth.subscribe(function(value){self.date_of_birth_validation_error(get_date_of_birth_validation_error(value));});self.serialize=function(){return{name:self.name(),relationship:self.relationship(),ssn:self.ssn(),date_of_birth:self.date_of_birth(),is_nonperson_entity:self.is_nonperson_entity()};};}
return{Beneficiary:Beneficiary};})();function CoverageOption(options){var self=this;self.is_by_face=options.is_by_face;self.premium=options.premium;self.payment_mode=options.payment_mode;self.face_value=options.face_value;self.applicant_type=options.applicant_type;self.get_total_premium=function(){return self.premium;};self.format_premium=function(){return format_premium_value(self.premium);};self.format_premium_option=function(){return self.format_premium()+" "+self.payment_mode().display_lowercase();};self.format_face_value=function(){return format_face_value(self.face_value);};self.format_face_option=function(){return self.format_face_value()+" face amount";};self.format_for_dropdown=function(){if(self.is_by_face){return self.format_face_option();}else{return self.format_premium_option();}};self.is_valid=function(){return true;};self.serialize_data=function(){return{premium:self.premium,face_value:self.face_value}}}
CoverageOption.display_benefit_option=function(item){return item.format_for_dropdown();};function CICoverageOption(wrapped_option){var self=this;self.is_by_face=wrapped_option.is_by_face;self.premium=wrapped_option.premium;self.get_total_premium=wrapped_option.get_total_premium;self.face_value=wrapped_option.face_value;self.format_premium=wrapped_option.format_premium;self.format_premium_option=wrapped_option.format_premium_option;self.format_face_value=function(){var face_value_formatted=format_face_value(self.face_value);var ci_value=Math.round(self.face_value*.3);var ci_value_formatted=format_face_value(ci_value);return face_value_formatted+"<br><small>("+ci_value_formatted+" CI)</small>";};self.format_for_dropdown=wrapped_option.format_for_dropdown;self.is_valid=wrapped_option.is_valid;self.serialize_data=wrapped_option.serialize_data;self.payment_mode=wrapped_option.payment_mode;self.applicant_type=wrapped_option.applicant_type;}
function NullCoverageOption(){'use strict';var self=this;self.is_by_face=true;self.premium=0;self.face_value=0;self.is_removed_from_product=ko.observable(false);self.is_valid=function(){return false;};self.format_premium_option=function(){return"";};self.format_premium=function(){};self.get_total_premium=function(){return 0;};self.format_face_value=function(){return"- no benefit -";};self.format_for_dropdown=function(){return"- no benefit -";};self.serialize_data=function(){return{};};self.payment_mode=function(){return null;};}
var health_question_buttons=(function(){function HealthButtonRow(question,product_coverage,product_health_questions){var self=this;self.question=question;self.product_coverage=product_coverage;self.product_health_questions=product_health_questions;self.button_groups=ko.pureComputed(function(){return _.map(self.product_coverage.applicant_list.get_valid_applicants(),function(applicant){var response=self.product_health_questions.get_applicant_answer_for_question(applicant,question);return new ResponseButtonGroup(question,applicant,response,{});});});}
function ResponseButtonGroup(question,applicant,response,options){var self=this;self.question=question;self.applicant=applicant;self.response=response;self.yes_text=options.yes_text||"Yes";self.no_text=options.yes_text||"No";self.yes_highlight=self.question.get_yes_highlight();self.no_highlight="checkmark";self.handle_yes=function(){self.response.value('Yes');self.question.show_yes_dialogue(self.applicant);};self.handle_no=function(){self.response.value('No');};self.does_applicant_need_to_answer=ko.pureComputed(function(){return self.question.does_applicant_need_to_answer(self.applicant);});self.should_show_yes_flag=ko.pureComputed(function(){return self.response.value()==="Yes"&&self.yes_highlight==="flag";});self.should_show_yes_stop=ko.pureComputed(function(){return self.response.value()==="Yes"&&self.yes_highlight==="stop";});self.should_show_yes_checkmark=ko.pureComputed(function(){return self.response.value()==="Yes"&&self.yes_highlight==="checkmark";});self.should_show_yes_default=ko.pureComputed(function(){return self.response.value()!=="Yes";});self.should_show_no_flag=ko.pureComputed(function(){return self.response.value()==="No"&&self.no_highlight==="flag";});self.should_show_no_stop=ko.pureComputed(function(){return self.response.value()==="No"&&self.no_highlight==="stop";});self.should_show_no_checkmark=ko.pureComputed(function(){return self.response.value()==="No"&&self.no_highlight==="checkmark";});self.should_show_no_default=ko.pureComputed(function(){return self.response.value()!=="No";});}
function are_health_questions_valid(){if(window.vm.should_show_other_insurance_questions()&&window.vm.is_in_person_application()&&general_questions_by_id['existing_insurance'].get_val()===null){return false;}
if(window.vm.should_show_other_insurance_questions()&&(!window.vm.did_select_any_fpp_product()&&general_questions_by_id['replace_insurance'].get_val()!="No")||(window.vm.did_select_any_fpp_product()&&general_questions_by_id['replace_insurance'].get_val()===null)){return false;}
if(window.vm.did_select_any_fpp_product()){if(window.vm.is_employee_actively_at_work()===null){return false;}}
var valid=true;_.each(window.vm.selected_product_health_questions(),function(product_health_questions){_.each(product_health_questions.health_button_rows(),function(health_button_row){_.each(health_button_row.button_groups(),function(button_group){if(button_group.does_applicant_need_to_answer()){if(!button_group.question.does_yes_stop_app()&&button_group.response.value()===null){valid=false;return false;}else if(button_group.question.does_yes_stop_app()&&button_group.response.value()!=="No"){valid=false;return false;}}});if(!valid){return false;}});if(!valid){return false;}});return valid;}
return{HealthButtonRow:HealthButtonRow,ResponseButtonGroup:ResponseButtonGroup,are_health_questions_valid:are_health_questions_valid}})();function QuestionButton(element,val,highlight_func,unhighlight_func){var self=this;self.elements=[$(element)];self.val=val;self.highlight=function(){$.each(self.elements,function(){highlight_func(this);});};self.unhighlight=function(){$.each(self.elements,function(){unhighlight_func(this);});};}
function QuestionButtonGroup(question,is_required){var self=this;self.question=question;self.buttons=[];self.selected_btn=ko.observable(null);self.is_required=is_required;self.get_val=ko.computed(function(){if(self.selected_btn()==null){return false;}else{return self.selected_btn().val;}});self.add_button=function(element,val,high_func,unhigh_func){var btn=null;$.each(self.buttons,function(){if(this.val==val){btn=this;}});if(btn){btn.elements.push(element);}else{self.buttons.push(new QuestionButton(element,val,high_func,unhigh_func));}};self.click_button=function(val){var btn=null;$.each(self.buttons,function(){if(this.val==val){btn=this;}
this.unhighlight();});btn.highlight();self.selected_btn(btn);};}
var general_questions_by_id={};ko.bindingHandlers.flagBtn={init:function(element,value_accessor){var val=ko.unwrap(value_accessor());$(element).addClass("flagBtn").addClass("val_"+val.val);var btn_group;if(val.applicant){var applicant=val.applicant;var product_health_questions=val.product_health_questions;var applicant_coverage=product_health_questions.product_coverage.__get_coverage_for_applicant(applicant);var question_text=val.question.get_question_text();btn_group=null;if(!btn_group){btn_group=new QuestionButtonGroup(val.question,val.is_required);}}else{var group_lookup=general_questions_by_id;if(val.question.get_question_text()in group_lookup){btn_group=group_lookup[val.question.get_question_text()];}else{btn_group=new QuestionButtonGroup(val.question,val.is_required);group_lookup[val.question.get_question_text()]=btn_group;}
if(val.is_selected===true){btn_group.click_button(val.val);}}
btn_group.add_button(element,val.val,function(el){var highlight_type;if(typeof val.highlight==="function"){highlight_type=val.highlight();}else{highlight_type=val.highlight;}
if(highlight_type==="flag"){$(el).prepend('<i class="icon glyphicon glyphicon-flag"></i>').addClass("btn btn-warning");}else if(highlight_type==="checkmark"){$(el).prepend('<i class="icon glyphicon glyphicon-ok"></i>').addClass("btn-success");}else if(highlight_type==="stop"){$(el).prepend('<i class="icon glyphicon glyphicon-remove"></i>').addClass("btn-danger");}},function(el){$(el).removeClass("btn-success btn-warning btn-danger").addClass("btn-default");$(el).find(".glyphicon").remove();});$(element).on("click",function(){btn_group.click_button(val.val);if(val.onclick){val.onclick();}});if(btn_group.selected_btn&&btn_group.selected_btn.val==val.val){btn_group.click_button(val.val);}},update:function(element,value_accessor){}};function handle_existing_insurance_modal(){if(window.vm.did_select_any_fpp_product()){}else{$("#modal_text_existing_warning_title").show();$("#modal_text_replacement_warning_title").hide();$("#modal_text_soh_warning_title").hide();$("#modal_text_existing_warning").show();$("#modal_text_replacement_warning").hide();$("#modal_text_soh_warning").hide();$("#health_modal").modal('show');$("#existing_warning_text").show();}
window.vm.existing_insurance(true);}
function reset_existing_insurance_warning(){window.vm.existing_insurance(false);$("#existing_warning_text_remote").hide();$("#existing_warning_text").hide();}
function handle_replacement_insurance_modal(){if(window.vm.did_select_any_fpp_product()){}else{$("#modal_text_existing_warning_title").hide();$("#modal_text_replacement_warning_title").show();$("#modal_text_soh_warning_title").hide();$("#modal_text_existing_warning").hide();$("#modal_text_existing_warning_remote").hide();$("#modal_text_replacement_warning").show();$("#modal_text_soh_warning").hide();$("#health_modal").modal('show');$("#replacement_warning_text").show();}
window.vm.replacing_insurance(true);}
function reset_replacement_insurance_warning(){$("#replacement_warning_text").hide();window.vm.replacing_insurance(false);}
function handle_question_yes(){$("#modal_text_existing_warning_title").hide();$("#modal_text_replacement_warning_title").hide();$("#modal_text_soh_warning_title").show();$("#modal_text_existing_warning").hide();$("#modal_text_existing_warning_remote").hide();$("#modal_text_replacement_warning").hide();$("#modal_text_soh_warning").show();$("#health_modal").modal('show');}
var health_questions=(function(){'use strict';function ProductHealthQuestions(product_coverage,spouse_questions,all_health_questions){var self=this;self.product_coverage=product_coverage;self.health_questions=ko.pureComputed(function(){var questions=health_questions.process_spouse_question_data(spouse_questions,self.product_coverage);var soh_questions=health_questions.process_health_question_data(all_health_questions,self.product_coverage);$.merge(questions,soh_questions);return questions;});self.show_yes_dialogue=function(applicant,message){var button_options={remove:{label:"Remove this applicant",className:'btn-danger',callback:function(){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);if(applicant.type===wizard_applicant.Applicant.ChildType){self.product_coverage.applicant_list.remove_applicant(applicant);}else{var null_option=_.find(applicant_coverage_options,function(o){return o.face_value===0;});self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(null_option);}
decline_product_if_no_coverage(self.product_coverage);}},ignore:{label:"Ignore and Continue",className:'btn-default',callback:function(){}}};var product_name=self.product_coverage.format_product_name();message=message||"A \"yes\" response to this question disqualifies this person from obtaining coverage for "+"'"+product_name+"'. You may proceed with this application after removing this individual from the "+"coverage selection before proceeding.";bootbox.dialog({message:message,buttons:button_options});};self.health_button_rows=ko.pureComputed(function(){return _.map(self.health_questions(),function(question){return new health_question_buttons.HealthButtonRow(question,self.product_coverage,self);});});self.do_any_health_questions_need_answering=function(){if(self.health_questions().length==0){return false;}
if(self.product_coverage.product.is_fpp_product()){return true;}
return _.any(self.health_questions(),function(question){return question.does_any_applicant_need_to_answer();});};self._health_question_responses=[];self.get_applicant_answer_for_question=function(applicant,question){var found_response=_.find(self._health_question_responses,function(response){return response.question===question&&response.applicant===applicant;});if(found_response===undefined){var resp=new HealthQuestionResponse(question,applicant,null);self._health_question_responses.push(resp);return resp;}else{return found_response;}};self.serialize_answers_for_applicant=function(applicant){return _.map(self.health_questions(),function(question){var response=self.get_applicant_answer_for_question(applicant,question);return response.serialize();});};}
function HealthQuestionResponse(question,applicant,initial_response){var self=this;self.question=question;self.applicant=applicant;self.value=ko.observable(initial_response);self.serialize=function(){var answer=null;if(self.question.does_applicant_need_to_answer(self.applicant)){answer=self.value();}else if(self.question.can_applicant_skip_due_to_GI(self.applicant)){answer='GI';}
return{question:self.question.get_question_text(),label:self.question.get_question_label(),is_spouse_only:self.question.is_spouse_only(),answer:answer};};}
function process_spouse_question_data(question_data_by_product,product_coverage){var questions=[];var product_data=product_coverage.product.product_data;_.each(question_data_by_product,function(product_questions,product_id){if(product_id==product_data.id){var question_factory;if(product_coverage.product.product_data.is_guaranteed_issue){question_factory=function(question_data){return new GIHealthQuestion(product_coverage.product,question_data,product_coverage,product_data.gi_criteria,product_data.statement_of_health_bypass_type,product_data.bypassed_soh_questions);};}else{question_factory=function(question_data){return new StandardHealthQuestion(question_data,product_coverage);}}
questions=_.map(product_questions,question_factory);}});return questions;}
function process_health_question_data(health_question_data_by_product,product_coverage){var questions=[];var product_data=product_coverage.product.product_data;_.each(health_question_data_by_product,function(product_health_questions,product_id){if(product_id==product_data.id){var question_factory;if(product_data.is_guaranteed_issue){question_factory=function(question_data){return new GIHealthQuestion(product_coverage.product,question_data,product_coverage,product_data.gi_criteria,product_data.statement_of_health_bypass_type,product_data.bypassed_soh_questions);};}else if(product_coverage.product.product_type=="Group CI"){question_factory=function(question_data){return new GIHealthQuestion(product_coverage.product,question_data,product_coverage,[{guarantee_issue_amount:10000,applicant_type:'Employee',age_max:null,age_min:null,weight_min:null,weight_max:null,height_min:null,height_max:null},{guarantee_issue_amount:25000,applicant_type:'Child',age_max:null,age_min:null,weight_min:null,weight_max:null,height_min:null,height_max:null}],"selected",[{question_type_label:"5yr Heart"},{question_type_label:"5yr Hypertension / Cholesterol"},{question_type_label:"5yr Lung / Colon"},{question_type_label:"5yr Skin Cancer"},{question_type_label:"5yr HPV/HSV"},{question_type_label:"Abnormal Results"},{question_type_label:"Ever been rejected"}]);};}else{question_factory=function(question_data){return new StandardHealthQuestion(question_data,product_coverage);};}
questions=_.map(product_health_questions,question_factory);}});return questions;}
return{ProductHealthQuestions:ProductHealthQuestions,HealthQuestionResponse:HealthQuestionResponse,process_health_question_data:process_health_question_data,process_spouse_question_data:process_spouse_question_data};})();var GlobalSOHQuestion=function(question_text){var self=this;self.question_text=question_text;};GlobalSOHQuestion.prototype.get_question_text=function(){return this.question_text;};var NonHealthQuestion=function(question_text){var self=this;self.question_text=question_text;};NonHealthQuestion.prototype.get_question_text=function(){return this.question_text;};function decline_product_if_no_coverage(product_coverage){'use strict';if(!product_coverage.did_select_valid_coverage()){if(window.vm.coverage_vm.has_multiple_products()){product_coverage.did_decline(true);}else{window.vm.did_decline(true);}}
if(window.vm.did_decline_all_products()){window.vm.set_wizard_step(1);}}
var StandardHealthQuestion=function(question,product_coverage){var self=this;self.product_coverage=product_coverage;self.question=question;self.does_employee_need_to_answer=ko.computed(function(){if(self.question.is_spouse_only){return false;}
return self.product_coverage.did_select_employee_coverage();});self.does_spouse_need_to_answer=ko.computed(function(){return self.product_coverage.did_select_spouse_coverage();});self.does_child_need_to_answer=function(child){if(self.question.is_spouse_only){return false;}
return self.product_coverage.did_select_children_coverage();};self.can_employee_skip_due_to_GI=function(){return false};self.can_spouse_skip_due_to_GI=function(){return false};self.can_child_skip_due_to_GI=function(child){return false};self.show_yes_dialogue_employee=function(){return self.show_yes_dialogue();};self.show_yes_dialogue_spouse=function(){return self.show_yes_dialogue();};self.show_yes_dialogue_child=function(child){return self.show_yes_dialogue();};self.show_yes_dialogue=function(applicant,message){if(!self.does_yes_stop_app()){return;}
var button_options={remove:{label:"Remove this applicant",className:'btn-danger',callback:function(){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);if(applicant.type===wizard_applicant.Applicant.ChildType){self.product_coverage.applicant_list.remove_applicant(applicant);}else{var null_option=_.find(applicant_coverage_options,function(o){return o.face_value===0;});self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(null_option);}
decline_product_if_no_coverage(self.product_coverage);}},ignore:{label:"Ignore and Continue",className:'btn-default',callback:function(){}}};var product_name=self.product_coverage.format_product_name();message=message||"A \"yes\" response to this question disqualifies this person from obtaining coverage for '"+product_name+"'.";bootbox.dialog({message:message+" You may proceed with this application after removing this individual from the coverage selection before proceeding.",buttons:button_options});};self.does_any_applicant_need_to_answer=ko.pureComputed(function(){return _.any(self.product_coverage.applicant_coverage_selections(),function(app_cov){return self.does_applicant_need_to_answer(app_cov.applicant);});});};StandardHealthQuestion.prototype.is_spouse_only=function(){return this.question.is_spouse_only;};StandardHealthQuestion.prototype.get_question_text=function(){return this.question.question_text;};StandardHealthQuestion.prototype.get_question_label=function(){return this.question.label;};StandardHealthQuestion.prototype.does_applicant_need_to_answer=function(applicant){if(applicant.type===wizard_applicant.Applicant.EmployeeType){return this.does_employee_need_to_answer();}
if(applicant.type===wizard_applicant.Applicant.SpouseType){return this.does_spouse_need_to_answer();}
if(applicant.type===wizard_applicant.Applicant.ChildType){if(!applicant.applicants){return this.does_child_need_to_answer(applicant);}else{return _.any(applicant.applicants(),function(child){return this.does_child_need_to_answer(child);},this);}}
return false;};StandardHealthQuestion.prototype.can_applicant_skip_due_to_GI=function(applicant){if(applicant.type===wizard_applicant.Applicant.EmployeeType){return this.can_employee_skip_due_to_GI();}else if(applicant.type===wizard_applicant.Applicant.SpouseType){return this.can_spouse_skip_due_to_GI();}else if(applicant.type===wizard_applicant.Applicant.ChildType){return this.can_child_skip_due_to_GI(applicant);}else{console.error("Invalid applicant type "+applicant.type,applicant);}};StandardHealthQuestion.prototype.get_yes_highlight=function(){return(this.does_yes_stop_app())?'stop':'checkmark';};StandardHealthQuestion.prototype.does_yes_stop_app=function(){return!this.question.is_ignored;};var GIHealthQuestion=function(product,question,product_coverage,applicant_criteria,skip_mode,skipped_questions){'use strict';var self=this;self.product=product;self.product_coverage=product_coverage;self.question=question;self.applicant_criteria=applicant_criteria;self.skip_mode=skip_mode;self.skipped_questions=skipped_questions;self.get_criteria=function(applicant_type){return _.filter(self.applicant_criteria,function(c){return self._clean_criteria_applicant_type(c.applicant_type)===applicant_type;});};self._clean_criteria_applicant_type=function(applicant_type){if(applicant_type==='Employee'){return wizard_applicant.Applicant.EmployeeType;}else if(applicant_type==='Spouse'){return wizard_applicant.Applicant.SpouseType;}else if(applicant_type==='Child'){return wizard_applicant.Applicant.ChildType;}else{return applicant_type;}};self.get_met_gi_criteria_for_employee=ko.computed(function(){var applicant=self.product_coverage.applicant_list.get_employee();var coverage=self.product_coverage.__get_coverage_for_applicant(applicant);var employee_criteria=self.get_criteria(applicant.type);return _.find(employee_criteria,function(criterion){return self.does_applicant_meet_GI_criteria(applicant,coverage,criterion);});});self.has_employee_met_GI_criteria=ko.computed(function(){return self.get_met_gi_criteria_for_employee()!==undefined;});self.get_met_gi_criteria_for_spouse=ko.computed(function(){var applicant=self.product_coverage.applicant_list.get_spouse();var coverage=self.product_coverage.__get_coverage_for_applicant(applicant);var criteria=self.get_criteria(applicant.type);return _.find(criteria,function(criterion){return self.does_applicant_meet_GI_criteria(applicant,coverage,criterion);});});self.has_spouse_met_GI_criteria=ko.computed(function(){return self.get_met_gi_criteria_for_spouse()!==undefined;});self.can_employee_skip_due_to_GI=ko.computed(function(){return self.has_employee_met_GI_criteria()&&self.should_skip_if_GI_criteria_met();});self.can_spouse_skip_due_to_GI=ko.computed(function(){return self.has_spouse_met_GI_criteria()&&self.should_skip_if_GI_criteria_met();});self.get_met_gi_criteria_for_child=function(child_applicant){var criteria=self.get_criteria(child_applicant.type);var children=self.product_coverage.applicant_list.get_children_group();var coverage=self.product_coverage.__get_coverage_for_applicant(children);return _.find(criteria,function(criterion){return self.does_applicant_meet_GI_criteria(child_applicant,coverage,criterion);});};self.has_child_met_GI_criteria=function(child_applicant){return self.get_met_gi_criteria_for_child(child_applicant)!==undefined;};self.show_yes_dialogue_employee=function(){self.show_yes_dialogue(self.product_coverage.applicant_list.get_employee());};self.show_yes_dialogue_spouse=function(){self.show_yes_dialogue(self.product_coverage.applicant_list.get_spouse());};self.show_yes_dialogue_child=function(child){self.show_yes_dialogue(child);};self.get_best_GI_criteria=function(applicant,coverage,criteria){var descendingCriteria=_.sortBy(criteria,function(c){return-c.guarantee_issue_amount;});return _.find(descendingCriteria,function(criterion){return(self.does_applicant_meet_demographic_GI_criteria(applicant,criterion)&&criterion.guarantee_issue_amount<coverage);});};self.show_yes_dialogue=function(applicant,message){var button_options={remove:{label:"Remove this applicant",className:'btn-danger',callback:function(){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);if(applicant.type===wizard_applicant.Applicant.ChildType){self.product_coverage.applicant_list.remove_applicant(applicant);}else{var null_option=_.find(applicant_coverage_options,function(o){return o.face_value===0;});self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(null_option);}
decline_product_if_no_coverage(self.product_coverage);}},ignore:{label:"Ignore and Continue",className:'btn-default',callback:function(){}}};var display_message;if(should_show_reduce_coverage_option(applicant)){add_reduce_option(applicant,button_options);display_message=create_reduce_dialogue_message(applicant);}else{var product_name=self.product_coverage.format_product_name();message=message||"A \"yes\" response to this question disqualifies this person from obtaining coverage for '"+product_name+"'.";display_message=message+" You may proceed with this application after removing this individual from the coverage selection before proceeding.";}
bootbox.dialog({message:display_message,buttons:button_options});};function create_reduce_dialogue_message(applicant){var face_amount=format_face_value(get_cumulative_coverage(applicant));var gi_amount=get_reduced_coverage_criteria(applicant).guarantee_issue_amount;var formatted_gi_amount=format_face_value(gi_amount);return'A "yes" response to this question prohibits this person from obtaining the selected '+face_amount+' of coverage. You may proceed, however, by reducing your coverage to the guaranteed coverage amount of '+formatted_gi_amount+'.'+'<br><br>Alternatively, you may remove this individual from the coverage selection altogether (in Step 1) before proceeding with the rest of the application.';}
function get_cumulative_coverage(applicant){var applicant_coverage=self.product_coverage.__get_coverage_for_applicant(applicant);return applicant_coverage.get_cumulative_coverage_amount();}
function get_reduced_coverage_criteria(applicant){var criteria=self.get_criteria(applicant.type);var coverage_amount=get_cumulative_coverage(applicant);return self.get_best_GI_criteria(applicant,coverage_amount,criteria);}
function should_show_reduce_coverage_option(applicant){if(!self.should_skip_if_GI_criteria_met()){return false;}
if(!get_reduced_coverage_criteria(applicant)){return false;}
if(!find_reduced_coverage_option(applicant)){return false;}
return true;}
function add_reduce_option(applicant,button_options){button_options["reduce"]={label:"Reduce the coverage",className:'btn-success',callback:function(){self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(find_reduced_coverage_option(applicant));}};}
function find_reduced_coverage_option(applicant){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);var applicant_coverage=self.product_coverage.__get_coverage_for_applicant(applicant);var previous_coverage_amount=applicant_coverage.get_previous_coverage_amount();var reduced_gi_criterion=get_reduced_coverage_criteria(applicant);var gi_amount=reduced_gi_criterion.guarantee_issue_amount;var filtered_options=_.filter(applicant_coverage_options,function(o){return o.face_value>0&&(previous_coverage_amount+o.face_value)<=gi_amount;});if(filtered_options.length==0){return null;}
return _.max(filtered_options,function(o){return o.face_value;});}
self.does_employee_need_to_answer=ko.computed(function(){if(!self.product_coverage.did_select_employee_coverage()){return false;}
if(self.can_employee_skip_due_to_GI()){return false;}
if(self.question.is_spouse_only){return false;}
return true;});self.does_spouse_need_to_answer=ko.computed(function(){if(!self.product_coverage.did_select_spouse_coverage()){return false;}
if(self.can_spouse_skip_due_to_GI()){return false;}
return true;});self.can_child_skip_due_to_GI=function(child_applicant){return self.has_child_met_GI_criteria(child_applicant)&&self.should_skip_if_GI_criteria_met();};self.does_child_need_to_answer=function(child_applicant){if(!self.product_coverage.did_select_children_coverage()){return false;}
if(self.can_child_skip_due_to_GI(child_applicant)){return false;}
if(self.question.is_spouse_only){return false;}
return true;};self.does_any_applicant_need_to_answer=ko.computed(function(){return _.any(self.product_coverage.applicant_coverage_selections(),function(app_cov){return self.does_applicant_need_to_answer(app_cov.applicant);});});};GIHealthQuestion.prototype=Object.create(StandardHealthQuestion.prototype);GIHealthQuestion.prototype.does_applicant_meet_GI_criteria=function(applicant,coverage,criterion){return(this.does_applicant_meet_coverage_GI_criteria(applicant,coverage,criterion)&&this.does_applicant_meet_demographic_GI_criteria(applicant,criterion));};GIHealthQuestion.prototype.does_applicant_meet_coverage_GI_criteria=function(applicant,applicant_coverage,criterion){var self=this;return applicant_coverage.get_cumulative_coverage_amount()<=criterion.guarantee_issue_amount;};GIHealthQuestion.prototype.does_applicant_meet_demographic_GI_criteria=function(applicant,criterion){var does_meet=true;if(criterion.age_max!==null){does_meet&=applicant.get_age()<=criterion.age_max;}
if(criterion.age_min!==null){does_meet&=applicant.get_age()>=criterion.age_min;}
if(criterion.height_max!==null){does_meet&=applicant.height()!==null&&applicant.height()<=criterion.height_max}
if(criterion.height_min!==null){does_meet&=applicant.height()!==null&&applicant.height()>=criterion.height_min;}
if(criterion.weight_max!==null){does_meet&=applicant.weight()!==null&&applicant.weight()<=criterion.weight_max}
if(criterion.weight_min!==null){does_meet&=applicant.weight()!==null&&applicant.weight()>=criterion.weight_min;}
return does_meet;};GIHealthQuestion.prototype.should_skip_if_GI_criteria_met=function(){var self=this;if(self.skip_mode=="all"){return true;}else{return _.any(self.skipped_questions,function(q){return self.get_question_label()==q.question_type_label});}};GIHealthQuestion.prototype.does_yes_stop_app=function(){var self=this;return true;};function HealthQuestionAnswer(question,button_group,question_object){var self=this;self.question=question;self.question_object=question_object;self.button_group=ko.observable(null);self.answer=ko.computed(function(){if(self.button_group()==null){return null;}else{return self.button_group().get_val();}});self.serialize=function(){var answer;if(self.button_group()){answer=(self.button_group().is_required())?self.button_group().get_val():"GI";}else{answer=null;}
return{question:self.question.question_text,label:self.question.label,is_spouse_only:self.question.is_spouse_only||false,answer:answer}};}
var enrollment_wizard=(function(){return{init:function(data){console.log("init with args: ",arguments);var ui=new wizard_viewmodel.WizardUI(data);window.ui=ui;ko.applyBindings(ui);init_validation();}};})();var payment_mode_module=(function(){function PaymentMode(options){this.frequency=options.frequency;this.label=options.label;}
PaymentMode.prototype={serialize:function(){return this.frequency;},display_lowercase:function(){return this.label.toLowerCase();},display:function(){return this.label;}};var FREQUENCY_LABELS={12:'Monthly',24:'Semimonthly',26:'Biweekly',52:'Weekly'};return{create_payment_mode:function(options){return new PaymentMode(options);},create_payment_mode_by_frequency:function(frequency){var options={frequency:frequency,label:FREQUENCY_LABELS[frequency]};return new PaymentMode(options);},select_initial_payment_mode:function(case_data,payment_modes){var initial_payment_mode=null;if(case_data&&case_data.payment_mode>=0){initial_payment_mode=_.find(payment_modes,function(pm){return pm.frequency===case_data.payment_mode;});if(initial_payment_mode===undefined){initial_payment_mode=null;}}
return initial_payment_mode;},can_change_payment_mode:function(case_data){return(case_data.payment_mode===-1||!case_data.payment_mode);}}})();var product_rates_service=(function(){var is_loading_rates=ko.observable(false);function ProductRatesVM(product){this.product=product;this.rates=ko.observableArray([]);this.recommendations=ko.observableArray([]);this.employee_options=ko.pureComputed(this._get_employee_options,this);this.spouse_options=ko.pureComputed(this._get_spouse_options,this);this.children_options=ko.pureComputed(this._get_children_options,this);this.applicant_coverage_options={};this.applicant_coverage_options[wizard_applicant.Applicant.EmployeeType]=this.employee_options;this.applicant_coverage_options[wizard_applicant.Applicant.SpouseType]=this.spouse_options;this.applicant_coverage_options[wizard_applicant.Applicant.ChildType]=this.children_options;}
ProductRatesVM.prototype={update_rates_data:function(rates_data){this.update_product_rates(rates_data);this.update_recommendations(rates_data);},update_product_rates:function(rates_data){this.rates(this.get_coverage_options_from_api_data(rates_data));},get_coverage_options_from_api_data:function(rates_data){var rates=[];rates=$.merge(rates,this.create_coverage_options_for_applicant(wizard_applicant.Applicant.EmployeeType,rates_data.employee_rates));rates=$.merge(rates,this.create_coverage_options_for_applicant(wizard_applicant.Applicant.SpouseType,rates_data.spouse_rates));rates=$.merge(rates,this.create_coverage_options_for_applicant(wizard_applicant.Applicant.ChildType,rates_data.children_rates));return rates;},create_coverage_options_for_applicant:function(applicant_type,applicant_rates_data){var options=[];if(applicant_rates_data.bypremium){options=$.merge(options,this.create_coverage_options(false,applicant_type,applicant_rates_data.bypremium));}
if(applicant_rates_data.byface){options=$.merge(options,this.create_coverage_options(true,applicant_type,applicant_rates_data.byface));}
return options;},create_coverage_options:function(is_by_face,applicant_type,rate_options){return _.map(rate_options,function(data){return this.product.create_coverage_option({applicant_type:applicant_type,is_by_face:is_by_face,face_value:data.coverage,premium:data.premium,payment_mode:function(){return payment_mode_module.create_payment_mode_by_frequency(data.payment_mode)}.bind(this)});},this);},update_recommendations:function(rates_data){if(rates_data.recommendations){this.recommendations(this.process_recommendations(rates_data.recommendations));}},process_recommendations:function(recommendations){var processed_recommendations=[];_.each(recommendations,function(rec_data){var emp_option=this.find_applicant_coverage_option(wizard_applicant.Applicant.EmployeeType,rec_data.coverages.employee);var sp_option=this.find_applicant_coverage_option(wizard_applicant.Applicant.SpouseType,rec_data.coverages.spouse);var ch_option=this.find_applicant_coverage_option(wizard_applicant.Applicant.ChildType,rec_data.coverages.children);processed_recommendations.push(new RecommendationSet(rec_data.name,[new Recommendation(rec_data.name,wizard_applicant.Applicant.EmployeeType,emp_option,this.product),new Recommendation(rec_data.name,wizard_applicant.Applicant.SpouseType,sp_option,this.product),new Recommendation(rec_data.name,wizard_applicant.Applicant.ChildType,ch_option,this.product)]));},this);return processed_recommendations;},find_applicant_coverage_option:function(applicant_type,coverage_amount){if(!coverage_amount){return new NullCoverageOption();}
var option=_.find(this.applicant_coverage_options[applicant_type](),function(opt){return opt.face_value===parseInt(coverage_amount);});if(option){return option;}else{return new NullCoverageOption();}},get_coverage_options_observable_for_applicant:function(applicant){return this.applicant_coverage_options[applicant.type];},_get_employee_options:function(){return this._get_applicant_type_options(wizard_applicant.Applicant.EmployeeType);},_get_spouse_options:function(){return this._get_applicant_type_options(wizard_applicant.Applicant.SpouseType);},_get_children_options:function(){return this._get_applicant_type_options(wizard_applicant.Applicant.ChildType);},_get_applicant_type_options:function(applicant_type){if(this.product.does_override_rate_options(applicant_type)){var all_options=this._get_all_options_by_applicant_type(applicant_type);return this.product.filter_coverage_options_for_applicant_type(all_options,applicant_type);}
return this._get_all_options_by_applicant_type(applicant_type);},_get_all_options_by_applicant_type:function(applicant_type){return _.select(this.rates(),function(option){return option.applicant_type===applicant_type;})}};var rates_by_product_id={};function update_product_rates(products,payment_mode,applicant_list,error_callback,statecode,coverage_vm){is_loading_rates(true);var requests=_.map(products,function(product){var enabled_riders=coverage_vm.get_enabled_riders_for_product(product);var data=_build_rate_parameters(payment_mode,applicant_list,statecode,enabled_riders);var request=remote_service.get_product_rates(product.product_data.id,data);request.product_id=product.product_data.id;return request;});function process_product_rates(){var product_rate_response;for(var i=0;i<products.length;i++){if(products.length===1){product_rate_response=arguments[0];}else{product_rate_response=arguments[i][0];}
var product_rates=product_rate_response.data;var product=_.find(products,function(p){return p.product_data.id===product_rates.product_id;},this);var product_rates_viewmodel=get_or_create_product_rates_viewmodel(product);product_rates_viewmodel.update_rates_data(product_rates);}
is_loading_rates(false);}
$.when.apply($,requests).done(process_product_rates).fail(error_callback);}
function _build_rate_parameters(payment_mode,applicant_list,statecode,enabled_riders){var params={payment_mode:payment_mode.frequency,statecode:statecode,rider_codes:_.pluck(enabled_riders,"code")};return $.extend({},params,_build_applicant_parameters(applicant_list));}
function _build_applicant_parameters(applicant_list){return{employee:applicant_list.get_employee().serialize_data(),spouse:(applicant_list.has_valid_spouse())?applicant_list.get_spouse().serialize_data():null};}
function get_or_create_product_rates_viewmodel(product){var rates_vm;if(!(product.product_data.id in rates_by_product_id)){rates_vm=new ProductRatesVM(product);rates_by_product_id[product.product_data.id]=rates_vm;}else{rates_vm=rates_by_product_id[product.product_data.id];}
return rates_vm;}
function get_product_recommendations(product){var rates=get_or_create_product_rates_viewmodel(product);return rates.recommendations;}
function get_product_coverage_options_for_applicant(product,applicant){var rates=get_or_create_product_rates_viewmodel(product);return rates.get_coverage_options_observable_for_applicant(applicant);}
return{update_product_rates:update_product_rates,is_loading_rates:is_loading_rates,get_product_coverage_options_for_applicant:get_product_coverage_options_for_applicant,get_product_recommendations:get_product_recommendations};})();var wizard_products=(function(){function build_products(root,products){if(products.length==0){alert("Error: No products to enroll.");return null;}
var product_objects=_.map(products,function(product){return build_product(root,product);});return _.filter(product_objects,function(product){return product!==null;});}
function build_product(root,product_data){var base_type=product_data.base_product_type;var base_product;if(base_type==="FPPTI"){base_product=new FPPTIProduct(product_data);}else if(base_type==="FPPCI"){base_product=new FPPCIProduct(product_data);}else if(base_type==="Group CI"){base_product=new GroupCIProduct(root,product_data);}else if(base_type==="FPP-Gov"){base_product=new FPPGovProduct(product_data);}else if(base_type==="ACC"||base_type==="HI"){return null;}else{alert("Invalid product type '"+base_type+"'");base_product=new FPPTIProduct(product_data);}
return base_product;}
function Product(){}
Product.prototype={min_emp_age:function(){return 18;},max_emp_age:function(){return 70;},min_sp_age:function(){return 18;},max_sp_age:function(){return 70;},min_child_age:function(){return 0;},max_child_age:function(){return 23;},is_valid_employee:function(employee){var age=employee.get_age();return(age>=this.min_emp_age()&&age<=this.max_emp_age());},is_valid_spouse:function(spouse){var age=spouse.get_age();return(age>=this.min_sp_age()&&age<=this.max_sp_age());},is_valid_child:function(child){var age=child.get_age();return(age>=this.min_child_age()&&age<=this.max_child_age());},create_coverage_option:function(options){return new CoverageOption(options);},requires_gender:function(){return false;},requires_height:function(){return false;},requires_weight:function(){return false;},requires_is_smoker:function(){return false;},has_critical_illness_coverages:function(){return false;},get_maximum_coverage_amount:function(applicant){var options=product_rates_service.get_product_coverage_options_for_applicant(this,applicant)();if(options.length>0){return _.max(_.pluck(options,"face_value"));}
return 0;},does_override_rate_options:function(){return false;},should_show_other_insurance_questions:function(){return this.is_fpp_product();},should_show_step_5:function(){return true;},should_use_date_of_hire_for_identity:function(){return true;},is_fpp_product:function(){return true;},should_confirm_disclosure_notice:function(){return this.is_fpp_product();},should_confirm_payroll_deduction:function(){return this.is_fpp_product();},should_show_contingent_beneficiary:function(){return this.is_fpp_product();},get_replacement_paragraphs:function(){return[];},does_use_recommended_coverage_table:function(){return true;},requires_additional_information:function(){return this.requires_gender()||this.requires_height()||this.requires_weight()||this.requires_is_smoker();}};function ApplicantSelectionProduct(product_data){this.product_type=product_data.base_product_type;this.product_data=product_data;}
ApplicantSelectionProduct.prototype={does_use_recommended_coverage_table:function(){return false;}};function FPPTIProduct(product_data){this.product_type="FPPTI";this.product_data=product_data;}
FPPTIProduct.prototype=Object.create(Product.prototype);FPPTIProduct.prototype.get_replacement_paragraphs=function(){return this.product_data.replacement_paragraphs;};function FPPCIProduct(product_data){this.product_type="FPPCI";this.product_data=product_data;}
FPPCIProduct.prototype=Object.create(Product.prototype);FPPCIProduct.prototype.create_coverage_option=function(options){return new CICoverageOption(new CoverageOption(options));};FPPCIProduct.prototype.has_critical_illness_coverages=function(){return true;};FPPCIProduct.prototype.get_replacement_paragraphs=function(){return this.product_data.replacement_paragraphs;};function GroupCIProduct(root,product_data){var self=this;self.root=root;self.product_type="Group CI";self.product_data=product_data;self.employee_current_benefit_subscription=null;self.spouse_options_for_demographics=ko.observableArray([]);self.all_spouse_rate_options=ko.observableArray([]);self.all_posible_children_options=ko.observableArray([]);self.all_coverage_options={employee:ko.observableArray([]),spouse:ko.observableArray([]),children:ko.observableArray([])};self.does_override_rate_options=function(applicant_type){return(applicant_type===wizard_applicant.Applicant.EmployeeType||applicant_type===wizard_applicant.Applicant.SpouseType);};self.filter_coverage_options_for_applicant_type=function(all_options,applicant_type){if(applicant_type===wizard_applicant.Applicant.EmployeeType){return self.filter_employee_coverage_options(all_options);}else if(applicant_type===wizard_applicant.Applicant.SpouseType){return self.filter_spouse_coverage_options(all_options);}else{return self.filter_children_coverage_options(all_options);}};self.filter_employee_coverage_options=function(all_options){return self.filter_base_rate_options(all_options);};function get_employee_total_cumulative_coverage(){var emp_coverage_option=window.vm.coverage_vm.get_applicant_coverage_option_for_product(window.vm.employee(),self);var emp_existing_coverage_amount=window.vm.employee().get_existing_coverage_amount_for_product(self);var emp_current_coverage_amount=(emp_coverage_option.is_valid()?emp_coverage_option.face_value:0);return emp_existing_coverage_amount+emp_current_coverage_amount;}
function has_employee_selected_coverage(){var applicant_coverage=window.vm.coverage_vm.get_applicant_coverage_for_product(window.vm.employee(),self);return applicant_coverage.has_selected_coverage();}
function has_employee_answered_required_question_yes(){return false;}
self.filter_spouse_coverage_options=function(all_options){var base_options=self.filter_base_rate_options(all_options);if(!has_employee_selected_coverage()||has_employee_answered_required_question_yes()){return _.filter(base_options,function(o){return o.face_value<=25000;});}else{var limit=_.min([get_employee_total_cumulative_coverage()/2.0,25000]);var valid_options=_.filter(base_options,function(o){return o.face_value<=limit});self.append_halfway_coverage_option_if_needed(valid_options,limit,all_options);return valid_options;}};self.append_halfway_coverage_option_if_needed=function(valid_options,max_coverage_limit,all_options){if(valid_options.length&&valid_options[valid_options.length-1].face_value<max_coverage_limit){var half_opt=_.find(all_options,function(o){return o.face_value===max_coverage_limit});if(half_opt){valid_options.push(half_opt);}}};self.filter_children_coverage_options=function(all_options){var base_options=self.filter_base_rate_options(all_options);if(!has_employee_selected_coverage()||has_employee_answered_required_question_yes()){return _.filter(base_options,function(o){return o.face_value<=10000;});}else{var limit=_.min([get_employee_total_cumulative_coverage()/2.0,10000]);return _.filter(base_options,function(o){return o.face_value<=limit});}};self.filter_base_rate_options=function(all_options){return _.filter(all_options,function(o){return o.face_value%5000===0;});};}
GroupCIProduct.prototype=Object.create(Product.prototype);GroupCIProduct.prototype.is_valid_employee=function(employee){var age=employee.get_age();var valid=(age>=this.min_emp_age()&&age<=this.max_emp_age());valid&=employee.is_smoker()!=null;valid&=employee.has_valid_weight();valid&=employee.has_valid_height();valid&=employee.has_valid_gender();return valid;};GroupCIProduct.prototype.is_valid_spouse=function(spouse){var age=spouse.get_age();var valid=(age>=this.min_sp_age()&&age<=this.max_sp_age());valid&=spouse.is_smoker()!=null;valid&=spouse.has_valid_weight();valid&=spouse.has_valid_height();valid&=spouse.has_valid_gender();return valid;};GroupCIProduct.prototype.requires_gender=function(){return true;};GroupCIProduct.prototype.requires_height=function(){return true;};GroupCIProduct.prototype.requires_weight=function(){return true;};GroupCIProduct.prototype.requires_is_smoker=function(){return true;};GroupCIProduct.prototype.has_critical_illness_coverages=function(){return true;};GroupCIProduct.prototype.should_show_step_5=function(){return false;};GroupCIProduct.prototype.should_use_date_of_hire_for_identity=function(){return false;};GroupCIProduct.prototype.is_fpp_product=function(){return false;};function FPPGovProduct(product_data){this.product_type="FPP-Gov";this.product_data=product_data;}
FPPGovProduct.prototype=Object.create(Product.prototype);FPPGovProduct.prototype.requires_gender=function(){return false;};FPPGovProduct.prototype.requires_height=function(){return false;};FPPGovProduct.prototype.requires_weight=function(){return false;};FPPGovProduct.prototype.requires_is_smoker=function(){return false;};FPPGovProduct.prototype.has_critical_illness_coverages=function(){return false;};FPPGovProduct.prototype.get_replacement_paragraphs=function(){return this.product_data.replacement_paragraphs;};return{build_products:build_products};})();function RecommendationSet(name,recommendations){var self=this;self.name=name;self.recommendations=recommendations;self.get_applicant_recommendation=function(applicant_type){return _.find(self.recommendations,function(rec){return rec.applicant_type===applicant_type;})};self.get_recommended_applicant_coverage=function(applicant_type){var rec=self.get_applicant_recommendation(applicant_type);if(!rec){return new NullCoverageOption();}
return rec.recommended_coverage;};self.formatted_payment_mode=function(){if(self.recommendations.length===0){return"";}
if(!_.any(_.invoke(self.recommendations,"is_valid"))){return"";}
var valid_recommendation=_.find(self.recommendations,function(rec){return rec.is_valid()});return valid_recommendation.recommended_coverage.payment_mode().display_lowercase();};self.formatted_total_premium=function(){return format_premium_value(self.get_total_premium());};self.get_total_premium=function(){var total=0.0;_.each(self.recommendations,function(rec){total+=rec.get_total_premium();});return total;};}
function Recommendation(name,applicant_type,coverage_option,product){var self=this;self.name=name;self.applicant_type=applicant_type;self.recommended_coverage=coverage_option;self.product=product;self.is_valid=function(){return self.recommended_coverage.is_valid();};self.get_total_premium=function(){if(self.product.is_fpp_product()&&self.applicant_type===wizard_applicant.Applicant.ChildType){return self.recommended_coverage.premium*window.vm.coverage_vm.applicants.get_valid_children().length;}
return self.recommended_coverage.premium;};self.format_total_premium=function(){if(!self.recommended_coverage.is_valid()){return"";}
return format_premium_value(self.get_total_premium());};self.format_premium_option=function(){return self.recommended_coverage.format_premium_option()};self.format_coverage=function(){return self.recommended_coverage.format_face_value();};}
function NullRecommendation(name){var self=this;self.name=name;self.recommended_coverage=new NullCoverageOption();self.is_valid=function(){return false;};self.get_total_premium=function(){return 0.0;};self.format_premium_option=function(){return"";};self.format_total_premium=function(){return"";};self.format_coverage=function(){return"";};}
var remote_service=(function(){function get_product_rates(product_id,data){return $.ajax({url:"/products/"+product_id+"/rates",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",processData:false,data:JSON.stringify(data)});}
return{get_product_rates:get_product_rates};})();function ReplacementPolicy(){var self=this;self.name=ko.observable('');self.policy_number=ko.observable('');self.insured=ko.observable('');self.replaced_or_financing=ko.observable(null);self.replacement_reason=ko.observable("");self.serialize=function(){return{name:self.name(),policy_number:self.policy_number(),insured:self.insured(),replaced_or_financing:self.replaced_or_financing(),replacement_reason:self.replacement_reason()};};}
function submit_application(){window.vm.is_submitting(true);window.vm.submission_error("");var results=_.map(window.vm.coverage_vm.selected_product_coverages(),function(product_cov){return build_wizard_results_for_product_coverage(product_cov);});var please_wait_dialogue=bootbox.dialog({message:"Generating application form(s) for signature. Please wait, this make take a minute...",buttons:{}});_send_wizard_results(results);}
var POLL_WAIT=5000;var MAX_POLL_COUNT=25;var poll_count=0;function _send_wizard_results(wizard_results){ajax_post("/submit-wizard-data",{"wizard_results":wizard_results},function(resp){if(resp.error){window.vm.is_submitting(false);bootbox.dialog({message:"There was a problem generating the application form ("+resp.error+").  Please contact the enrollment system administrator.",buttons:{"success":{"label":"OK","className":"btn-sm btn-primary"}}});}else if(resp.redirect_url){window.location.href=resp.redirect_url}else{setTimeout(function(){poll_envelope_result(resp.poll_url,wizard_results);},POLL_WAIT);}},function(req){window.vm.is_submitting(false);handle_error_and_retry(req,wizard_results);},true);}
function poll_envelope_result(url,wizard_results){poll_count+=1;if(poll_count>MAX_POLL_COUNT){alert("Sorry, an error occurred generating the signature page. Please check your Agent Inbox to sign this application.");window.location.href=urls.get_manage_case_url(window.vm.options.case_data.id)+'#enrollment';}
$.get(url).success(function(resp){if(resp.status==='ready'||resp.status==='declined'){window.location.href=resp.redirect_url;}else{setTimeout(function(){poll_envelope_result(url,wizard_results);},POLL_WAIT);}}).error(function(resp){handle_error_and_retry(resp,wizard_results)})}
function handle_error_and_retry(resp,wizard_results){handle_remote_error_with_retry(resp,function retry_callback(success){if(success){_send_wizard_results(wizard_results);}});}
var SUBMISSION_RETRIES_ALLOWED=3;var submission_retry_count=0;function handle_remote_error_with_retry(response,retry_callback){window.vm.is_submitting(false);if(response.status===401){}else if(response.status===503){alert("Sorry, an error occurred communicating with the server. Please check your Agent Inbox to sign this application.");window.location=urls.get_manage_case_url(window.vm.options.case_data.id)+'#enrollment';}else if(response.status===500){alert("Sorry, the server encountered an error processing this request.");}else{alert("Sorry, an error occurred communicating with the server. Please check your connection to the internet and try again.");}}
function build_wizard_results_for_product_coverage(product_cov){var root=window.vm;var health_questions=vm.get_product_health_questions(product_cov);var did_decline=(root.coverage_vm.has_multiple_products())?product_cov.did_decline():root.did_decline();var wizard_results={product_id:product_cov.product.product_data.id,case_id:root.enrollment_case.id,enrollCity:root.enrollCity(),enrollState:root.enrollState(),payment_mode:root.coverage_vm.payment_mode().frequency,payment_mode_text:root.coverage_vm.payment_mode().label,method:(root.is_in_person_application())?'in_person':'self_enroll_email',did_decline:did_decline,identityToken:root.identityToken(),identityType:root.identityType(),employee:root.employee().serialize_data(),spouse:root.spouse().serialize_data(),is_spouse_address_same_as_employee:root.is_spouse_address_same_as_employee(),is_spouse_email_same_as_employee:root.is_spouse_email_same_as_employee(),employee_owner:product_cov.policy_owner(),employee_other_owner_name:product_cov.other_owner_name(),employee_other_owner_ssn:product_cov.other_owner_ssn(),spouse_owner:product_cov.spouse_policy_owner(),spouse_other_owner_name:product_cov.spouse_other_owner_name(),spouse_other_owner_ssn:product_cov.spouse_other_owner_ssn(),employee_beneficiary:product_cov.employee_beneficiary_type(),spouse_beneficiary:product_cov.spouse_beneficiary_type(),employee_contingent_beneficiary_type:product_cov.employee_contingent_beneficiary_type(),employee_contingent_beneficiary:product_cov.employee_contingent_beneficiary().serialize(),employee_beneficiary_name:product_cov.employee_other_beneficiary().name(),employee_beneficiary_relationship:product_cov.employee_other_beneficiary().relationship(),employee_beneficiary_ssn:product_cov.employee_other_beneficiary().ssn(),employee_beneficiary_dob:product_cov.employee_other_beneficiary().date_of_birth(),spouse_beneficiary_name:product_cov.spouse_other_beneficiary().name(),spouse_beneficiary_relationship:product_cov.spouse_other_beneficiary().relationship(),spouse_beneficiary_ssn:product_cov.spouse_other_beneficiary().ssn(),spouse_beneficiary_dob:product_cov.spouse_other_beneficiary().date_of_birth(),spouse_contingent_beneficiary_type:product_cov.spouse_contingent_beneficiary_type(),spouse_contingent_beneficiary:product_cov.spouse_contingent_beneficiary().serialize()};wizard_results.children=[];_.each(product_cov.get_covered_children(),function(child){wizard_results['children'].push(child.serialize_data());});if(did_decline){return wizard_results;}
wizard_results=$.extend({},wizard_results,{existing_insurance:root.existing_insurance(),replacing_insurance:root.replacing_insurance(),is_employee_actively_at_work:root.is_employee_actively_at_work(),has_spouse_been_treated_6_months:product_cov.has_spouse_been_treated_6_months(),has_spouse_been_disabled_6_months:product_cov.has_spouse_been_disabled_6_months(),});if(health_questions){wizard_results.employee_soh_questions=health_questions.serialize_answers_for_applicant(vm.employee());wizard_results.spouse_soh_questions=health_questions.serialize_answers_for_applicant(vm.spouse());}
if(!root.should_include_spouse_in_table()){wizard_results.employee_beneficiary="other";}
var emp_coverage=product_cov.__get_coverage_for_applicant(root.employee());if(emp_coverage.coverage_option().is_valid()){wizard_results['employee_coverage']=emp_coverage.coverage_option().serialize_data();}else{wizard_results['employee_coverage']=""}
var sp_benefit=product_cov.__get_coverage_for_applicant(root.spouse());if(sp_benefit.coverage_option().is_valid()){wizard_results['spouse_coverage']=sp_benefit.coverage_option().serialize_data();}else{wizard_results['spouse_coverage']=""}
wizard_results['child_coverages']=[];wizard_results['children_soh_questions']=[];_.each(product_cov.get_covered_children(),function(child){var coverage=product_cov.__get_coverage_for_applicant(child);wizard_results['child_coverages'].push(coverage.coverage_option().serialize_data());if(health_questions){var soh_questions=health_questions.serialize_answers_for_applicant(child);wizard_results['children_soh_questions'].push(soh_questions);}});wizard_results.replacement_read_aloud=root.replacement_read_aloud();wizard_results.replacement_is_terminating=root.replacement_is_terminating();wizard_results.replacement_using_funds=root.replacement_using_funds();wizard_results.replacement_policies=_.invoke(root.replacement_policies(),"serialize");wizard_results.rider_data=product_cov.selected_riders.serialize_data();return wizard_results;}
function submit_decline(){var root=window.vm;window.vm.is_submitting(true);window.vm.submission_error("");var results=_.map(root.product_coverage_viewmodels(),function(product_cov){return build_wizard_results_for_product_coverage(product_cov);});ajax_post("/submit-wizard-data",{"wizard_results":results},function(resp){if(resp.error){bootbox.dialog({message:"There was a problem submitting the form ("+resp.error+").  Please contact the enrollment system administrator.",buttons:{"success":{"label":"OK","className":"btn-sm btn-primary"}}});}else{location=resp.redirect;}},handle_remote_error,true);}
function init_validation(ui){$('[data-rel=tooltip]').tooltip();var validation_debug=false;$('#enrollment-wizard').ace_wizard().on('actionclicked.fu.wizard',function(e,info){if(validation_debug){return true;}
var is_valid;if(info.step===1){$("#health_questions_error").html("");if(ui.did_decline_all_products()){submit_decline();e.preventDefault();return;}
is_valid=ui.validator.form();if(!ui.is_coverage_selection_valid()){ui.show_no_selection_error();e.preventDefault();return;}
function validate_coverage_amount(applicant_coverage){var product_id=applicant_coverage.product.product_data.id;var product=applicant_coverage.product;var applicant=applicant_coverage.applicant;var existing_coverage_amount=applicant.get_existing_coverage_amount_for_product(product_id);if(!existing_coverage_amount){return true;}
var selected_option=applicant_coverage.get_selected_coverage();var applied_coverage_amount=(selected_option.is_valid())?selected_option.face_value:0;var max_coverage_amount=applicant_coverage.product.get_maximum_coverage_amount(applicant_coverage.applicant);var name=applicant.name();if(applied_coverage_amount>0&&existing_coverage_amount&&(max_coverage_amount<existing_coverage_amount+applied_coverage_amount)){var additional_allowed_coverage=max_coverage_amount-existing_coverage_amount;additional_allowed_coverage=_.max([0,additional_allowed_coverage]);var msg=("Due to one or more previous applications for "+product.product_data.name+" this enrollment period for "+
format_face_value(existing_coverage_amount)+" coverage, "+name+" can apply for a maximum of "+
format_face_value(additional_allowed_coverage)+" additional coverage.");alert(msg);return false;}
return true;}
_.each(ui.coverage_vm.selected_product_coverages(),function(product_coverage){_.each(product_coverage.applicant_coverage_selections(),function(applicant_coverage){var can_apply=validate_coverage_amount(applicant_coverage);if(!can_apply){is_valid=false;return false;}});if(!is_valid){return false;}});if(is_valid){$(document.body).scrollTop(0);}else{e.preventDefault();}}
if(info.step===2&&info.direction==='next'){var validator=ui.validators.step2;is_valid=validator.form();if(ui.did_select_any_fpp_product()&&(ui.should_show_replacement_form())){is_valid=$('#questions-form').valid()&&is_valid;}
if(ui.did_select_any_fpp_product()&&(ui.replacing_insurance()===null||ui.existing_insurance()===null)){is_valid=false;}
if(ui.did_select_any_fpp_product()&&ui.is_KY_OR_KS()&&ui.replacing_insurance()){is_valid=false;}
if(ui.did_select_any_fpp_product()&&ui.is_self_enroll()&&(ui.replacement_is_terminating()||ui.replacement_using_funds())){is_valid=false;}
is_valid=health_question_buttons.are_health_questions_valid()&&is_valid;if(!is_valid){$("#health_questions_error").html("Please answer all questions for all applicants.  Invalid responses may prevent you from continuing this online application; if so, please see your agent or enrollment professional.");e.preventDefault();return;}else{$("#health_questions_error").html("");}}
if(info.step===3&&info.direction==='next'){if(!$('#step3-form').valid()){e.preventDefault();return;}}
if(info.step===4&&info.direction==='next'){if(!$('#step4-form').valid()){e.preventDefault();return;}}
if(info.step===5&&info.direction==='next'){_.forEach(ui.coverage_vm.product_coverage_viewmodels(),function(product_coverage_vm){product_coverage_vm.employee_other_beneficiary().date_of_birth.valueHasMutated();if(product_coverage_vm.employee_contingent_beneficiary_type()==='other'){product_coverage_vm.employee_contingent_beneficiary().date_of_birth.valueHasMutated();}});var has_beneficiary_errors=_.any(ui.coverage_vm.product_coverage_viewmodels(),function has_beneficiary_errors(product_coverage_vm){if(product_coverage_vm.employee_contingent_beneficiary_type()==='other'){return!!product_coverage_vm.employee_other_beneficiary().date_of_birth_validation_error()||!!product_coverage_vm.employee_contingent_beneficiary().date_of_birth_validation_error();}
return!!product_coverage_vm.employee_other_beneficiary().date_of_birth_validation_error();});if(!$('#step5-form').valid()||has_beneficiary_errors){e.preventDefault();return;}
if(ui.has_contingent_beneficiary_error()){e.preventDefault();return;}}
if(info.step==6&&info.direction=='next'){if(!$('#step6-form').valid()){e.preventDefault();return;}}}).on('finished.fu.wizard',function(e){if(!$('#step6-form').valid())return false;if(ui.should_confirm_disclosure_notice()&&!ui.disclaimer_notice_confirmed()){bootbox.dialog({message:"Please confirm that you have received the disclosure notice.",buttons:{"danger":{"label":"OK","className":"btn-warning"}}});return false;}
if(ui.should_confirm_payroll_deduction()&&!ui.payroll_deductions_confirmed()){bootbox.dialog({message:"Please confirm that you agree to payroll deductions by your employer.",buttons:{"danger":{"label":"OK","className":"btn-warning"}}});return false;}
if(!ui.can_submit_wizard()){e.preventDefault();vm.submission_error("Please wait, the submission is still processing.");return false;}
submit_application();}).on('stepclick.fu.wizard',function(e){return true;});$.mask.definitions['~']='[+-]';$('#phone').mask('(999) 999-9999');$('#eeDOB').mask('99/99/1999');$('.input-mask-date').mask('99/99/9999');$('.input-mask-ssn').mask('999-99-9999');$('.input-mask-zip').mask('99999');jQuery.validator.addMethod("phone",function(value,element){return this.optional(element)||/^\(\d{3}\) \d{3}\-\d{4}( x\d{1,6})?$/.test(value);},"Enter a valid phone number.");var step_2_validator=$('#questions-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{replacement_read_aloud:{required:{depends:function(){return ui.is_replacement_form_required();}}},replacement_is_terminating:{required:{depends:function(){return ui.is_replacement_form_required();}}},replacement_using_funds:{required:{depends:function(){return ui.is_replacement_form_required();}}}},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});$.validator.addClassRules("replacement-question",{required:{depends:function(){return ui.is_replacement_form_required();}}});$.validator.addClassRules("replacement-details-input",{required:{depends:function(){return ui.should_show_replacement_details_form();}}});function isEmployeeOtherOwnerRequired(element){var product_coverage=ko.dataFor(element);return product_coverage.policy_owner()==="other";}
function isSpouseOtherOwnerRequired(element){var product_coverage=ko.dataFor(element);return product_coverage.spouse_policy_owner()==="other";}
$.validator.addClassRules("ee-other-owner-name",{required:{depends:function(element){return isEmployeeOtherOwnerRequired(element);}}});$.validator.addClassRules("ee-other-owner-ssn",{required:{depends:function(element){return isEmployeeOtherOwnerRequired(element);}}});$.validator.addClassRules("sp-other-owner-name",{required:{depends:function(element){return isSpouseOtherOwnerRequired(element);}}});$.validator.addClassRules("sp-other-owner-ssn",{required:{depends:function(element){return isSpouseOtherOwnerRequired(element);}}});$('#step3-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{email:{email:true,required:{depends:function(){return ui.is_self_enroll();}}},eeFName2:{required:true},eeLName2:{required:true},eeGender:{required:true},eessn:{required:true},eeStreet1:{required:true},eeCity:{required:true},eeState:{required:true},eeZip:{required:true},eeOwner:{required:true}},messages:{email:{email:"Please provide a valid email."},eeFName2:"required",eeLName2:"required",eeGender:"Please choose gender",eessn:"required",eeStreet1:"required",eeCity:"required",eeState:"required",eeZip:"required",eeOwner:"Please confirm policy owner"},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});$('#step4-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{spFName2:{required:true},spLName2:{required:true},spGender:{required:true},spssn:{required:{depends:function(element){return($("#spOwner-self").is(':checked'))}}},spOwner:{required:true}},messages:{spFName2:"required",spLName2:"required",spGender:"Please choose gender",spssn:"Spouse SSN required",spOwner:"Please confirm policy owner"},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});function is_other_beneficiary_detail_required(element,applicant_type,beneficiary_type){var product_coverage=ko.dataFor(element);if(beneficiary_type==="contingent"&&!product_coverage.should_show_contingent_beneficiary()){return false;}
if(applicant_type==="spouse"&&!ui.coverage_vm.did_select_spouse_coverage()){return false;}
if(applicant_type==="employee"){if(beneficiary_type==="primary"){return product_coverage.employee_beneficiary_type()==="other"||!ui.coverage_vm.did_select_spouse_coverage();}else{return product_coverage.employee_contingent_beneficiary_type()==="other";}}else if(applicant_type==='spouse'){if(beneficiary_type==="primary"){return product_coverage.spouse_beneficiary_type()==="other";}else{return product_coverage.spouse_contingent_beneficiary_type()==="other";}}}
var beneficiary_depends_rules={"ee-bene-name":function(el){return is_other_beneficiary_detail_required(el,'employee','primary')},"ee-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'employee','primary')},"ee-cont-bene-name":function(el){return is_other_beneficiary_detail_required(el,'employee','contingent')},"ee-cont-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'employee','contingent')},"sp-bene-name":function(el){return is_other_beneficiary_detail_required(el,'spouse','primary')},"sp-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'spouse','primary')},"sp-cont-bene-name":function(el){return is_other_beneficiary_detail_required(el,'spouse','contingent')},"sp-cont-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'spouse','contingent')}};for(className in beneficiary_depends_rules){var depends_func=beneficiary_depends_rules[className];$.validator.addClassRules(className,{required:{depends:depends_func}})}
$('#step5-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});$('#step6-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{confirmDisclaimer:{required:true},enrollCity:{required:true},tokenType:{required:true},ConfirmationToken:{required:function(){return window.vm.should_use_date_of_hire_for_identity();}},hireDate:{required:true}},messages:{confirmDisclaimer:"please acknowledge that you have received the notice",enrollCity:"required",tokenType:"required",ConfirmationToken:"Valid date required"},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});}
function wizard_validate_highlight(e){$(e).closest('.form-group').removeClass('has-info').addClass('has-error');}
function wizard_validate_success(e){$(e).closest('.form-group').removeClass('has-error').addClass('has-info');$(e).remove();}
function wizard_error_placement(error,element){if(element.is(':checkbox')||element.is(':radio')){var controls=element.closest('div[class*="col-"]');if(controls.find(':checkbox,:radio').length>1)controls.append(error);else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));}
else if(element.is('.select2')){error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));}
else if(element.is('.chosen-select')){error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));}else if(element.closest('.form-group').length>0){error.appendTo(element.closest('.form-group'));}
else error.insertAfter(element);}
function step_two_error_placement(error,element){'use strict';if((element.is('[name="height_feet_0"]')||element.is('[name="height_inches_0"]')||element.is('[name="weight_0"]'))&&$('#weight_0-error').length===0&&$('#height_feet_0-error').length===0&&$('#height_inches_0-error').length===0){error.appendTo($('#employee-height-weight'));}else if((element.is('[name="height_feet_1"]')||element.is('[name="height_inches_1"]')||element.is('[name="weight_1"]'))&&$('#weight_1-error').length===0&&$('#height_feet_1-error').length===0&&$('#height_inches_1-error').length===0){error.appendTo($('#spouse-height-weight'));}else if(element.is('[name="tobacco-0"]')||element.is('[name="tobacco-1"]')||element.is('[name="gender-0"]')||element.is('[name="gender-1"]')){error.appendTo(element.parent().parent());}}
var wizard_viewmodel=(function(){ko.bindingHandlers.wizard={init:function(element,val_accessor){var val=val_accessor();val($(element).ace_wizard());$(element).wizard('selectedItem',{step:1});}};function CoverageVM(available_products,applicant_list,case_data,all_payment_modes,should_include_spouse,should_include_children,root){this.products=available_products;this.applicants=applicant_list;this.should_include_spouse=should_include_spouse;this.should_include_children=should_include_children;this.root=root;this.multiproduct_wizard_widget=ko.observable(null);this.applicants_in_table=ko.computed(function(){var applicants_in_table=[];if(this.applicants.has_valid_employee()){applicants_in_table.push(this.applicants.get_employee());}
if(this.applicants.has_valid_spouse()&&this.should_include_spouse()){applicants_in_table.push(this.applicants.get_spouse());}
if(this.applicants.has_valid_children()&&this.should_include_children()){_.each(this.applicants.get_children(),function(c){if(c.any_valid_field()){applicants_in_table.push(c);}});}
return applicants_in_table;},this);this.payment_modes=_.map(all_payment_modes||[],function(pm){return payment_mode_module.create_payment_mode(pm);});this.payment_mode=ko.observable(payment_mode_module.select_initial_payment_mode(case_data,this.payment_modes));this.can_change_payment_mode=ko.computed(function(){return payment_mode_module.can_change_payment_mode(case_data);});this.is_payment_mode_valid=ko.pureComputed(this._is_payment_mode_valid,this);this.product_coverage_viewmodels=ko.observableArray(_.map(this.products,function(p){return new ProductCoverageViewModel(p,case_data,applicant_list,this.payment_mode,this.should_include_spouse,this.should_include_children,this.root);},this));this.current_product=ko.observable(this.product_coverage_viewmodels()[0]);this.select_product=function(product_coverage){this.current_product(product_coverage);}.bind(this);this.has_multiple_products=ko.pureComputed(function(){return this.product_coverage_viewmodels().length>1;},this);this.previous_product=ko.pureComputed(function(){var index=this.product_coverage_viewmodels().indexOf(this.current_product());return val_or_null(this.product_coverage_viewmodels(),index-1);},this);this.next_product=ko.pureComputed(function(){var index=this.product_coverage_viewmodels().indexOf(this.current_product());return val_or_null(this.product_coverage_viewmodels(),index+1);},this);function val_or_null(array,index){if(index>=0&&index<array.length){return array[index];}
return null;}
this.coverage_summary_vm=new CoverageSummaryVM(this.product_coverage_viewmodels,this.applicants);var self=this;this.selected_product_coverages=ko.pureComputed(function(){return _.select(self.product_coverage_viewmodels(),function(prod_cov){return prod_cov.did_select_coverage();});},this);self.did_select_employee_coverage=ko.pureComputed(function(){return _.any(self.selected_product_coverages(),function(cov){return cov.did_select_employee_coverage();});});self.did_select_spouse_coverage=ko.pureComputed(function(){return _.any(self.selected_product_coverages(),function(cov){return cov.did_select_spouse_coverage();});});self.did_select_children_coverage=ko.pureComputed(function(){return _.any(self.selected_product_coverages(),function(cov){return cov.did_select_children_coverage();});});self.get_covered_children=ko.pureComputed(function(){var children=[];_.each(self.selected_product_coverages(),function(cov){_.each(cov.get_covered_children(),function(child){if(_.includes(children,child)){return;}
children.push(child);});});return children;});}
CoverageVM.prototype={_is_payment_mode_valid:function(){return((!this.can_change_payment_mode())||(this.can_change_payment_mode()&&this.payment_mode()!=null));},get_applicant_coverage_option_for_product:function(applicant,product){if(applicant.type==wizard_applicant.Applicant.SpouseType&&!this.should_include_spouse()){return new NullCoverageOption();}
if(applicant.type==wizard_applicant.Applicant.ChildType&&!this.should_include_children()){return new NullCoverageOption();}
var applicant_coverage_selection=this.get_applicant_coverage_for_product(applicant,product);return applicant_coverage_selection.get_selected_coverage();},get_applicant_coverage_for_product:function(applicant,product){var product_coverage=this.get_product_coverage(product);return product_coverage.get_coverage_for_applicant(applicant);},format_total_premium_for_product:function(product){var product_coverage=this.get_product_coverage(product);var total=product_coverage.get_total_premium();return format_premium_value(total);},get_enabled_riders_for_product:function(product){return this.get_product_coverage(product).enabled_riders;},format_total_premium_for_applicant:function(applicant){var applicant_total=0.0;_.each(this.product_coverage_viewmodels(),function(pcov){if(pcov.did_decline()){return true;}
var matching_applicant_coverage=_.find(pcov.valid_applicant_coverage_selections(),function(app_cov){return app_cov.applicant===applicant;});if(!matching_applicant_coverage){return format_premium_value(0.0);}
applicant_total+=matching_applicant_coverage.get_total_premium();});return format_premium_value(applicant_total);},format_grand_total_premium:function(){var grand_total=0.0;_.each(this.product_coverage_viewmodels(),function(pcov){if(pcov.did_decline()){return true;}
grand_total+=pcov.get_total_premium();});return format_premium_value(grand_total);},get_product_coverage:function(product){return _.find(this.product_coverage_viewmodels(),function(pcov){return pcov.product.product_data.id===product.product_data.id;});},go_to_next_product:function(){if(this.next_product()){this.current_product(this.next_product());}},go_to_previous_product:function(){if(this.previous_product()){this.current_product(this.previous_product());}}};function ProductCoverageViewModel(product,case_data,applicant_list,payment_mode,should_include_spouse,should_include_children,root){var self=this;self.product=product;self.case_data=case_data;self.payment_mode=payment_mode;self.applicant_list=applicant_list;self.should_include_spouse=should_include_spouse;self.should_include_children=should_include_children;self.root=root;self.did_decline=ko.observable(false);self.available_recommendations=product_rates_service.get_product_recommendations(self.product,payment_mode);self.selected_recommendation=ko.observable(null);self._applicant_coverage_viewmodels={};self.applicant_coverage_selections=ko.computed(this._get_applicant_coverage_selections,this);self.get_coverage_options_for_applicant=function(applicant){return _.find(self.applicant_coverage_selections(),function(cov){return cov.applicant.type===applicant.type;}).get_coverage_options();};self.has_completed_selection=ko.computed(this._has_completed_selection,this);self.did_select_coverage=ko.pureComputed(function(){return self.has_completed_selection()&&!self.did_decline();},this);self.did_select_valid_coverage=ko.pureComputed(function(){return self.did_select_coverage()&&(self.did_select_employee_coverage()||self.did_select_spouse_coverage()||self.did_select_children_coverage());});self.did_select_employee_coverage=ko.pureComputed(function(){return _.any(self.valid_applicant_coverage_selections(),function(cov){return cov.applicant.type==wizard_applicant.Applicant.EmployeeType&&cov.coverage_option().is_valid();});});self.did_select_spouse_coverage=ko.pureComputed(function(){return _.any(self.valid_applicant_coverage_selections(),function(cov){return cov.applicant.type==wizard_applicant.Applicant.SpouseType&&cov.coverage_option().is_valid();});});self.did_select_children_coverage=ko.pureComputed(function(){return _.any(self.valid_applicant_coverage_selections(),function(cov){return cov.applicant.type==wizard_applicant.Applicant.ChildType&&cov.coverage_option().is_valid();});});self.get_covered_children=ko.computed(function(){return self._get_covered_children();});function is_rider_enabled_for_case(rider,case_data){return _.any(case_data.product_settings.riders,function(r){return(self.product.product_data.id===r.product_id&&rider.code===r.rider_code&&r.is_selected);});}
self.enabled_riders=_.select(product.product_data.riders,function(r){return is_rider_enabled_for_case(r,case_data);});self.shown_rider=ko.observable(null);self.rider_options=[];_.each([self.applicant_list.get_employee(),self.applicant_list.get_spouse()],function(applicant){_.each(self.enabled_riders,function(rider){var vm=new ApplicantRiderOptionVM(self,rider,applicant);self.rider_options.push(vm);});});self.visible_rider_options=ko.computed(function(){return _.select(self.rider_options,function(option){return option.is_visible()});});self.selected_riders=ko.computed(function(){var selected_emp_riders=_.select(self.visible_rider_options(),function(option){return option.applicant===self.applicant_list.get_employee()&&option.is_selected();});var selected_sp_riders=_.select(self.visible_rider_options(),function(option){return option.applicant===self.applicant_list.get_spouse()&&option.is_selected();});return{emp:_.pluck(selected_emp_riders,'rider'),sp:_.pluck(selected_sp_riders,'rider')};});self.selected_riders.serialize_data=ko.computed(function(){return{emp:self.selected_riders().emp,sp:self.selected_riders().sp};});self.get_selected_riders=function(person){if(person.applicant_type==="employee"){return self.selected_riders().emp;}else if(person.applicant_type==="spouse"){return self.selected_riders().sp;}
return[];};self.policy_owner=ko.observable("self");self.other_owner_name=ko.observable("");self.other_owner_ssn=ko.observable("");self.spouse_policy_owner=ko.observable("employee");self.spouse_other_owner_name=ko.observable("");self.spouse_other_owner_ssn=ko.observable("");self.employee_beneficiary_type=ko.observable("spouse");self.employee_other_beneficiary=ko.observable(new beneficiary.Beneficiary());self.employee_contingent_beneficiary_type=ko.observable("none");self.employee_contingent_beneficiary=ko.observable(new beneficiary.Beneficiary());self.spouse_beneficiary_type=ko.observable("spouse");self.spouse_other_beneficiary=ko.observable(new beneficiary.Beneficiary());self.spouse_contingent_beneficiary_type=ko.observable("none");self.spouse_contingent_beneficiary=ko.observable(new beneficiary.Beneficiary());self.is_employee_beneficiary_info_required=function(){return!self.did_select_spouse_coverage()||$("#eeBeneOther").is(':checked')};self.should_show_contingent_beneficiary=function(){return self.product.should_show_contingent_beneficiary();};self.has_contingent_beneficiary_error=ko.computed(function(){var employee_beneficiary_error=(self.employee_contingent_beneficiary_type()==='spouse'&&self.employee_beneficiary_type()==='spouse');var spouse_beneficiary_error=(self.did_select_spouse_coverage()&&self.should_show_contingent_beneficiary()&&self.spouse_contingent_beneficiary_type()==='spouse'&&self.spouse_beneficiary_type()==='spouse');return(self.should_show_contingent_beneficiary()&&(employee_beneficiary_error||spouse_beneficiary_error));});self.has_spouse_been_treated_6_months=ko.pureComputed(function(){return _find_answer_for_spouse_question_with_label("Spouse Treated 6 Months");});self.has_spouse_been_disabled_6_months=ko.pureComputed(function(){return _find_answer_for_spouse_question_with_label("Spouse Disabled 6 Months");});function _find_answer_for_spouse_question_with_label(lbl){if(!self.did_select_spouse_coverage()){return null;}
var product_questions=self.root.get_product_health_questions(self);var spouse_question=_.find(product_questions.health_questions(),function(q){return q.get_question_label()===lbl;});if(!spouse_question){return null;}
if(spouse_question.can_spouse_skip_due_to_GI()){return"GI";}
var spouse_answer=product_questions.get_applicant_answer_for_question(self.root.spouse(),spouse_question);return spouse_answer.value();}}
ProductCoverageViewModel.prototype={format_product_name:function(){return this.product.product_data.name;},get_coverage_selection_template:function(){if(this.product.does_use_recommended_coverage_table()){return'recommendation_coverage_selection';}else{return'category_coverage_selection';}},select_recommended_coverage:function(recommendation_set){this.selected_recommendation(recommendation_set);_.each(this.valid_applicant_coverage_selections(),function(applicant_coverage){applicant_coverage.select_recommended_coverage(recommendation_set);},this);},_has_completed_selection:function(){if(this.did_decline()){return true;}
return _.all(this.valid_applicant_coverage_selections(),function(applicant_coverage){return applicant_coverage.did_select_option();},this);},_get_applicant_coverage_selections:function(){var selections=[];if(this.applicant_list.has_valid_employee()){selections.push(this.__get_coverage_for_applicant(this.applicant_list.get_employee()));}
if(this.applicant_list.has_valid_spouse()&&this.should_include_spouse()){selections.push(this.__get_coverage_for_applicant(this.applicant_list.get_spouse()));}
if(this.applicant_list.has_valid_children()&&this.should_include_children()){selections.push(this.__get_coverage_for_applicant(this.applicant_list.get_children_group()));}
return selections;},valid_applicant_coverage_selections:function(){return _.filter(this.applicant_coverage_selections(),function(acov){var applicant=acov.applicant;return((applicant.type===wizard_applicant.Applicant.EmployeeType&&this.applicant_list.has_valid_employee())||(applicant.type===wizard_applicant.Applicant.SpouseType&&(this.applicant_list.has_valid_spouse()&&this.should_include_spouse()))||(applicant.type===wizard_applicant.Applicant.ChildType&&(this.applicant_list.has_valid_children()&&this.should_include_children())))},this);},get_coverage_for_applicant:function(applicant){return this.__get_coverage_for_applicant(applicant);},__get_coverage_for_applicant:function(applicant){if(applicant.type===wizard_applicant.Applicant.ChildType){applicant=this.applicant_list.get_children_group();}
var applicant_coverage;if(applicant._id in this._applicant_coverage_viewmodels){applicant_coverage=this._applicant_coverage_viewmodels[applicant._id];}else{var new_selection_instance=new ApplicantCoverageSelectionVM(applicant,this);this._applicant_coverage_viewmodels[applicant._id]=new_selection_instance;applicant_coverage=new_selection_instance;}
return applicant_coverage;},_get_covered_children:function(){var coverage=this.get_coverage_for_applicant(this.applicant_list.get_children_group());if(coverage.coverage_option().is_valid()){return _.filter(this.applicant_list.get_children(),function(child){return child.is_valid();});}else{return[];}},get_total_premium:function(){var total=0.0;if(this.did_decline()){return total;}
_.each(this.applicant_coverage_selections(),function(applicant_coverage){total+=applicant_coverage.get_total_premium();},this);return total;}};function ApplicantCoverageSelectionVM(applicant,product_coverage){this.applicant=applicant;this.product_coverage=product_coverage;this.product=product_coverage.product;this.customized_coverage_option=ko.observable(null);this.recommended_coverage_option=ko.observable(null);this.coverage_option=ko.computed(function(){if(!this.applicant.is_valid()){return new NullCoverageOption();}else if(this.applicant.type===wizard_applicant.Applicant.SpouseType&&!this.product_coverage.root.should_include_spouse_in_table()){return new NullCoverageOption();}else if(this.applicant.type===wizard_applicant.Applicant.ChildType&&!this.product_coverage.root.should_include_children_in_table()){return new NullCoverageOption();}
var custom_option=this.customized_coverage_option();var recommended_option=this.recommended_coverage_option();if(custom_option){return custom_option;}else if(recommended_option){return recommended_option;}else{return new NullCoverageOption();}},this);this.did_select_option=ko.pureComputed(function(){return(this.customized_coverage_option()!==null&&this.customized_coverage_option()!==undefined)||this.recommended_coverage_option()!==null;},this);this.riders=ko.observableArray();this.beneficiaries=ko.observableArray([]);this.get_coverage_options=ko.pureComputed(this._get_coverage_options,this);}
ApplicantCoverageSelectionVM.prototype={select_recommended_coverage:function(recommendation_set){if(!recommendation_set){this.recommended_coverage_option(null);this.customized_coverage_option(null);return;}
var coverage_option=recommendation_set.get_recommended_applicant_coverage(this.applicant.type);if(coverage_option){this.recommended_coverage_option(coverage_option);this.customized_coverage_option(null);}},select_custom_coverage:function(option){this.customized_coverage_option(option);},has_selected_coverage:function(){return this.coverage_option().is_valid();},get_selected_coverage:function(){return this.coverage_option();},get_cumulative_coverage_amount:function(){var previous_coverage_amount=this.applicant.get_existing_coverage_amount_for_product(this.product.product_data.id);var current_coverage_amount=(this.has_selected_coverage()?this.coverage_option().face_value:0);return previous_coverage_amount+current_coverage_amount;},format_name:function(){return this.applicant.name();},_get_coverage_options:function(){var options=[new NullCoverageOption()];options=$.merge(options,product_rates_service.get_product_coverage_options_for_applicant(this.product,this.applicant)());return options;},format_recommendation_coverage:function(recommendation_set){var coverage=recommendation_set.get_recommended_applicant_coverage(this.applicant.type);return coverage.format_face_value();},format_recommendation_premium:function(recommendation_set){var recommendation=recommendation_set.get_applicant_recommendation(this.applicant.type);return recommendation.format_total_premium();},format_selected_coverage:function(){return this.get_selected_coverage().format_face_value();},format_selected_premium:function(){if(this.applicant.type==wizard_applicant.Applicant.ChildType&&this.product_coverage.product.is_fpp_product()&&this.has_selected_coverage()){var premium=this.get_selected_coverage().get_total_premium()*window.vm.coverage_vm.applicants.get_valid_children().length;return format_premium_value(premium);}
return this.get_selected_coverage().format_premium_option();},get_total_premium:function(){if(this.applicant.type===wizard_applicant.Applicant.ChildType&&this.product.is_fpp_product()){return this.coverage_option().premium*this.applicant.applicants().length;}
return this.coverage_option().premium;},get_previous_coverage_amount:function(){return this.applicant.get_existing_coverage_amount_for_product(this.product.product_data.id);}};function CoverageSummaryVM(product_coverages,applicant_list){this.product_coverages=product_coverages;this.applicant_list=applicant_list;this.product_names=ko.pureComputed(function(){return _.map(this.product_coverages(),function(pcov){return pcov.product.format_product_name();});},this);this.valid_applicants=ko.pureComputed(function(){return this.applicant_list.get_valid_applicants_for_coverage();},this);this.all_coverages=ko.computed(function(){var _coverages=[];_.each(this.product_coverages(),function(pcov){_.each(pcov.valid_applicant_coverage_selections(),function(app_cov){_coverages.push(app_cov);});});return _coverages;},this);}
function ApplicantRiderOptionVM(root,rider,applicant){var self=this;self.MAX_COVERAGE=150000;self.root=root;self.rider=rider;self.applicant=applicant;self._user_selection=ko.observable(false);self.can_user_select=ko.computed(function(){return self.rider.code==='AIR';});self.is_visible=ko.computed(function(){return self.root.get_coverage_for_applicant(self.applicant).has_selected_coverage();});self.is_selected=ko.computed({read:function(){if(self.can_user_select()){return self._user_selection();}else{return self.is_visible();}},write:function(val){self._user_selection(val);}});self.format_rider_name=function(){return self.rider.user_facing_name;};self.format_applicant_name=function(){return self.applicant.name();};self.has_rider_modal=function(){return(self.rider.code==="AIR"||self.rider.code==="QOL3"||self.rider.code==="QOL4"||self.rider.code==="WP");};self.show_rider_info=function(){self.root.shown_rider(self);switch(self.rider.code){case"AIR":$("#modal-auto-increase-rider").modal('show');break;case"WP":$("#modal-wop-rider").modal('show');break;case"QOL3":$("#modal-qol3-rider").modal('show');break;case"QOL4":$("#modal-qol4-rider").modal('show');break;}};self.get_policy_years=function(){var policy_years=[];for(var year=2;year<=6;year++){if(self.get_age_for_policy_year(year)<=70&&self.get_total_coverage_for_year(year)<self.MAX_COVERAGE){policy_years.push(year);}}
return policy_years;};self.get_age_for_policy_year=function(n){return self.applicant.get_age()+n-1;};self.format_coverage_for_year=function(n){var coverage=self.get_coverage_for_year(n);return format_face_value(coverage);};self.format_total_coverage_for_year=function(n){var coverage=self.get_total_coverage_for_year(n);return format_face_value(coverage);};self.format_coverage_for_policy=function(){var coverage=0;var years=self.get_policy_years();for(i=0;i<years.length;i++){coverage+=self.get_coverage_for_year(years[i]);}
return format_face_value(coverage);};self.get_coverage_for_year=function(n){var age=self.get_age_for_policy_year(n);return self.get_coverage_for_applicant_age(age);};self.get_total_coverage_for_year=function(n){var additional_coverage=self.get_coverage_for_year(n);if(n==2){var selected_coverage=parseInt(self.root.get_coverage_for_applicant(self.applicant).coverage_option().face_value);return selected_coverage+additional_coverage;}
var total_coverage_last_year=self.get_total_coverage_for_year(n-1);return additional_coverage+total_coverage_last_year;};self.get_coverage_for_applicant_age=function(n){var _coverage_values={18:'15339',19:'15339',20:'15339',21:'15339',22:'15339',23:'15339',24:'15339',25:'15339',26:'15249',27:'14986',28:'14566',29:'13978',30:'13299',31:'12621',32:'11954',33:'11280',34:'10612',35:'9962',36:'9336',37:'8739',38:'8176',39:'7636',40:'7123',41:'6624',42:'6154',43:'5727',44:'5339',45:'4986',46:'4668',47:'4381',48:'4117',49:'3869',50:'3629',51:'3390',52:'3152',53:'2920',54:'2698',55:'2495',56:'2311',57:'2147',58:'2002',59:'1871',60:'1751',61:'1641',62:'1540',63:'1445',64:'1353',65:'1264',66:'1174',67:'1085',68:'999',69:'917',70:'839'};return parseInt(_coverage_values[n]);};self.format_premium=function(){if(self.rider.code==="AIR"){return"No initial premium charge";}else{return"Included";}};}
function WizardVM(options){var self=this;self.options=options;self.enrollment_case=options.case_data;self.products=wizard_products.build_products(self,options.products);self.is_rate_table_loading=product_rates_service.is_loading_rates;self.is_show_rates_clicked=ko.observable(false);init_applicants();init_jquery_validator();self.set_wizard_step=function(step_number){var wizard=$('#enrollment-wizard').data('fu.wizard');wizard.currentStep=step_number;wizard.setState();};self.get_wizard_step=function(){var wizard=$('#enrollment-wizard').data('fu.wizard');return wizard.currentStep;};self.should_include_spouse_in_table=ko.computed(function(){return self.should_show_spouse()&&self.spouse().is_valid();});self.should_include_children_in_table=ko.computed(function(){return(self.should_include_children()&&self.applicant_list.has_valid_children());});self.coverage_vm=new CoverageVM(self.products,self.applicant_list,options.case_data,options.payment_modes,self.should_show_spouse,self.should_include_children,self);self.product_coverage_viewmodels=self.coverage_vm.product_coverage_viewmodels;self.add_child=function(){var child=wizard_applicant.create_applicant({last:self.employee().last(),type:wizard_applicant.Applicant.ChildType});self.applicant_list.add_applicant(child);};self.remove_child=function(child){self.applicant_list.remove_applicant(child);if(self.applicant_list.get_children().length===0){self.should_include_children(false);}};self.rendered_child=function(element){$(element).hide().slideDown(400);};self.removing_child=function(element){$(element).slideUp(function(){$(element).remove();});};self.is_recommended_table_visible=ko.computed(function(){return(self.is_show_rates_clicked()&&self.can_display_rates_table());});self.is_applicant_editor_visible=ko.pureComputed(function(){return!self.is_recommended_table_visible();});self.update_rate_table=function(){if(self.validator){self.validator.resetForm();}
self.is_show_rates_clicked(true);if(!self.is_recommended_table_visible()){return;}
self.refresh_rate_table();};self.refresh_rate_table=function(){var products_to_fetch=_.chain(self.product_coverage_viewmodels()).filter(function(product_coverage_view_model){return!product_coverage_view_model.did_decline();}).map(function(product_coverage_view_model){return product_coverage_view_model.product;}).value();product_rates_service.update_product_rates(products_to_fetch,self.coverage_vm.payment_mode(),self.applicant_list,self.handle_update_rates_error,self.enrollment_case.situs_state,self.coverage_vm);};self.handle_update_rates_error=function(resp){if(resp.status===400&&resp.responseJSON&&resp.responseJSON.errors){$.each(resp.responseJSON.errors,function(error){var field_name=this.field;var message=this.error;self.limit_error_lookup[field_name](true);self.validator.form();});if(self.get_wizard_step&&self.get_wizard_step()===2){var product_id=resp.product_id;if(!product_id){return;}
var employee_height_error=_.find(resp.responseJSON.errors,function(error){return error.field==='employee_height';});var employee_weight_error=_.find(resp.responseJSON.errors,function(error){return error.field==='employee_weight';});var spouse_height_error=_.find(resp.responseJSON.errors,function(error){return error.field==='spouse_height';});var spouse_weight_error=_.find(resp.responseJSON.errors,function(error){return error.field==='spouse_weight';});var applicant;if(employee_height_error||employee_weight_error){applicant=self.employee();}
if(spouse_height_error||spouse_weight_error){applicant=self.spouse();}
if(!applicant){return;}
var product=_.find(self.products,function(product){return product.product_data.id===product_id;});var health_questions_vm=_.find(self.selected_product_health_questions(),function(health_question_vm){return health_question_vm.product_coverage.product.product_data.id===product_id;});health_questions_vm.show_yes_dialogue(applicant,"This applicant is not within the height and weight"+" requirements for '"+product.product_data.name+"'. You may proceed with this application after"+" removing this individual from the coverage selection before proceeding.");self.validators.step2.resetForm();self.validators.step2.form();self.show_height_weight_dialog_if_invalid();}}else{handle_remote_error(resp,function(){});}};function show_height_weight_error(product,applicant){var health_questions_vm=_.find(self.selected_product_health_questions(),function(health_question_vm){return health_question_vm.product_coverage.product.product_data.id===product.product_data.id;});health_questions_vm.show_yes_dialogue(applicant,"This applicant is not within the height and weight"+" requirements for '"+product.product_data.name+"'. You may proceed with this application after"+" removing this individual from the coverage selection before proceeding.");}
function get_row_for_height(table,height){return _.find(table,function(row){return row.height===height;});}
function is_applicant_height_valid(product_tables,product,applicant){if(!product_tables||!product||!applicant){return false;}
var result;var gender=applicant.gender();var height=applicant.height();if(typeof height==='string'){height=parseInt(height);}
try{var gender_tables=product_tables[product.product_data.base_product_type];var table=gender_tables[gender];result=!!get_row_for_height(table,height);}catch(ignored){result=false;}
return result;}
function is_applicant_weight_valid(product_tables,product,applicant){if(!product_tables||!product||!applicant){return false;}
var result;var gender=applicant.gender();var height=applicant.height();var weight=applicant.weight();if(typeof height==='string'){height=parseInt(height);}
if(typeof weight==='string'){weight=parseInt(weight);}
try{var table=product_tables[product.product_data.base_product_type][gender];var row=get_row_for_height(table,height);result=weight>row.min_weight&&weight<row.max_weight;}catch(ignored){result=false;}
return result;}
self.show_height_weight_dialog_if_applicants_invalid=function(){var is_employee_invalid=_.any(self.products,function(product){return!is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.employee())&&product.requires_additional_information();});if(is_employee_invalid){show_height_weight_error(_.first(self.products,function(product){return product.requires_additional_information();}),self.employee());return;}
var is_spouse_invalid=_.any(self.products,function(product){return(self.should_show_spouse()&&!is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.spouse()))&&product.requires_additional_information();});if(is_spouse_invalid){show_height_weight_error(_.first(self.products,function(product){return product.requires_additional_information();}),self.spouse());}};var observables=[self.employee().height,self.employee().weight];if(self.should_show_spouse()){observables.push(self.spouse().height,self.spouse().weight);}
_.forEach(observables,function(observable){observable.subscribe(function(){self.show_height_weight_dialog_if_applicants_invalid();});});self.should_allow_grandchildren=ko.computed(function(){return!!self.products&&self.products.length===1&&_.some(self.products,function(product){return product.is_fpp_product();});});self.show_spouse_name=ko.computed(function(){return(self.should_include_spouse_in_table())?self.spouse().name():"";});self.has_show_rates_been_clicked=ko.observable(false);self.can_display_rates_table=ko.computed(function(){var is_employee_valid=self.applicant_list.has_valid_employee();var is_payment_valid=self.coverage_vm.is_payment_mode_valid();var has_limit_errors=self.any_limit_error();return is_employee_valid&&is_payment_valid&&!has_limit_errors;});self.show_coverage_selection_table=function(){$.each(self.limit_error_lookup,function(k,v){self.limit_error_lookup[k](null);});var valid_form=true;if(!self.can_display_rates_table()){valid_form=false;}
valid_form=self.validator.form()&&valid_form;if(valid_form){self.has_show_rates_been_clicked(true);self.update_rate_table();}};self.show_applicant_editor=function(){self.has_show_rates_been_clicked(false);self.is_show_rates_clicked(false);};self.is_coverage_selection_visible=ko.pureComputed(function(){return(self.has_show_rates_been_clicked()&&self.can_display_rates_table());});self.should_display_show_rates_button=ko.pureComputed(function(){return!self.is_coverage_selection_visible();});self.should_show_critical_illness_styling=function(){return false;};var any_product=function(method_name){return _.any(_.invoke(self.products,method_name));};var all_products=function(method_name){return _.all(_.invoke(self.products,method_name));};self.should_show_extended_questions=function(){return(any_product('requires_gender')||any_product('requires_height')||any_product('requires_weight')||any_product('requires_is_smoker'));};function requires_additional_employee_information(){return _.any(self.coverage_vm.product_coverage_viewmodels(),function(product_coverage_view_model){var product=product_coverage_view_model.product;var requires_additional_information=product.requires_gender()||product.requires_height()||product.requires_weight()||product.requires_is_smoker();return requires_additional_information&&product_coverage_view_model.did_select_employee_coverage();});}
function requires_additional_spouse_information(){if(!self.should_include_spouse_in_table()){return false;}
return _.any(self.coverage_vm.product_coverage_viewmodels(),function(product_coverage_view_model){var product=product_coverage_view_model.product;var requires_additional_information=product.requires_gender()||product.requires_height()||product.requires_weight()||product.requires_is_smoker();return requires_additional_information&&product_coverage_view_model.did_select_spouse_coverage();});}
self.requires_additional_employee_information=ko.computed(requires_additional_employee_information);self.requires_additional_spouse_information=ko.computed(requires_additional_spouse_information);self.requires_additional_information=ko.computed(function(){return self.requires_additional_employee_information()||self.requires_additional_spouse_information();});self.should_show_gender=function(){return any_product('requires_gender');};self.should_show_height=function(){return any_product('requires_height');};self.should_show_weight=function(){return any_product('requires_weight');};self.should_show_smoker=function(){return any_product('requires_is_smoker');};function min_emp_age(){return _.min(_.invoke(self.products,'min_emp_age'));}
function min_sp_age(){return _.min(_.invoke(self.products,'min_sp_age'));}
function min_ch_age(){return _.min(_.invoke(self.products,'min_child_age'));}
function max_emp_age(){return _.max(_.invoke(self.products,'max_emp_age'));}
function max_sp_age(){return _.max(_.invoke(self.products,'max_sp_age'));}
function max_ch_age(){return _.max(_.invoke(self.products,'max_child_age'));}
self.can_decline=ko.computed(function(){return(!_.any(self.product_coverage_viewmodels(),function(product_coverage){return _.any(self.applicant_list.applicants(),function(applicant){return _.any(applicant.existing_coverages,function(existing_coverage){return existing_coverage.product_id===product_coverage.product.id&&existing_coverage.coverage_status==='enrolled';});});}));});self.is_submitting=ko.observable(false);self.submission_error=ko.observable("");self.can_submit_wizard=ko.pureComputed(function(){return!self.is_submitting();});self.did_decline=ko.observable(false);self.did_decline_all_products=ko.pureComputed(function(){return self.did_decline()||_.all(self.product_coverage_viewmodels(),function(pcov){return pcov.did_decline();});});self.did_decline.subscribe(function(val){if(val){bootbox.dialog({message:"Please note that even after declining enrollment, you may still change your decision and elect to enroll at a later time, provided that your employer's enrollment period is still active.",buttons:{"success":{"label":"Close","className":"btn-sm btn-primary"}}});}});self.exit_application=function(){bootbox.dialog({message:"Are you sure you want to exit? All data on this application will be discarded.",buttons:{default:{label:"Cancel",className:"btn-default",callback:function(){}},danger:{label:"Exit application and discard data",className:"btn-danger",callback:function(){window.location.href="/enrollment-case/"+self.options.case_data.id+"#enrollment";}}}});};self.attempted_advance_step=ko.observable(false);self.is_selection_error_visible=ko.computed(function(){return self.attempted_advance_step()&&!self.is_coverage_selection_valid();});self.show_no_selection_error=function(){self.attempted_advance_step(true);};self.is_coverage_selection_valid=function(){return _.all(self.coverage_vm.product_coverage_viewmodels(),function(prod_cov){return prod_cov.did_select_valid_coverage()||prod_cov.did_decline();});};self.existing_insurance=ko.observable(null);self.replacing_insurance=ko.observable(null);self.is_employee_actively_at_work=ko.observable(null);self.selected_product_health_questions=ko.computed(function(){return _.map(self.coverage_vm.selected_product_coverages(),function(product_cov){return new health_questions.ProductHealthQuestions(product_cov,options.spouse_questions,options.health_questions);});});self.get_product_health_questions=function(product_coverage){return _.find(self.selected_product_health_questions(),function(phq){return phq.product_coverage===product_coverage;});};self.should_show_other_insurance_questions=ko.pureComputed(function(){return _.any(self.coverage_vm.selected_product_coverages(),function(product_cov){return product_cov.product.should_show_other_insurance_questions();});});self.get_replacement_paragraphs=function(){var paragraph_map={};_.each(self.coverage_vm.selected_product_coverages(),function(prod_cov){var paragraphs=prod_cov.product.get_replacement_paragraphs();$.extend(paragraph_map,paragraphs);});var paragraphs=paragraph_map[self.enrollment_case.situs_state];if(!paragraphs){return[];}
return paragraphs;};self.did_select_any_fpp_product=ko.pureComputed(function(){return _.find(self.coverage_vm.selected_product_coverages(),function(ps){return ps.product.is_fpp_product();});});self.NAIC_AND_MI=['AK','AL','AR','AZ','CO','IA','LA','MD','ME','MS','MT','NC','NE','NH','NJ','NM','OH','OR','RI','SC','TX','UT','VA','VT','WI','WV','MI'];self.is_NAIC_OR_MI=function(){return self.did_select_any_fpp_product()&&_.contains(self.NAIC_AND_MI,self.enrollment_case.situs_state);};self.is_KY_OR_KS=function(){return self.enrollment_case.situs_state=="KY"||self.enrollment_case.situs_state=="KS";};self.is_CT_DC_ND_VI=function(){return _.contains(['CT','DC','ND','VI'],self.enrollment_case.situs_state);};self.is_non_NAIC_other=function(){return!(self.is_NAIC_OR_MI()||self.is_KY_OR_KS()||self.is_CT_DC_ND_VI());};self.is_in_person_application=function(){return'is_in_person'in options&&options.is_in_person;};self.is_self_enroll=function(){return!self.is_in_person_application()};self.get_has_existing_question_highlight=function(){if(self.is_self_enroll()){return'flag';}
return"checkmark";};self.get_replacing_question_highlight=function(){if(self.is_KY_OR_KS()){return"stop";}
if(self.is_CT_DC_ND_VI()){return"checkmark";}
return'flag';};self.warning_modal_title=ko.observable("");self.warning_modal_body=ko.observable("");self.show_warning_modal=function(title,body){self.warning_modal_title(title);self.warning_modal_body(body);$("#warning_modal").modal('show');};var default_warning_body='STOP: A "yes" response to this question disqualifies you from completing this application in your state.';self.select_has_existing_insurance=function(){self.existing_insurance(true);};self.select_replacing_insurance=function(){self.replacing_insurance(true);if(!self.did_select_any_fpp_product()||self.is_KY_OR_KS()){self.show_warning_modal("Replacement Notice",default_warning_body);}};self.should_show_NAIC_replacement_notice=ko.computed(function(){return(self.is_NAIC_OR_MI()&&self.replacing_insurance()===false);});self.should_show_replacement_form=ko.computed(function(){if(!self.did_select_any_fpp_product()){return false;}
if(self.is_KY_OR_KS()||self.is_CT_DC_ND_VI()){return false;}
if(self.is_self_enroll()&&self.existing_insurance()){return true;}
if(self.should_show_NAIC_replacement_notice()){return false;}
return self.replacing_insurance();});self.replacement_read_aloud=ko.observable(false);self.replacement_is_terminating=ko.observable(null);self.replacement_using_funds=ko.observable(null);var self_enroll_stop_message="This response requires you to speak with your insurance representative directly, and prevents you from continuing enrollment at this time. You may cancel this enrollment session and contact your representative.";self.replacement_is_terminating.subscribe(function(){if(self.is_self_enroll()&&self.replacement_is_terminating()){self.show_warning_modal("Replacement Notice",self_enroll_stop_message);}});self.replacement_using_funds.subscribe(function(){if(self.is_self_enroll()&&self.replacement_using_funds()){self.show_warning_modal("Replacement Notice",self_enroll_stop_message);}});self.should_show_replacement_details_form=ko.pureComputed(function(){if(self.is_self_enroll()){return false;}
return self.replacement_using_funds()||self.replacement_is_terminating();});self.replacement_policies=ko.observableArray([new ReplacementPolicy()]);self.add_replacement_policy=function(){self.replacement_policies.push(new ReplacementPolicy());};self.remove_replacement_policy=function(policy){self.replacement_policies.remove(policy);};self.is_replacement_form_required=ko.computed(function(){return(self.did_select_any_fpp_product()&&(self.existing_insurance()||self.replacing_insurance()));});self.company_name=ko.observable(self.enrollment_case.company_name);self.is_spouse_address_same_as_employee=ko.observable(!self.spouse().address1()||(self.employee().address1()===self.spouse().address1()&&self.employee().address2()===self.spouse().address2()&&self.employee().city()===self.spouse().city()&&self.employee().state()===self.spouse().state()&&self.employee().zip()===self.spouse().zip()));self.is_spouse_email_same_as_employee=ko.observable((!self.spouse().email()||self.employee().email()===self.spouse().email()));self.should_show_step_5=function(){return _.any(self.coverage_vm.selected_product_coverages(),function(pcov){return pcov.product.should_show_step_5();})};self.should_show_contingent_beneficiary=function(){return _.any(_.invoke(self.products,"should_show_contingent_beneficiary"));};self.has_contingent_beneficiary_error=ko.computed(function(){return _.any(self.coverage_vm.selected_product_coverages(),function(prod_cov){return prod_cov.has_contingent_beneficiary_error();});});self.disclaimer_notice_confirmed=ko.observable(false);self.payroll_deductions_confirmed=ko.observable(false);self.identityToken=ko.observable("");self.identityType=ko.observable("");self.enrollState=ko.observable(self.enrollment_case.situs_state);self.enrollCity=ko.observable(self.enrollment_case.situs_city);self.should_confirm_disclosure_notice=ko.pureComputed(function(){return any_selected_product('should_confirm_disclosure_notice');});self.should_confirm_payroll_deduction=function(){return any_selected_product('should_confirm_payroll_deduction');};self.should_use_date_of_hire_for_identity=function(){return true;};function any_selected_product(method){var selected_products=_.pluck(self.coverage_vm.selected_product_coverages(),'product');return _.any(_.invoke(selected_products,method));}
function init_applicants(){var initial_applicant_list=_.map(options.applicants||[],function(applicant_data){return wizard_applicant.create_applicant(applicant_data);});self.should_show_spouse=ko.observable(false);self.should_include_children=ko.observable(false);self.applicant_list=new wizard_applicant.ApplicantList(initial_applicant_list,self.should_show_spouse,self.should_include_children);self.employee=function(){return self.applicant_list.get_employee();};self.spouse=function(){return self.applicant_list.get_spouse();};self.smoker_status_changed_dialog_loading=ko.observable(false);self.smoker_status_changed_message=ko.observable('');self.smoker_status_changed_messages=ko.observableArray([]);self.show_smoker_status_changed_dialog=function(value,old_value,applicant){$('#smoking-status-dialog').modal('show');var old_selected_coverage_options=_.chain(self.coverage_vm.product_coverage_viewmodels()).map(function(view_model){return view_model._get_applicant_coverage_selections();}).flatten().filter(function(applicant_coverage_vm){return applicant_coverage_vm.coverage_option().face_value>0&&applicant_coverage_vm.product_coverage.product.requires_is_smoker();}).value();self.smoker_status_changed_dialog_loading(true);self.refresh_rate_table();var subscription;subscription=self.is_rate_table_loading.subscribe(function(value){if(!!value){return;}
self.smoker_status_changed_dialog_loading(false);self.smoker_status_changed_messages.removeAll();if(subscription){subscription.dispose();subscription=null;}
_.forEach(old_selected_coverage_options,function(applicant_coverage_selection_view_model){var old_coverage_option=applicant_coverage_selection_view_model.coverage_option();var view_model=_.find(self.coverage_vm.product_coverage_viewmodels(),function(view_model){return applicant_coverage_selection_view_model.product_coverage===view_model;});var new_coverage_options=view_model.get_coverage_options_for_applicant(applicant_coverage_selection_view_model.applicant);var coverage_option=_.chain(new_coverage_options).find(function(coverage_option){return coverage_option.face_value===old_coverage_option.face_value;}).value();if(!coverage_option){coverage_option=_.chain(new_coverage_options).filter(function(coverage_option){return coverage_option.face_value<old_coverage_option.face_value;}).max(function(coverage_option){return coverage_option.face_value;}).value();}
var premium_changed=coverage_option.premium!==old_coverage_option.premium;var face_value_changed=coverage_option.face_value!==old_coverage_option.face_value;applicant_coverage_selection_view_model.customized_coverage_option(coverage_option);if(applicant===applicant_coverage_selection_view_model.applicant){var start_type='non-smoker';var end_type='smoker';if(old_value===true&&value===false){start_type='smoker';end_type='non-smoker';}
self.smoker_status_changed_messages.push('The status change from '+
start_type+' to '+end_type+' adjusts your premium for '+
applicant_coverage_selection_view_model.product_coverage.format_product_name()+' to '+
coverage_option.format_premium()+' for '+coverage_option.format_face_value()+' coverage.');}});});};self.on_smoker_status_changed_dialog=function(){$('#smoking-status-dialog').modal('hide');};function subscribe_to_boolean_changes(observable,callback){if(!observable){return;}
var caller_args=arguments;var previous_value;observable.subscribe(function(old_value){previous_value=old_value;},null,'beforeChange');observable.subscribe(function(value){if((previous_value===undefined||previous_value===null)&&value===false){return;}
if((previous_value!==undefined&&previous_value!==null)||value===true){var args=[value,previous_value];if(caller_args.length>2){_.forEach(Array.prototype.slice.call(caller_args,2),function(arg){args.push(arg);});}
callback.apply(this,args);}});}
subscribe_to_boolean_changes(self.employee().is_smoker,self.show_smoker_status_changed_dialog,self.employee());if(self.spouse()){subscribe_to_boolean_changes(self.spouse().is_smoker,self.show_smoker_status_changed_dialog,self.spouse());}
self.children=ko.computed(function(){return self.applicant_list.get_children();});var should_show_spouse_initially=self.spouse().any_valid_field();self.should_show_spouse(should_show_spouse_initially);var should_show_children_initially=self.applicant_list.has_valid_children();self.should_include_children(should_show_children_initially);var num_initial_children=self.children().length;var last_name=self.employee().last()||"";if(num_initial_children==0){var num_blank_children_forms=(2-num_initial_children);for(var i=0;i<num_blank_children_forms;i+=1){var ch=wizard_applicant.create_applicant({last:last_name,type:wizard_applicant.Applicant.ChildType});self.applicant_list.add_applicant(ch);}}}
function init_jquery_validator(){$.validator.addMethod("minAge",function(val,element,params){var age=wizard_applicant.age_for_date(val);return(age!==""&&age>=params);},"Must be at least {0} years old for this product");$.validator.addMethod("maxAge",function(val,element,params){var age=wizard_applicant.age_for_date(val);return(age!==""&&age<=params);},"Must be no more than {0} years old for this product");self.limit_error_lookup={employee_height:self.employee().height_error,employee_weight:self.employee().weight_error,spouse_height:self.spouse().height_error,spouse_weight:self.spouse().weight_error};self.any_limit_error=ko.pureComputed(function(){return self.employee().height_error()||self.employee().weight_error()||self.spouse().height_error()||self.spouse().weight_error();});$.validator.addMethod("empHeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_height_valid(self.enrollment_case.product_height_weight_tables,product,self.employee());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("empWeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.employee());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("spHeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_height_valid(self.enrollment_case.product_height_weight_tables,product,self.spouse());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("spWeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.spouse());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("isValidPaymentMode",function(value,element){return self.coverage_vm.is_payment_mode_valid();},"You must select a payment mode.");function any_valid_spouse_field(){return self.spouse().any_valid_field();}
self.validator=$("#step1-form").validate({highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement,errorElement:'div',errorClass:'help-block',rules:{eeBenefitFName:"required",eeBenefitLName:"required",eeBenefitDOB:{required:true,date:true,minAge:min_emp_age(),maxAge:max_emp_age()},spFName:{required:{depends:any_valid_spouse_field}},spLName:{required:{depends:any_valid_spouse_field}},spDOB:{required:{depends:any_valid_spouse_field},date:{depends:any_valid_spouse_field},minAge:{param:min_sp_age(),depends:any_valid_spouse_field},maxAge:{param:max_sp_age(),depends:any_valid_spouse_field}},paymentMode:{isValidPaymentMode:{depends:self.can_change_payment_mode}}},groups:{emp_height:"height_feet_0 height_inches_0",sp_height:"height_feet_1 height_inches_1"}});self.validators={};self.validators.step1=self.validator;self.validators.step2=$('#questions-form').validate({highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:step_two_error_placement,errorElement:'span',errorClass:'help-block',rules:{'tobacco-0':{required:requires_additional_employee_information},'gender-0':{required:requires_additional_employee_information},'height_feet_0':{required:requires_additional_employee_information,empHeightLimit:true},'height_inches_0':{required:requires_additional_employee_information,empHeightLimit:true},'weight_0':{required:requires_additional_employee_information,empWeightLimit:true},'tobacco-1':{required:{depends:requires_additional_spouse_information}},'gender-1':{required:{depends:requires_additional_spouse_information}},'weight_1':{required:{depends:requires_additional_spouse_information},spWeightLimit:true},'height_feet_1':{required:{depends:requires_additional_spouse_information},spHeightLimit:true},'height_inches_1':{required:{depends:requires_additional_spouse_information},spHeightLimit:true}}});function is_child_name_required(element){if($(element).attr("id")==="child-first-0"||$(element).attr("id")==="child-last-0"||$(element).attr("id")==="child-dob-0"){return self.should_include_children();}
var child=ko.dataFor(element);if(!child){return false;}
return child.any_valid_field();}
function is_child_field_required(element){if($(element).attr("id")==="child-first-0"||$(element).attr("id")==="child-last-0"||$(element).attr("id")==="child-dob-0"){return self.should_include_children();}
var child=ko.dataFor(element);if(!child){return false;}
return child.any_valid_field();}
$.validator.addClassRules("child_birthdate",{required:{depends:is_child_field_required},date:{depends:is_child_field_required},minAge:{param:min_ch_age(),depends:is_child_field_required},maxAge:{param:max_ch_age(),depends:is_child_field_required}});$.validator.addClassRules("child_first",{required:{depends:is_child_name_required}});$.validator.addClassRules("child_last",{required:{depends:is_child_name_required}});}
init_validation(self);}
function handle_remote_error(request,retry_callback){if(request.status==401){if(ui.account_href!=null){prompt_login(retry_callback);}else{login_reauth(null,null,retry_callback);}}else{alert("Sorry, an error occurred communicating with the server.");}}
function prompt_login(callback){bootbox.confirm({message:"Please type your password to login again: <input id='password' class='form-control' placeholder='Password' type='password'/>",title:"Session Timed Out, Please Re-Login:",buttons:{"cancel":{"label":"Cancel"},"confirm":{"label":"Login","className":"width-35 pull-right btn btn-primary"}},callback:function(result){if(result==true){login_reauth(ui.account_href,$('#password').val(),callback);}}});}
function login_reauth(account_href,password,callback){var post_data={"account_href":account_href,"password":password,"success_message":"You were re-authenticated successfully.  Please continue with the application.","session_data":{"is_self_enroll":ui.is_self_enroll(),"active_case_id":ui.case_id,"enrolling_census_record_id":ui.record_id}};ajax_post('/reauth',post_data,function(reauth_response){bootbox.alert(reauth_response.message);if(callback){callback(true);}},function(){bootbox.alert("There was a problem reauthenticating. Please try again.");if(callback){callback(false);}},true);}
function ajax_post(url,data,on_success,on_error,is_json){var options={data:data,error:on_error,success:on_success,dataType:"json",method:"POST"};if(is_json===true){options.contentType="application/json; charset=utf-8";options.processData=false;options.data=JSON.stringify(data);}
$.ajax(url,options);}
return{WizardVM:WizardVM};})
();var agent_inbox=(function(){var AgentInboxViewModel=function(agent_id){var self=this;self.current_agent_id=agent_id;self.is_loading=ko.observable(true);self.envelopes=ko.observableArray([]);self.pending_envelopes=ko.pureComputed(function(){return _.filter(self.envelopes(),function(e){return e.is_pending();});});self.completed_envelopes=ko.pureComputed(function(){return _.filter(self.envelopes(),function(e){return e.is_completed();});});self.sign_envelope=function(){var envelope_id=$(this).attr("data-id");sign_envelope(envelope_id,{from_inbox:true}).success(function(resp){var data=resp.data;if(data.errors&&data.errors.length>0&&data.errors[0].reason==="voided_envelope"){var envelope=_.find(self.envelopes(),function(e){return e.id===envelope_id});if(envelope){self.envelopes.remove(envelope);}}});};self.table_options={order:[[2,"asc"]],columns:[{sortable:false,data:function(row){var icon_class;if(row.should_show_sign_button(self.current_agent_id)){icon_class="glyphicon glyphicon-pencil";}else if(row.should_show_view_button(self.current_agent_id)){icon_class="glyphicon glyphicon-file";}else{return"";}
return'<button class="btn btn-primary btn-xs sign-button" data-id="'+row.id+'"><span class="ace-icon '+icon_class+'"></span> '+row.button_text+'</button>';}},{data:"status"},{data:"timestamp",visible:false},{data:"formatted_timestamp",orderData:[2]},{data:"agent"},{data:"group"},{data:function(row){return"<a href='/enrollment-case/"+row.case_id+"/census/"+row.census_record_id+"'>"+row.employee_first+"</a>";}},{data:function(row){return"<a href='/enrollment-case/"+row.case_id+"/census/"+row.census_record_id+"'>"+row.employee_last+"</a>";}},{data:"products"},{data:"coverage"}]};fetch_envelopes(self.is_loading,self.envelopes);$("body").on("click","button.sign-button",self.sign_envelope);};var EnvelopeViewModel=function(envelope){var self=this;self.id=envelope.id;self.case_id=envelope.case_id;self.census_record_id=envelope.census_record_id;self.application_status=envelope.application_status;self.agent_signing_status=envelope.agent_signing_status;self.employee_signing_status=envelope.employee_signing_status;self.employee_signing_datetime=envelope.employee_signing_datetime;self.agent_signing_datetime=envelope.agent_signing_datetime;if(self.employee_signing_status==="pending"||self.employee_signing_status==="declined_to_sign"){self.status="Pending Employee";self.button_text="Sign";self.timestamp=envelope.timestamp;self.formatted_timestamp=format_time();}else if(self.agent_signing_status===null||self.agent_signing_status==="pending"){self.status="Pending Agent";self.button_text="Sign";self.timestamp=envelope.timestamp;self.formatted_timestamp=format_time();}else if(self.agent_signing_status==="signed"){self.status="Complete";self.button_text="View";self.timestamp=(self.employee_signing_datetime)?self.employee_signing_datetime:self.agent_signing_datetime;self.formatted_timestamp=format_time();}else if(self.agent_signing_status==="declined_to_sign"){self.status="Agent Declined";self.timestamp=envelope.timestamp;self.formatted_timestamp=format_time();}else{self.status="Unknown";self.button_text="";self.timestamp=envelope.timestamp;self.formatted_timestamp=format_time();}
self.group=envelope.group;self.agent=envelope.agent;self.employee_first=envelope.employee_first;self.employee_last=envelope.employee_last;self.products=envelope.products;self.coverage=envelope.coverage;self.agent_id=envelope.agent_id;self.is_pending=function(){return self.agent_signing_status!=="signed"&&self.agent_signing_status!=="declined_to_sign"&&self.application_status!=="voided";};self.is_completed=function(){return self.agent_signing_status==="signed"&&self.application_status!=="voided";};self.should_show_sign_button=function(current_agent_id){return self.button_text==="Sign"&&(current_agent_id===self.agent_id||self.agent_id===null);};self.should_show_view_button=function(current_agent_id){return self.button_text==="View";};function format_time(){return moment(self.timestamp).format("MM/DD/YYYY h:mma");}};function fetch_envelopes(loading_observable,envelopes_observable){loading_observable(true);$.ajax("/envelopes").success(function(data){loading_observable(false);var envelopes=_.map(data.data,function(envelope_data){return new EnvelopeViewModel(envelope_data);});envelopes_observable(envelopes);})}
function sign_envelope(envelope_id,options){var url="/envelopes/"+envelope_id+"/sign";if(options&&options.from_inbox){url+="?from=inbox";}
var req=$.post(url).success(function(data){return handle_signing_redirect(envelope_id,data)}).error(handle_signing_failure);bootbox.alert("Redirecting to signing page, please wait...");return req;}
function handle_signing_redirect(envelope_id,resp){var data=resp.data;if(data.errors.length>0){bootbox.hideAll();bootbox.alert(data.errors[0].message);return;}
window.location.href=data.url;}
function handle_signing_failure(data){bootbox.hideAll();bootbox.alert("There was a problem redirecting to the signing page.");}
return{init_viewmodel:function(params){return new AgentInboxViewModel(params);},sign_envelope:function(envelope_id){return sign_envelope(envelope_id);}}})();var case_management=(function(){var loading_html="<span class='icon-spinner icon-spin grey bigger-200'></span> <span class='bigger-175'> Loading data...</span>";function refresh_census_table(case_id,url,table_selector,loading_selector,init_callback,no_data_cb,success_callback){var loading=$(loading_selector);var table=$(table_selector);var table_settings={"responsive":{breakpoints:get_responsive_datatables_breakpoints()},"autoWidth":false,"processing":true,"pagingType":"full","serverSide":true,"ajax":"/cases/"+case_id+"/census_records","columnDefs":[{targets:[0],sortable:false,name:"action",data:function(row){if(row.enrollment_status==="enrolled"){return'<button class="btn btn-primary btn-xs enroll-employee" data-id="'+row.id+'"><span class="ace-icon glyphicon glyphicon-plus"></span> Add Coverage</button>';}else if(row.enrollment_status==="pending_employee"||row.enrollment_status==="pending_agent"){return"";}else{return'<button class="btn btn-primary btn-sm enroll-employee" data-id="'+row.id+'">Enroll</button>';}}},{targets:[1],name:"status",data:function(row){return format_enrollment_status_html(row.enrollment_status);}},{targets:[2],name:"employee_first",data:function(row){return"<a href='/enrollment-case/"+row.case_id+"/census/"+row.id+"'>"+row.employee_first+"</a>";}},{targets:[3],name:"employee_last",data:function(source){return"<a href='/enrollment-case/"+source.case_id+"/census/"+source.id+"'>"+source.employee_last+"</a>";}},{targets:[4],sortable:false,name:"employee_birthdate",data:function(source){return normalize_date(source.employee_birthdate);}},{targets:[5],sortable:false,name:"employee_email",data:"employee_email",className:"min-breakIII"}],sorting:[[3,"asc"]]};table.show();$(".no-census-header").hide();if(!$.fn.DataTable.fnIsDataTable(table[0])){table.wrap("<div class='dataTables_borderWrap' />").DataTable(table_settings);}else{table.DataTable().columns.adjust().draw();}}
function refresh_enrollments_table(case_id,url,table_selector,loading_selector,table_options,init_callback){var loading=$(loading_selector);var table=$(table_selector);var table_defaults={"responsive":{breakpoints:get_responsive_datatables_breakpoints()},"autoWidth":false,"processing":true,"pagingType":"full","serverSide":true,"ajax":"/cases/"+case_id+"/enrollment_records","columnDefs":[{"targets":[0],name:"date","data":function(source){return format_date(parse_date(source.date));},"className":"min-breakII"},{"targets":[1],name:"employee_first","data":function(row){return"<a href='/enrollment-case/"+row.case_id+"/census/"+row.census_record_id+"'>"+row.employee_first+"</a>";}},{"targets":[2],name:"employee_last","data":function(row){return"<a href='/enrollment-case/"+row.case_id+"/census/"+row.census_record_id+"'>"+row.employee_last+"</a>";}},{"targets":[3],name:"employee_birthdate",sortable:false,"data":function(source){return format_date(parse_date(source.employee_birthdate,"YYYY-MM-DD"));},"className":"min-breakI"},{targets:[4],name:"agent_name",data:"agent_name","className":"min-breakII"},{"targets":[5],name:"enrollment_status","data":function(source){return format_enrollment_status_html(source.enrollment_status)},className:"min-breakV"},{"targets":[6],name:"total_premium","data":function(source){return'$'+source.total_premium;},className:"text-right"}],"sorting":[[2,"asc"]],"displayLength":25};var table_settings=$.extend({},table_defaults,table_options||{});if(!table_exists(table)){table.show();table.wrap("<div class='dataTables_borderWrap' />").DataTable(table_settings);init_callback(table);}else{table.DataTable().columns.adjust().draw();}}
function table_exists(table){return $.fn.DataTable.fnIsDataTable(table.get(0));}
function clear_table(table){if($.fn.DataTable.fnIsDataTable(table.get(0))){table.dataTable().fnClearTable();}}
function update_table_data(table,data){table.dataTable().fnAddData(data);table.DataTable().columns.adjust().draw();}
function init_data_table(table,table_settings,data,init_callback){table.show();table_settings.aaData=data;table.wrap("<div class='dataTables_borderWrap' />").dataTable(table_settings);if(init_callback!==undefined){init_callback(table);}
table.DataTable().columns.adjust().draw();}
var _alphabet_search_letter;$.fn.dataTableExt.afnFiltering.push(function(oSettings,aData,iDataIndex){if(!_alphabet_search_letter){return true;}
var last_name_col=3;return(aData[last_name_col]&&aData[last_name_col].charAt(0)===_alphabet_search_letter);});function init_alphabet_search(table){var alphabet=$('<div class="alphabet hidden-sm hidden-xs"/>').append('Last Name: ');$('<span class="clear active"/>').data('letter','').html('Reset').appendTo(alphabet);for(var i=0;i<26;i++){var letter=String.fromCharCode(65+i);$('<span class="letter"/>').data('letter',letter).html(letter).appendTo(alphabet);}
alphabet.insertBefore(table);alphabet.on('click','span',function(){alphabet.find('.active').removeClass('active');$(this).addClass('active');_alphabet_search_letter=$(this).data('letter');table.fnDraw();});}
var _should_show_enrolled=true;$.fn.dataTableExt.afnFiltering.push(function(oSettings,aData,iDataIndex){if(_should_show_enrolled){return true;}
return(aData[1]==="Not Enrolled");});function init_status_filter(table){var ctn=$('<div class="status-filter">');ctn.html("<label><input type='checkbox' class='ace' checked='checked'> <span class='lbl'> Show Enrolled</span></label>");ctn.on('change','input',function(){_should_show_enrolled=$(this).prop("checked");table.fnDraw();});ctn.insertBefore(table);}
return{refresh_census_table:refresh_census_table,refresh_enrollments_table:refresh_enrollments_table,init_alphabet_search:init_alphabet_search,init_status_filter:init_status_filter};})();function format_face_value(val){if(val==null){return"(NA)";}
return"$"+numberWithCommas(val);}
function format_premium_value(val){if(val==null){return"(NA)";}
return"$"+numberWithCommas(val.toFixed(2));}
function handle_remote_error(){alert("Sorry, an error occurred communicating with the server.");}
function ajax_post(url,data,on_success,on_error,is_json){var options={data:data,error:on_error,success:on_success,dataType:"json",method:"POST"};if(is_json===true){options.contentType="application/json; charset=utf-8";options.processData=false;options.data=JSON.stringify(data);}
$.ajax(url,options);}
function init_case_riders(riders){window.ui.selected_riders["emp"](riders.slice());window.ui.selected_riders["sp"](riders.slice());window.ui.case_riders(riders);}
function init_enrollment_riders(riders){window.ui.enrollment_riders(riders);}
ko.bindingHandlers.wysiwyg=(function(){var toolbars={simple:['bold','italic','underline',null,'createLink','unlink',null,null,null,'undo','redo'],full:[null,null,null,'bold','italic','strikethrough','underline',null,'insertunorderedlist','insertorderedlist',null,'outdent','indent',null,'justifyleft','justifycenter','justifyright','justifyfull',null,{name:'createLink',placeholder:'URL',button_class:'btn-purple',button_text:'Add'},'unlink',null,{name:'insertImage',placeholder:'Image URL',button_insert_class:'btn-purple',button_insert:'Add',choose_file:true,button_class:'btn-success',button_text:'Choose an Image'},null,'foreColor',null,'undo','redo']};return{init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var va=valueAccessor();var html=va.value,type=va.type;var toolbar=toolbars[type]||toolbars.simple;$(element).ace_wysiwyg({toolbar:toolbar});$(element).html(ko.unwrap(html));$(element).on("change",function(){html($(element).html());});},update:function(element,valueAccessor){var updated_html=ko.unwrap(valueAccessor().value);if($(element).html()!=updated_html){$(element).html(updated_html);}}};})();ko.components.register('case-report',{viewModel:{createViewModel:function(params,componentInfo){return new CaseReportsViewModel(params);}},template:{element:'case-report-template'}});ko.subscribable.fn.watch=function(a,b,c,d){var e=typeof a;return"boolean"===e||"undefined"===e?ko.watch(this,{enabled:a!==!1}):"function"!==e||ko.isSubscribable(a)?ko.watch(a,b,c,d||this):ko.watch(this,b||{},a,d||this),this},ko.watch=function(a,b,c,d){function e(h,i,j,k,l,m){if(h&&0!==b.depth&&(-1===b.depth||j.length<(b.depth||1))){if(b.watchedOnly&&!h.watchable&&h!=a)return;if((b.enabled===!1||b.enabled===!0)&&(h.watchable=b.enabled),h.watchable===!1)return;b.seal===!0&&(h.watchable=!1);var n=typeof h;if("object"===n||"function"===n){if(h._watcher===d)return;if(b.hide&&ko.utils.arrayIndexOf(b.hide,h)>-1)return;var o=[].concat(j,i&&i!==a?i:[]);if("function"!==n){if("[object Object]"===Object.prototype.toString.call(h))ko.utils.objectForEach(h,function(a,c){if(c=b.getter?b.getter.call(d,o,h,a):c){if(b.wrap){var f=Object.prototype.toString.call(c);"[object Function]"!==f&&"[object Object]"!==f&&(b.beforeWrap&&b.beforeWrap.call(d,o,h,c)===!1||(c=h[a]="[object Array]"===f?ko.observableArray(c):ko.observable(c)))}b.unloop&&(c._watcher=k?void 0:d);var g=e(c,l?null:h,o,k,null,a);b.tagFields&&void 0===c._fieldName&&(g||"parentsOnly"!==b.tagFields&&"function"==typeof c||"object"==typeof c)&&(c._fieldName=a)}});else if(b.hideArrays!==!0)for(var p=0;p<h.length;p++)e(h[p],l?null:h,o,k);return!0}if("function"==typeof h.notifySubscribers&&c){if(b.enabled===!0&&h.watchable===!1)return;if(k||!b.beforeWatch||b.beforeWatch.call(d,o,h,m)!==!1){var q="function"==typeof h.pop;if(k?f(h):g(h,q,o,l),q)return e(h(),l?null:h,o,k,!0),!0;if(b.hideWrappedValues!==!0)return e(h(),l?null:h,o,k,!0)}}}}}function f(a){var c=a[h];if(!c)throw"Subscriptions field (."+h+") not defined for observable child "+(a._fieldName||"");if(c.change)for(var e=c.change.length-1;e>=0;e--)c.change[e]._watcher===d&&c.change[e].dispose();if(c.beforeChange&&(b.mutable||b.oldValues>0))for(var e=c.beforeChange.length-1;e>=0;e--)c.beforeChange[e]._watcher===d&&c.beforeChange[e].dispose();if(c.arrayChange)for(var e=c.arrayChange.length-1;e>=0;e--)c.arrayChange[e]._watcher===d&&c.arrayChange[e].dispose()}function g(a,f,g,h){f?a.subscribe(function(b){ko.utils.arrayForEach(b,function(b){var f=c.call(d,g,a,b);void 0!==f&&d(f),b.moved||setTimeout(function(){e(b.value,h?null:a,g,"deleted"===b.status)},0)})},void 0,"arrayChange")._watcher=d:(a.subscribe(function(){if(a.watchable!==!1){var f=c.call(d,g,a);void 0!==f&&d(f),b.mutable&&"object"==typeof a()&&e(a(),h?null:a,g)}},null,"change")._watcher=d,(b.oldValues>0||b.mutable)&&(a.subscribe(function(c){if(b.oldValues>0){var d=a.oldValues?a.oldValues:a.oldValues=[];for(d.unshift(c);d.length>b.oldValues;)d.pop()}b.mutable&&"object"==typeof c&&e(c,h?null:a,g,!1,!0)},null,"beforeChange")._watcher=d))}"function"==typeof b&&(d=d||c,c=b,b={}),d=d||this;var h;switch(ko.DEBUG||ko.version){case!0:h="_subscriptions";break;case"3.0.0":h="F";break;case"3.1.0":h="H";break;case"3.2.0":h="M";break;case"3.3.0":h="G";case"3.4.0":h="K";break;default:throw"Unsupported Knockout version. Only v3.0.0 to v3.4.0 are supported when minified. Current version is "+ko.version}return"function"!=typeof a||ko.isSubscribable(a)?(e(a,null,[]),{dispose:function(){e(a,null,[],!0)}}):ko.computed(a,c,b)};window.foo="1.3.6";var urls=(function urls(){return{get_manage_cases_url:function(){return'/enrollment-cases';},get_manage_case_url:function(case_id){return'/enrollment-case/'+case_id;},get_cases_api_url:function(){return"/cases";},get_case_api_url:function(case_id){return'/cases/'+case_id;},get_case_api_enrollment_periods_url:function(case_id){return'/cases/'+case_id+'/enrollment_periods';},get_case_api_enrollment_report_url:function(case_id){return'/cases/'+case_id+'/enrollment_report';},get_case_api_self_enrollment_url:function(case_id){return'/cases/'+case_id+'/self_enrollment_setup';},get_case_api_agent_splits_url:function(case_id){return'/cases/'+case_id+'/agent_splits_setup';},get_case_api_enrollment_records_url:function(case_id){return'/cases/'+case_id+'/enrollment_records';},get_case_api_enrollment_record_url:function(case_id,census_record_id){return'/cases/'+case_id+'/enrollment_records/'+census_record_id;},get_case_api_census_records_url:function(case_id){return'/cases/'+case_id+'/census_records';},get_case_api_census_record_url:function(case_id,census_record_id){return'/cases/'+case_id+'/census_records/'+census_record_id;},get_case_api_census_email_batches:function(case_id){return"/cases/"+case_id+"/self_enroll_email_batches"},get_case_api_census_email_batch_preview_url:function(case_id,batch_id){return"/batch-info/"+case_id+"/preview/"+batch_id},get_case_api_census_email_batch_logs_url:function(case_id,batch_id){return"/batch-info/"+case_id+"/logs/"+batch_id;},get_case_email_self_enrollment_batches_url:function(case_id){return'/cases/'+case_id+'/self_enroll_email_batches';},get_case_email_self_enrollment_batch_url:function(case_id,batch_id){return'/cases/'+case_id+'/self_enroll_email_batches/'+batch_id;},get_product_api_url:function(product_id){return'/products/'+case_id;},get_in_person_enrollment_url:function(){return'/in-person-enrollment';},get_submit_enrollment_records_url:function(){return'/enrollments';},get_delete_enrollment_record_url:function(id){return'/enrollments/records/'+id;},get_flat_file_documentation_url:function(){return"/flat_file_documentation.html";},get_csv_import_documentation_url:function(){return"/delimited_file_import_documentation.html";}}})();$(function(){$.ajaxSetup({cache:false});});function send_form_data(method,url,data,on_success,on_error){return submit_data(method,url,data,true,on_success,on_error);}
function send_file_data(method,url,data,on_success,on_error){return submit_data(method,url,data,false,on_success,on_error,false);}
function send_json_data(method,url,data,on_success,on_error){return submit_data(method,url,JSON.stringify(data),false,on_success,on_error,'application/json');}
function get_loading_html(message){var text=message||"Loading data...";return'<div class="text-center">'+"<h4>"+text+"</h4>"+'<i class="icon-spinner icon-spin grey bigger-200"></i>'+"</div>";}
function format_enrollment_status_text(status){if(status==="enrolled"){return"Enrolled";}else if(status==="declined"){return"Declined";}else if(status==="pending_employee"){return"Pending Employee";}else if(status==="pending_agent"){return"Pending Agent";}else{return"Not Enrolled";}}
function format_enrollment_status_html(status){var status_text=format_enrollment_status_text(status);if(status_text==="Not Enrolled"){return status_text;}else{if(status_text==="Enrolled"){return"<span class='enroll-status ace-icon glyphicon glyphicon-ok'> </span><span class='enroll-status'> Enrolled</span>";}else if(status_text==="Pending Employee"||status_text==="Pending Agent"){return"<span class='enroll-status pending icon glyphicon glyphicon-pencil'></span><span class='enroll-status pending'>"+status_text+"</span>";}else{return"<span class='ace-icon glyphicon glyphicon-remove error'></span> <span class='enroll-status declined'> Declined</span>";}}}
function parse_month_date_input(val){return parse_date(val,"MM/DD");}
function today_between(start,end){var today=moment();var is_after_start=today.isSameOrAfter(moment(start),'day');if(!moment(end).isValid()){return is_after_start;}else{var is_before_end=today.isSameOrBefore(moment(end),'day');return is_after_start&&is_before_end}}
function parse_date(date_str,format_str){if(format_str===undefined){format_str=["YYYY-MM-DD","MM/DD/YYYY"];}
return moment(date_str,format_str);}
function normalize_date(date_str){if(date_str!=''&&is_valid_date(date_str)){return format_date(parse_date(date_str));}else{return'';}}
function normalize_date_of_birth(date_of_birth_string){'use strict';if(date_of_birth_string&&is_valid_date_of_birth(date_of_birth_string)){return format_date(parse_date(date_of_birth_string));}else{return'';}}
function is_valid_date(date_str,format_str){var date=parse_date(date_str,format_str);return date.isValid();}
function is_valid_date_of_birth(date_of_birth){'use strict';if(!date_of_birth){return false;}
var dob_moment=moment.isMoment(date_of_birth)?date_of_birth:moment(date_of_birth,'MM/DD/YYYY');if(!dob_moment.isValid()){dob_moment=moment(date_of_birth,'YYYY-MM-DD');}
var today=moment({hour:0,minute:0,seconds:0,milliseconds:0});return dob_moment.isValid()&&dob_moment.isBefore(today);}
function get_date_of_birth_validation_error(date_of_birth){'use strict';if(!date_of_birth){return null;}
var dob_moment=moment.isMoment(date_of_birth)?date_of_birth:moment(date_of_birth,'MM/DD/YYYY');if(!dob_moment.isValid()){return'Date is invalid.';}
var today=moment({hour:0,minute:0,seconds:0,milliseconds:0});if(dob_moment.isAfter(today)){return'Date must be before today.';}
return null;}
function format_date(moment_date){return moment_date.format("MM/DD/YYYY");}
function now(){return moment();}
function get_responsive_datatables_breakpoints(){return[{name:'breakI',width:Infinity},{name:'breakII',width:1024},{name:'breakIII',width:768},{name:'breakIV',width:600},{name:'breakV',width:560},{name:'smallphone',width:480}];}
function submit_data(method,url,data,should_process_data,on_success,on_error,contentType){on_success=on_success||function(){};on_error=on_error||function(){};var options={url:url,type:method,data:data,dataType:'json',success:function(results){on_success(results);},error:function(xhr){on_error(xhr);}};if(!should_process_data){options.processData=false;}
if(contentType!==undefined){options.contentType=contentType;}
return $.ajax(options);}
function submit_to_url(url,data){var form=document.createElement('form');for(k in data){if(data.hasOwnProperty(k)){$("<input>",{name:k,value:data[k]}).appendTo(form);}}
form.method="POST";form.action=url;var wrapper=$("<div>");wrapper.appendTo("body").hide();$(form).appendTo(wrapper).submit();}
function show_all_errors(all_errors){if(Object.keys(all_errors).length==0){return;}
$(".submit-message").addClass("error").html("Please fix the indicated problems and resubmit.").show();$.each(all_errors,function(field_name,errors){show_errors(field_name,errors);});focus_first_error(all_errors);}
function show_errors(field_name,field_error_messages){get_field(field_name).after($("<div>").addClass("error").html(field_error_messages.join("<br>")));}
function get_field(field_name){return $("textarea[name="+field_name+"], select[name="+field_name+"], input[name="+field_name+"], #"+field_name);}
function focus_first_error(errors){$.each(errors,function(field_name,errors){get_field(field_name).focus();})}
function hide_all_errors(){$(".submit-message").removeClass("error").hide();$(".error").remove();}
function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}
ko.bindingHandlers.modal={update:function(element,valueAccessor){if(ko.unwrap(valueAccessor())){$(element).modal('show');}else{$(element).modal('hide');}}};ko.bindingHandlers.dataTable={update:function(element,valueAccessor){var bind_opts=ko.unwrap(valueAccessor());var datatable_opts=$.extend({},bind_opts.options);var data_observable=bind_opts.data;var updated_data=data_observable();if(!$.fn.DataTable.fnIsDataTable(element)&&updated_data.length>0){datatable_opts.data=updated_data;$(element).DataTable(datatable_opts);}else if(updated_data.length>0){var table=$(element).DataTable();table.clear();table.rows.add(updated_data).draw();}}};ko.bindingHandlers.flashMessage={update:function(element,valueAccessor){$(element).html(ko.unwrap(valueAccessor())).delay(5000).hide('fade')}};ko.bindingHandlers.maskedInput={init:function(element,valueAccessor){$(element).mask(ko.unwrap(valueAccessor()));}};ko.bindingHandlers.slideDownIf={init:function(element,value_accessor){var val=ko.unwrap(value_accessor());$(element).toggle(val);},update:function(element,value_accessor){var val=ko.unwrap(value_accessor());if(val){$(element).slideDown(400);}else{$(element).slideUp(400);}}};ko.bindingHandlers.fadeInIf={init:function(element,value_accessor){var val=ko.unwrap(value_accessor());$(element).toggle(val);},update:function(element,value_accessor){var val=ko.unwrap(value_accessor());if(val){$(element).fadeIn(400);}else{$(element).fadeOut(400);}}};ko.bindingHandlers.multiSelect={init:function(element,valueAccessor,allBindings,viewModel){valueAccessor().observed.subscribe(function(newVal){console.log(newVal);$(element).multiselect('deselectAll');$(element).multiselect('select',newVal);});$(element).multiselect(valueAccessor().options);},update:function(element,valueAccessor,allBindings,viewModel){$(element).multiselect('refresh');}};ko.bindingHandlers.dualListbox={init:function(element,valueAccessor){valueAccessor().observed();$(element).bootstrapDualListbox(valueAccessor().options);},update:function(element,valueAccessor){$(element).bootstrapDualListbox("refresh");}};ko.bindingHandlers.uniqueNameValidation={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var value=valueAccessor();var remoteInvocation=value.remoteMethod;var tracked_observable=value.uniqueObservable;tracked_observable.has_been_checked=ko.observable(false);tracked_observable.is_checking=ko.observable(false);tracked_observable.is_unique=ko.observable(null);tracked_observable.unique_value=null;tracked_observable.subscribe(function(current_value){tracked_observable.is_unique(null);tracked_observable.is_checking(true);tracked_observable.has_been_checked(false);remoteInvocation(current_value,function(is_unique){tracked_observable.unique_value=current_value;tracked_observable.is_unique(is_unique);tracked_observable.is_checking(false);tracked_observable.has_been_checked(true);});});}};$(function(){$('body').on('focus','[contenteditable]',function(){var $this=$(this);$this.data('before',$this.html());return $this;}).on('blur keyup paste input','[contenteditable]',function(){var $this=$(this);if($this.data('before')!==$this.html()){$this.data('before',$this.html());$this.trigger('change');}
return $this;});});var FlashMessages=function(){var self=this;self.messages=ko.observableArray();self.clear=function(){_.invoke(self.messages(),"dismiss");};self.flash_error=function(message){self.messages.push(new FlashMessage({message:message,type:"error"}));};self.flash_success=function(message){self.messages.push(new FlashMessage({message:message,type:"success"}));};};var FlashMessage=function(message_obj){var self=this;self.message=message_obj.message;self.type=message_obj.type;self.is_visible=ko.observable(true);self.is_error=function(){return self.type==="error";};self.is_success=function(){return self.type==="success";};self.dismiss=function(){self.is_visible(false);}};ko.components.register('flash-messages',{viewModel:function(params){var self=this;self.flash_messages=params.messages;},template:'\
  <!--ko foreach: flash_messages.messages-->\
  <div class="alert alert-block" \
  data-bind="visible: is_visible, \
  css: {\'alert-success\': is_success(), \'alert-danger\': is_error()}">\
  <button type="button" class="close" data-bind="click: dismiss">\
  <i class="ace-icon fa fa-times"></i>\
  </button>\
  \
  <p>\
  <strong data-bind="visible: is_success()">\
  <i class="ace-icon fa fa-check"></i>\
  </strong>\
  \
  <strong data-bind="visible: is_error()">\
  <i class="ace-icon fa fa-exclamation-triangle"></i>\
  </strong>\
  <span data-bind="html: message"></span>\
  </p>\
  </div>\
  <!--/ko-->'});ko.components.register('loading-modal',{viewModel:function(params){var self=this;self.options=params.options;self.defaults={message:"Loading...",title:"Please Wait"};self._current_settings=ko.pureComputed(function(){return $.extend({},self.defaults,self.options()||{});});self.message=ko.pureComputed(function(){return self._current_settings().message;});self.title=ko.pureComputed(function(){return self._current_settings().title;});self.is_showing=ko.pureComputed(function(){return self.options()!==null;});},template:'\
  <div class="modal fade" data-bind="modal: is_showing">\
  <div class="modal-dialog">\
  <div class="modal-content">\
  <div class="modal-header">\
  <button type="button" class="close" data-dismiss="modal"><span\
  aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\
  <h4 class="modal-title" data-bind="html: title">Please wait</h4>\
  </div>\
  <div class="modal-body">\
  <div class="form-panel modal-panel">\
  <div class="text-center">\
  <h4 data-bind="html: message"></h4>\
  <i class="ace-icon fa fa-spinner fa-spin grey bigger-200"></i>\
  </div>\
  </div>\
  </div>\
  <div class="modal-footer">\
  </div>\
  </div>\
  <!-- /.modal-content -->\
  </div>\
  <!-- /.modal-dialog -->\
  </div>\
  '});ko.components.register('height-select',{viewModel:function(params){var self=this;self.height=params.value;self.required=params.required||false;self.name_suffix=params.name_suffix||null;self.height_feet_part=ko.observable(""+get_feet_part(self.height()));self.height_inches_part=ko.observable(""+get_inches_part(self.height()));self.update_height=function(){var feet=parseInt(self.height_feet_part());var inches=parseInt(self.height_inches_part());if(feet===null||isNaN(feet)||inches===null||isNaN(inches)){self.height(null);}else{self.height((12*feet)+inches);}};self.height_feet_part.subscribe(self.update_height);self.height_inches_part.subscribe(self.update_height);},template:'\
  <label>\
  Height:\
  <select data-bind="value: height_feet_part, attr: {name: \'height_feet_\'+name_suffix}">\
  <option></option>\
  <option>4</option>\
  <option>5</option>\
  <option>6</option>\
  </select> Feet\
  </label>\
  <label>\
  <select data-bind="value: height_inches_part, attr: {name: \'height_inches_\'+name_suffix}">\
  <option></option>\
  <option>0</option>\
  <option>1</option>\
  <option>2</option>\
  <option>3</option>\
  <option>4</option>\
  <option>5</option>\
  <option>6</option>\
  <option>7</option>\
  <option>8</option>\
  <option>9</option>\
  <option>10</option>\
  <option>11</option>\
  </select> Inches\
  </label>'});function get_feet_part(val){if(val===null||val===undefined){return null;}else{return Math.floor(parseInt(val)/12);}}
function get_inches_part(val){if(val===null||val===undefined){return null;}else{return Math.floor(parseInt(val)%12);}}
ko.components.register('limited-state-select',{viewModel:function(params){this.limiter=params.limiter;this.is_disabled=ko.observable(params.disabled||false);},template:'<select name="enrollmentState" id="enrollmentState" data-bind="\
  value: limiter.selected_state,\
  options: limiter.available_states,\
  optionsCaption: \'(Select State)\',\
  optionsText: \'statecode\',\
  optionsAfterRender: limiter.disable_state_option_if_invalid,\
  disable: is_disabled\
  "></select>'});ko.components.register('limited-product-select',{viewModel:function(params){this.limiter=params.limiter;this.is_disabled=ko.observable(params.disabled||false);this.is_mulit_select=params.is_multi_select||false;},template:'<select multiple name="productID" id="productID" data-bind="\
  selectedOptions: limiter.selected_products, \
  options: limiter.available_products,\
  optionsText: \'name\', \
  optionsAfterRender: limiter.disable_product_option_if_invalid,\
  disable: is_disabled\
  "> \
  </select>'});var ProductStatesLimiterViewModel=function(product_statecode_mapping,selected_state,available_states,selected_products,available_products){var self=this;self.product_state_mapping=map_states_to_products_from_statecode_map(available_states,product_statecode_mapping);self.selected_state=selected_state;self.available_states=available_states;self.selected_products=selected_products;self.available_products=available_products;self.is_valid_product_for_state=function(product,state){if(!state){return true;}
return _.contains(self.product_state_mapping[product.id],state);};self.is_state_disabled=function(state){return!_.contains(self.enabled_states(),state);};self.is_product_disabled=function(product){return!_.contains(self.enabled_products(),product);};self.disable_product_option_if_invalid=function(option,product){if(product===undefined){return;}
ko.applyBindingsToNode(option,{disable:ko.computed(function(){return self.is_product_disabled(product);})},product);};self.disable_state_option_if_invalid=function(option,state){if(state===undefined){return;}
ko.applyBindingsToNode(option,{disable:ko.computed(function(){return self.is_state_disabled(state);})},state);};self.enabled_states=ko.computed(function(){return _.filter(self.available_states,function(state){return _.all(self.selected_products(),function(product){return self.is_valid_product_for_state(product,state);});});});self.enabled_products=ko.computed(function(){if(self.selected_state()!==null&&self.selected_state()){return _.filter(self.available_products(),function(product){return self.is_valid_product_for_state(product,self.selected_state());});}
return self.available_products();});};function map_states_to_products_from_statecode_map(available_states,product_state_mapping){var states_for_products={};_.each(product_state_mapping,function(statecodes,product_id){states_for_products[product_id]=[];_.each(statecodes,function(statecode){var matched_state=_.find(available_states,function(s){return s.statecode==statecode;});if(matched_state){states_for_products[product_id].push(matched_state);}});});return states_for_products;}
var StatesLimiterViewModel=function(product_statecode_mapping,selected_state,available_states,selected_products){var self=this;self.available_states=available_states;self.selected_state=selected_state;self.product_state_mapping=map_states_to_products_from_statecode_map(available_states,product_statecode_mapping);self.is_valid_product_for_state=function(product,state){return _.contains(self.product_state_mapping[product.id],state);};self.is_state_disabled=function(state){return!_.contains(self.enabled_states(),state);};self.disable_state_option_if_invalid=function(option,state){if(state===undefined){return;}
ko.applyBindingsToNode(option,{disable:ko.computed(function(){return self.is_state_disabled(state);})},state);};self.enabled_states=ko.computed(function(){return _.filter(self.available_states,function(state){return _.all(selected_products(),function(product){return self.is_valid_product_for_state(product,state);});});});selected_products.subscribe(function(products){if(!_.any(products,function(product){return self.is_valid_product_for_state(product,self.selected_state());})){self.selected_state(null);}});};if(typeof Object.create!='function'){(function(){var F=function(){};Object.create=function(o){if(arguments.length>1){throw Error('Second argument not supported');}
if(o===null){throw Error('Cannot set a null [[Prototype]]');}
if(typeof o!='object'){throw new TypeError('Argument must be an object');}
F.prototype=o;return new F();};})();}
ko.components.register('delete-confirm-modal',{viewModel:function(params){var self=this;self.title=params.title;self.message=params.message;self.callback=params.callback;self.modal_observable=params.modal_observable;self.delete_confirmation_text=ko.observable("");self.is_delete_text_valid=ko.pureComputed(function(){return self.delete_confirmation_text()=="DELETE";});},template:'<div data-bind="modal: modal_observable" class="modal fade">\
    <div class="modal-dialog modal-lg">\
      <div class="modal-content">\
        <div class="modal-header">\
          <button type="button" class="close" data-dismiss="modal"><span\
                                              aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\
          <h4 class="modal-title" data-bind="text: title"></h4>\
        </div>\
        <div class="modal-body">\
          <div class="form-panel modal-panel">\
            <div class="row">\
              <div class="col-xs-12">\
                <p data-bind="text: message">\
                \
                </p>\
                <br>\
                <label>\
                  Type DELETE in the following box to confirm this is what you want:\
                  <input data-bind="textInput: delete_confirmation_text">\
                </label>\
              </div>\
            </div>\
          </div>\
        </div>\
\
        <div class="modal-footer">\
          <div class="form-buttons buttons-panel">\
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\
            <button class="btn btn-danger"\
                    data-bind="enable: is_delete_enrollment_modal_showing.is_delete_text_valid, click: do_delete_enrollment_record">PERMANENT DELETE</button>\
          </div>\
        </div>\
      </div>\
    </div>\
  </div>'});
var AddToCensusViewModel=function AddToCensusViewModel(case_id){var self=this;self.case_id=ko.observable(case_id);self.matched_employees=ko.observableArray([]);self.matched_employees.error=ko.observable("");self.selected_employee=ko.observable(null);self.matched_employee=ko.computed(function(){if(self.matched_employees().length==0){return null;}
return self.matched_employees()[0];});self.loading_message=ko.observable("Loading...");self.ssn=ko.observable(null);self.ssn.error=ko.observable("");self.PANEL_FORM="find_employee";self.PANEL_LOADING="loading";self.PANEL_NOMATCH="no_matches";self.PANEL_ONEMATCH="one_match";self.PANEL_MANYMATCHES="matches";self.current_panel=ko.observable(self.PANEL_FORM);self.show_modal=function(){self.current_panel(self.PANEL_FORM);self.ssn("");self.ssn.error("");self.selected_employee(null);};self.is_match_form_showing=ko.computed(function(){return(self.current_panel()==self.PANEL_NOMATCH||self.current_panel()==self.PANEL_MANYMATCHES||self.current_panel()==self.PANEL_ONEMATCH);});self.add_form_showing=ko.computed(function(){return self.current_panel()==self.PANEL_FORM;});self.is_loading=ko.computed(function(){return self.current_panel()==self.PANEL_LOADING;});self.no_matches_found=ko.computed(function(){return self.current_panel()==self.PANEL_NOMATCH;});self.multiple_matches_found=ko.computed(function(){return self.current_panel()==self.PANEL_MANYMATCHES;});self.one_match_found=ko.computed(function(){return self.current_panel()==self.PANEL_ONEMATCH;});self.one_or_more_matches_found=ko.computed(function(){return self.multiple_matches_found()||self.one_match_found();});self.find_matches=function(){self.ssn.error("");if(!self.is_valid_ssn()){self.ssn.error("A valid SSN is required");return;}
self.loading_message("Checking census for matches...");self.current_panel(self.PANEL_LOADING);$.get("/cases/"+self.case_id()+"/census_records",{filter_ssn:self.ssn()}).success(function(resp){if(resp.data.length>0){self.matched_employees(_.map(resp.data,function(e){return new EmployeeMatchViewModel(e)}));if(resp.data.length==1){self.current_panel(self.PANEL_ONEMATCH);}else{self.current_panel(self.PANEL_MANYMATCHES);}}else{self.matched_employees([]);self.current_panel(self.PANEL_NOMATCH);}}).error(function(resp){console.error(resp);});};self.is_valid_ssn=ko.computed(function(){var ssn_regex=/^\d\d\d-\d\d-\d\d\d\d$/;return ssn_regex.test(self.ssn());});self.add_to_census=function(){self.enroll_without_record();};self.enroll_from_match=function(){if(self.matched_employees().length==1){self.enroll_from_record(self.matched_employees()[0].id);}else{var id=self.selected_employee();if(id===null){self.matched_employees.error("Please select the census record to enroll.");return;}
self.enroll_from_record(id);}};self.enroll_from_record=function(id){self._submit_enrollment({record_id:id});};self.enroll_without_record=function(){self._submit_enrollment({});};self._submit_enrollment=function(options){var data={case_id:self.case_id(),enrollment_city:window.case_settings.get_enrollment_city_override(),enrollment_state:window.case_settings.get_enrollment_state_override()};if(options.record_id){data.record_id=options.record_id;}else{data.ssn=self.ssn();}
self.loading_message("Loading Enrollment Application...");self.current_panel(self.PANEL_LOADING);submit_to_url(urls.get_in_person_enrollment_url(),data);}};var CaseEnrollmentPeriod=function CaseEnrollmentPeriod(period){var self=this;var defaults={period_type:"annual_period",case_id:null,start_date:"",end_date:""};var settings=$.extend({},defaults,period);self.period_type=settings.period_type;self.is_annual=ko.computed(function(){return self.period_type=="annual_period"});self.is_open=ko.computed(function(){return!self.is_annual()});self.case_id=settings.case_id;self.error=ko.observable("");function strip_year(d){var month_day_search=/\d{4}-(\d{2}-\d{2})/;var matches=d.match(month_day_search);if(matches&&matches.length>1){return matches[1];}
return"";}
if(self.is_open()){self.start_date=ko.observable(normalize_date(settings.start_date));self.end_date=ko.observable(normalize_date(settings.end_date));}else{self.start_date=ko.observable(strip_year(settings.start_date));self.end_date=ko.observable(strip_year(settings.end_date));}
self.is_valid_month_day=function(val){return self.get_month_day(val).isValid();};self.get_month_day=function(val){return parse_month_date_input(val);};self.is_valid_date=function(val){return is_valid_date(val);};self.is_valid=ko.computed(function(){if(self.is_open()){if(self.end_date()){return(self.is_valid_date(self.start_date())&&self.is_valid_date(self.end_date())&&parse_date(self.end_date())>=parse_date(self.start_date()));}else{return self.is_valid_date(self.start_date());}}else{return(self.is_valid_month_day(self.start_date())&&self.is_valid_month_day(self.end_date()));}});self.serialize=function(){return{period_type:self.period_type,case_id:self.case_id,start_date:self.start_date(),end_date:self.end_date()}};};var CaseEnrollmentsViewModel=function(case_data){var self=this;self.add_to_census_modal=new AddToCensusViewModel(case_data.id);ko.applyBindings(self.add_to_census_modal,$("#add-to-census-modal")[0]);$("#add-to-census-btn").on('click',function(){$("#add-to-census-modal").modal("show");self.add_to_census_modal.show_modal();});$("#enrollment").on('click',"button.enroll-employee",function(){var record_id=$(this).attr('data-id');submit_to_url(urls.get_in_person_enrollment_url(),{record_id:record_id,enrollment_city:window.case_settings.get_enrollment_city_override(),enrollment_state:window.case_settings.get_enrollment_state_override()});});};var CaseReportsViewModel=function(params){var self=this;self.is_loading=ko.observable(true);self.error_message=ko.observable("");self.company_name=ko.observable({});self.group_number=ko.observable({});self.any_enrollments=ko.observable(false);self.summary_data=ko.observable({});self.product_data=ko.observable([]);self.enrollment_dates=ko.observable({});self.enrollment_methods=ko.observableArray([]);self.case_agents=ko.observableArray([]);self.load_reports=function(){self.is_loading(true);var url=urls.get_case_api_enrollment_report_url(params.settings_viewmodel.case_id);$.get(url).success(function(resp){self.company_name(resp.data.company_name);self.group_number(resp.data.group_number);self.enrollment_dates(resp.data.enrollment_period);self.enrollment_methods(resp.data.enrollment_methods);self.summary_data(resp.data.summary);self.any_enrollments(self.summary_data().processed_enrollments>0);var pdata=[];$.each(resp.data.product_report,function(){var data=this;pdata.push({name:data.product_name,num_taken:data.enrolled_count,percent_taken:(data.enrolled_count/resp.data.summary.total_census*100).toFixed(2),annualized_premium:data.total_annualized_premium});});self.product_data(pdata);var case_agents=[];if(resp.data.case_owner){case_agents.push(resp.data.case_owner.first+" "+resp.data.case_owner.last);}
_.each(resp.data.case_agents,function(agent){case_agents.push(agent.first+" "+agent.last);});self.case_agents(case_agents);self.is_loading(false);}).error(function(e){console.error(e);self.error_message("There was a problem loading the enrollment report data.");self.is_loading(false);});};self.enter_print_preview=function(){$(".header ul").hide();$(".container.page").hide();$("#print-wrap").html($("#reports .report-wrap").clone()).prepend("<div><a class='btn btn-default hidden-print' href='#reports'>"+"<span class='glyphicon glyphicon-chevron-left'></span> Back to report</a></div>").show();};self.exit_print_preview=function(){$(".header ul").show();$(".container.page").show();$("#print-wrap").hide();};self.load_enrollments=function(){case_management.refresh_enrollments_table(params.settings_viewmodel.case_id,urls.get_case_api_enrollment_records_url(params.settings_viewmodel.case_id),"#enrollment-records-table","#enrollment-table-loading",{},function(table){});};self.format_enrollment_methods=ko.computed(function(){var display_map={in_person:'In Person',self_enroll_email:'Self-Enroll by Email'};return _.map(self.enrollment_methods(),function(m){return display_map[m]}).join(",");});self.format_enrollment_dates=ko.computed(function(){var start=self.enrollment_dates().start;var end=self.enrollment_dates().end;if(is_valid_date(end)){return normalize_date(start)+" - "+normalize_date(end);}else{return"Open enrollment starting "+normalize_date(start);}});self.is_census_report=ko.computed(function(){return self.summary_data().is_census_report;});self.only_one_product=ko.computed(function(){return self.summary_data().only_one_product;});self.product_name=ko.computed(function(){return(self.only_one_product())?self.summary_data().product_names[0]:"";});self.format_total_percent_processed=ko.computed(function(){var percent=self.summary_data().processed_enrollments/self.summary_data().total_census*100;return percent.toFixed(2)+"%";});self.format_total_num_census=ko.pureComputed(function(){return self.summary_data().total_census;});self.format_total_num_processed=ko.computed(function(){return self.summary_data().processed_enrollments;});self.format_total_percent_taken=ko.computed(function(){var percent=self.summary_data().taken_enrollments/self.summary_data().total_census*100;return percent.toFixed(2)+"%";});self.format_total_num_taken=ko.computed(function(){return self.summary_data().taken_enrollments;});self.format_total_num_declined=ko.computed(function(){return self.summary_data().declined_enrollments;});self.format_total_percent_declined=ko.computed(function(){var percent=self.summary_data().declined_enrollments/self.summary_data().total_census*100;return percent.toFixed(2)+"%";});self.format_total_annualized_premium=ko.computed(function(){return'$'+self.summary_data().total_annualized_premium;});self.format_case_agents=ko.computed(function(){return self.case_agents().join(", ");});params.settings_viewmodel.report_viewmodel(self);};function CaseRiderConfiguration(case_settings,product,rider,initial_product_settings){var self=this;self.case_settings=case_settings;self.product=product;self.rider=rider;self.name=rider.name;self.code=rider.code;self.is_rider_initially_selected=function(initial_product_settings){if(!initial_product_settings||!initial_product_settings.riders){return false;}
return _.any(initial_product_settings.riders,function(r){return(self.product.id===r.product_id&&self.rider.code===r.rider_code&&r.is_selected)});};self.is_selected=ko.observable(self.is_rider_initially_selected(initial_product_settings));self.can_enable_rider=ko.pureComputed(function(){var is_enabled=true;_.each(case_settings.enabled_case_riders_for_product(self.product),function(r){if(_.includes(rider.disallowed_rider_combinations,r.code)){is_enabled=false;return false;}});return is_enabled;});}
CaseRiderConfiguration.prototype.serialize=function(){return{product_id:this.product.id,rider_code:this.rider.code,is_selected:this.is_selected()}};function add_case_error(errors,field_name,message){if(field_name in errors){errors[field_name].push(message);}else{errors[field_name]=[message];}}
function get_form_data(form){var data=$(form).serializeArray();var data_object={};$.each(data,function(){var key=this.name;var val=this.value;if(key in data_object&&data_object.length===undefined){data_object[key]=[data_object[key]];data_object[key].push(val);}else if(key in data_object){data_object[key].push(val);}else{data_object[key]=val;}});return data_object;}
function show_loading_panel(modal){$(".form-panel",modal).hide("slide");$(".loading-panel",modal).show("slide");$(".processing-buttons",modal).show("fade");$(".form-buttons",modal).hide("fade");}
function show_error_panel(modal){$(".loading-panel",modal).hide("slide");$(".error-panel",modal).show("slide");$(".error-buttons",modal).show("fade");$(".processing-buttons",modal).hide("fade");}
function show_success_panel(modal){$(".loading-panel",modal).hide("slide");$(".success-panel",modal).show("slide");$(".success-buttons",modal).show("fade");$(".processing-buttons",modal).hide("fade");}
function show_form_panel(modal){$(".modal-panel",modal).hide("slide");$(".buttons-panel",modal).hide("slide");$(".form-panel",modal).show("slide");$(".form-buttons",modal).show("slide");}
function reset_upload_modal(){$(".modal-panel").hide();$(".buttons-panel").hide();$(".form-panel").show();$(".form-buttons").show();}
function handle_upload_success(resp,modal){census_errors_panel.error_records(resp.data.errors);census_errors_panel.num_data_records(resp.data.records.length);show_success_panel($(modal));window.case_settings.census_data(resp.data.records);case_management.refresh_census_table(window.case_id,urls.get_case_api_census_records_url(window.case_id),"#census-records-table","#census-table-loading");}
function handle_upload_error(xhr,modal){if(xhr.status>=400&&xhr.status<500){show_error_panel($(modal));var data=$.parseJSON(xhr.responseText).data;census_errors_panel.error_records(data.errors);$('.upload-error-table td.error').tooltip({placement:"auto left"});}else{alert("Sorry, there was a problem communicating with the server.");reset_upload_modal($(modal));}}
function observe_settings_events(settings){$("#upload-btn").on("click",reset_upload_modal);$(".back-btn").on("click",function(){show_form_panel($(this).parents(".modal"));});$('#reset-page-text').click(function(){$('#page_text').html(settings.default_page_text).focus();});$('#self_enrollment_type').change(function(){if($('#self_enrollment_type option:selected').val()=='case-generic'){$('.self-enroll-email').hide();$('.self-enroll-email-off').show();}else{$('.self-enroll-email').show();$('.self-enroll-email-off').hide();}}).change();$('#edit-self-enrollment-form').on('submit',function(){window.case_settings.save_settings();return false;});}
function observe_census_record_form_submit(){$("#census-record-form").on("submit",function(){var form=this;var file_select=$(this).find("input[type=file]").get(0);var files=file_select.files;var form_data=new FormData();if(files.length!==1){alert("Please select a file");return false;}
form_data.append('csv-file',files[0],files[0].name);form_data.append('upload_type',$("input[name=upload_type]:checked").val());send_file_data("POST",urls.get_case_api_census_records_url(window.case_id),form_data,function(data){handle_upload_success(data,form);},function(err){handle_upload_error(err,form);},false);show_loading_panel($(this));return false;});}
function handle_enrollment_upload_success(data,modal){window.enrollment_api_panel.num_records(data.data.num_processed);show_success_panel($(modal));}
function handle_enrollment_upload_error(err,modal){if(err.status>=400&&err.status<500){var data=$.parseJSON(err.responseText).data;window.enrollment_api_panel.error_records(data.errors);show_error_panel($(modal));}else{alert("Sorry, there was a problem communicating with the server.");reset_upload_modal($(modal));}}
function observe_enrollment_upload_form_submit(){$("#enrollment-csv-form").on("submit",function(){var form=this;var file_select=$(this).find("input[type=file]").get(0);var files=file_select.files;var form_data=new FormData();if(files.length!==1){alert("Please select a file");return false;}
form_data.append('api-upload-file',files[0],files[0].name);file_extension=files[0].name.split(".").slice(-1)[0];if(window.case_settings){form_data.append('case_token',window.case_settings.case_token);}
form_data.append('auth_token',window.enrollment_api_panel.user_token);form_data.append('email_errors',false);form_data.append('upload_source','api');form_data.append('format',file_extension);send_file_data("POST",urls.get_submit_enrollment_records_url(),form_data,function success(data){handle_enrollment_upload_success(data,form);},function error(err){handle_enrollment_upload_error(err,form);},false);show_loading_panel($(this));return false;});}
function init_settings_fields(){$('#csv-file-input').ace_file_input({no_file:'No File ...',btn_choose:'Choose File',btn_change:'Change File',droppable:false,onchange:null,thumbnail:false,whitelist:'csv'});$('#csv-file-input-enrollment').ace_file_input({no_file:'No File ...',btn_choose:'Choose File',btn_change:'Change File',droppable:false,onchange:null,thumbnail:false,whitelist:'csv'});$(".input-mask-date").mask("99/99/9999");$(".input-mask-month-day").mask("99/99");$('[data-rel=tooltip]').tooltip();$('#partner-agents').bootstrapDualListbox({infoTextFiltered:'<span class="label label-purple label-lg">Filtered</span>',showFilterInputs:true,moveOnSelect:false,nonSelectedListLabel:'Available Agents:',selectedListLabel:'Case Visible to Agents:'});}
function init_enrollment_import_fields(){$('#csv-file-input-enrollment').ace_file_input({no_file:'No File ...',btn_choose:'Choose File',btn_change:'Change File',droppable:false,onchange:null,thumbnail:false,whitelist:'csv'});}
function apply_default_values(){$.each(['#email_sender_name','#email_sender_email','#email_message','#page_title','#page_text'],function(index,value){if($(value).prop('tagName')=='DIV'){if($(value).html()==''){$(value).html($(value).attr('default'));$(value).trigger('change');}}else{if($(value).val()==''){$(value).val($(value).attr('default'));$(value).trigger('change');}}});}
function handle_url_hashs(){if(window.location.hash=='#success'){window.location.href=window.location.href.replace(/#.*$/,'#');$('#save-success').show();}
if(window.location.hash==""){window.location.hash="setup";}}
var CaseViewModel=function CaseViewModel(case_data,product_choices,can_edit_case,settings){var self=this;self.case_id=case_data.id;self.case_token=case_data.case_token;self.can_edit_case=can_edit_case;self.report_data=ko.observable(null);self.report_viewmodel=ko.observable(null);self.report_viewmodel.subscribe(function(val){if(val&&window.location.hash=="#reports"){val.load_reports();val.load_enrollments();}});self.company_name=ko.observable(case_data.company_name||"").extend({rateLimit:1000});self.group_number=ko.observable(case_data.group_number||"");self.product_choices=ko.observableArray(product_choices);var matched_selected_products=_.chain(self.product_choices()).filter(function(p){return _.includes(_.map(case_data.products,"id"),p.id);}).value();matched_selected_products=_.sortBy(matched_selected_products,function(product){return product.ordinal;});self.products=ko.observableArray(matched_selected_products);self.sort_selected_products=ko.observableArray([]);self.products.subscribe(function(){self.is_data_dirty(true);self.update_product_ordinals();});self.has_product_sort_selections=ko.computed(function(){return!!self.sort_selected_products()&&self.sort_selected_products().length>0;});self.unselected_products=ko.computed(function(){return _.sortBy(_.difference(self.product_choices(),self.products()),function(product){return product.ordinal;});});self.selected_product=ko.observable(null);self.has_selected_product=ko.computed(function(){return!!self.selected_product();});self.add_selected_product=function(){var product=self.selected_product();if(!product){return;}
self.products.push(product);};self.remove_selected_products=function(){var products_to_remove=self.sort_selected_products();var products=self.products();if(!products_to_remove||products_to_remove.length===0){return;}
_.forEach(products_to_remove,function(product){var index=products.indexOf(product);if(index!==-1){products.splice(index,1);}});self.products(products);self.update_product_ordinals();};self.emailSettings={sender_name:ko.observable(case_data.self_enrollment_setup.email_sender_name),sender_email:ko.observable(case_data.self_enrollment_setup.email_sender_email),subject:ko.observable(case_data.self_enrollment_setup.email_subject||settings.default_email_subject),greeting_type:ko.observable(case_data.self_enrollment_setup.email_greeting_type),greeting_salutation:ko.observable(case_data.self_enrollment_setup.email_greeting_salutation),message:ko.observable(case_data.self_enrollment_setup.email_message||settings.default_email_message)};self.resetEmail=function(){self.emailSettings.message(settings.default_email_message);self.emailSettings.subject(settings.default_email_subject);};self.landing={page_title:ko.observable(case_data.self_enrollment_setup.page_title||$("#page_title").html()),page_text:ko.observable(case_data.self_enrollment_setup.page_text||$("#page_text").html())};self.update_product_ordinals=function(){for(var idx=0;idx<self.products().length;idx++){var product=self.products()[idx];product.ordinal=idx;}};self.move_products_up=function(){var productsToSort=self.sort_selected_products();if(!productsToSort||productsToSort.length===0||productsToSort.length===self.products().length){return;}
var selectedProducts=self.products();var startPosition=selectedProducts.indexOf(_.first(productsToSort));if(startPosition===0){return;}
_.forEach(productsToSort,function(product){var position=selectedProducts.indexOf(product);if(position===0||position===-1){return;}
selectedProducts.splice(position,1);selectedProducts.splice(position-1,0,product);self.products(selectedProducts);});self.update_product_ordinals();};self.move_products_down=function(){var productsToSort=self.sort_selected_products();if(!productsToSort||productsToSort.length===0||productsToSort.length===self.products().length){return;}
var selectedProducts=self.products();var endPosition=selectedProducts.indexOf(_.last(productsToSort));if(endPosition===selectedProducts.length-1){return;}
_.chain(productsToSort).reverse().forEach(function(product){var position=selectedProducts.indexOf(product);if(position===-1){return;}
selectedProducts.splice(position,1);selectedProducts.splice(position+1,0,product);self.products(selectedProducts);}).value();self.update_product_ordinals();};self.enrollment_period_type=ko.observable(case_data.enrollment_period_type);self.enrollment_periods=ko.observableArray($.map(case_data.enrollment_periods,function(p){return new CaseEnrollmentPeriod(p);}));self.situs_city=ko.observable(case_data.situs_city);self.state_choices=settings.all_states;self.situs_state=ko.observable(get_state_from_statecode(case_data.situs_state));function get_state_from_statecode(statecode){return _.find(self.state_choices,function(c){return c.statecode==statecode;});}
self.enrollment_city_override=ko.observable(get_storage_or_default('enrollment_city_override.'+self.case_id,self.situs_city()));self.enrollment_state_override=ko.observable(get_default_state_override());self.get_enrollment_city_override=ko.pureComputed(function(){if(!self.enrollment_city_override()){return"";}
return self.enrollment_city_override();});self.get_enrollment_state_override=ko.pureComputed(function(){if(!self.enrollment_state_override()){return"";}
return self.enrollment_state_override().statecode;});set_storage_from_observable('enrollment_city_override.'+self.case_id,self.enrollment_city_override);set_storage_from_observable('enrollment_state_override.'+self.case_id,self.get_enrollment_state_override);function get_default_state_override(){var case_default_statecode=(self.situs_state())?self.situs_state().statecode:"";var statecode=get_storage_or_default('enrollment_state_override.'+self.case_id,case_default_statecode);if(!statecode||!get_state_from_statecode(statecode)){return get_state_from_statecode(case_default_statecode);}else{return get_state_from_statecode(statecode);}}
function get_storage_or_default(key,default_val){if(window.sessionStorage.getItem(key)){return window.sessionStorage.getItem(key);}
return default_val;}
function set_storage_from_observable(key,observable){observable.subscribe(function(new_val){window.sessionStorage.setItem(key,new_val);});}
self.situs_city.subscribe(function(new_val){self.enrollment_city_override(new_val);});self.situs_state.subscribe(function(new_val){self.enrollment_state_override(new_val);});self.selected_statecode=ko.pureComputed(function(){return(self.situs_state())?self.situs_state().statecode:null;});self.is_active=ko.observable(case_data.active);self.owner_agent_id=ko.observable(case_data.agent_id||"");var should_restrict_downloads=false;if(case_data.can_partners_download_enrollments===false){should_restrict_downloads=true;}
self.restrict_download_enrollments_to_owner=ko.observable(should_restrict_downloads);self.can_partners_download_enrollments=ko.pureComputed(function(){return!self.restrict_download_enrollments_to_owner();});self.can_download_enrollments=ko.pureComputed(function(){return self.has_census_data();});self.partner_agents=ko.observable((case_data.partner_agents)?_.map(_.pluck(case_data.partner_agents,"id"),function(id){return id+"";}):[]);self.state_product_limiter=new ProductStatesLimiterViewModel(settings.product_state_mapping,self.situs_state,self.state_choices,self.products,self.product_choices);self.on_products_select_rendered=function(option,item){if(!item){return;}
var is_valid=ko.computed(function(){return self.state_product_limiter.is_valid_product_for_state(item,self.situs_state());});ko.applyBindingAccessorsToNode(option,{enable:is_valid},item);};self.is_editing_products=ko.observable(false);if(case_data.products.length===0){self.is_editing_products(true);}
self.start_editing_products=function(){self.is_editing_products(true);};self.stop_editing_products=function(){self.is_editing_products(false);};self.state_product_override_limiter=new StatesLimiterViewModel(settings.product_state_mapping,self.enrollment_state_override,self.state_choices,self.products);self.on_state_selected=function(){self.selected_product(null);};self.state_product_limiter.selected_state.subscribe(self.on_state_selected);self.state_product_override_limiter.selected_state.subscribe(self.on_state_selected);self.is_open_enrollment=ko.computed(function(){return self.enrollment_period_type()==="open";});self.is_annual_enrollment=ko.computed(function(){return self.enrollment_period_type()==="annual";});self.get_open_enrollment_period=ko.computed(function(){return _.find(self.enrollment_periods(),function(p){return p.is_open();});});self.today_between=ko.computed(function(){if(!self.get_open_enrollment_period()){return false;}
var start=self.get_open_enrollment_period().start_date();var end=self.get_open_enrollment_period().end_date();return today_between(start,end);});self.annual_enrollment_periods=ko.computed(function(){return _.filter(self.enrollment_periods(),function(p){return p.period_type==="annual_period";});});self.annual_today_between=ko.computed(function(){if(self.annual_enrollment_periods().length>=4&&self.annual_enrollment_periods()[0].start_date()!==""){return self.annual_enrollment_periods().reduce(function(a,period){var start_date=moment(period.start_date(),"MM/DD");var end_date=moment(period.end_date(),"MM/DD");return today_between(start_date,end_date)||a;},false);}
return true;});self.payment_mode_choices=settings.payment_modes;self.payment_mode=ko.observable(_.find(self.payment_mode_choices,function(c){return c.mode==case_data.payment_mode;}));self.selected_payment_mode=ko.pureComputed(function(){return(self.payment_mode())?parseInt(self.payment_mode().mode):null;});self.include_bank_draft_form=ko.observable(case_data.include_bank_draft_form);self.can_include_bank_draft_form=ko.pureComputed(function(){return self.selected_payment_mode()===12;});self.can_include_bank_draft_form.subscribe(function(can_include){if(!can_include){self.include_bank_draft_form(false);}});self.should_use_call_center_workflow=ko.observable(case_data.should_use_call_center_workflow);self.occupation_classes=ko.observableArray(case_data.occupation_class_settings);self.new_occupation_class=ko.observable('');self.addOccupationClass=function(){self.occupation_classes.push({label:self.new_occupation_class()});self.new_occupation_class('');};self.removeOccupationClass=function(occupation_class){self.occupation_classes.remove(occupation_class);};self.is_new_occupation_class_valid=ko.computed(function(){var index=_.findIndex(self.occupation_classes(),function(item){return item.label.toLowerCase()===self.new_occupation_class().toLowerCase();});return(self.new_occupation_class()!==''&&index===-1);});self.available_occupation_mappings=[{value:1,label:'1'},{value:2,label:'2'},{value:3,label:'3'}];self.eligible_product_codes=['ACC','HI'];self.is_product_occupation_class_eligible=function(product){return self.eligible_product_codes.indexOf(product.base_product_type)!=-1;};self.is_case_occupation_class_eligible=function(){return _.any(_.map(case_settings.products(),function(p){return self.is_product_occupation_class_eligible(p);}));return _.intersection(_.map(case_settings.products(),function(p){return p.base_product_type;}),self.eligible_product_codes).length;};self.occ_mapping_cache={};self.update_occ_vm=function(product_id,label,value){var is_update=false;if(product_id in self.occ_mapping_cache){if(!(label in self.occ_mapping_cache[product_id])){is_update=true;}}else{self.occ_mapping_cache[product_id]={};self.occ_mapping_cache[product_id][label]={};is_update=true;}
if(is_update){self.occ_mapping_cache[product_id][label]={product_id:product_id,label:label,value:ko.observable(value)};}};function is_product_active(product){for(var i in self.products()){if(i=='first'){continue;}
if(self.products()[i].id==product.id){return true;}}
return false;}
function is_occupation_class_active(label){for(var i in self.occupation_classes()){if(i=='first'){continue;}
if(self.occupation_classes()[i].label==label){return true;}}
return false;}
self.deserialize_occ_mapping=function(){self.occ_mapping_cache={};if(!case_data.product_settings){return;}
var data=case_data.product_settings.classification_mappings;if(!data){return;}
for(var i=0;i<case_data.products.length;i++){for(var j=0;j<self.occupation_classes().length;j++){var product=case_data.products[i];var occ_label=self.occupation_classes()[j].label;var value=null;if(data[product.id]!=undefined&&data[product.id][occ_label]!=undefined){value=data[product.id][occ_label];}
self.update_occ_vm(product.id,occ_label,value);}}};self.deserialize_occ_mapping();self.serialize_occ_mapping=function(){var data={};for(var product_id in self.occ_mapping_cache){if(!is_product_active({id:product_id})){continue;}
if(!(product_id in data)){data[product_id]={};}
for(var label in self.occ_mapping_cache[product_id]){if(!is_occupation_class_active(label)){continue;}
if(!(label in data)){data[product_id][label]=self.occ_mapping_cache[product_id][label].value();}}}
return data;};self.occupation_classes_for_product=function(product){var r=[];if(!(product.id in self.occ_mapping_cache)){for(var i in self.occupation_classes()){if(i=='first'){continue;}
self.update_occ_vm(product.id,self.occupation_classes()[i].label,null);}}
for(var i in self.occupation_classes()){if(i=='first'){continue;}
if(!(self.occupation_classes()[i].label in self.occ_mapping_cache[product.id])){self.update_occ_vm(product.id,self.occupation_classes()[i].label,null);}}
for(var label in self.occ_mapping_cache[product.id]){if(is_product_active(product)&&is_occupation_class_active(label)){r.push(self.occ_mapping_cache[product.id][label]);}}
return r;};self._case_rider_configurations_by_product={};self.case_riders=ko.computed(function(){var _case_rider_configs=[];_.each(self.products(),function(product){if(!_.has(self._case_rider_configurations_by_product,product.id)){self._case_rider_configurations_by_product[product.id]=_.map(product.riders,function(r){return new CaseRiderConfiguration(self,product,r,case_data.product_settings);});}
_case_rider_configs=_case_rider_configs.concat(self._case_rider_configurations_by_product[product.id]);});return _case_rider_configs;});self.case_riders_for_product=function(product){return _.filter(self.case_riders(),function(rider){return rider.product===product;});};self.enabled_case_riders=ko.computed(function(){return _.filter(self.case_riders(),function(rider){return rider.is_selected()===true;});});self.enabled_case_riders_for_product=function(product){return _.filter(self.enabled_case_riders(),function(cr){return cr.product===product;});};if(!Array.prototype.first){Array.prototype.first=function(){if(this.length>0){return this[0];}else{return undefined;}};}
self.owner_agent=ko.computed(function(){return _.find(settings.active_agents,function(elem){return elem.id===parseInt(self.owner_agent_id(),10);});});self.partner_agent_list=ko.computed(function(){return settings.active_agents.filter(function(elem){return self.partner_agents().indexOf(String(elem.id))!==-1;});});self.case_agents=ko.computed(function(){var owner=self.owner_agent();if(owner&&_.pluck(self.partner_agent_list(),"id").indexOf(owner.id)===-1){var all_agents=self.partner_agent_list().concat(owner);all_agents.sort(function(a,b){if(a.last==b.last){return a.first.localeCompare(b.first);}
return a.last.localeCompare(b.last);});return all_agents;}else{return self.partner_agent_list();}});self.has_agent_splits=ko.observable(case_data.is_stp);self.selected_agent_splits=ko.observableArray(get_initial_splits());self.selected_agent=ko.observable();self.selected_agents=ko.observableArray(get_initial_split_agents());self.unused_agents=ko.computed(function(){var selected_ids=self.selected_agents();return self.case_agents().filter(function(i){return!~selected_ids.indexOf(i.id);});});self.show_product_subcount_modal=function(element_id){$('#'+element_id).modal('show');};self.add_agent_split=function(){var selected_agent=self.selected_agent();if(selected_agent){self.selected_agents.push(selected_agent.id);}};self.get_agent_name_from_id=function(agent_id){if(agent_id===null){return"Writing Agent";}
var cur_agent=settings.active_agents.filter(function(elem){return elem.id===agent_id;}).first();if(!cur_agent){return"";}
return cur_agent.first+" "+cur_agent.last;};self.get_agent_splits_for_product=function(product_id){return _.filter(self.selected_agent_splits(),function(split){return!!split.agent_id&&split.product_id===product_id;});};self.are_agent_splits_complete=function(product_id){if(!self.has_agent_splits()){return true;}
var splits=self.selected_agent_splits().filter(function(split){return!!split.agent_id&&split.product_id===product_id;});return _.reduce(splits,function(sum,n){return sum&&!!n.commission_subcount_code();},true);};self.get_agent_splits_completion_status=function(product_id){if(!self.has_agent_splits()){return"Complete";}
var splits=self.selected_agent_splits().filter(function(split){return!!split.agent_id&&split.product_id===product_id;});var success=_.reduce(splits,function(sum,n){return sum&&!!n.commission_subcount_code();},true);if(success){return"Complete";}else{return"Incomplete";}};self.is_data_dirty=ko.observable();self.agent_has_percentage=function(agent_id){var agent=_.find(self.case_agents(),function(item){return item.id===agent_id;});if(!agent){return false;}
return _.some(self.selected_agent_splits(),{agent_id:agent.id});};self.agents_with_percentage=ko.computed(function(){return _.filter(self.case_agents(),function(agent){return self.agent_has_percentage(agent.id);});});self.agents_with_percentage_ids=ko.computed(function(){return _.map(self.agents_with_percentage(),function(item){return item.id;});});function AgentSplit(agent_id,product_id,commission_subcount_code,split_percentage,is_added){this.agent_id=agent_id;this.product_id=product_id;this.commission_subcount_code=ko.observable(commission_subcount_code);this.split_percentage=ko.observable(split_percentage);this.is_added=ko.observable(!!is_added);this.valid=ko.computed(function(){if(this.agent_id===null){return true;}
return self.case_agents().filter(function(elem){return elem.id===this.agent_id;}.bind(this)).length>0;},this);this.product_name=(function(){var cur_product=self.products().filter(function(elem){return elem.id===product_id;}).first();return cur_product.name;})();this.toJson=function(){return{agent_id:this.agent_id,product_id:this.product_id,split_percentage:this.split_percentage(),commission_subcount_code:this.commission_subcount_code()};};this.commission_subcount_code.subscribe(function(){self.is_data_dirty(true);});this.split_percentage.subscribe(function(){self.is_data_dirty(true);});}
self.get_or_create_split=function(agent_id,product_id){var current_split=self.selected_agent_splits().filter(function(elem){return elem.agent_id===agent_id&&elem.product_id===product_id;}).first();if(current_split){return current_split;}else{var split=new AgentSplit(agent_id,product_id);self.selected_agent_splits.push(split);return split;}};0
self.has_products=ko.computed(function(){return!!self.products()&&self.products().length>0;});function get_initial_splits(){return case_data.agent_splits.filter(function(elem){return _.find(self.products(),function(product){return product.id===elem.product_id;})!==undefined;}).map(function(elem){return new AgentSplit(elem.agent_id,elem.product_id,elem.commission_subcount_code,elem.split_percentage);});}
function get_initial_split_agents(){var agentIds=_.chain(case_data.agent_splits).filter(function(split){return!!split.split_percentage&&_.find(self.case_agents(),{id:split.agent_id});}).map(function(split){return split.agent_id;}).uniq().value();if(agentIds.indexOf(null)===-1){agentIds.splice(0,0,null);}
return agentIds;}
self.is_self_enrollment=ko.observable(case_data.is_self_enrollment);self.is_self_enrollment.subscribe(function(){if(!self.is_self_enrollment()){bootbox.confirm('<h3>Any self-enrollment links you have sent out <u class="text-danger">will no longer work</u> if you turn off self-enrollment.</h3><p>Click <em>OK</em> to turn it off, or <em>Cancel</em> to leave it on.</p>',function(result){self.is_self_enrollment(!result);});}});self.self_enrollment_type=ko.observable(case_data.self_enrollment_type);self.enrolling_agent_id=ko.observable(case_data.self_enrollment_setup.enrolling_agent_id);if(!self.get_open_enrollment_period()){self.enrollment_periods.push(new CaseEnrollmentPeriod({case_id:case_data.id,period_type:"open_with_start"}));}
if(self.annual_enrollment_periods().length<4){var num_missing=4-self.annual_enrollment_periods().length;_.each(_.range(num_missing),function(){var p=new CaseEnrollmentPeriod({case_id:case_data.id,period_type:"annual_period"});self.enrollment_periods.push(p);});}
function get_annual_periods_after_period(period){var periods=self.annual_enrollment_periods();return _.filter(periods,function(p){return periods.indexOf(p)>periods.indexOf(period);});}
function compute_next_quarter_start(m){return m.add(3,"months");}
function compute_period_end(start,months){return start.add(months,"months").subtract(1,"day");}
function compute_quarterly_dates(period,val){if(val&&period.is_valid_month_day(val)&&period.end_date()===""){var computed_date=compute_period_end(period.get_month_day(val),2);period.end_date(computed_date.format("MM/DD"));var remaining_periods=get_annual_periods_after_period(period);var previous_period=period;$.each(remaining_periods,function(){var rp=this;if(!rp.is_valid()){var previous_start=previous_period.get_month_day(previous_period.start_date());var computed_start=compute_next_quarter_start(previous_start);rp.start_date(computed_start.format("MM/DD"));var computed_finish=compute_period_end(computed_start,1);rp.end_date(computed_finish.format("MM/DD"));}else{return false;}
previous_period=rp;});}}
var first_period=self.annual_enrollment_periods()[0];first_period.start_date.extend({notify:'always'});first_period.start_date.subscribe(function(val){compute_quarterly_dates(first_period,val);});_.each(self.annual_enrollment_periods(),function(period){_.each([period.start_date,period.end_date],function(date_observable){date_observable.subscribe(function(val){if(val===""){return;}
var val_date=parse_month_date_input(val);if(!val_date.isValid()){date_observable("");bootbox.dialog({title:"Invalid Date",message:"The value '"+val+"' is not a valid start or end date. Provide a month and date formatted as 'MM/DD'.",buttons:{main:{label:"OK"}}});}});});});self.census_data=ko.observable(true);self.has_census_data=ko.pureComputed(function(){return self.census_data();});self.flash_messages=new FlashMessages();if(self.can_edit_case){var fields=[self.company_name,self.group_number,self.products,self.enrollment_period_type,self.enrollment_periods,self.situs_city,self.situs_state,self.payment_mode,self.is_active,self.owner_agent_id,self.can_partners_download_enrollments,self.is_self_enrollment,self.selected_agent_splits,self.has_agent_splits];_.each(self.enrollment_periods(),function(p){fields.push(p.start_date);fields.push(p.end_date);});$.each(fields,function(){var field=this;field.subscribe(function(){self.is_data_dirty(true);});});$("#edit-self-enrollment-form").on("change","input, select, [contenteditable]",function(){if(self.is_self_enrollment()){self.is_data_dirty(true);}});}
self.email_batches=ko.observableArray([]);$.getJSON(urls.get_case_api_census_email_batches(case_data.id),function(data){self.email_batches(data.data);});self.batch_preview=function(batch){window.open(urls.get_case_api_census_email_batch_preview_url(case_data.id,batch.id),"batchView","menubar=no,location=no,resizable=no,width=650,height=600,scrollbars=yes,status=yes");};self.load_logs=function(batch){$("#log"+batch.id).html("Loading Logs...");$.get(urls.get_case_api_census_email_batch_logs_url(case_data.id,batch.id),function(data){$("#log"+batch.id).html(data);$("#log"+batch.id+" .dt-responsive").dataTable();$("#log"+batch.id+" .dt-responsive .status").each(function(){$(this).html(format_enrollment_status_html($(this).text()));});});};self.can_activate_case=ko.computed(function(){var is_valid=(self.enrollment_period_type()!==null&&self.enrollment_periods().length>0&&self.products().length>0&&$.trim(self.company_name())!==""&&$.trim(self.situs_city())!==""&&self.selected_statecode()!==null&&self.selected_payment_mode()!==null&&self.owner_agent_id()>0);return is_valid;});self.is_active.subscribe(function(value){if(value&&!self.can_activate_case()){bootbox.alert("Cannot activate case for enrollment until settings are complete.");self.is_active(false);}
self.toggle_enrollment_buttons();});self.toggle_enrollment_buttons=function(){if(self.is_active()){$("button.enroll-employee").prop('disabled',false);}else{$("button.enroll-employee").prop('disabled',true);}};self.toggle_enrollment_buttons();self.switch_label=ko.computed(function(){if(self.is_active()){return"Case is Active";}else{return"Case is Not Active";}});self.get_form_error=ko.pureComputed(function(){if(self.company_name.is_unique!==undefined&&self.company_name.is_unique()===false){return"The name '"+self.company_name()+"' is already used.";}
return"";});self.check_unique_name=function(current_value,callback){$.get(urls.get_cases_api_url(case_data.id),{by_name:current_value},function(result){var is_unique=(result.data.length===0||current_value===case_data.company_name);callback(is_unique);},"json");};self.validate_splits=function(){if(!self.has_agent_splits()){return true;}
if(!_.all(self.products(),self.has_proper_split_percentage_sum)){var invalid_product=_.find(self.products(),_.negate(self.has_proper_split_percentage_sum));var bad_sum=self.sum_split_percentages_for_product(invalid_product);bootbox.alert("Agent splits for "+invalid_product.name+" must total 100%; the current total percentage is "+bad_sum+"%");return false;}
return true;};self.has_proper_split_percentage_sum=function(product){var product_split_sum=self.sum_split_percentages_for_product(product);return product_split_sum===100;};self.sum_split_percentages_for_product=function(product){var splits=self.selected_agent_splits();var splits_for_product_with_percentage=splits.filter(function(elem){return elem.product_id===product.id&&parseInt(elem.split_percentage())>0;});return splits_for_product_with_percentage.reduce(function(acc,split){return acc+parseInt(split.split_percentage(),0);},0);};self.validate=function(){hide_all_errors();_.invoke(self.annual_enrollment_periods(),"error","");var errors={};var unique_name_error=self.get_form_error();if(unique_name_error!==""){add_case_error(errors,"company_name",unique_name_error);}
if($.trim(self.company_name())===""){add_case_error(errors,"company_name","Company name is required.");}
if(self.is_open_enrollment()&&!self.get_open_enrollment_period().is_valid()){var start=self.get_open_enrollment_period().start_date();var end=self.get_open_enrollment_period().end_date();if(end!==''){if(!is_valid_date(end)){add_case_error(errors,"open_enrollment_end_date","Enter valid End Date");}
else if(start===''){add_case_error(errors,"open_enrollment_start_date","Enter valid Start Date or both dates blank");}}
if(start!==''&&!is_valid_date(start)){add_case_error(errors,"open_enrollment_start_date","Enter valid Start Date");}
if(start!==''&&end!==''&&parse_date(start)>parse_date(end)){add_case_error(errors,"open_enrollment_start_date","Start Date comes after End Date");}}
if(self.is_annual_enrollment()&&self.any_annual_period_missing_a_component()){var missing_observables=_.filter(self.annual_enrollment_periods(),self.missing_annual_period_predicate);_.invoke(missing_observables,"error","Must fill in start and end date");return false;}
if(Object.keys(errors).length>0){show_all_errors(errors);return false;}else{return true;}};self.missing_annual_period_predicate=function(period){var start_date_present=period.start_date()!=="";var end_date_present=period.end_date()!=="";return(start_date_present?!end_date_present:end_date_present);};self.any_annual_period_missing_a_component=function(){return _.any(self.annual_enrollment_periods(),self.missing_annual_period_predicate);};self.serialize_case=function(){var partner_agents=_.map(self.partner_agents(),function(id_str){return parseInt(id_str);});return{company_name:self.company_name(),group_number:self.group_number(),active:self.is_active(),products:self.products(),partner_agents:partner_agents,enrollment_period_type:self.enrollment_period_type(),situs_city:self.situs_city(),situs_state:self.selected_statecode()?self.selected_statecode():"",payment_mode:self.selected_payment_mode()?self.selected_payment_mode():null,agent_id:self.owner_agent_id(),can_partners_download_enrollments:self.can_partners_download_enrollments(),is_self_enrollment:self.is_self_enrollment(),include_bank_draft_form:self.include_bank_draft_form(),should_use_call_center_workflow:self.should_use_call_center_workflow(),product_settings:self.serialize_product_settings(),is_stp:Boolean(self.has_agent_splits()),occupation_class_settings:self.occupation_classes()};};self.serialize_product_settings=function(){return{riders:self.serialize_riders(),classification_mappings:self.serialize_occ_mapping()};};self.serialize_riders=function(){return _.invoke(self.case_riders(),"serialize");};self.serialize_enrollment_periods=function(){if(self.is_annual_enrollment()){return _.invoke(_.filter(self.annual_enrollment_periods(),function(p){return p.is_valid();}),"serialize");}else{var period=self.get_open_enrollment_period();return[period.serialize()];}};function removeHarmfulEmailTags(message){var allowedTags=["br","span","strong","b","i","em","emphasis","img","a"]
var base=$("<div>"+message+"</div>")[0].childNodes;var mapped=Array.prototype.map.call(base,function(elem,a){if(elem.tagName){var tagName=elem.tagName.toLowerCase();if(allowedTags.indexOf(tagName)===-1){elem=$(elem).contents().unwrap()[0]}}
return elem;});var htmlstr=Array.prototype.reduce.call(base,function(html,node){return html+(node.outerHTML||node.nodeValue);},"");return htmlstr;}
self.serialize_self_enroll=function(){self.emailSettings.message(removeHarmfulEmailTags(self.emailSettings.message()));var settings=$.extend({},self.emailSettings,self.landing);for(var key in settings){if(settings.hasOwnProperty(key)){settings[key]=settings[key]();}}
return{self_enrollment_type:self.self_enrollment_type(),enrolling_agent_id:self.enrolling_agent_id(),email_sender_email:settings.sender_email,email_sender_name:settings.sender_name,email_subject:settings.subject,email_greeting_type:settings.greeting_type,email_greeting_salutation:settings.greeting_salutation,email_message:settings.message,page_title:settings.page_title,page_text:settings.page_text};};self.serialize_agent_splits=function(){var serialized_records=self.selected_agent_splits();serialized_records=_.filter(serialized_records,function(split){return _.some(self.case_agents(),{'id':split.agent_id})||split.agent_id===null;});return serialized_records.reduce(function(start,elem){if(elem.split_percentage()||elem.commission_subcount_code()){start.push(elem.toJson());}
return start;},[]);};self.loading_modal=ko.observable(null);self.save_settings=function(cb){self.flash_messages.clear();if(!self.can_save_case()){return;}
self.loading_modal({message:"Saving case..."});if(self.is_active()&&!self.can_activate_case()){self.is_active(false);self.flash_messages.flash_error("The case has been deactivated due to missing settings.");}
var case_request=send_json_data("PUT",urls.get_case_api_url(case_data.id),self.serialize_case());var periods_request=send_json_data("PUT",urls.get_case_api_enrollment_periods_url(case_data.id),self.serialize_enrollment_periods());var self_enroll_request;if(self.is_self_enrollment()){self_enroll_request=send_json_data("PUT",urls.get_case_api_self_enrollment_url(case_data.id),self.serialize_self_enroll());}
var agent_splits_request;if(self.has_agent_splits()){agent_splits_request=send_json_data("PUT",urls.get_case_api_agent_splits_url(case_data.id),self.serialize_agent_splits());}
$('#save-success').hide();$('#save-fail').hide();var on_success=function(case_xhr,periods_xhr,self_enroll_xhr){self.is_data_dirty(false);self.flash_messages.flash_success("Data Saved");$("#save-success").text("Data Saved");self.loading_modal(null);};var on_failure=function(failed_xhr){var errors=failed_xhr.responseJSON.errors||[];show_all_errors(errors);self.loading_modal(null);self.flash_messages.flash_error("Save failed. Please correct any errors below.");};var done;if(!self.is_self_enrollment()){done=$.when(case_request,periods_request);}else{done=$.when(case_request,periods_request,self_enroll_request);}
if(cb&&typeof(cb)==="function"){cb(done);self.loading_modal(null);return;}
done.then(on_success,on_failure);return false;};self.can_save_case=function(){if(!self.can_edit_case){self.flash_messages.flash_error("Only the case owner agent or home office can make changes to the case.");return false;}
if(!self.validate()){self.flash_messages.flash_error("Please correct any errors below before saving.");return false;}
if(!self.validate_splits()){self.flash_messages.flash_error("Please correct any errors below before saving.");return false;}
if(self.is_active()&&!self.can_activate_case()){self.is_active(false);self.flash_messages.flash_error("The case has been deactivated due to missing settings.");}
return true;};self.delete_case=function(){bootbox.confirm("Are you sure you want to the case '"+self.company_name()+"'? This is permanent and cannot be undone!",function(result){if(!result){return;}
self.remote_delete();});};self.remote_delete=function(){var request=send_json_data("DELETE",urls.get_case_api_url(case_data.id));$.when(request).then(function(){bootbox.alert("Case deleted successfully");self.is_data_dirty(false);window.location.href=urls.get_manage_cases_url(case_data.id);},function(){bootbox.alert("There was a problem removing this case.");});};self.is_permanent_delete_modal_showing=ko.observable(false);self.delete_confirmation_text=ko.observable("");self.is_delete_text_valid=ko.pureComputed(function(){return self.delete_confirmation_text()=="DELETE";});self.delete_case_with_enrollments=function(){self.delete_confirmation_text("");self.is_permanent_delete_modal_showing(false);self.is_permanent_delete_modal_showing(true);};if(self.can_edit_case){$(window).bind("beforeunload",function(){return self.has_unsaved_data()?"You have made changes without saving. Do you you wish to leave this page and lose all changes?":undefined;});}
self.show_upload_enrollment_form=function(){var el=$("#enrollment-csv-modal");reset_upload_modal(el);el.modal("show");};self.has_unsaved_data=ko.computed(function(){return self.is_data_dirty();});self.exit_print_mode=function(){if(self.report_viewmodel()){self.report_viewmodel().exit_print_preview();}};var setup_tab=$('#case-nav-tabs a[href="#setup"]');var enrollment_tab=$('#case-nav-tabs a[href="#enrollment"]');var history_tab=$('#case-nav-tabs a[href="#history"]');var reports_tab=$('#case-nav-tabs a[href="#reports"]');var api_tab=$('#case-nav-tabs a[href="#api"]');self.sammy_app=Sammy(function(){this.get("#setup",function(){self.exit_print_mode();setup_tab.tab('show');if(!self.can_edit_case){$("#setup").find("input, select, button").prop("disabled",true);}});this.before({except:{path:'#setup'}},function(){if(self.has_unsaved_data()){bootbox.dialog({title:"Unsaved Changes",message:"You have made changes without saving. Please save your changes or discard before leaving this page.",buttons:{main:{label:"Save",className:'btn-primary',callback:function(){self.save_settings();}},danger:{label:"Discard Changes",className:'btn-danger',callback:function(){self.is_data_dirty(false);window.location.reload();}},cancel:{label:"Cancel",className:'btn-default',callback:function(){}}}});this.redirect("#setup");return false;}});this.get("#enrollment",function(){self.exit_print_mode();enrollment_tab.tab('show');setTimeout(load_initial_census_data,0);function load_initial_census_data(){case_management.refresh_census_table(case_data.id,urls.get_case_api_census_records_url(case_data.id),"#census-records-table","#census-table-loading",handle_census_data_loaded_first_time,handle_no_census_data_loaded,handle_census_data_loaded);}
function handle_census_data_loaded_first_time(table,data){case_management.init_status_filter(table);case_management.init_alphabet_search(table);}
function handle_census_data_loaded(table,data){self.census_data(data);self.toggle_enrollment_buttons();}
function handle_no_census_data_loaded(){self.census_data(false);self.toggle_enrollment_buttons();}});this.get("#history",function(){self.exit_print_mode();history_tab.tab('show');setTimeout(function(){$.getJSON(urls.get_case_api_census_email_batches(case_data.id),function(data){self.email_batches(data.data);});},0);});this.get("#reports",function(){self.exit_print_mode();reports_tab.tab('show');if(self.report_viewmodel()){self.report_viewmodel().load_reports();self.report_viewmodel().load_enrollments();}});this.get("#api",function(){self.exit_print_mode();api_tab.tab('show');});this.get("#print",function(){if(self.report_viewmodel()){self.report_viewmodel().enter_print_preview();window.print();}else{window.location="#reports";}});}).run();};var EmployeeMatchViewModel=function(data){var self=this;self.id=data.id;self.first=data.employee_first||"(No First Name)";self.last=data.employee_last||"(No Last Name)";self.ssn=data.employee_ssn;self.birthdate=data.employee_birthdate;self.formatted_birthdate=function(){return moment(self.birthdate,"YYYY-MM-DD").format("MM/DD/YYYY");};self.is_selected=ko.observable(false);};var EnrollmentAPIPanel=function EnrollmentAPIPanel(user_token){var self=this;self.user_token=user_token;self.error_records=ko.observableArray();self.num_records=ko.observable();self.display_error=function(error_record){var msg="";if(error_record.record_num){msg+="Error in record "+error_record.record_num+": ";}
msg+=error_record.fields+': '+error_record.message;return msg;}};var SendEmailsModalViewModel=function SendEmailsModalViewModel(case_settings_vm,settings){var self=this;self.case_settings_vm=case_settings_vm;self.numbers={not_sent:ko.pureComputed(function(){return 0;return self.case_settings_vm.census_data().reduce(function addNotSent(acc,app){return!app.sent_email?acc+1:acc;},0);}),not_enrolled:ko.pureComputed(function(){return 0;return self.case_settings_vm.census_data().reduce(function addNotApplied(acc,app){return app.enrollment_status===null?acc+1:acc;},0);}),declined:ko.pureComputed(function(){return 0;return self.case_settings_vm.census_data().reduce(function addDeclined(acc,app){return app.enrollment_status==='declined'?acc+1:acc;},0);})};self.send_type=ko.observable("");self.emailSettings=self.case_settings_vm.emailSettings;self.num_emails_to_send=ko.pureComputed(function(){if(!self.send_type())return 0;return self.numbers[self.send_type().replace("-","_")]();});self.resetEmail=function(){self.emailSettings.message(settings.default_email_message);self.emailSettings.subject(settings.default_email_subject);};self.errors=ko.observableArray();self.send_emails=function(){self.errors([]);if(self.num_emails_to_send()==0){self.errors.push("There are no census records that match the selected criteria.");return false;}
if(!confirm("You are about to send "+self.num_emails_to_send()+" emails. Are you sure?")){return false;}
self.show_loading_panel();if(window.case_settings.can_edit_case){window.case_settings.save_settings(save_callback);}else{send_emails({});}
function save_callback(promise){promise.then(send_emails,handle_failed_save);}
function handle_failed_save(){bootbox.alert("Sorry, there was a problem saving the case data before sending the emails. No emails were sent.");}
function send_emails(data){$.ajax({url:urls.get_case_email_self_enrollment_batches_url(self.case_settings_vm.case_id)+'?send_type='+self.send_type(),method:'POST',dataType:'json',success:function(results){self.show_finished_panel();var sent_status_list=results.data;$('#email-target-links-modal #email-status-wrap').html(sent_status_list.join('<br>'));},error:function(xhr){self.show_error_panel();}});}};self.show_form_panel=function(){$('#email-target-links-modal .success-buttons').hide();$('#email-target-links-modal .form-buttons').show();$('#email-target-links-modal .modal-panel').hide();$('#email-target-links-modal .form-panel').show();};self.show_loading_panel=function(){$('#email-target-links-modal .form-panel').hide();$('#email-target-links-modal .form-buttons').hide();$('#email-target-links-modal .loading-panel').show();$('#email-target-links-modal .processing-buttons').show();};self.show_finished_panel=function(){$('#email-target-links-modal .loading-panel').hide();$('#email-target-links-modal .success-panel').show();$('#email-target-links-modal .processing-buttons').hide();$('#email-target-links-modal .success-buttons').show();$("#email-target-links-modal .success-buttons button").click(function(){self.show_form_panel();});};self.show_error_panel=function(){$('#email-target-links-modal .loading-panel').hide();$('#email-target-links-modal .processing-buttons').hide();$('#email-target-links-modal .form-buttons').hide();$('#email-target-links-modal .error-panel').show();$('#email-target-links-modal .error-buttons').show();$("#email-target-links-modal .error-buttons button:not(.back-btn)").click(function(){$('#email-target-links-modal .error-buttons').hide();$('#email-target-links-modal .processing-buttons').show();$('#email-target-links-modal .modal-panel').hide();$('#email-target-links-modal .form-panel').show();});};};var wizard_applicant=(function(){var _applicant_count=0;function Applicant(options){var self=this;var defaults={first:"",last:"",email:"",phone:"",birthdate:null,ssn:"",gender:null,height:null,weight:null,is_smoker:null,street_address:"",street_address2:"",city:"",state:"",zip:"",existing_coverages:[]};var applicant_data=$.extend({},defaults,options);self.type=applicant_data.type;self._id=_applicant_count++;self.first=ko.observable(applicant_data.first);self.last=ko.observable(applicant_data.last);self.email=ko.observable(applicant_data.email);self.phone=ko.observable(applicant_data.phone);self.birthdate=ko.observable(normalize_date_of_birth(applicant_data.birthdate));self.ssn=ko.observable(applicant_data.ssn);self.gender=ko.observable(applicant_data.gender);self.height=ko.observable(parseFloat(applicant_data.height)?parseFloat(applicant_data.height):null);self.weight=ko.observable(applicant_data.weight||null);self.is_smoker=ko.observable(applicant_data.is_smoker);self.height_error=ko.observable(null);self.weight_error=ko.observable(null);self.address1=ko.observable(applicant_data.street_address);self.address2=ko.observable(applicant_data.street_address2);self.city=ko.observable(applicant_data.city);self.state=ko.observable(applicant_data.state);self.zip=ko.observable(applicant_data.zip);self.existing_coverages=applicant_data.existing_coverages||[];self.has_valid_gender=ko.pureComputed(function(){return self.gender()!==null;});self.has_valid_height=ko.computed(function(){return self.height()!=null&&self.height()>0&&self.height_error()==null;});self.has_valid_weight=ko.computed(function(){return self.weight()!=null&&self.weight_error()==null;});self.is_valid=ko.computed(function(){return($.trim(self.first())!=""&&$.trim(self.last())!=""&&$.trim(self.birthdate())!="");});self.any_valid_field=ko.computed(function(){return($.trim(self.first())!==""||$.trim(self.last())!==""||$.trim(self.birthdate())!=="");});self.name=ko.computed(function(){if(self.is_valid()){return self.first();}else{return"";}});self.get_age=ko.computed(function(){return age_for_date(self.birthdate());});self.is_age_in_band=function(min_age,max_age){var is_in_band=true;if(min_age!==null){is_in_band=is_in_band&&self.get_age()>=min_age;}
if(max_age!==null){is_in_band=is_in_band&&self.get_age()<=max_age;}
return is_in_band;};self.serialize_data=function(){var data={};data.first=self.first();data.last=self.last();data.email=self.email();data.age=self.get_age();data.weight=self.weight();data.height=self.height();data.is_smoker=self.is_smoker();data.birthdate=self.birthdate();data.ssn=self.ssn();data.gender=self.gender();data.phone=self.phone();data.address1=self.address1();data.address2=self.address2();data.city=self.city();data.state=self.state();data.zip=self.zip();return data;};self.get_existing_coverage_amount_for_product=function(product_id){var amount=self.get_existing_coverage_amount_by_product()[product_id];if(!amount){return 0;}
return parseFloat(amount);};self.get_existing_coverage_amount_by_product=function(){return _.reduce(self.existing_coverages,function(by_product_id,coverage){if(!(coverage.product.id in by_product_id)){by_product_id[coverage.product.id]=0.0;}
if(coverage.coverage_status==='enrolled'){by_product_id[coverage.product.id]+=parseFloat(coverage.coverage_face_value);}
return by_product_id;},{});};}
Applicant.EmployeeType="employee";Applicant.SpouseType="spouse";Applicant.ChildType="children";var ApplicantGroup=function(options,applicants){var self=this;self.type=options.type;self.applicants=applicants;self._id=_applicant_count++;self.is_valid=ko.computed(function(){return _.all(self.applicants(),function(applicant){return(applicant.any_valid_field()&&applicant.is_valid())||!applicant.any_valid_field();});});self.name=ko.pureComputed(function(){var non_empty_name_applicants=_.filter(self.applicants(),function(applicant){return $.trim(applicant.name())!=="";});return _.invoke(non_empty_name_applicants,"name").join(", ");});self.is_age_in_band=function(min_age,max_age){return self.all_ages_in_band(min_age,max_age);};self.all_ages_in_band=function(min_age,max_age){var is_in_band=true;if(min_age!==null){is_in_band=is_in_band&&_.all(self.applicants(),function(applicant){return applicant.get_age()>=min_age;});}
if(max_age!==null){is_in_band=is_in_band&&_.all(self.applicants(),function(applicant){return applicant.get_age()<=max_age;});}
return is_in_band;};self.any_valid_field=function(){return _.any(self.applicants(),function(applicant){return applicant.any_valid_field();});};self.serialize_data=function(){return{type:self.type,applicants:_.map(self.applicants(),function(applicant){return applicant.serialize_data();})};};self.get_existing_coverage_amount_for_product=function(product_id){if(self.applicants().length===0){return 0;}
return self.applicants()[0].get_existing_coverage_amount_for_product(product_id);};};var ApplicantList=function(initial_list,should_show_spouse,should_show_children){this.applicants=ko.observableArray(initial_list||[]);this.children=ko.pureComputed(this.get_children,this);this._children_group=null;this.should_show_spouse=should_show_spouse;this.should_show_children=should_show_children;this.get_valid_applicants_for_coverage=ko.pureComputed(this._get_valid_applicants_for_coverage,this);this.get_valid_applicants=ko.pureComputed(this._get_valid_applicants,this);if(this.get_employee()===undefined){this.applicants.push(create_applicant({type:Applicant.EmployeeType}));}
if(this.get_spouse()===undefined){this.applicants.push(create_applicant({type:Applicant.SpouseType,last:this.get_employee().last()}));}};ApplicantList.prototype={_get_valid_applicants_for_coverage:function(){var applicants=[];if(this.has_valid_employee()){applicants.push(this.get_employee());}
if(this.should_show_spouse()&&this.has_valid_spouse()){applicants.push(this.get_spouse());}
if(this.should_show_children()&&this.has_valid_children()){applicants.push(this.get_children_group());}
return applicants;},_get_valid_applicants:function(){return _.filter(vm.coverage_vm.applicants.applicants(),function(a){return a.is_valid();});},get_employee:function(){return this._find_applicant_by_type(Applicant.EmployeeType);},get_spouse:function(){return this._find_applicant_by_type(Applicant.SpouseType);},get_children:function(){return _.filter(this.applicants(),function(a){return a.type===Applicant.ChildType;});},get_children_group:function(){if(this._children_group===null){this._children_group=new ApplicantGroup({type:Applicant.ChildType},this.children);}
return this._children_group;},has_valid_employee:function(){return this.get_employee()&&this.get_employee().is_valid();},has_valid_spouse:function(){return this.get_spouse()&&this.get_spouse().is_valid();},has_valid_children:function(){return _.any(this.get_children(),function(c){return c.is_valid();});},get_valid_children:function(){return _.filter(this.get_children(),function(c){return c.is_valid();});},add_applicant:function(applicant){this.applicants.push(applicant);},remove_applicant:function(applicant){this.applicants.remove(applicant);},_find_applicant_by_type:function(applicant_type){return _.find(this.applicants(),function(applicant){return applicant.type===applicant_type;});}};function age_for_date(date){var bd=parse_date(date,"MM/DD/YYYY");if(bd.isValid()){if(bd.isAfter(now())){return-1;}else{return now().diff(bd,"years");}}else{return"";}}
function create_applicant(options){return new Applicant(options);}
return{Applicant:Applicant,ApplicantGroup:ApplicantGroup,ApplicantList:ApplicantList,create_applicant:create_applicant,age_for_date:age_for_date};})();var beneficiary=(function(){"use strict";function Beneficiary(options){var self=this;var defaults={name:"",relationship:"",ssn:"",date_of_birth:"",is_nonperson_entity:false};options=$.merge({},defaults,options);self.name=ko.observable(options.name);self.relationship=ko.observable(options.relationship);self.ssn=ko.observable(options.ssn);self.date_of_birth=ko.observable(options.date_of_birth);self.is_nonperson_entity=ko.observable(options.is_nonperson_entity);self.date_of_birth_validation_error=ko.observable(null);self.date_of_birth.subscribe(function(value){self.date_of_birth_validation_error(get_date_of_birth_validation_error(value));});self.serialize=function(){return{name:self.name(),relationship:self.relationship(),ssn:self.ssn(),date_of_birth:self.date_of_birth(),is_nonperson_entity:self.is_nonperson_entity()};};}
return{Beneficiary:Beneficiary};})();function CoverageOption(options){var self=this;self.is_by_face=options.is_by_face;self.premium=options.premium;self.payment_mode=options.payment_mode;self.face_value=options.face_value;self.applicant_type=options.applicant_type;self.get_total_premium=function(){return self.premium;};self.format_premium=function(){return format_premium_value(self.premium);};self.format_premium_option=function(){return self.format_premium()+" "+self.payment_mode().display_lowercase();};self.format_face_value=function(){return format_face_value(self.face_value);};self.format_face_option=function(){return self.format_face_value()+" face amount";};self.format_for_dropdown=function(){if(self.is_by_face){return self.format_face_option();}else{return self.format_premium_option();}};self.is_valid=function(){return true;};self.serialize_data=function(){return{premium:self.premium,face_value:self.face_value}}}
CoverageOption.display_benefit_option=function(item){return item.format_for_dropdown();};function CICoverageOption(wrapped_option){var self=this;self.is_by_face=wrapped_option.is_by_face;self.premium=wrapped_option.premium;self.get_total_premium=wrapped_option.get_total_premium;self.face_value=wrapped_option.face_value;self.format_premium=wrapped_option.format_premium;self.format_premium_option=wrapped_option.format_premium_option;self.format_face_value=function(){var face_value_formatted=format_face_value(self.face_value);var ci_value=Math.round(self.face_value*.3);var ci_value_formatted=format_face_value(ci_value);return face_value_formatted+"<br><small>("+ci_value_formatted+" CI)</small>";};self.format_for_dropdown=wrapped_option.format_for_dropdown;self.is_valid=wrapped_option.is_valid;self.serialize_data=wrapped_option.serialize_data;self.payment_mode=wrapped_option.payment_mode;self.applicant_type=wrapped_option.applicant_type;}
function NullCoverageOption(){'use strict';var self=this;self.is_by_face=true;self.premium=0;self.face_value=0;self.is_removed_from_product=ko.observable(false);self.is_valid=function(){return false;};self.format_premium_option=function(){return"";};self.format_premium=function(){};self.get_total_premium=function(){return 0;};self.format_face_value=function(){return"- no benefit -";};self.format_for_dropdown=function(){return"- no benefit -";};self.serialize_data=function(){return{};};self.payment_mode=function(){return null;};}
var health_question_buttons=(function(){function HealthButtonRow(question,product_coverage,product_health_questions){var self=this;self.question=question;self.product_coverage=product_coverage;self.product_health_questions=product_health_questions;self.button_groups=ko.pureComputed(function(){return _.map(self.product_coverage.applicant_list.get_valid_applicants(),function(applicant){var response=self.product_health_questions.get_applicant_answer_for_question(applicant,question);return new ResponseButtonGroup(question,applicant,response,{});});});}
function ResponseButtonGroup(question,applicant,response,options){var self=this;self.question=question;self.applicant=applicant;self.response=response;self.yes_text=options.yes_text||"Yes";self.no_text=options.yes_text||"No";self.yes_highlight=self.question.get_yes_highlight();self.no_highlight="checkmark";self.handle_yes=function(){self.response.value('Yes');self.question.show_yes_dialogue(self.applicant);};self.handle_no=function(){self.response.value('No');};self.does_applicant_need_to_answer=ko.pureComputed(function(){return self.question.does_applicant_need_to_answer(self.applicant);});self.should_show_yes_flag=ko.pureComputed(function(){return self.response.value()==="Yes"&&self.yes_highlight==="flag";});self.should_show_yes_stop=ko.pureComputed(function(){return self.response.value()==="Yes"&&self.yes_highlight==="stop";});self.should_show_yes_checkmark=ko.pureComputed(function(){return self.response.value()==="Yes"&&self.yes_highlight==="checkmark";});self.should_show_yes_default=ko.pureComputed(function(){return self.response.value()!=="Yes";});self.should_show_no_flag=ko.pureComputed(function(){return self.response.value()==="No"&&self.no_highlight==="flag";});self.should_show_no_stop=ko.pureComputed(function(){return self.response.value()==="No"&&self.no_highlight==="stop";});self.should_show_no_checkmark=ko.pureComputed(function(){return self.response.value()==="No"&&self.no_highlight==="checkmark";});self.should_show_no_default=ko.pureComputed(function(){return self.response.value()!=="No";});}
function are_health_questions_valid(){if(window.vm.should_show_other_insurance_questions()&&window.vm.is_in_person_application()&&general_questions_by_id['existing_insurance'].get_val()===null){return false;}
if(window.vm.should_show_other_insurance_questions()&&(!window.vm.did_select_any_fpp_product()&&general_questions_by_id['replace_insurance'].get_val()!="No")||(window.vm.did_select_any_fpp_product()&&general_questions_by_id['replace_insurance'].get_val()===null)){return false;}
if(window.vm.did_select_any_fpp_product()){if(window.vm.is_employee_actively_at_work()===null){return false;}}
var valid=true;_.each(window.vm.selected_product_health_questions(),function(product_health_questions){_.each(product_health_questions.health_button_rows(),function(health_button_row){_.each(health_button_row.button_groups(),function(button_group){if(button_group.does_applicant_need_to_answer()){if(!button_group.question.does_yes_stop_app()&&button_group.response.value()===null){valid=false;return false;}else if(button_group.question.does_yes_stop_app()&&button_group.response.value()!=="No"){valid=false;return false;}}});if(!valid){return false;}});if(!valid){return false;}});return valid;}
return{HealthButtonRow:HealthButtonRow,ResponseButtonGroup:ResponseButtonGroup,are_health_questions_valid:are_health_questions_valid}})();function QuestionButton(element,val,highlight_func,unhighlight_func){var self=this;self.elements=[$(element)];self.val=val;self.highlight=function(){$.each(self.elements,function(){highlight_func(this);});};self.unhighlight=function(){$.each(self.elements,function(){unhighlight_func(this);});};}
function QuestionButtonGroup(question,is_required){var self=this;self.question=question;self.buttons=[];self.selected_btn=ko.observable(null);self.is_required=is_required;self.get_val=ko.computed(function(){if(self.selected_btn()==null){return false;}else{return self.selected_btn().val;}});self.add_button=function(element,val,high_func,unhigh_func){var btn=null;$.each(self.buttons,function(){if(this.val==val){btn=this;}});if(btn){btn.elements.push(element);}else{self.buttons.push(new QuestionButton(element,val,high_func,unhigh_func));}};self.click_button=function(val){var btn=null;$.each(self.buttons,function(){if(this.val==val){btn=this;}
this.unhighlight();});btn.highlight();self.selected_btn(btn);};}
var general_questions_by_id={};ko.bindingHandlers.flagBtn={init:function(element,value_accessor){var val=ko.unwrap(value_accessor());$(element).addClass("flagBtn").addClass("val_"+val.val);var btn_group;if(val.applicant){var applicant=val.applicant;var product_health_questions=val.product_health_questions;var applicant_coverage=product_health_questions.product_coverage.__get_coverage_for_applicant(applicant);var question_text=val.question.get_question_text();btn_group=null;if(!btn_group){btn_group=new QuestionButtonGroup(val.question,val.is_required);}}else{var group_lookup=general_questions_by_id;if(val.question.get_question_text()in group_lookup){btn_group=group_lookup[val.question.get_question_text()];}else{btn_group=new QuestionButtonGroup(val.question,val.is_required);group_lookup[val.question.get_question_text()]=btn_group;}
if(val.is_selected===true){btn_group.click_button(val.val);}}
btn_group.add_button(element,val.val,function(el){var highlight_type;if(typeof val.highlight==="function"){highlight_type=val.highlight();}else{highlight_type=val.highlight;}
if(highlight_type==="flag"){$(el).prepend('<i class="icon glyphicon glyphicon-flag"></i>').addClass("btn btn-warning");}else if(highlight_type==="checkmark"){$(el).prepend('<i class="icon glyphicon glyphicon-ok"></i>').addClass("btn-success");}else if(highlight_type==="stop"){$(el).prepend('<i class="icon glyphicon glyphicon-remove"></i>').addClass("btn-danger");}},function(el){$(el).removeClass("btn-success btn-warning btn-danger").addClass("btn-default");$(el).find(".glyphicon").remove();});$(element).on("click",function(){btn_group.click_button(val.val);if(val.onclick){val.onclick();}});if(btn_group.selected_btn&&btn_group.selected_btn.val==val.val){btn_group.click_button(val.val);}},update:function(element,value_accessor){}};function handle_existing_insurance_modal(){if(window.vm.did_select_any_fpp_product()){}else{$("#modal_text_existing_warning_title").show();$("#modal_text_replacement_warning_title").hide();$("#modal_text_soh_warning_title").hide();$("#modal_text_existing_warning").show();$("#modal_text_replacement_warning").hide();$("#modal_text_soh_warning").hide();$("#health_modal").modal('show');$("#existing_warning_text").show();}
window.vm.existing_insurance(true);}
function reset_existing_insurance_warning(){window.vm.existing_insurance(false);$("#existing_warning_text_remote").hide();$("#existing_warning_text").hide();}
function handle_replacement_insurance_modal(){if(window.vm.did_select_any_fpp_product()){}else{$("#modal_text_existing_warning_title").hide();$("#modal_text_replacement_warning_title").show();$("#modal_text_soh_warning_title").hide();$("#modal_text_existing_warning").hide();$("#modal_text_existing_warning_remote").hide();$("#modal_text_replacement_warning").show();$("#modal_text_soh_warning").hide();$("#health_modal").modal('show');$("#replacement_warning_text").show();}
window.vm.replacing_insurance(true);}
function reset_replacement_insurance_warning(){$("#replacement_warning_text").hide();window.vm.replacing_insurance(false);}
function handle_question_yes(){$("#modal_text_existing_warning_title").hide();$("#modal_text_replacement_warning_title").hide();$("#modal_text_soh_warning_title").show();$("#modal_text_existing_warning").hide();$("#modal_text_existing_warning_remote").hide();$("#modal_text_replacement_warning").hide();$("#modal_text_soh_warning").show();$("#health_modal").modal('show');}
var health_questions=(function(){'use strict';function ProductHealthQuestions(product_coverage,spouse_questions,all_health_questions){var self=this;self.product_coverage=product_coverage;self.health_questions=ko.pureComputed(function(){var questions=health_questions.process_spouse_question_data(spouse_questions,self.product_coverage);var soh_questions=health_questions.process_health_question_data(all_health_questions,self.product_coverage);$.merge(questions,soh_questions);return questions;});self.show_yes_dialogue=function(applicant,message){var button_options={remove:{label:"Remove this applicant",className:'btn-danger',callback:function(){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);if(applicant.type===wizard_applicant.Applicant.ChildType){self.product_coverage.applicant_list.remove_applicant(applicant);}else{var null_option=_.find(applicant_coverage_options,function(o){return o.face_value===0;});self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(null_option);}
decline_product_if_no_coverage(self.product_coverage);}},ignore:{label:"Ignore and Continue",className:'btn-default',callback:function(){}}};var product_name=self.product_coverage.format_product_name();message=message||"A \"yes\" response to this question disqualifies this person from obtaining coverage for "+"'"+product_name+"'. You may proceed with this application after removing this individual from the "+"coverage selection before proceeding.";bootbox.dialog({message:message,buttons:button_options});};self.health_button_rows=ko.pureComputed(function(){return _.map(self.health_questions(),function(question){return new health_question_buttons.HealthButtonRow(question,self.product_coverage,self);});});self.do_any_health_questions_need_answering=function(){if(self.health_questions().length==0){return false;}
if(self.product_coverage.product.is_fpp_product()){return true;}
return _.any(self.health_questions(),function(question){return question.does_any_applicant_need_to_answer();});};self._health_question_responses=[];self.get_applicant_answer_for_question=function(applicant,question){var found_response=_.find(self._health_question_responses,function(response){return response.question===question&&response.applicant===applicant;});if(found_response===undefined){var resp=new HealthQuestionResponse(question,applicant,null);self._health_question_responses.push(resp);return resp;}else{return found_response;}};self.serialize_answers_for_applicant=function(applicant){return _.map(self.health_questions(),function(question){var response=self.get_applicant_answer_for_question(applicant,question);return response.serialize();});};}
function HealthQuestionResponse(question,applicant,initial_response){var self=this;self.question=question;self.applicant=applicant;self.value=ko.observable(initial_response);self.serialize=function(){var answer=null;if(self.question.does_applicant_need_to_answer(self.applicant)){answer=self.value();}else if(self.question.can_applicant_skip_due_to_GI(self.applicant)){answer='GI';}
return{question:self.question.get_question_text(),label:self.question.get_question_label(),is_spouse_only:self.question.is_spouse_only(),answer:answer};};}
function process_spouse_question_data(question_data_by_product,product_coverage){var questions=[];var product_data=product_coverage.product.product_data;_.each(question_data_by_product,function(product_questions,product_id){if(product_id==product_data.id){var question_factory;if(product_coverage.product.product_data.is_guaranteed_issue){question_factory=function(question_data){return new GIHealthQuestion(product_coverage.product,question_data,product_coverage,product_data.gi_criteria,product_data.statement_of_health_bypass_type,product_data.bypassed_soh_questions);};}else{question_factory=function(question_data){return new StandardHealthQuestion(question_data,product_coverage);}}
questions=_.map(product_questions,question_factory);}});return questions;}
function process_health_question_data(health_question_data_by_product,product_coverage){var questions=[];var product_data=product_coverage.product.product_data;_.each(health_question_data_by_product,function(product_health_questions,product_id){if(product_id==product_data.id){var question_factory;if(product_data.is_guaranteed_issue){question_factory=function(question_data){return new GIHealthQuestion(product_coverage.product,question_data,product_coverage,product_data.gi_criteria,product_data.statement_of_health_bypass_type,product_data.bypassed_soh_questions);};}else if(product_coverage.product.product_type=="Group CI"){question_factory=function(question_data){return new GIHealthQuestion(product_coverage.product,question_data,product_coverage,[{guarantee_issue_amount:10000,applicant_type:'Employee',age_max:null,age_min:null,weight_min:null,weight_max:null,height_min:null,height_max:null},{guarantee_issue_amount:25000,applicant_type:'Child',age_max:null,age_min:null,weight_min:null,weight_max:null,height_min:null,height_max:null}],"selected",[{question_type_label:"5yr Heart"},{question_type_label:"5yr Hypertension / Cholesterol"},{question_type_label:"5yr Lung / Colon"},{question_type_label:"5yr Skin Cancer"},{question_type_label:"5yr HPV/HSV"},{question_type_label:"Abnormal Results"},{question_type_label:"Ever been rejected"}]);};}else{question_factory=function(question_data){return new StandardHealthQuestion(question_data,product_coverage);};}
questions=_.map(product_health_questions,question_factory);}});return questions;}
return{ProductHealthQuestions:ProductHealthQuestions,HealthQuestionResponse:HealthQuestionResponse,process_health_question_data:process_health_question_data,process_spouse_question_data:process_spouse_question_data};})();var GlobalSOHQuestion=function(question_text){var self=this;self.question_text=question_text;};GlobalSOHQuestion.prototype.get_question_text=function(){return this.question_text;};var NonHealthQuestion=function(question_text){var self=this;self.question_text=question_text;};NonHealthQuestion.prototype.get_question_text=function(){return this.question_text;};function decline_product_if_no_coverage(product_coverage){'use strict';if(!product_coverage.did_select_valid_coverage()){if(window.vm.coverage_vm.has_multiple_products()){product_coverage.did_decline(true);}else{window.vm.did_decline(true);}}
if(window.vm.did_decline_all_products()){window.vm.set_wizard_step(1);}}
var StandardHealthQuestion=function(question,product_coverage){var self=this;self.product_coverage=product_coverage;self.question=question;self.does_employee_need_to_answer=ko.computed(function(){if(self.question.is_spouse_only){return false;}
return self.product_coverage.did_select_employee_coverage();});self.does_spouse_need_to_answer=ko.computed(function(){return self.product_coverage.did_select_spouse_coverage();});self.does_child_need_to_answer=function(child){if(self.question.is_spouse_only){return false;}
return self.product_coverage.did_select_children_coverage();};self.can_employee_skip_due_to_GI=function(){return false};self.can_spouse_skip_due_to_GI=function(){return false};self.can_child_skip_due_to_GI=function(child){return false};self.show_yes_dialogue_employee=function(){return self.show_yes_dialogue();};self.show_yes_dialogue_spouse=function(){return self.show_yes_dialogue();};self.show_yes_dialogue_child=function(child){return self.show_yes_dialogue();};self.show_yes_dialogue=function(applicant,message){if(!self.does_yes_stop_app()){return;}
var button_options={remove:{label:"Remove this applicant",className:'btn-danger',callback:function(){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);if(applicant.type===wizard_applicant.Applicant.ChildType){self.product_coverage.applicant_list.remove_applicant(applicant);}else{var null_option=_.find(applicant_coverage_options,function(o){return o.face_value===0;});self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(null_option);}
decline_product_if_no_coverage(self.product_coverage);}},ignore:{label:"Ignore and Continue",className:'btn-default',callback:function(){}}};var product_name=self.product_coverage.format_product_name();message=message||"A \"yes\" response to this question disqualifies this person from obtaining coverage for '"+product_name+"'.";bootbox.dialog({message:message+" You may proceed with this application after removing this individual from the coverage selection before proceeding.",buttons:button_options});};self.does_any_applicant_need_to_answer=ko.pureComputed(function(){return _.any(self.product_coverage.applicant_coverage_selections(),function(app_cov){return self.does_applicant_need_to_answer(app_cov.applicant);});});};StandardHealthQuestion.prototype.is_spouse_only=function(){return this.question.is_spouse_only;};StandardHealthQuestion.prototype.get_question_text=function(){return this.question.question_text;};StandardHealthQuestion.prototype.get_question_label=function(){return this.question.label;};StandardHealthQuestion.prototype.does_applicant_need_to_answer=function(applicant){if(applicant.type===wizard_applicant.Applicant.EmployeeType){return this.does_employee_need_to_answer();}
if(applicant.type===wizard_applicant.Applicant.SpouseType){return this.does_spouse_need_to_answer();}
if(applicant.type===wizard_applicant.Applicant.ChildType){if(!applicant.applicants){return this.does_child_need_to_answer(applicant);}else{return _.any(applicant.applicants(),function(child){return this.does_child_need_to_answer(child);},this);}}
return false;};StandardHealthQuestion.prototype.can_applicant_skip_due_to_GI=function(applicant){if(applicant.type===wizard_applicant.Applicant.EmployeeType){return this.can_employee_skip_due_to_GI();}else if(applicant.type===wizard_applicant.Applicant.SpouseType){return this.can_spouse_skip_due_to_GI();}else if(applicant.type===wizard_applicant.Applicant.ChildType){return this.can_child_skip_due_to_GI(applicant);}else{console.error("Invalid applicant type "+applicant.type,applicant);}};StandardHealthQuestion.prototype.get_yes_highlight=function(){return(this.does_yes_stop_app())?'stop':'checkmark';};StandardHealthQuestion.prototype.does_yes_stop_app=function(){return!this.question.is_ignored;};var GIHealthQuestion=function(product,question,product_coverage,applicant_criteria,skip_mode,skipped_questions){'use strict';var self=this;self.product=product;self.product_coverage=product_coverage;self.question=question;self.applicant_criteria=applicant_criteria;self.skip_mode=skip_mode;self.skipped_questions=skipped_questions;self.get_criteria=function(applicant_type){return _.filter(self.applicant_criteria,function(c){return self._clean_criteria_applicant_type(c.applicant_type)===applicant_type;});};self._clean_criteria_applicant_type=function(applicant_type){if(applicant_type==='Employee'){return wizard_applicant.Applicant.EmployeeType;}else if(applicant_type==='Spouse'){return wizard_applicant.Applicant.SpouseType;}else if(applicant_type==='Child'){return wizard_applicant.Applicant.ChildType;}else{return applicant_type;}};self.get_met_gi_criteria_for_employee=ko.computed(function(){var applicant=self.product_coverage.applicant_list.get_employee();var coverage=self.product_coverage.__get_coverage_for_applicant(applicant);var employee_criteria=self.get_criteria(applicant.type);return _.find(employee_criteria,function(criterion){return self.does_applicant_meet_GI_criteria(applicant,coverage,criterion);});});self.has_employee_met_GI_criteria=ko.computed(function(){return self.get_met_gi_criteria_for_employee()!==undefined;});self.get_met_gi_criteria_for_spouse=ko.computed(function(){var applicant=self.product_coverage.applicant_list.get_spouse();var coverage=self.product_coverage.__get_coverage_for_applicant(applicant);var criteria=self.get_criteria(applicant.type);return _.find(criteria,function(criterion){return self.does_applicant_meet_GI_criteria(applicant,coverage,criterion);});});self.has_spouse_met_GI_criteria=ko.computed(function(){return self.get_met_gi_criteria_for_spouse()!==undefined;});self.can_employee_skip_due_to_GI=ko.computed(function(){return self.has_employee_met_GI_criteria()&&self.should_skip_if_GI_criteria_met();});self.can_spouse_skip_due_to_GI=ko.computed(function(){return self.has_spouse_met_GI_criteria()&&self.should_skip_if_GI_criteria_met();});self.get_met_gi_criteria_for_child=function(child_applicant){var criteria=self.get_criteria(child_applicant.type);var children=self.product_coverage.applicant_list.get_children_group();var coverage=self.product_coverage.__get_coverage_for_applicant(children);return _.find(criteria,function(criterion){return self.does_applicant_meet_GI_criteria(child_applicant,coverage,criterion);});};self.has_child_met_GI_criteria=function(child_applicant){return self.get_met_gi_criteria_for_child(child_applicant)!==undefined;};self.show_yes_dialogue_employee=function(){self.show_yes_dialogue(self.product_coverage.applicant_list.get_employee());};self.show_yes_dialogue_spouse=function(){self.show_yes_dialogue(self.product_coverage.applicant_list.get_spouse());};self.show_yes_dialogue_child=function(child){self.show_yes_dialogue(child);};self.get_best_GI_criteria=function(applicant,coverage,criteria){var descendingCriteria=_.sortBy(criteria,function(c){return-c.guarantee_issue_amount;});return _.find(descendingCriteria,function(criterion){return(self.does_applicant_meet_demographic_GI_criteria(applicant,criterion)&&criterion.guarantee_issue_amount<coverage);});};self.show_yes_dialogue=function(applicant,message){var button_options={remove:{label:"Remove this applicant",className:'btn-danger',callback:function(){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);if(applicant.type===wizard_applicant.Applicant.ChildType){self.product_coverage.applicant_list.remove_applicant(applicant);}else{var null_option=_.find(applicant_coverage_options,function(o){return o.face_value===0;});self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(null_option);}
decline_product_if_no_coverage(self.product_coverage);}},ignore:{label:"Ignore and Continue",className:'btn-default',callback:function(){}}};var display_message;if(should_show_reduce_coverage_option(applicant)){add_reduce_option(applicant,button_options);display_message=create_reduce_dialogue_message(applicant);}else{var product_name=self.product_coverage.format_product_name();message=message||"A \"yes\" response to this question disqualifies this person from obtaining coverage for '"+product_name+"'.";display_message=message+" You may proceed with this application after removing this individual from the coverage selection before proceeding.";}
bootbox.dialog({message:display_message,buttons:button_options});};function create_reduce_dialogue_message(applicant){var face_amount=format_face_value(get_cumulative_coverage(applicant));var gi_amount=get_reduced_coverage_criteria(applicant).guarantee_issue_amount;var formatted_gi_amount=format_face_value(gi_amount);return'A "yes" response to this question prohibits this person from obtaining the selected '+face_amount+' of coverage. You may proceed, however, by reducing your coverage to the guaranteed coverage amount of '+formatted_gi_amount+'.'+'<br><br>Alternatively, you may remove this individual from the coverage selection altogether (in Step 1) before proceeding with the rest of the application.';}
function get_cumulative_coverage(applicant){var applicant_coverage=self.product_coverage.__get_coverage_for_applicant(applicant);return applicant_coverage.get_cumulative_coverage_amount();}
function get_reduced_coverage_criteria(applicant){var criteria=self.get_criteria(applicant.type);var coverage_amount=get_cumulative_coverage(applicant);return self.get_best_GI_criteria(applicant,coverage_amount,criteria);}
function should_show_reduce_coverage_option(applicant){if(!self.should_skip_if_GI_criteria_met()){return false;}
if(!get_reduced_coverage_criteria(applicant)){return false;}
if(!find_reduced_coverage_option(applicant)){return false;}
return true;}
function add_reduce_option(applicant,button_options){button_options["reduce"]={label:"Reduce the coverage",className:'btn-success',callback:function(){self.product_coverage.__get_coverage_for_applicant(applicant).customized_coverage_option(find_reduced_coverage_option(applicant));}};}
function find_reduced_coverage_option(applicant){var applicant_coverage_options=self.product_coverage.get_coverage_options_for_applicant(applicant);var applicant_coverage=self.product_coverage.__get_coverage_for_applicant(applicant);var previous_coverage_amount=applicant_coverage.get_previous_coverage_amount();var reduced_gi_criterion=get_reduced_coverage_criteria(applicant);var gi_amount=reduced_gi_criterion.guarantee_issue_amount;var filtered_options=_.filter(applicant_coverage_options,function(o){return o.face_value>0&&(previous_coverage_amount+o.face_value)<=gi_amount;});if(filtered_options.length==0){return null;}
return _.max(filtered_options,function(o){return o.face_value;});}
self.does_employee_need_to_answer=ko.computed(function(){if(!self.product_coverage.did_select_employee_coverage()){return false;}
if(self.can_employee_skip_due_to_GI()){return false;}
if(self.question.is_spouse_only){return false;}
return true;});self.does_spouse_need_to_answer=ko.computed(function(){if(!self.product_coverage.did_select_spouse_coverage()){return false;}
if(self.can_spouse_skip_due_to_GI()){return false;}
return true;});self.can_child_skip_due_to_GI=function(child_applicant){return self.has_child_met_GI_criteria(child_applicant)&&self.should_skip_if_GI_criteria_met();};self.does_child_need_to_answer=function(child_applicant){if(!self.product_coverage.did_select_children_coverage()){return false;}
if(self.can_child_skip_due_to_GI(child_applicant)){return false;}
if(self.question.is_spouse_only){return false;}
return true;};self.does_any_applicant_need_to_answer=ko.computed(function(){return _.any(self.product_coverage.applicant_coverage_selections(),function(app_cov){return self.does_applicant_need_to_answer(app_cov.applicant);});});};GIHealthQuestion.prototype=Object.create(StandardHealthQuestion.prototype);GIHealthQuestion.prototype.does_applicant_meet_GI_criteria=function(applicant,coverage,criterion){return(this.does_applicant_meet_coverage_GI_criteria(applicant,coverage,criterion)&&this.does_applicant_meet_demographic_GI_criteria(applicant,criterion));};GIHealthQuestion.prototype.does_applicant_meet_coverage_GI_criteria=function(applicant,applicant_coverage,criterion){var self=this;return applicant_coverage.get_cumulative_coverage_amount()<=criterion.guarantee_issue_amount;};GIHealthQuestion.prototype.does_applicant_meet_demographic_GI_criteria=function(applicant,criterion){var does_meet=true;if(criterion.age_max!==null){does_meet&=applicant.get_age()<=criterion.age_max;}
if(criterion.age_min!==null){does_meet&=applicant.get_age()>=criterion.age_min;}
if(criterion.height_max!==null){does_meet&=applicant.height()!==null&&applicant.height()<=criterion.height_max}
if(criterion.height_min!==null){does_meet&=applicant.height()!==null&&applicant.height()>=criterion.height_min;}
if(criterion.weight_max!==null){does_meet&=applicant.weight()!==null&&applicant.weight()<=criterion.weight_max}
if(criterion.weight_min!==null){does_meet&=applicant.weight()!==null&&applicant.weight()>=criterion.weight_min;}
return does_meet;};GIHealthQuestion.prototype.should_skip_if_GI_criteria_met=function(){var self=this;if(self.skip_mode=="all"){return true;}else{return _.any(self.skipped_questions,function(q){return self.get_question_label()==q.question_type_label});}};GIHealthQuestion.prototype.does_yes_stop_app=function(){var self=this;return true;};function HealthQuestionAnswer(question,button_group,question_object){var self=this;self.question=question;self.question_object=question_object;self.button_group=ko.observable(null);self.answer=ko.computed(function(){if(self.button_group()==null){return null;}else{return self.button_group().get_val();}});self.serialize=function(){var answer;if(self.button_group()){answer=(self.button_group().is_required())?self.button_group().get_val():"GI";}else{answer=null;}
return{question:self.question.question_text,label:self.question.label,is_spouse_only:self.question.is_spouse_only||false,answer:answer}};}
var enrollment_wizard=(function(){return{init:function(data){console.log("init with args: ",arguments);var ui=new wizard_viewmodel.WizardUI(data);window.ui=ui;ko.applyBindings(ui);init_validation();}};})();var payment_mode_module=(function(){function PaymentMode(options){this.frequency=options.frequency;this.label=options.label;}
PaymentMode.prototype={serialize:function(){return this.frequency;},display_lowercase:function(){return this.label.toLowerCase();},display:function(){return this.label;}};var FREQUENCY_LABELS={12:'Monthly',24:'Semimonthly',26:'Biweekly',52:'Weekly'};return{create_payment_mode:function(options){return new PaymentMode(options);},create_payment_mode_by_frequency:function(frequency){var options={frequency:frequency,label:FREQUENCY_LABELS[frequency]};return new PaymentMode(options);},select_initial_payment_mode:function(case_data,payment_modes){var initial_payment_mode=null;if(case_data&&case_data.payment_mode>=0){initial_payment_mode=_.find(payment_modes,function(pm){return pm.frequency===case_data.payment_mode;});if(initial_payment_mode===undefined){initial_payment_mode=null;}}
return initial_payment_mode;},can_change_payment_mode:function(case_data){return(case_data.payment_mode===-1||!case_data.payment_mode);}}})();var product_rates_service=(function(){var is_loading_rates=ko.observable(false);function ProductRatesVM(product){this.product=product;this.rates=ko.observableArray([]);this.recommendations=ko.observableArray([]);this.employee_options=ko.pureComputed(this._get_employee_options,this);this.spouse_options=ko.pureComputed(this._get_spouse_options,this);this.children_options=ko.pureComputed(this._get_children_options,this);this.applicant_coverage_options={};this.applicant_coverage_options[wizard_applicant.Applicant.EmployeeType]=this.employee_options;this.applicant_coverage_options[wizard_applicant.Applicant.SpouseType]=this.spouse_options;this.applicant_coverage_options[wizard_applicant.Applicant.ChildType]=this.children_options;}
ProductRatesVM.prototype={update_rates_data:function(rates_data){this.update_product_rates(rates_data);this.update_recommendations(rates_data);},update_product_rates:function(rates_data){this.rates(this.get_coverage_options_from_api_data(rates_data));},get_coverage_options_from_api_data:function(rates_data){var rates=[];rates=$.merge(rates,this.create_coverage_options_for_applicant(wizard_applicant.Applicant.EmployeeType,rates_data.employee_rates));rates=$.merge(rates,this.create_coverage_options_for_applicant(wizard_applicant.Applicant.SpouseType,rates_data.spouse_rates));rates=$.merge(rates,this.create_coverage_options_for_applicant(wizard_applicant.Applicant.ChildType,rates_data.children_rates));return rates;},create_coverage_options_for_applicant:function(applicant_type,applicant_rates_data){var options=[];if(applicant_rates_data.bypremium){options=$.merge(options,this.create_coverage_options(false,applicant_type,applicant_rates_data.bypremium));}
if(applicant_rates_data.byface){options=$.merge(options,this.create_coverage_options(true,applicant_type,applicant_rates_data.byface));}
return options;},create_coverage_options:function(is_by_face,applicant_type,rate_options){return _.map(rate_options,function(data){return this.product.create_coverage_option({applicant_type:applicant_type,is_by_face:is_by_face,face_value:data.coverage,premium:data.premium,payment_mode:function(){return payment_mode_module.create_payment_mode_by_frequency(data.payment_mode)}.bind(this)});},this);},update_recommendations:function(rates_data){if(rates_data.recommendations){this.recommendations(this.process_recommendations(rates_data.recommendations));}},process_recommendations:function(recommendations){var processed_recommendations=[];_.each(recommendations,function(rec_data){var emp_option=this.find_applicant_coverage_option(wizard_applicant.Applicant.EmployeeType,rec_data.coverages.employee);var sp_option=this.find_applicant_coverage_option(wizard_applicant.Applicant.SpouseType,rec_data.coverages.spouse);var ch_option=this.find_applicant_coverage_option(wizard_applicant.Applicant.ChildType,rec_data.coverages.children);processed_recommendations.push(new RecommendationSet(rec_data.name,[new Recommendation(rec_data.name,wizard_applicant.Applicant.EmployeeType,emp_option,this.product),new Recommendation(rec_data.name,wizard_applicant.Applicant.SpouseType,sp_option,this.product),new Recommendation(rec_data.name,wizard_applicant.Applicant.ChildType,ch_option,this.product)]));},this);return processed_recommendations;},find_applicant_coverage_option:function(applicant_type,coverage_amount){if(!coverage_amount){return new NullCoverageOption();}
var option=_.find(this.applicant_coverage_options[applicant_type](),function(opt){return opt.face_value===parseInt(coverage_amount);});if(option){return option;}else{return new NullCoverageOption();}},get_coverage_options_observable_for_applicant:function(applicant){return this.applicant_coverage_options[applicant.type];},_get_employee_options:function(){return this._get_applicant_type_options(wizard_applicant.Applicant.EmployeeType);},_get_spouse_options:function(){return this._get_applicant_type_options(wizard_applicant.Applicant.SpouseType);},_get_children_options:function(){return this._get_applicant_type_options(wizard_applicant.Applicant.ChildType);},_get_applicant_type_options:function(applicant_type){if(this.product.does_override_rate_options(applicant_type)){var all_options=this._get_all_options_by_applicant_type(applicant_type);return this.product.filter_coverage_options_for_applicant_type(all_options,applicant_type);}
return this._get_all_options_by_applicant_type(applicant_type);},_get_all_options_by_applicant_type:function(applicant_type){return _.select(this.rates(),function(option){return option.applicant_type===applicant_type;})}};var rates_by_product_id={};function update_product_rates(products,payment_mode,applicant_list,error_callback,statecode,coverage_vm){is_loading_rates(true);var requests=_.map(products,function(product){var enabled_riders=coverage_vm.get_enabled_riders_for_product(product);var data=_build_rate_parameters(payment_mode,applicant_list,statecode,enabled_riders);var request=remote_service.get_product_rates(product.product_data.id,data);request.product_id=product.product_data.id;return request;});function process_product_rates(){var product_rate_response;for(var i=0;i<products.length;i++){if(products.length===1){product_rate_response=arguments[0];}else{product_rate_response=arguments[i][0];}
var product_rates=product_rate_response.data;var product=_.find(products,function(p){return p.product_data.id===product_rates.product_id;},this);var product_rates_viewmodel=get_or_create_product_rates_viewmodel(product);product_rates_viewmodel.update_rates_data(product_rates);}
is_loading_rates(false);}
$.when.apply($,requests).done(process_product_rates).fail(error_callback);}
function _build_rate_parameters(payment_mode,applicant_list,statecode,enabled_riders){var params={payment_mode:payment_mode.frequency,statecode:statecode,rider_codes:_.pluck(enabled_riders,"code")};return $.extend({},params,_build_applicant_parameters(applicant_list));}
function _build_applicant_parameters(applicant_list){return{employee:applicant_list.get_employee().serialize_data(),spouse:(applicant_list.has_valid_spouse())?applicant_list.get_spouse().serialize_data():null};}
function get_or_create_product_rates_viewmodel(product){var rates_vm;if(!(product.product_data.id in rates_by_product_id)){rates_vm=new ProductRatesVM(product);rates_by_product_id[product.product_data.id]=rates_vm;}else{rates_vm=rates_by_product_id[product.product_data.id];}
return rates_vm;}
function get_product_recommendations(product){var rates=get_or_create_product_rates_viewmodel(product);return rates.recommendations;}
function get_product_coverage_options_for_applicant(product,applicant){var rates=get_or_create_product_rates_viewmodel(product);return rates.get_coverage_options_observable_for_applicant(applicant);}
return{update_product_rates:update_product_rates,is_loading_rates:is_loading_rates,get_product_coverage_options_for_applicant:get_product_coverage_options_for_applicant,get_product_recommendations:get_product_recommendations};})();var wizard_products=(function(){function build_products(root,products){if(products.length==0){alert("Error: No products to enroll.");return null;}
var product_objects=_.map(products,function(product){return build_product(root,product);});return _.filter(product_objects,function(product){return product!==null;});}
function build_product(root,product_data){var base_type=product_data.base_product_type;var base_product;if(base_type==="FPPTI"){base_product=new FPPTIProduct(product_data);}else if(base_type==="FPPCI"){base_product=new FPPCIProduct(product_data);}else if(base_type==="Group CI"){base_product=new GroupCIProduct(root,product_data);}else if(base_type==="FPP-Gov"){base_product=new FPPGovProduct(product_data);}else if(base_type==="ACC"||base_type==="HI"){return null;}else{alert("Invalid product type '"+base_type+"'");base_product=new FPPTIProduct(product_data);}
return base_product;}
function Product(){}
Product.prototype={min_emp_age:function(){return 18;},max_emp_age:function(){return 70;},min_sp_age:function(){return 18;},max_sp_age:function(){return 70;},min_child_age:function(){return 0;},max_child_age:function(){return 23;},is_valid_employee:function(employee){var age=employee.get_age();return(age>=this.min_emp_age()&&age<=this.max_emp_age());},is_valid_spouse:function(spouse){var age=spouse.get_age();return(age>=this.min_sp_age()&&age<=this.max_sp_age());},is_valid_child:function(child){var age=child.get_age();return(age>=this.min_child_age()&&age<=this.max_child_age());},create_coverage_option:function(options){return new CoverageOption(options);},requires_gender:function(){return false;},requires_height:function(){return false;},requires_weight:function(){return false;},requires_is_smoker:function(){return false;},has_critical_illness_coverages:function(){return false;},get_maximum_coverage_amount:function(applicant){var options=product_rates_service.get_product_coverage_options_for_applicant(this,applicant)();if(options.length>0){return _.max(_.pluck(options,"face_value"));}
return 0;},does_override_rate_options:function(){return false;},should_show_other_insurance_questions:function(){return this.is_fpp_product();},should_show_step_5:function(){return true;},should_use_date_of_hire_for_identity:function(){return true;},is_fpp_product:function(){return true;},should_confirm_disclosure_notice:function(){return this.is_fpp_product();},should_confirm_payroll_deduction:function(){return this.is_fpp_product();},should_show_contingent_beneficiary:function(){return this.is_fpp_product();},get_replacement_paragraphs:function(){return[];},does_use_recommended_coverage_table:function(){return true;},requires_additional_information:function(){return this.requires_gender()||this.requires_height()||this.requires_weight()||this.requires_is_smoker();}};function ApplicantSelectionProduct(product_data){this.product_type=product_data.base_product_type;this.product_data=product_data;}
ApplicantSelectionProduct.prototype={does_use_recommended_coverage_table:function(){return false;}};function FPPTIProduct(product_data){this.product_type="FPPTI";this.product_data=product_data;}
FPPTIProduct.prototype=Object.create(Product.prototype);FPPTIProduct.prototype.get_replacement_paragraphs=function(){return this.product_data.replacement_paragraphs;};function FPPCIProduct(product_data){this.product_type="FPPCI";this.product_data=product_data;}
FPPCIProduct.prototype=Object.create(Product.prototype);FPPCIProduct.prototype.create_coverage_option=function(options){return new CICoverageOption(new CoverageOption(options));};FPPCIProduct.prototype.has_critical_illness_coverages=function(){return true;};FPPCIProduct.prototype.get_replacement_paragraphs=function(){return this.product_data.replacement_paragraphs;};function GroupCIProduct(root,product_data){var self=this;self.root=root;self.product_type="Group CI";self.product_data=product_data;self.employee_current_benefit_subscription=null;self.spouse_options_for_demographics=ko.observableArray([]);self.all_spouse_rate_options=ko.observableArray([]);self.all_posible_children_options=ko.observableArray([]);self.all_coverage_options={employee:ko.observableArray([]),spouse:ko.observableArray([]),children:ko.observableArray([])};self.does_override_rate_options=function(applicant_type){return(applicant_type===wizard_applicant.Applicant.EmployeeType||applicant_type===wizard_applicant.Applicant.SpouseType);};self.filter_coverage_options_for_applicant_type=function(all_options,applicant_type){if(applicant_type===wizard_applicant.Applicant.EmployeeType){return self.filter_employee_coverage_options(all_options);}else if(applicant_type===wizard_applicant.Applicant.SpouseType){return self.filter_spouse_coverage_options(all_options);}else{return self.filter_children_coverage_options(all_options);}};self.filter_employee_coverage_options=function(all_options){return self.filter_base_rate_options(all_options);};function get_employee_total_cumulative_coverage(){var emp_coverage_option=window.vm.coverage_vm.get_applicant_coverage_option_for_product(window.vm.employee(),self);var emp_existing_coverage_amount=window.vm.employee().get_existing_coverage_amount_for_product(self);var emp_current_coverage_amount=(emp_coverage_option.is_valid()?emp_coverage_option.face_value:0);return emp_existing_coverage_amount+emp_current_coverage_amount;}
function has_employee_selected_coverage(){var applicant_coverage=window.vm.coverage_vm.get_applicant_coverage_for_product(window.vm.employee(),self);return applicant_coverage.has_selected_coverage();}
function has_employee_answered_required_question_yes(){return false;}
self.filter_spouse_coverage_options=function(all_options){var base_options=self.filter_base_rate_options(all_options);if(!has_employee_selected_coverage()||has_employee_answered_required_question_yes()){return _.filter(base_options,function(o){return o.face_value<=25000;});}else{var limit=_.min([get_employee_total_cumulative_coverage()/2.0,25000]);var valid_options=_.filter(base_options,function(o){return o.face_value<=limit});self.append_halfway_coverage_option_if_needed(valid_options,limit,all_options);return valid_options;}};self.append_halfway_coverage_option_if_needed=function(valid_options,max_coverage_limit,all_options){if(valid_options.length&&valid_options[valid_options.length-1].face_value<max_coverage_limit){var half_opt=_.find(all_options,function(o){return o.face_value===max_coverage_limit});if(half_opt){valid_options.push(half_opt);}}};self.filter_children_coverage_options=function(all_options){var base_options=self.filter_base_rate_options(all_options);if(!has_employee_selected_coverage()||has_employee_answered_required_question_yes()){return _.filter(base_options,function(o){return o.face_value<=10000;});}else{var limit=_.min([get_employee_total_cumulative_coverage()/2.0,10000]);return _.filter(base_options,function(o){return o.face_value<=limit});}};self.filter_base_rate_options=function(all_options){return _.filter(all_options,function(o){return o.face_value%5000===0;});};}
GroupCIProduct.prototype=Object.create(Product.prototype);GroupCIProduct.prototype.is_valid_employee=function(employee){var age=employee.get_age();var valid=(age>=this.min_emp_age()&&age<=this.max_emp_age());valid&=employee.is_smoker()!=null;valid&=employee.has_valid_weight();valid&=employee.has_valid_height();valid&=employee.has_valid_gender();return valid;};GroupCIProduct.prototype.is_valid_spouse=function(spouse){var age=spouse.get_age();var valid=(age>=this.min_sp_age()&&age<=this.max_sp_age());valid&=spouse.is_smoker()!=null;valid&=spouse.has_valid_weight();valid&=spouse.has_valid_height();valid&=spouse.has_valid_gender();return valid;};GroupCIProduct.prototype.requires_gender=function(){return true;};GroupCIProduct.prototype.requires_height=function(){return true;};GroupCIProduct.prototype.requires_weight=function(){return true;};GroupCIProduct.prototype.requires_is_smoker=function(){return true;};GroupCIProduct.prototype.has_critical_illness_coverages=function(){return true;};GroupCIProduct.prototype.should_show_step_5=function(){return false;};GroupCIProduct.prototype.should_use_date_of_hire_for_identity=function(){return false;};GroupCIProduct.prototype.is_fpp_product=function(){return false;};function FPPGovProduct(product_data){this.product_type="FPP-Gov";this.product_data=product_data;}
FPPGovProduct.prototype=Object.create(Product.prototype);FPPGovProduct.prototype.requires_gender=function(){return false;};FPPGovProduct.prototype.requires_height=function(){return false;};FPPGovProduct.prototype.requires_weight=function(){return false;};FPPGovProduct.prototype.requires_is_smoker=function(){return false;};FPPGovProduct.prototype.has_critical_illness_coverages=function(){return false;};FPPGovProduct.prototype.get_replacement_paragraphs=function(){return this.product_data.replacement_paragraphs;};return{build_products:build_products};})();function RecommendationSet(name,recommendations){var self=this;self.name=name;self.recommendations=recommendations;self.get_applicant_recommendation=function(applicant_type){return _.find(self.recommendations,function(rec){return rec.applicant_type===applicant_type;})};self.get_recommended_applicant_coverage=function(applicant_type){var rec=self.get_applicant_recommendation(applicant_type);if(!rec){return new NullCoverageOption();}
return rec.recommended_coverage;};self.formatted_payment_mode=function(){if(self.recommendations.length===0){return"";}
if(!_.any(_.invoke(self.recommendations,"is_valid"))){return"";}
var valid_recommendation=_.find(self.recommendations,function(rec){return rec.is_valid()});return valid_recommendation.recommended_coverage.payment_mode().display_lowercase();};self.formatted_total_premium=function(){return format_premium_value(self.get_total_premium());};self.get_total_premium=function(){var total=0.0;_.each(self.recommendations,function(rec){total+=rec.get_total_premium();});return total;};}
function Recommendation(name,applicant_type,coverage_option,product){var self=this;self.name=name;self.applicant_type=applicant_type;self.recommended_coverage=coverage_option;self.product=product;self.is_valid=function(){return self.recommended_coverage.is_valid();};self.get_total_premium=function(){if(self.product.is_fpp_product()&&self.applicant_type===wizard_applicant.Applicant.ChildType){return self.recommended_coverage.premium*window.vm.coverage_vm.applicants.get_valid_children().length;}
return self.recommended_coverage.premium;};self.format_total_premium=function(){if(!self.recommended_coverage.is_valid()){return"";}
return format_premium_value(self.get_total_premium());};self.format_premium_option=function(){return self.recommended_coverage.format_premium_option()};self.format_coverage=function(){return self.recommended_coverage.format_face_value();};}
function NullRecommendation(name){var self=this;self.name=name;self.recommended_coverage=new NullCoverageOption();self.is_valid=function(){return false;};self.get_total_premium=function(){return 0.0;};self.format_premium_option=function(){return"";};self.format_total_premium=function(){return"";};self.format_coverage=function(){return"";};}
var remote_service=(function(){function get_product_rates(product_id,data){return $.ajax({url:"/products/"+product_id+"/rates",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",processData:false,data:JSON.stringify(data)});}
return{get_product_rates:get_product_rates};})();function ReplacementPolicy(){var self=this;self.name=ko.observable('');self.policy_number=ko.observable('');self.insured=ko.observable('');self.replaced_or_financing=ko.observable(null);self.replacement_reason=ko.observable("");self.serialize=function(){return{name:self.name(),policy_number:self.policy_number(),insured:self.insured(),replaced_or_financing:self.replaced_or_financing(),replacement_reason:self.replacement_reason()};};}
function submit_application(){window.vm.is_submitting(true);window.vm.submission_error("");var results=_.map(window.vm.coverage_vm.selected_product_coverages(),function(product_cov){return build_wizard_results_for_product_coverage(product_cov);});var please_wait_dialogue=bootbox.dialog({message:"Generating application form(s) for signature. Please wait, this make take a minute...",buttons:{}});_send_wizard_results(results);}
var POLL_WAIT=5000;var MAX_POLL_COUNT=25;var poll_count=0;function _send_wizard_results(wizard_results){ajax_post("/submit-wizard-data",{"wizard_results":wizard_results},function(resp){if(resp.error){window.vm.is_submitting(false);bootbox.dialog({message:"There was a problem generating the application form ("+resp.error+").  Please contact the enrollment system administrator.",buttons:{"success":{"label":"OK","className":"btn-sm btn-primary"}}});}else if(resp.redirect_url){window.location.href=resp.redirect_url}else{setTimeout(function(){poll_envelope_result(resp.poll_url,wizard_results);},POLL_WAIT);}},function(req){window.vm.is_submitting(false);handle_error_and_retry(req,wizard_results);},true);}
function poll_envelope_result(url,wizard_results){poll_count+=1;if(poll_count>MAX_POLL_COUNT){alert("Sorry, an error occurred generating the signature page. Please check your Agent Inbox to sign this application.");window.location.href=urls.get_manage_case_url(window.vm.options.case_data.id)+'#enrollment';}
$.get(url).success(function(resp){if(resp.status==='ready'||resp.status==='declined'){window.location.href=resp.redirect_url;}else{setTimeout(function(){poll_envelope_result(url,wizard_results);},POLL_WAIT);}}).error(function(resp){handle_error_and_retry(resp,wizard_results)})}
function handle_error_and_retry(resp,wizard_results){handle_remote_error_with_retry(resp,function retry_callback(success){if(success){_send_wizard_results(wizard_results);}});}
var SUBMISSION_RETRIES_ALLOWED=3;var submission_retry_count=0;function handle_remote_error_with_retry(response,retry_callback){window.vm.is_submitting(false);if(response.status===401){}else if(response.status===503){alert("Sorry, an error occurred communicating with the server. Please check your Agent Inbox to sign this application.");window.location=urls.get_manage_case_url(window.vm.options.case_data.id)+'#enrollment';}else if(response.status===500){alert("Sorry, the server encountered an error processing this request.");}else{alert("Sorry, an error occurred communicating with the server. Please check your connection to the internet and try again.");}}
function build_wizard_results_for_product_coverage(product_cov){var root=window.vm;var health_questions=vm.get_product_health_questions(product_cov);var did_decline=(root.coverage_vm.has_multiple_products())?product_cov.did_decline():root.did_decline();var wizard_results={product_id:product_cov.product.product_data.id,case_id:root.enrollment_case.id,enrollCity:root.enrollCity(),enrollState:root.enrollState(),payment_mode:root.coverage_vm.payment_mode().frequency,payment_mode_text:root.coverage_vm.payment_mode().label,method:(root.is_in_person_application())?'in_person':'self_enroll_email',did_decline:did_decline,identityToken:root.identityToken(),identityType:root.identityType(),employee:root.employee().serialize_data(),spouse:root.spouse().serialize_data(),is_spouse_address_same_as_employee:root.is_spouse_address_same_as_employee(),is_spouse_email_same_as_employee:root.is_spouse_email_same_as_employee(),employee_owner:product_cov.policy_owner(),employee_other_owner_name:product_cov.other_owner_name(),employee_other_owner_ssn:product_cov.other_owner_ssn(),spouse_owner:product_cov.spouse_policy_owner(),spouse_other_owner_name:product_cov.spouse_other_owner_name(),spouse_other_owner_ssn:product_cov.spouse_other_owner_ssn(),employee_beneficiary:product_cov.employee_beneficiary_type(),spouse_beneficiary:product_cov.spouse_beneficiary_type(),employee_contingent_beneficiary_type:product_cov.employee_contingent_beneficiary_type(),employee_contingent_beneficiary:product_cov.employee_contingent_beneficiary().serialize(),employee_beneficiary_name:product_cov.employee_other_beneficiary().name(),employee_beneficiary_relationship:product_cov.employee_other_beneficiary().relationship(),employee_beneficiary_ssn:product_cov.employee_other_beneficiary().ssn(),employee_beneficiary_dob:product_cov.employee_other_beneficiary().date_of_birth(),spouse_beneficiary_name:product_cov.spouse_other_beneficiary().name(),spouse_beneficiary_relationship:product_cov.spouse_other_beneficiary().relationship(),spouse_beneficiary_ssn:product_cov.spouse_other_beneficiary().ssn(),spouse_beneficiary_dob:product_cov.spouse_other_beneficiary().date_of_birth(),spouse_contingent_beneficiary_type:product_cov.spouse_contingent_beneficiary_type(),spouse_contingent_beneficiary:product_cov.spouse_contingent_beneficiary().serialize()};wizard_results.children=[];_.each(product_cov.get_covered_children(),function(child){wizard_results['children'].push(child.serialize_data());});if(did_decline){return wizard_results;}
wizard_results=$.extend({},wizard_results,{existing_insurance:root.existing_insurance(),replacing_insurance:root.replacing_insurance(),is_employee_actively_at_work:root.is_employee_actively_at_work(),has_spouse_been_treated_6_months:product_cov.has_spouse_been_treated_6_months(),has_spouse_been_disabled_6_months:product_cov.has_spouse_been_disabled_6_months(),});if(health_questions){wizard_results.employee_soh_questions=health_questions.serialize_answers_for_applicant(vm.employee());wizard_results.spouse_soh_questions=health_questions.serialize_answers_for_applicant(vm.spouse());}
if(!root.should_include_spouse_in_table()){wizard_results.employee_beneficiary="other";}
var emp_coverage=product_cov.__get_coverage_for_applicant(root.employee());if(emp_coverage.coverage_option().is_valid()){wizard_results['employee_coverage']=emp_coverage.coverage_option().serialize_data();}else{wizard_results['employee_coverage']=""}
var sp_benefit=product_cov.__get_coverage_for_applicant(root.spouse());if(sp_benefit.coverage_option().is_valid()){wizard_results['spouse_coverage']=sp_benefit.coverage_option().serialize_data();}else{wizard_results['spouse_coverage']=""}
wizard_results['child_coverages']=[];wizard_results['children_soh_questions']=[];_.each(product_cov.get_covered_children(),function(child){var coverage=product_cov.__get_coverage_for_applicant(child);wizard_results['child_coverages'].push(coverage.coverage_option().serialize_data());if(health_questions){var soh_questions=health_questions.serialize_answers_for_applicant(child);wizard_results['children_soh_questions'].push(soh_questions);}});wizard_results.replacement_read_aloud=root.replacement_read_aloud();wizard_results.replacement_is_terminating=root.replacement_is_terminating();wizard_results.replacement_using_funds=root.replacement_using_funds();wizard_results.replacement_policies=_.invoke(root.replacement_policies(),"serialize");wizard_results.rider_data=product_cov.selected_riders.serialize_data();return wizard_results;}
function submit_decline(){var root=window.vm;window.vm.is_submitting(true);window.vm.submission_error("");var results=_.map(root.product_coverage_viewmodels(),function(product_cov){return build_wizard_results_for_product_coverage(product_cov);});ajax_post("/submit-wizard-data",{"wizard_results":results},function(resp){if(resp.error){bootbox.dialog({message:"There was a problem submitting the form ("+resp.error+").  Please contact the enrollment system administrator.",buttons:{"success":{"label":"OK","className":"btn-sm btn-primary"}}});}else{location=resp.redirect;}},handle_remote_error,true);}
function init_validation(ui){$('[data-rel=tooltip]').tooltip();var validation_debug=false;$('#enrollment-wizard').ace_wizard().on('actionclicked.fu.wizard',function(e,info){if(validation_debug){return true;}
var is_valid;if(info.step===1){$("#health_questions_error").html("");if(ui.did_decline_all_products()){submit_decline();e.preventDefault();return;}
is_valid=ui.validator.form();if(!ui.is_coverage_selection_valid()){ui.show_no_selection_error();e.preventDefault();return;}
function validate_coverage_amount(applicant_coverage){var product_id=applicant_coverage.product.product_data.id;var product=applicant_coverage.product;var applicant=applicant_coverage.applicant;var existing_coverage_amount=applicant.get_existing_coverage_amount_for_product(product_id);if(!existing_coverage_amount){return true;}
var selected_option=applicant_coverage.get_selected_coverage();var applied_coverage_amount=(selected_option.is_valid())?selected_option.face_value:0;var max_coverage_amount=applicant_coverage.product.get_maximum_coverage_amount(applicant_coverage.applicant);var name=applicant.name();if(applied_coverage_amount>0&&existing_coverage_amount&&(max_coverage_amount<existing_coverage_amount+applied_coverage_amount)){var additional_allowed_coverage=max_coverage_amount-existing_coverage_amount;additional_allowed_coverage=_.max([0,additional_allowed_coverage]);var msg=("Due to one or more previous applications for "+product.product_data.name+" this enrollment period for "+
format_face_value(existing_coverage_amount)+" coverage, "+name+" can apply for a maximum of "+
format_face_value(additional_allowed_coverage)+" additional coverage.");alert(msg);return false;}
return true;}
_.each(ui.coverage_vm.selected_product_coverages(),function(product_coverage){_.each(product_coverage.applicant_coverage_selections(),function(applicant_coverage){var can_apply=validate_coverage_amount(applicant_coverage);if(!can_apply){is_valid=false;return false;}});if(!is_valid){return false;}});if(is_valid){$(document.body).scrollTop(0);}else{e.preventDefault();}}
if(info.step===2&&info.direction==='next'){var validator=ui.validators.step2;is_valid=validator.form();if(ui.did_select_any_fpp_product()&&(ui.should_show_replacement_form())){is_valid=$('#questions-form').valid()&&is_valid;}
if(ui.did_select_any_fpp_product()&&(ui.replacing_insurance()===null||ui.existing_insurance()===null)){is_valid=false;}
if(ui.did_select_any_fpp_product()&&ui.is_KY_OR_KS()&&ui.replacing_insurance()){is_valid=false;}
if(ui.did_select_any_fpp_product()&&ui.is_self_enroll()&&(ui.replacement_is_terminating()||ui.replacement_using_funds())){is_valid=false;}
is_valid=health_question_buttons.are_health_questions_valid()&&is_valid;if(!is_valid){$("#health_questions_error").html("Please answer all questions for all applicants.  Invalid responses may prevent you from continuing this online application; if so, please see your agent or enrollment professional.");e.preventDefault();return;}else{$("#health_questions_error").html("");}}
if(info.step===3&&info.direction==='next'){if(!$('#step3-form').valid()){e.preventDefault();return;}}
if(info.step===4&&info.direction==='next'){if(!$('#step4-form').valid()){e.preventDefault();return;}}
if(info.step===5&&info.direction==='next'){_.forEach(ui.coverage_vm.product_coverage_viewmodels(),function(product_coverage_vm){product_coverage_vm.employee_other_beneficiary().date_of_birth.valueHasMutated();if(product_coverage_vm.employee_contingent_beneficiary_type()==='other'){product_coverage_vm.employee_contingent_beneficiary().date_of_birth.valueHasMutated();}});var has_beneficiary_errors=_.any(ui.coverage_vm.product_coverage_viewmodels(),function has_beneficiary_errors(product_coverage_vm){if(product_coverage_vm.employee_contingent_beneficiary_type()==='other'){return!!product_coverage_vm.employee_other_beneficiary().date_of_birth_validation_error()||!!product_coverage_vm.employee_contingent_beneficiary().date_of_birth_validation_error();}
return!!product_coverage_vm.employee_other_beneficiary().date_of_birth_validation_error();});if(!$('#step5-form').valid()||has_beneficiary_errors){e.preventDefault();return;}
if(ui.has_contingent_beneficiary_error()){e.preventDefault();return;}}
if(info.step==6&&info.direction=='next'){if(!$('#step6-form').valid()){e.preventDefault();return;}}}).on('finished.fu.wizard',function(e){if(!$('#step6-form').valid())return false;if(ui.should_confirm_disclosure_notice()&&!ui.disclaimer_notice_confirmed()){bootbox.dialog({message:"Please confirm that you have received the disclosure notice.",buttons:{"danger":{"label":"OK","className":"btn-warning"}}});return false;}
if(ui.should_confirm_payroll_deduction()&&!ui.payroll_deductions_confirmed()){bootbox.dialog({message:"Please confirm that you agree to payroll deductions by your employer.",buttons:{"danger":{"label":"OK","className":"btn-warning"}}});return false;}
if(!ui.can_submit_wizard()){e.preventDefault();vm.submission_error("Please wait, the submission is still processing.");return false;}
submit_application();}).on('stepclick.fu.wizard',function(e){return true;});$.mask.definitions['~']='[+-]';$('#phone').mask('(999) 999-9999');$('#eeDOB').mask('99/99/1999');$('.input-mask-date').mask('99/99/9999');$('.input-mask-ssn').mask('999-99-9999');$('.input-mask-zip').mask('99999');jQuery.validator.addMethod("phone",function(value,element){return this.optional(element)||/^\(\d{3}\) \d{3}\-\d{4}( x\d{1,6})?$/.test(value);},"Enter a valid phone number.");var step_2_validator=$('#questions-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{replacement_read_aloud:{required:{depends:function(){return ui.is_replacement_form_required();}}},replacement_is_terminating:{required:{depends:function(){return ui.is_replacement_form_required();}}},replacement_using_funds:{required:{depends:function(){return ui.is_replacement_form_required();}}}},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});$.validator.addClassRules("replacement-question",{required:{depends:function(){return ui.is_replacement_form_required();}}});$.validator.addClassRules("replacement-details-input",{required:{depends:function(){return ui.should_show_replacement_details_form();}}});function isEmployeeOtherOwnerRequired(element){var product_coverage=ko.dataFor(element);return product_coverage.policy_owner()==="other";}
function isSpouseOtherOwnerRequired(element){var product_coverage=ko.dataFor(element);return product_coverage.spouse_policy_owner()==="other";}
$.validator.addClassRules("ee-other-owner-name",{required:{depends:function(element){return isEmployeeOtherOwnerRequired(element);}}});$.validator.addClassRules("ee-other-owner-ssn",{required:{depends:function(element){return isEmployeeOtherOwnerRequired(element);}}});$.validator.addClassRules("sp-other-owner-name",{required:{depends:function(element){return isSpouseOtherOwnerRequired(element);}}});$.validator.addClassRules("sp-other-owner-ssn",{required:{depends:function(element){return isSpouseOtherOwnerRequired(element);}}});$('#step3-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{email:{email:true,required:{depends:function(){return ui.is_self_enroll();}}},eeFName2:{required:true},eeLName2:{required:true},eeGender:{required:true},eessn:{required:true},eeStreet1:{required:true},eeCity:{required:true},eeState:{required:true},eeZip:{required:true},eeOwner:{required:true}},messages:{email:{email:"Please provide a valid email."},eeFName2:"required",eeLName2:"required",eeGender:"Please choose gender",eessn:"required",eeStreet1:"required",eeCity:"required",eeState:"required",eeZip:"required",eeOwner:"Please confirm policy owner"},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});$('#step4-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{spFName2:{required:true},spLName2:{required:true},spGender:{required:true},spssn:{required:{depends:function(element){return($("#spOwner-self").is(':checked'))}}},spOwner:{required:true}},messages:{spFName2:"required",spLName2:"required",spGender:"Please choose gender",spssn:"Spouse SSN required",spOwner:"Please confirm policy owner"},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});function is_other_beneficiary_detail_required(element,applicant_type,beneficiary_type){var product_coverage=ko.dataFor(element);if(beneficiary_type==="contingent"&&!product_coverage.should_show_contingent_beneficiary()){return false;}
if(applicant_type==="spouse"&&!ui.coverage_vm.did_select_spouse_coverage()){return false;}
if(applicant_type==="employee"){if(beneficiary_type==="primary"){return product_coverage.employee_beneficiary_type()==="other"||!ui.coverage_vm.did_select_spouse_coverage();}else{return product_coverage.employee_contingent_beneficiary_type()==="other";}}else if(applicant_type==='spouse'){if(beneficiary_type==="primary"){return product_coverage.spouse_beneficiary_type()==="other";}else{return product_coverage.spouse_contingent_beneficiary_type()==="other";}}}
var beneficiary_depends_rules={"ee-bene-name":function(el){return is_other_beneficiary_detail_required(el,'employee','primary')},"ee-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'employee','primary')},"ee-cont-bene-name":function(el){return is_other_beneficiary_detail_required(el,'employee','contingent')},"ee-cont-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'employee','contingent')},"sp-bene-name":function(el){return is_other_beneficiary_detail_required(el,'spouse','primary')},"sp-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'spouse','primary')},"sp-cont-bene-name":function(el){return is_other_beneficiary_detail_required(el,'spouse','contingent')},"sp-cont-bene-rel":function(el){return is_other_beneficiary_detail_required(el,'spouse','contingent')}};for(className in beneficiary_depends_rules){var depends_func=beneficiary_depends_rules[className];$.validator.addClassRules(className,{required:{depends:depends_func}})}
$('#step5-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});$('#step6-form').validate({errorElement:'div',errorClass:'help-block',focusInvalid:false,rules:{confirmDisclaimer:{required:true},enrollCity:{required:true},tokenType:{required:true},ConfirmationToken:{required:function(){return window.vm.should_use_date_of_hire_for_identity();}},hireDate:{required:true}},messages:{confirmDisclaimer:"please acknowledge that you have received the notice",enrollCity:"required",tokenType:"required",ConfirmationToken:"Valid date required"},highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement});}
function wizard_validate_highlight(e){$(e).closest('.form-group').removeClass('has-info').addClass('has-error');}
function wizard_validate_success(e){$(e).closest('.form-group').removeClass('has-error').addClass('has-info');$(e).remove();}
function wizard_error_placement(error,element){if(element.is(':checkbox')||element.is(':radio')){var controls=element.closest('div[class*="col-"]');if(controls.find(':checkbox,:radio').length>1)controls.append(error);else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));}
else if(element.is('.select2')){error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));}
else if(element.is('.chosen-select')){error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));}else if(element.closest('.form-group').length>0){error.appendTo(element.closest('.form-group'));}
else error.insertAfter(element);}
function step_two_error_placement(error,element){'use strict';if((element.is('[name="height_feet_0"]')||element.is('[name="height_inches_0"]')||element.is('[name="weight_0"]'))&&$('#weight_0-error').length===0&&$('#height_feet_0-error').length===0&&$('#height_inches_0-error').length===0){error.appendTo($('#employee-height-weight'));}else if((element.is('[name="height_feet_1"]')||element.is('[name="height_inches_1"]')||element.is('[name="weight_1"]'))&&$('#weight_1-error').length===0&&$('#height_feet_1-error').length===0&&$('#height_inches_1-error').length===0){error.appendTo($('#spouse-height-weight'));}else if(element.is('[name="tobacco-0"]')||element.is('[name="tobacco-1"]')||element.is('[name="gender-0"]')||element.is('[name="gender-1"]')){error.appendTo(element.parent().parent());}}
var wizard_viewmodel=(function(){ko.bindingHandlers.wizard={init:function(element,val_accessor){var val=val_accessor();val($(element).ace_wizard());$(element).wizard('selectedItem',{step:1});}};function CoverageVM(available_products,applicant_list,case_data,all_payment_modes,should_include_spouse,should_include_children,root){this.products=available_products;this.applicants=applicant_list;this.should_include_spouse=should_include_spouse;this.should_include_children=should_include_children;this.root=root;this.multiproduct_wizard_widget=ko.observable(null);this.applicants_in_table=ko.computed(function(){var applicants_in_table=[];if(this.applicants.has_valid_employee()){applicants_in_table.push(this.applicants.get_employee());}
if(this.applicants.has_valid_spouse()&&this.should_include_spouse()){applicants_in_table.push(this.applicants.get_spouse());}
if(this.applicants.has_valid_children()&&this.should_include_children()){_.each(this.applicants.get_children(),function(c){if(c.any_valid_field()){applicants_in_table.push(c);}});}
return applicants_in_table;},this);this.payment_modes=_.map(all_payment_modes||[],function(pm){return payment_mode_module.create_payment_mode(pm);});this.payment_mode=ko.observable(payment_mode_module.select_initial_payment_mode(case_data,this.payment_modes));this.can_change_payment_mode=ko.computed(function(){return payment_mode_module.can_change_payment_mode(case_data);});this.is_payment_mode_valid=ko.pureComputed(this._is_payment_mode_valid,this);this.product_coverage_viewmodels=ko.observableArray(_.map(this.products,function(p){return new ProductCoverageViewModel(p,case_data,applicant_list,this.payment_mode,this.should_include_spouse,this.should_include_children,this.root);},this));this.current_product=ko.observable(this.product_coverage_viewmodels()[0]);this.select_product=function(product_coverage){this.current_product(product_coverage);}.bind(this);this.has_multiple_products=ko.pureComputed(function(){return this.product_coverage_viewmodels().length>1;},this);this.previous_product=ko.pureComputed(function(){var index=this.product_coverage_viewmodels().indexOf(this.current_product());return val_or_null(this.product_coverage_viewmodels(),index-1);},this);this.next_product=ko.pureComputed(function(){var index=this.product_coverage_viewmodels().indexOf(this.current_product());return val_or_null(this.product_coverage_viewmodels(),index+1);},this);function val_or_null(array,index){if(index>=0&&index<array.length){return array[index];}
return null;}
this.coverage_summary_vm=new CoverageSummaryVM(this.product_coverage_viewmodels,this.applicants);var self=this;this.selected_product_coverages=ko.pureComputed(function(){return _.select(self.product_coverage_viewmodels(),function(prod_cov){return prod_cov.did_select_coverage();});},this);self.did_select_employee_coverage=ko.pureComputed(function(){return _.any(self.selected_product_coverages(),function(cov){return cov.did_select_employee_coverage();});});self.did_select_spouse_coverage=ko.pureComputed(function(){return _.any(self.selected_product_coverages(),function(cov){return cov.did_select_spouse_coverage();});});self.did_select_children_coverage=ko.pureComputed(function(){return _.any(self.selected_product_coverages(),function(cov){return cov.did_select_children_coverage();});});self.get_covered_children=ko.pureComputed(function(){var children=[];_.each(self.selected_product_coverages(),function(cov){_.each(cov.get_covered_children(),function(child){if(_.includes(children,child)){return;}
children.push(child);});});return children;});}
CoverageVM.prototype={_is_payment_mode_valid:function(){return((!this.can_change_payment_mode())||(this.can_change_payment_mode()&&this.payment_mode()!=null));},get_applicant_coverage_option_for_product:function(applicant,product){if(applicant.type==wizard_applicant.Applicant.SpouseType&&!this.should_include_spouse()){return new NullCoverageOption();}
if(applicant.type==wizard_applicant.Applicant.ChildType&&!this.should_include_children()){return new NullCoverageOption();}
var applicant_coverage_selection=this.get_applicant_coverage_for_product(applicant,product);return applicant_coverage_selection.get_selected_coverage();},get_applicant_coverage_for_product:function(applicant,product){var product_coverage=this.get_product_coverage(product);return product_coverage.get_coverage_for_applicant(applicant);},format_total_premium_for_product:function(product){var product_coverage=this.get_product_coverage(product);var total=product_coverage.get_total_premium();return format_premium_value(total);},get_enabled_riders_for_product:function(product){return this.get_product_coverage(product).enabled_riders;},format_total_premium_for_applicant:function(applicant){var applicant_total=0.0;_.each(this.product_coverage_viewmodels(),function(pcov){if(pcov.did_decline()){return true;}
var matching_applicant_coverage=_.find(pcov.valid_applicant_coverage_selections(),function(app_cov){return app_cov.applicant===applicant;});if(!matching_applicant_coverage){return format_premium_value(0.0);}
applicant_total+=matching_applicant_coverage.get_total_premium();});return format_premium_value(applicant_total);},format_grand_total_premium:function(){var grand_total=0.0;_.each(this.product_coverage_viewmodels(),function(pcov){if(pcov.did_decline()){return true;}
grand_total+=pcov.get_total_premium();});return format_premium_value(grand_total);},get_product_coverage:function(product){return _.find(this.product_coverage_viewmodels(),function(pcov){return pcov.product.product_data.id===product.product_data.id;});},go_to_next_product:function(){if(this.next_product()){this.current_product(this.next_product());}},go_to_previous_product:function(){if(this.previous_product()){this.current_product(this.previous_product());}}};function ProductCoverageViewModel(product,case_data,applicant_list,payment_mode,should_include_spouse,should_include_children,root){var self=this;self.product=product;self.case_data=case_data;self.payment_mode=payment_mode;self.applicant_list=applicant_list;self.should_include_spouse=should_include_spouse;self.should_include_children=should_include_children;self.root=root;self.did_decline=ko.observable(false);self.available_recommendations=product_rates_service.get_product_recommendations(self.product,payment_mode);self.selected_recommendation=ko.observable(null);self._applicant_coverage_viewmodels={};self.applicant_coverage_selections=ko.computed(this._get_applicant_coverage_selections,this);self.get_coverage_options_for_applicant=function(applicant){return _.find(self.applicant_coverage_selections(),function(cov){return cov.applicant.type===applicant.type;}).get_coverage_options();};self.has_completed_selection=ko.computed(this._has_completed_selection,this);self.did_select_coverage=ko.pureComputed(function(){return self.has_completed_selection()&&!self.did_decline();},this);self.did_select_valid_coverage=ko.pureComputed(function(){return self.did_select_coverage()&&(self.did_select_employee_coverage()||self.did_select_spouse_coverage()||self.did_select_children_coverage());});self.did_select_employee_coverage=ko.pureComputed(function(){return _.any(self.valid_applicant_coverage_selections(),function(cov){return cov.applicant.type==wizard_applicant.Applicant.EmployeeType&&cov.coverage_option().is_valid();});});self.did_select_spouse_coverage=ko.pureComputed(function(){return _.any(self.valid_applicant_coverage_selections(),function(cov){return cov.applicant.type==wizard_applicant.Applicant.SpouseType&&cov.coverage_option().is_valid();});});self.did_select_children_coverage=ko.pureComputed(function(){return _.any(self.valid_applicant_coverage_selections(),function(cov){return cov.applicant.type==wizard_applicant.Applicant.ChildType&&cov.coverage_option().is_valid();});});self.get_covered_children=ko.computed(function(){return self._get_covered_children();});function is_rider_enabled_for_case(rider,case_data){return _.any(case_data.product_settings.riders,function(r){return(self.product.product_data.id===r.product_id&&rider.code===r.rider_code&&r.is_selected);});}
self.enabled_riders=_.select(product.product_data.riders,function(r){return is_rider_enabled_for_case(r,case_data);});self.shown_rider=ko.observable(null);self.rider_options=[];_.each([self.applicant_list.get_employee(),self.applicant_list.get_spouse()],function(applicant){_.each(self.enabled_riders,function(rider){var vm=new ApplicantRiderOptionVM(self,rider,applicant);self.rider_options.push(vm);});});self.visible_rider_options=ko.computed(function(){return _.select(self.rider_options,function(option){return option.is_visible()});});self.selected_riders=ko.computed(function(){var selected_emp_riders=_.select(self.visible_rider_options(),function(option){return option.applicant===self.applicant_list.get_employee()&&option.is_selected();});var selected_sp_riders=_.select(self.visible_rider_options(),function(option){return option.applicant===self.applicant_list.get_spouse()&&option.is_selected();});return{emp:_.pluck(selected_emp_riders,'rider'),sp:_.pluck(selected_sp_riders,'rider')};});self.selected_riders.serialize_data=ko.computed(function(){return{emp:self.selected_riders().emp,sp:self.selected_riders().sp};});self.get_selected_riders=function(person){if(person.applicant_type==="employee"){return self.selected_riders().emp;}else if(person.applicant_type==="spouse"){return self.selected_riders().sp;}
return[];};self.policy_owner=ko.observable("self");self.other_owner_name=ko.observable("");self.other_owner_ssn=ko.observable("");self.spouse_policy_owner=ko.observable("employee");self.spouse_other_owner_name=ko.observable("");self.spouse_other_owner_ssn=ko.observable("");self.employee_beneficiary_type=ko.observable("spouse");self.employee_other_beneficiary=ko.observable(new beneficiary.Beneficiary());self.employee_contingent_beneficiary_type=ko.observable("none");self.employee_contingent_beneficiary=ko.observable(new beneficiary.Beneficiary());self.spouse_beneficiary_type=ko.observable("spouse");self.spouse_other_beneficiary=ko.observable(new beneficiary.Beneficiary());self.spouse_contingent_beneficiary_type=ko.observable("none");self.spouse_contingent_beneficiary=ko.observable(new beneficiary.Beneficiary());self.is_employee_beneficiary_info_required=function(){return!self.did_select_spouse_coverage()||$("#eeBeneOther").is(':checked')};self.should_show_contingent_beneficiary=function(){return self.product.should_show_contingent_beneficiary();};self.has_contingent_beneficiary_error=ko.computed(function(){var employee_beneficiary_error=(self.employee_contingent_beneficiary_type()==='spouse'&&self.employee_beneficiary_type()==='spouse');var spouse_beneficiary_error=(self.did_select_spouse_coverage()&&self.should_show_contingent_beneficiary()&&self.spouse_contingent_beneficiary_type()==='spouse'&&self.spouse_beneficiary_type()==='spouse');return(self.should_show_contingent_beneficiary()&&(employee_beneficiary_error||spouse_beneficiary_error));});self.has_spouse_been_treated_6_months=ko.pureComputed(function(){return _find_answer_for_spouse_question_with_label("Spouse Treated 6 Months");});self.has_spouse_been_disabled_6_months=ko.pureComputed(function(){return _find_answer_for_spouse_question_with_label("Spouse Disabled 6 Months");});function _find_answer_for_spouse_question_with_label(lbl){if(!self.did_select_spouse_coverage()){return null;}
var product_questions=self.root.get_product_health_questions(self);var spouse_question=_.find(product_questions.health_questions(),function(q){return q.get_question_label()===lbl;});if(!spouse_question){return null;}
if(spouse_question.can_spouse_skip_due_to_GI()){return"GI";}
var spouse_answer=product_questions.get_applicant_answer_for_question(self.root.spouse(),spouse_question);return spouse_answer.value();}}
ProductCoverageViewModel.prototype={format_product_name:function(){return this.product.product_data.name;},get_coverage_selection_template:function(){if(this.product.does_use_recommended_coverage_table()){return'recommendation_coverage_selection';}else{return'category_coverage_selection';}},select_recommended_coverage:function(recommendation_set){this.selected_recommendation(recommendation_set);_.each(this.valid_applicant_coverage_selections(),function(applicant_coverage){applicant_coverage.select_recommended_coverage(recommendation_set);},this);},_has_completed_selection:function(){if(this.did_decline()){return true;}
return _.all(this.valid_applicant_coverage_selections(),function(applicant_coverage){return applicant_coverage.did_select_option();},this);},_get_applicant_coverage_selections:function(){var selections=[];if(this.applicant_list.has_valid_employee()){selections.push(this.__get_coverage_for_applicant(this.applicant_list.get_employee()));}
if(this.applicant_list.has_valid_spouse()&&this.should_include_spouse()){selections.push(this.__get_coverage_for_applicant(this.applicant_list.get_spouse()));}
if(this.applicant_list.has_valid_children()&&this.should_include_children()){selections.push(this.__get_coverage_for_applicant(this.applicant_list.get_children_group()));}
return selections;},valid_applicant_coverage_selections:function(){return _.filter(this.applicant_coverage_selections(),function(acov){var applicant=acov.applicant;return((applicant.type===wizard_applicant.Applicant.EmployeeType&&this.applicant_list.has_valid_employee())||(applicant.type===wizard_applicant.Applicant.SpouseType&&(this.applicant_list.has_valid_spouse()&&this.should_include_spouse()))||(applicant.type===wizard_applicant.Applicant.ChildType&&(this.applicant_list.has_valid_children()&&this.should_include_children())))},this);},get_coverage_for_applicant:function(applicant){return this.__get_coverage_for_applicant(applicant);},__get_coverage_for_applicant:function(applicant){if(applicant.type===wizard_applicant.Applicant.ChildType){applicant=this.applicant_list.get_children_group();}
var applicant_coverage;if(applicant._id in this._applicant_coverage_viewmodels){applicant_coverage=this._applicant_coverage_viewmodels[applicant._id];}else{var new_selection_instance=new ApplicantCoverageSelectionVM(applicant,this);this._applicant_coverage_viewmodels[applicant._id]=new_selection_instance;applicant_coverage=new_selection_instance;}
return applicant_coverage;},_get_covered_children:function(){var coverage=this.get_coverage_for_applicant(this.applicant_list.get_children_group());if(coverage.coverage_option().is_valid()){return _.filter(this.applicant_list.get_children(),function(child){return child.is_valid();});}else{return[];}},get_total_premium:function(){var total=0.0;if(this.did_decline()){return total;}
_.each(this.applicant_coverage_selections(),function(applicant_coverage){total+=applicant_coverage.get_total_premium();},this);return total;}};function ApplicantCoverageSelectionVM(applicant,product_coverage){this.applicant=applicant;this.product_coverage=product_coverage;this.product=product_coverage.product;this.customized_coverage_option=ko.observable(null);this.recommended_coverage_option=ko.observable(null);this.coverage_option=ko.computed(function(){if(!this.applicant.is_valid()){return new NullCoverageOption();}else if(this.applicant.type===wizard_applicant.Applicant.SpouseType&&!this.product_coverage.root.should_include_spouse_in_table()){return new NullCoverageOption();}else if(this.applicant.type===wizard_applicant.Applicant.ChildType&&!this.product_coverage.root.should_include_children_in_table()){return new NullCoverageOption();}
var custom_option=this.customized_coverage_option();var recommended_option=this.recommended_coverage_option();if(custom_option){return custom_option;}else if(recommended_option){return recommended_option;}else{return new NullCoverageOption();}},this);this.did_select_option=ko.pureComputed(function(){return(this.customized_coverage_option()!==null&&this.customized_coverage_option()!==undefined)||this.recommended_coverage_option()!==null;},this);this.riders=ko.observableArray();this.beneficiaries=ko.observableArray([]);this.get_coverage_options=ko.pureComputed(this._get_coverage_options,this);}
ApplicantCoverageSelectionVM.prototype={select_recommended_coverage:function(recommendation_set){if(!recommendation_set){this.recommended_coverage_option(null);this.customized_coverage_option(null);return;}
var coverage_option=recommendation_set.get_recommended_applicant_coverage(this.applicant.type);if(coverage_option){this.recommended_coverage_option(coverage_option);this.customized_coverage_option(null);}},select_custom_coverage:function(option){this.customized_coverage_option(option);},has_selected_coverage:function(){return this.coverage_option().is_valid();},get_selected_coverage:function(){return this.coverage_option();},get_cumulative_coverage_amount:function(){var previous_coverage_amount=this.applicant.get_existing_coverage_amount_for_product(this.product.product_data.id);var current_coverage_amount=(this.has_selected_coverage()?this.coverage_option().face_value:0);return previous_coverage_amount+current_coverage_amount;},format_name:function(){return this.applicant.name();},_get_coverage_options:function(){var options=[new NullCoverageOption()];options=$.merge(options,product_rates_service.get_product_coverage_options_for_applicant(this.product,this.applicant)());return options;},format_recommendation_coverage:function(recommendation_set){var coverage=recommendation_set.get_recommended_applicant_coverage(this.applicant.type);return coverage.format_face_value();},format_recommendation_premium:function(recommendation_set){var recommendation=recommendation_set.get_applicant_recommendation(this.applicant.type);return recommendation.format_total_premium();},format_selected_coverage:function(){return this.get_selected_coverage().format_face_value();},format_selected_premium:function(){if(this.applicant.type==wizard_applicant.Applicant.ChildType&&this.product_coverage.product.is_fpp_product()&&this.has_selected_coverage()){var premium=this.get_selected_coverage().get_total_premium()*window.vm.coverage_vm.applicants.get_valid_children().length;return format_premium_value(premium);}
return this.get_selected_coverage().format_premium_option();},get_total_premium:function(){if(this.applicant.type===wizard_applicant.Applicant.ChildType&&this.product.is_fpp_product()){return this.coverage_option().premium*this.applicant.applicants().length;}
return this.coverage_option().premium;},get_previous_coverage_amount:function(){return this.applicant.get_existing_coverage_amount_for_product(this.product.product_data.id);}};function CoverageSummaryVM(product_coverages,applicant_list){this.product_coverages=product_coverages;this.applicant_list=applicant_list;this.product_names=ko.pureComputed(function(){return _.map(this.product_coverages(),function(pcov){return pcov.product.format_product_name();});},this);this.valid_applicants=ko.pureComputed(function(){return this.applicant_list.get_valid_applicants_for_coverage();},this);this.all_coverages=ko.computed(function(){var _coverages=[];_.each(this.product_coverages(),function(pcov){_.each(pcov.valid_applicant_coverage_selections(),function(app_cov){_coverages.push(app_cov);});});return _coverages;},this);}
function ApplicantRiderOptionVM(root,rider,applicant){var self=this;self.MAX_COVERAGE=150000;self.root=root;self.rider=rider;self.applicant=applicant;self._user_selection=ko.observable(false);self.can_user_select=ko.computed(function(){return self.rider.code==='AIR';});self.is_visible=ko.computed(function(){return self.root.get_coverage_for_applicant(self.applicant).has_selected_coverage();});self.is_selected=ko.computed({read:function(){if(self.can_user_select()){return self._user_selection();}else{return self.is_visible();}},write:function(val){self._user_selection(val);}});self.format_rider_name=function(){return self.rider.user_facing_name;};self.format_applicant_name=function(){return self.applicant.name();};self.has_rider_modal=function(){return(self.rider.code==="AIR"||self.rider.code==="QOL3"||self.rider.code==="QOL4"||self.rider.code==="WP");};self.show_rider_info=function(){self.root.shown_rider(self);switch(self.rider.code){case"AIR":$("#modal-auto-increase-rider").modal('show');break;case"WP":$("#modal-wop-rider").modal('show');break;case"QOL3":$("#modal-qol3-rider").modal('show');break;case"QOL4":$("#modal-qol4-rider").modal('show');break;}};self.get_policy_years=function(){var policy_years=[];for(var year=2;year<=6;year++){if(self.get_age_for_policy_year(year)<=70&&self.get_total_coverage_for_year(year)<self.MAX_COVERAGE){policy_years.push(year);}}
return policy_years;};self.get_age_for_policy_year=function(n){return self.applicant.get_age()+n-1;};self.format_coverage_for_year=function(n){var coverage=self.get_coverage_for_year(n);return format_face_value(coverage);};self.format_total_coverage_for_year=function(n){var coverage=self.get_total_coverage_for_year(n);return format_face_value(coverage);};self.format_coverage_for_policy=function(){var coverage=0;var years=self.get_policy_years();for(i=0;i<years.length;i++){coverage+=self.get_coverage_for_year(years[i]);}
return format_face_value(coverage);};self.get_coverage_for_year=function(n){var age=self.get_age_for_policy_year(n);return self.get_coverage_for_applicant_age(age);};self.get_total_coverage_for_year=function(n){var additional_coverage=self.get_coverage_for_year(n);if(n==2){var selected_coverage=parseInt(self.root.get_coverage_for_applicant(self.applicant).coverage_option().face_value);return selected_coverage+additional_coverage;}
var total_coverage_last_year=self.get_total_coverage_for_year(n-1);return additional_coverage+total_coverage_last_year;};self.get_coverage_for_applicant_age=function(n){var _coverage_values={18:'15339',19:'15339',20:'15339',21:'15339',22:'15339',23:'15339',24:'15339',25:'15339',26:'15249',27:'14986',28:'14566',29:'13978',30:'13299',31:'12621',32:'11954',33:'11280',34:'10612',35:'9962',36:'9336',37:'8739',38:'8176',39:'7636',40:'7123',41:'6624',42:'6154',43:'5727',44:'5339',45:'4986',46:'4668',47:'4381',48:'4117',49:'3869',50:'3629',51:'3390',52:'3152',53:'2920',54:'2698',55:'2495',56:'2311',57:'2147',58:'2002',59:'1871',60:'1751',61:'1641',62:'1540',63:'1445',64:'1353',65:'1264',66:'1174',67:'1085',68:'999',69:'917',70:'839'};return parseInt(_coverage_values[n]);};self.format_premium=function(){if(self.rider.code==="AIR"){return"No initial premium charge";}else{return"Included";}};}
function WizardVM(options){var self=this;self.options=options;self.enrollment_case=options.case_data;self.products=wizard_products.build_products(self,options.products);self.is_rate_table_loading=product_rates_service.is_loading_rates;self.is_show_rates_clicked=ko.observable(false);init_applicants();init_jquery_validator();self.set_wizard_step=function(step_number){var wizard=$('#enrollment-wizard').data('fu.wizard');wizard.currentStep=step_number;wizard.setState();};self.get_wizard_step=function(){var wizard=$('#enrollment-wizard').data('fu.wizard');return wizard.currentStep;};self.should_include_spouse_in_table=ko.computed(function(){return self.should_show_spouse()&&self.spouse().is_valid();});self.should_include_children_in_table=ko.computed(function(){return(self.should_include_children()&&self.applicant_list.has_valid_children());});self.coverage_vm=new CoverageVM(self.products,self.applicant_list,options.case_data,options.payment_modes,self.should_show_spouse,self.should_include_children,self);self.product_coverage_viewmodels=self.coverage_vm.product_coverage_viewmodels;self.add_child=function(){var child=wizard_applicant.create_applicant({last:self.employee().last(),type:wizard_applicant.Applicant.ChildType});self.applicant_list.add_applicant(child);};self.remove_child=function(child){self.applicant_list.remove_applicant(child);if(self.applicant_list.get_children().length===0){self.should_include_children(false);}};self.rendered_child=function(element){$(element).hide().slideDown(400);};self.removing_child=function(element){$(element).slideUp(function(){$(element).remove();});};self.is_recommended_table_visible=ko.computed(function(){return(self.is_show_rates_clicked()&&self.can_display_rates_table());});self.is_applicant_editor_visible=ko.pureComputed(function(){return!self.is_recommended_table_visible();});self.update_rate_table=function(){if(self.validator){self.validator.resetForm();}
self.is_show_rates_clicked(true);if(!self.is_recommended_table_visible()){return;}
self.refresh_rate_table();};self.refresh_rate_table=function(){var products_to_fetch=_.chain(self.product_coverage_viewmodels()).filter(function(product_coverage_view_model){return!product_coverage_view_model.did_decline();}).map(function(product_coverage_view_model){return product_coverage_view_model.product;}).value();product_rates_service.update_product_rates(products_to_fetch,self.coverage_vm.payment_mode(),self.applicant_list,self.handle_update_rates_error,self.enrollment_case.situs_state,self.coverage_vm);};self.handle_update_rates_error=function(resp){if(resp.status===400&&resp.responseJSON&&resp.responseJSON.errors){$.each(resp.responseJSON.errors,function(error){var field_name=this.field;var message=this.error;self.limit_error_lookup[field_name](true);self.validator.form();});if(self.get_wizard_step&&self.get_wizard_step()===2){var product_id=resp.product_id;if(!product_id){return;}
var employee_height_error=_.find(resp.responseJSON.errors,function(error){return error.field==='employee_height';});var employee_weight_error=_.find(resp.responseJSON.errors,function(error){return error.field==='employee_weight';});var spouse_height_error=_.find(resp.responseJSON.errors,function(error){return error.field==='spouse_height';});var spouse_weight_error=_.find(resp.responseJSON.errors,function(error){return error.field==='spouse_weight';});var applicant;if(employee_height_error||employee_weight_error){applicant=self.employee();}
if(spouse_height_error||spouse_weight_error){applicant=self.spouse();}
if(!applicant){return;}
var product=_.find(self.products,function(product){return product.product_data.id===product_id;});var health_questions_vm=_.find(self.selected_product_health_questions(),function(health_question_vm){return health_question_vm.product_coverage.product.product_data.id===product_id;});health_questions_vm.show_yes_dialogue(applicant,"This applicant is not within the height and weight"+" requirements for '"+product.product_data.name+"'. You may proceed with this application after"+" removing this individual from the coverage selection before proceeding.");self.validators.step2.resetForm();self.validators.step2.form();self.show_height_weight_dialog_if_invalid();}}else{handle_remote_error(resp,function(){});}};function show_height_weight_error(product,applicant){var health_questions_vm=_.find(self.selected_product_health_questions(),function(health_question_vm){return health_question_vm.product_coverage.product.product_data.id===product.product_data.id;});health_questions_vm.show_yes_dialogue(applicant,"This applicant is not within the height and weight"+" requirements for '"+product.product_data.name+"'. You may proceed with this application after"+" removing this individual from the coverage selection before proceeding.");}
function get_row_for_height(table,height){return _.find(table,function(row){return row.height===height;});}
function is_applicant_height_valid(product_tables,product,applicant){if(!product_tables||!product||!applicant){return false;}
var result;var gender=applicant.gender();var height=applicant.height();if(typeof height==='string'){height=parseInt(height);}
try{var gender_tables=product_tables[product.product_data.base_product_type];var table=gender_tables[gender];result=!!get_row_for_height(table,height);}catch(ignored){result=false;}
return result;}
function is_applicant_weight_valid(product_tables,product,applicant){if(!product_tables||!product||!applicant){return false;}
var result;var gender=applicant.gender();var height=applicant.height();var weight=applicant.weight();if(typeof height==='string'){height=parseInt(height);}
if(typeof weight==='string'){weight=parseInt(weight);}
try{var table=product_tables[product.product_data.base_product_type][gender];var row=get_row_for_height(table,height);result=weight>row.min_weight&&weight<row.max_weight;}catch(ignored){result=false;}
return result;}
self.show_height_weight_dialog_if_applicants_invalid=function(){var is_employee_invalid=_.any(self.products,function(product){return!is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.employee())&&product.requires_additional_information();});if(is_employee_invalid){show_height_weight_error(_.first(self.products,function(product){return product.requires_additional_information();}),self.employee());return;}
var is_spouse_invalid=_.any(self.products,function(product){return(self.should_show_spouse()&&!is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.spouse()))&&product.requires_additional_information();});if(is_spouse_invalid){show_height_weight_error(_.first(self.products,function(product){return product.requires_additional_information();}),self.spouse());}};var observables=[self.employee().height,self.employee().weight];if(self.should_show_spouse()){observables.push(self.spouse().height,self.spouse().weight);}
_.forEach(observables,function(observable){observable.subscribe(function(){self.show_height_weight_dialog_if_applicants_invalid();});});self.should_allow_grandchildren=ko.computed(function(){return!!self.products&&self.products.length===1&&_.some(self.products,function(product){return product.is_fpp_product();});});self.show_spouse_name=ko.computed(function(){return(self.should_include_spouse_in_table())?self.spouse().name():"";});self.has_show_rates_been_clicked=ko.observable(false);self.can_display_rates_table=ko.computed(function(){var is_employee_valid=self.applicant_list.has_valid_employee();var is_payment_valid=self.coverage_vm.is_payment_mode_valid();var has_limit_errors=self.any_limit_error();return is_employee_valid&&is_payment_valid&&!has_limit_errors;});self.show_coverage_selection_table=function(){$.each(self.limit_error_lookup,function(k,v){self.limit_error_lookup[k](null);});var valid_form=true;if(!self.can_display_rates_table()){valid_form=false;}
valid_form=self.validator.form()&&valid_form;if(valid_form){self.has_show_rates_been_clicked(true);self.update_rate_table();}};self.show_applicant_editor=function(){self.has_show_rates_been_clicked(false);self.is_show_rates_clicked(false);};self.is_coverage_selection_visible=ko.pureComputed(function(){return(self.has_show_rates_been_clicked()&&self.can_display_rates_table());});self.should_display_show_rates_button=ko.pureComputed(function(){return!self.is_coverage_selection_visible();});self.should_show_critical_illness_styling=function(){return false;};var any_product=function(method_name){return _.any(_.invoke(self.products,method_name));};var all_products=function(method_name){return _.all(_.invoke(self.products,method_name));};self.should_show_extended_questions=function(){return(any_product('requires_gender')||any_product('requires_height')||any_product('requires_weight')||any_product('requires_is_smoker'));};function requires_additional_employee_information(){return _.any(self.coverage_vm.product_coverage_viewmodels(),function(product_coverage_view_model){var product=product_coverage_view_model.product;var requires_additional_information=product.requires_gender()||product.requires_height()||product.requires_weight()||product.requires_is_smoker();return requires_additional_information&&product_coverage_view_model.did_select_employee_coverage();});}
function requires_additional_spouse_information(){if(!self.should_include_spouse_in_table()){return false;}
return _.any(self.coverage_vm.product_coverage_viewmodels(),function(product_coverage_view_model){var product=product_coverage_view_model.product;var requires_additional_information=product.requires_gender()||product.requires_height()||product.requires_weight()||product.requires_is_smoker();return requires_additional_information&&product_coverage_view_model.did_select_spouse_coverage();});}
self.requires_additional_employee_information=ko.computed(requires_additional_employee_information);self.requires_additional_spouse_information=ko.computed(requires_additional_spouse_information);self.requires_additional_information=ko.computed(function(){return self.requires_additional_employee_information()||self.requires_additional_spouse_information();});self.should_show_gender=function(){return any_product('requires_gender');};self.should_show_height=function(){return any_product('requires_height');};self.should_show_weight=function(){return any_product('requires_weight');};self.should_show_smoker=function(){return any_product('requires_is_smoker');};function min_emp_age(){return _.min(_.invoke(self.products,'min_emp_age'));}
function min_sp_age(){return _.min(_.invoke(self.products,'min_sp_age'));}
function min_ch_age(){return _.min(_.invoke(self.products,'min_child_age'));}
function max_emp_age(){return _.max(_.invoke(self.products,'max_emp_age'));}
function max_sp_age(){return _.max(_.invoke(self.products,'max_sp_age'));}
function max_ch_age(){return _.max(_.invoke(self.products,'max_child_age'));}
self.can_decline=ko.computed(function(){return(!_.any(self.product_coverage_viewmodels(),function(product_coverage){return _.any(self.applicant_list.applicants(),function(applicant){return _.any(applicant.existing_coverages,function(existing_coverage){return existing_coverage.product_id===product_coverage.product.id&&existing_coverage.coverage_status==='enrolled';});});}));});self.is_submitting=ko.observable(false);self.submission_error=ko.observable("");self.can_submit_wizard=ko.pureComputed(function(){return!self.is_submitting();});self.did_decline=ko.observable(false);self.did_decline_all_products=ko.pureComputed(function(){return self.did_decline()||_.all(self.product_coverage_viewmodels(),function(pcov){return pcov.did_decline();});});self.did_decline.subscribe(function(val){if(val){bootbox.dialog({message:"Please note that even after declining enrollment, you may still change your decision and elect to enroll at a later time, provided that your employer's enrollment period is still active.",buttons:{"success":{"label":"Close","className":"btn-sm btn-primary"}}});}});self.exit_application=function(){bootbox.dialog({message:"Are you sure you want to exit? All data on this application will be discarded.",buttons:{default:{label:"Cancel",className:"btn-default",callback:function(){}},danger:{label:"Exit application and discard data",className:"btn-danger",callback:function(){window.location.href="/enrollment-case/"+self.options.case_data.id+"#enrollment";}}}});};self.attempted_advance_step=ko.observable(false);self.is_selection_error_visible=ko.computed(function(){return self.attempted_advance_step()&&!self.is_coverage_selection_valid();});self.show_no_selection_error=function(){self.attempted_advance_step(true);};self.is_coverage_selection_valid=function(){return _.all(self.coverage_vm.product_coverage_viewmodels(),function(prod_cov){return prod_cov.did_select_valid_coverage()||prod_cov.did_decline();});};self.existing_insurance=ko.observable(null);self.replacing_insurance=ko.observable(null);self.is_employee_actively_at_work=ko.observable(null);self.selected_product_health_questions=ko.computed(function(){return _.map(self.coverage_vm.selected_product_coverages(),function(product_cov){return new health_questions.ProductHealthQuestions(product_cov,options.spouse_questions,options.health_questions);});});self.get_product_health_questions=function(product_coverage){return _.find(self.selected_product_health_questions(),function(phq){return phq.product_coverage===product_coverage;});};self.should_show_other_insurance_questions=ko.pureComputed(function(){return _.any(self.coverage_vm.selected_product_coverages(),function(product_cov){return product_cov.product.should_show_other_insurance_questions();});});self.get_replacement_paragraphs=function(){var paragraph_map={};_.each(self.coverage_vm.selected_product_coverages(),function(prod_cov){var paragraphs=prod_cov.product.get_replacement_paragraphs();$.extend(paragraph_map,paragraphs);});var paragraphs=paragraph_map[self.enrollment_case.situs_state];if(!paragraphs){return[];}
return paragraphs;};self.did_select_any_fpp_product=ko.pureComputed(function(){return _.find(self.coverage_vm.selected_product_coverages(),function(ps){return ps.product.is_fpp_product();});});self.NAIC_AND_MI=['AK','AL','AR','AZ','CO','IA','LA','MD','ME','MS','MT','NC','NE','NH','NJ','NM','OH','OR','RI','SC','TX','UT','VA','VT','WI','WV','MI'];self.is_NAIC_OR_MI=function(){return self.did_select_any_fpp_product()&&_.contains(self.NAIC_AND_MI,self.enrollment_case.situs_state);};self.is_KY_OR_KS=function(){return self.enrollment_case.situs_state=="KY"||self.enrollment_case.situs_state=="KS";};self.is_CT_DC_ND_VI=function(){return _.contains(['CT','DC','ND','VI'],self.enrollment_case.situs_state);};self.is_non_NAIC_other=function(){return!(self.is_NAIC_OR_MI()||self.is_KY_OR_KS()||self.is_CT_DC_ND_VI());};self.is_in_person_application=function(){return'is_in_person'in options&&options.is_in_person;};self.is_self_enroll=function(){return!self.is_in_person_application()};self.get_has_existing_question_highlight=function(){if(self.is_self_enroll()){return'flag';}
return"checkmark";};self.get_replacing_question_highlight=function(){if(self.is_KY_OR_KS()){return"stop";}
if(self.is_CT_DC_ND_VI()){return"checkmark";}
return'flag';};self.warning_modal_title=ko.observable("");self.warning_modal_body=ko.observable("");self.show_warning_modal=function(title,body){self.warning_modal_title(title);self.warning_modal_body(body);$("#warning_modal").modal('show');};var default_warning_body='STOP: A "yes" response to this question disqualifies you from completing this application in your state.';self.select_has_existing_insurance=function(){self.existing_insurance(true);};self.select_replacing_insurance=function(){self.replacing_insurance(true);if(!self.did_select_any_fpp_product()||self.is_KY_OR_KS()){self.show_warning_modal("Replacement Notice",default_warning_body);}};self.should_show_NAIC_replacement_notice=ko.computed(function(){return(self.is_NAIC_OR_MI()&&self.replacing_insurance()===false);});self.should_show_replacement_form=ko.computed(function(){if(!self.did_select_any_fpp_product()){return false;}
if(self.is_KY_OR_KS()||self.is_CT_DC_ND_VI()){return false;}
if(self.is_self_enroll()&&self.existing_insurance()){return true;}
if(self.should_show_NAIC_replacement_notice()){return false;}
return self.replacing_insurance();});self.replacement_read_aloud=ko.observable(false);self.replacement_is_terminating=ko.observable(null);self.replacement_using_funds=ko.observable(null);var self_enroll_stop_message="This response requires you to speak with your insurance representative directly, and prevents you from continuing enrollment at this time. You may cancel this enrollment session and contact your representative.";self.replacement_is_terminating.subscribe(function(){if(self.is_self_enroll()&&self.replacement_is_terminating()){self.show_warning_modal("Replacement Notice",self_enroll_stop_message);}});self.replacement_using_funds.subscribe(function(){if(self.is_self_enroll()&&self.replacement_using_funds()){self.show_warning_modal("Replacement Notice",self_enroll_stop_message);}});self.should_show_replacement_details_form=ko.pureComputed(function(){if(self.is_self_enroll()){return false;}
return self.replacement_using_funds()||self.replacement_is_terminating();});self.replacement_policies=ko.observableArray([new ReplacementPolicy()]);self.add_replacement_policy=function(){self.replacement_policies.push(new ReplacementPolicy());};self.remove_replacement_policy=function(policy){self.replacement_policies.remove(policy);};self.is_replacement_form_required=ko.computed(function(){return(self.did_select_any_fpp_product()&&(self.existing_insurance()||self.replacing_insurance()));});self.company_name=ko.observable(self.enrollment_case.company_name);self.is_spouse_address_same_as_employee=ko.observable(!self.spouse().address1()||(self.employee().address1()===self.spouse().address1()&&self.employee().address2()===self.spouse().address2()&&self.employee().city()===self.spouse().city()&&self.employee().state()===self.spouse().state()&&self.employee().zip()===self.spouse().zip()));self.is_spouse_email_same_as_employee=ko.observable((!self.spouse().email()||self.employee().email()===self.spouse().email()));self.should_show_step_5=function(){return _.any(self.coverage_vm.selected_product_coverages(),function(pcov){return pcov.product.should_show_step_5();})};self.should_show_contingent_beneficiary=function(){return _.any(_.invoke(self.products,"should_show_contingent_beneficiary"));};self.has_contingent_beneficiary_error=ko.computed(function(){return _.any(self.coverage_vm.selected_product_coverages(),function(prod_cov){return prod_cov.has_contingent_beneficiary_error();});});self.disclaimer_notice_confirmed=ko.observable(false);self.payroll_deductions_confirmed=ko.observable(false);self.identityToken=ko.observable("");self.identityType=ko.observable("");self.enrollState=ko.observable(self.enrollment_case.situs_state);self.enrollCity=ko.observable(self.enrollment_case.situs_city);self.should_confirm_disclosure_notice=ko.pureComputed(function(){return any_selected_product('should_confirm_disclosure_notice');});self.should_confirm_payroll_deduction=function(){return any_selected_product('should_confirm_payroll_deduction');};self.should_use_date_of_hire_for_identity=function(){return true;};function any_selected_product(method){var selected_products=_.pluck(self.coverage_vm.selected_product_coverages(),'product');return _.any(_.invoke(selected_products,method));}
function init_applicants(){var initial_applicant_list=_.map(options.applicants||[],function(applicant_data){return wizard_applicant.create_applicant(applicant_data);});self.should_show_spouse=ko.observable(false);self.should_include_children=ko.observable(false);self.applicant_list=new wizard_applicant.ApplicantList(initial_applicant_list,self.should_show_spouse,self.should_include_children);self.employee=function(){return self.applicant_list.get_employee();};self.spouse=function(){return self.applicant_list.get_spouse();};self.smoker_status_changed_dialog_loading=ko.observable(false);self.smoker_status_changed_message=ko.observable('');self.smoker_status_changed_messages=ko.observableArray([]);self.show_smoker_status_changed_dialog=function(value,old_value,applicant){$('#smoking-status-dialog').modal('show');var old_selected_coverage_options=_.chain(self.coverage_vm.product_coverage_viewmodels()).map(function(view_model){return view_model._get_applicant_coverage_selections();}).flatten().filter(function(applicant_coverage_vm){return applicant_coverage_vm.coverage_option().face_value>0&&applicant_coverage_vm.product_coverage.product.requires_is_smoker();}).value();self.smoker_status_changed_dialog_loading(true);self.refresh_rate_table();var subscription;subscription=self.is_rate_table_loading.subscribe(function(value){if(!!value){return;}
self.smoker_status_changed_dialog_loading(false);self.smoker_status_changed_messages.removeAll();if(subscription){subscription.dispose();subscription=null;}
_.forEach(old_selected_coverage_options,function(applicant_coverage_selection_view_model){var old_coverage_option=applicant_coverage_selection_view_model.coverage_option();var view_model=_.find(self.coverage_vm.product_coverage_viewmodels(),function(view_model){return applicant_coverage_selection_view_model.product_coverage===view_model;});var new_coverage_options=view_model.get_coverage_options_for_applicant(applicant_coverage_selection_view_model.applicant);var coverage_option=_.chain(new_coverage_options).find(function(coverage_option){return coverage_option.face_value===old_coverage_option.face_value;}).value();if(!coverage_option){coverage_option=_.chain(new_coverage_options).filter(function(coverage_option){return coverage_option.face_value<old_coverage_option.face_value;}).max(function(coverage_option){return coverage_option.face_value;}).value();}
var premium_changed=coverage_option.premium!==old_coverage_option.premium;var face_value_changed=coverage_option.face_value!==old_coverage_option.face_value;applicant_coverage_selection_view_model.customized_coverage_option(coverage_option);if(applicant===applicant_coverage_selection_view_model.applicant){var start_type='non-smoker';var end_type='smoker';if(old_value===true&&value===false){start_type='smoker';end_type='non-smoker';}
self.smoker_status_changed_messages.push('The status change from '+
start_type+' to '+end_type+' adjusts your premium for '+
applicant_coverage_selection_view_model.product_coverage.format_product_name()+' to '+
coverage_option.format_premium()+' for '+coverage_option.format_face_value()+' coverage.');}});});};self.on_smoker_status_changed_dialog=function(){$('#smoking-status-dialog').modal('hide');};function subscribe_to_boolean_changes(observable,callback){if(!observable){return;}
var caller_args=arguments;var previous_value;observable.subscribe(function(old_value){previous_value=old_value;},null,'beforeChange');observable.subscribe(function(value){if((previous_value===undefined||previous_value===null)&&value===false){return;}
if((previous_value!==undefined&&previous_value!==null)||value===true){var args=[value,previous_value];if(caller_args.length>2){_.forEach(Array.prototype.slice.call(caller_args,2),function(arg){args.push(arg);});}
callback.apply(this,args);}});}
subscribe_to_boolean_changes(self.employee().is_smoker,self.show_smoker_status_changed_dialog,self.employee());if(self.spouse()){subscribe_to_boolean_changes(self.spouse().is_smoker,self.show_smoker_status_changed_dialog,self.spouse());}
self.children=ko.computed(function(){return self.applicant_list.get_children();});var should_show_spouse_initially=self.spouse().any_valid_field();self.should_show_spouse(should_show_spouse_initially);var should_show_children_initially=self.applicant_list.has_valid_children();self.should_include_children(should_show_children_initially);var num_initial_children=self.children().length;var last_name=self.employee().last()||"";if(num_initial_children==0){var num_blank_children_forms=(2-num_initial_children);for(var i=0;i<num_blank_children_forms;i+=1){var ch=wizard_applicant.create_applicant({last:last_name,type:wizard_applicant.Applicant.ChildType});self.applicant_list.add_applicant(ch);}}}
function init_jquery_validator(){$.validator.addMethod("minAge",function(val,element,params){var age=wizard_applicant.age_for_date(val);return(age!==""&&age>=params);},"Must be at least {0} years old for this product");$.validator.addMethod("maxAge",function(val,element,params){var age=wizard_applicant.age_for_date(val);return(age!==""&&age<=params);},"Must be no more than {0} years old for this product");self.limit_error_lookup={employee_height:self.employee().height_error,employee_weight:self.employee().weight_error,spouse_height:self.spouse().height_error,spouse_weight:self.spouse().weight_error};self.any_limit_error=ko.pureComputed(function(){return self.employee().height_error()||self.employee().weight_error()||self.spouse().height_error()||self.spouse().weight_error();});$.validator.addMethod("empHeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_height_valid(self.enrollment_case.product_height_weight_tables,product,self.employee());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("empWeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.employee());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("spHeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_height_valid(self.enrollment_case.product_height_weight_tables,product,self.spouse());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("spWeightLimit",function(val,el,params){return _.chain(self.products).filter(function(product){return product.requires_additional_information();}).all(function(product){return is_applicant_weight_valid(self.enrollment_case.product_height_weight_tables,product,self.spouse());}).value()||!requires_additional_employee_information();},"The height or weight entered is outside the limits for this product.");$.validator.addMethod("isValidPaymentMode",function(value,element){return self.coverage_vm.is_payment_mode_valid();},"You must select a payment mode.");function any_valid_spouse_field(){return self.spouse().any_valid_field();}
self.validator=$("#step1-form").validate({highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:wizard_error_placement,errorElement:'div',errorClass:'help-block',rules:{eeBenefitFName:"required",eeBenefitLName:"required",eeBenefitDOB:{required:true,date:true,minAge:min_emp_age(),maxAge:max_emp_age()},spFName:{required:{depends:any_valid_spouse_field}},spLName:{required:{depends:any_valid_spouse_field}},spDOB:{required:{depends:any_valid_spouse_field},date:{depends:any_valid_spouse_field},minAge:{param:min_sp_age(),depends:any_valid_spouse_field},maxAge:{param:max_sp_age(),depends:any_valid_spouse_field}},paymentMode:{isValidPaymentMode:{depends:self.can_change_payment_mode}}},groups:{emp_height:"height_feet_0 height_inches_0",sp_height:"height_feet_1 height_inches_1"}});self.validators={};self.validators.step1=self.validator;self.validators.step2=$('#questions-form').validate({highlight:wizard_validate_highlight,success:wizard_validate_success,errorPlacement:step_two_error_placement,errorElement:'span',errorClass:'help-block',rules:{'tobacco-0':{required:requires_additional_employee_information},'gender-0':{required:requires_additional_employee_information},'height_feet_0':{required:requires_additional_employee_information,empHeightLimit:true},'height_inches_0':{required:requires_additional_employee_information,empHeightLimit:true},'weight_0':{required:requires_additional_employee_information,empWeightLimit:true},'tobacco-1':{required:{depends:requires_additional_spouse_information}},'gender-1':{required:{depends:requires_additional_spouse_information}},'weight_1':{required:{depends:requires_additional_spouse_information},spWeightLimit:true},'height_feet_1':{required:{depends:requires_additional_spouse_information},spHeightLimit:true},'height_inches_1':{required:{depends:requires_additional_spouse_information},spHeightLimit:true}}});function is_child_name_required(element){if($(element).attr("id")==="child-first-0"||$(element).attr("id")==="child-last-0"||$(element).attr("id")==="child-dob-0"){return self.should_include_children();}
var child=ko.dataFor(element);if(!child){return false;}
return child.any_valid_field();}
function is_child_field_required(element){if($(element).attr("id")==="child-first-0"||$(element).attr("id")==="child-last-0"||$(element).attr("id")==="child-dob-0"){return self.should_include_children();}
var child=ko.dataFor(element);if(!child){return false;}
return child.any_valid_field();}
$.validator.addClassRules("child_birthdate",{required:{depends:is_child_field_required},date:{depends:is_child_field_required},minAge:{param:min_ch_age(),depends:is_child_field_required},maxAge:{param:max_ch_age(),depends:is_child_field_required}});$.validator.addClassRules("child_first",{required:{depends:is_child_name_required}});$.validator.addClassRules("child_last",{required:{depends:is_child_name_required}});}
init_validation(self);}
function handle_remote_error(request,retry_callback){if(request.status==401){if(ui.account_href!=null){prompt_login(retry_callback);}else{login_reauth(null,null,retry_callback);}}else{alert("Sorry, an error occurred communicating with the server.");}}
function prompt_login(callback){bootbox.confirm({message:"Please type your password to login again: <input id='password' class='form-control' placeholder='Password' type='password'/>",title:"Session Timed Out, Please Re-Login:",buttons:{"cancel":{"label":"Cancel"},"confirm":{"label":"Login","className":"width-35 pull-right btn btn-primary"}},callback:function(result){if(result==true){login_reauth(ui.account_href,$('#password').val(),callback);}}});}
function login_reauth(account_href,password,callback){var post_data={"account_href":account_href,"password":password,"success_message":"You were re-authenticated successfully.  Please continue with the application.","session_data":{"is_self_enroll":ui.is_self_enroll(),"active_case_id":ui.case_id,"enrolling_census_record_id":ui.record_id}};ajax_post('/reauth',post_data,function(reauth_response){bootbox.alert(reauth_response.message);if(callback){callback(true);}},function(){bootbox.alert("There was a problem reauthenticating. Please try again.");if(callback){callback(false);}},true);}
function ajax_post(url,data,on_success,on_error,is_json){var options={data:data,error:on_error,success:on_success,dataType:"json",method:"POST"};if(is_json===true){options.contentType="application/json; charset=utf-8";options.processData=false;options.data=JSON.stringify(data);}
$.ajax(url,options);}
return{WizardVM:WizardVM};})
();