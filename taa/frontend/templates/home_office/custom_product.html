{% extends "home_office/home_office_base.html" %}
{% from "form_macros.html" import render_field_with_errors %}
{% set active_page = 'nav_customproducts' -%}
{% block title %} - Manage Products{% endblock %}

{% block content %}
    
    <div class="row">
        <div class="col-md-12">
            <form class="form-horizontal product-setup">
                    
                <div class="widget-box">
                    <div class="widget-header">
                        <div class="row">
                            <h3 class="col-xs-6">Custom Product: {{ product.name }}</h3>
                        </div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">  
                            <div class="row">
                                <div class="col-md-12 col-xs-12">
                                    <h4 class="header lighter">Settings</h4>
                                    {{ render_field_with_errors(product_form.name) }}
                                    {{ render_field_with_errors(product_form.base_product_id) }}   
                                    {{ render_field_with_errors(product_form.guarantee_issue_amount) }}  
                                    <br>
                                    <h4 class="header lighter">Additional Criteria</h4>
                                    <div class="form-group">
                                        <div class="col-md-3 control-label"><label>Height</label></div>
                                        <div class="col-md-9">
                                            <div class="criteria-select">
                                                    Greater Than: 
                                                    {{ product_form.criteria_height_min() | safe }} 
                                                    Less Than: 
                                                    {{ product_form.criteria_height_max() | safe }} 
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-3 control-label"><label>Weight</label></div>
                                        <div class="col-md-9">
                                            <div class="criteria-select">
                                                    Greater Than: 
                                                    {{ product_form.criteria_weight_min() | safe }} 
                                                    Less Than: 
                                                    {{ product_form.criteria_weight_max() | safe }} 
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-3 control-label"><label>Height</label></div>
                                        <div class="col-md-9">
                                            <div class="criteria-select">
                                                    Greater Than: 
                                                    {{ product_form.criteria_age_min() | safe }} 
                                                    Less Than: 
                                                    {{ product_form.criteria_age_max() | safe }} 
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h4 class="header lighter">When GI and criteria met</h4>
                                    <div class="form-group">            
                                        <div class="col-md-9 col-md-offset-3">
                                            <label class="control-label">
                                                
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-3 control-label"><label>Height</label></div>
                                        <div class="col-md-9">
                                            <div class="criteria-select">
                                                    Greater Than: 
                                                    {{ product_form.criteria_age_min() | safe }} 
                                                    Less Than: 
                                                    {{ product_form.criteria_age_max() | safe }} 
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h4 class="header lighter">Assign to Agents</h4>
                                    <div class="row">
                                        <div class="col-md-4 col-md-offset-1">
                                            <label class="block" for="available-agents">Available Agents:</label>
                                            <select class="form-control" id='available-agents' size="10" style="min-height: 8em;">
                                            </select>
                                        </div>
                                        <div class="col-md-1">
                                            <br>
                                            <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-arrow-right"></span></button>
                                            <br><br>
                                            <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-arrow-left"></span></button>
                                            
                                        </div>
                                        <div class="col-md-4">
                                            <label class="block" for="assigned-agents">Assigned Agents:</label>
                                            <select class="form-control" id="assigned-agents" size="10" style="min-height: 8em;">
                                                
                                            </select>
                                        </div>
                                    </div>
                                   
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="widget-toolbox clearfix padding-8">
                            <div class="clearfix">
                                <button type="submit" class="btn-primary btn-sm pull-right">Save</button>
                            </div>
                            <div class="clearfix">
                                <div class="pull-right submit-message"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </form> 
            
        </div>
    </div>
    
{% endblock %}


{% block page_js %}
<script>
$(function() {
    $("form.product-setup").on('submit', function() {
        var form_data = $(this).serialize();
        var settings_request = send_form_data(
            "PUT", 
            "{{ url_for("products.update_product", product_id=product.id) }}",
            form_data
        );
        
        
        var on_success = function(case_xhr, periods_xhr) {
            alert("Saved");
        };
        var on_failure = function(case_xhr, periods_xhr) {
            var resp = case_xhr.responseJSON;
            if (resp.errors) {
                show_all_errors(resp.errors);
            } else {
                alert("There was a problem saving the data.");
            }
        };
        $.when(settings_request//, agents_request
        ).then(on_success, on_failure);
        
        hide_all_errors();
        return false; 
    });
});
</script>
{% endblock %}