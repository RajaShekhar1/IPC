{% extends "base.html" %}
{% set active_page = 'nav_agent_manage_case' -%}
{% block title %} - Agent Manage Case{% endblock %}

{% block content %}
    
    
    <h1 class="header lighter">Case Settings</h1>
    
    <div class="row">
        <div class="col-xs-12 col-md-6">
            <form class="form-horizontal" method="POST" action="{{ url_for("save_case", case_id=case.id) }}">
                    
            <div class="widget-box">
                <div class="widget-header">
                    <h3>Basic Setup</h3>
                </div>
                <div class="widget-body">
                    <div class="widget-main">  
                        
                            <div class="form-group">
                                <label class="col-md-3 control-label" for="company_name">Company Name</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control" id="company_name" name="company_name" placeholder="Company Name">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="col-md-3 control-label" for="case_product">Product</label>
                                <div class="col-md-9">
                                    <select id="case_product" name="case_product" class="form-control">
                                        <option></option>
                                        {% for product in product_choices %}
                                            <option value="{{product['short_name']}}" 
                                            {%- if product["disabled"] -%}
                                            disabled="1"
                                            {%- endif -%}
                                            >{{product["name"]}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        
                            <div class="form-group">
                                <label class="col-md-3 control-label" for="case_state">State</label>
                                <div class="col-md-9">
                                    <select id="case_state" name="case_state" class="form-control">
                                        <option></option>
                                        {% for state in all_states %}
                                            <option value="{{state['short_name']}}">{{state["name"]}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                
                                <div class="col-md-9 col-md-offset-3">
                                    <label class="control-label">
                                        <input type="checkbox" id="case_active" name="case_active" checked> Active
                                    </label>
                                </div>
                            </div>
                                
                    </div>
                    <div class="widget-toolbox clearfix padding-8">
                        <button type="submit" class="btn-primary btn-sm pull-right">Save</button>
                    </div>
                </div>
            </div>
                
            </form> 
        </div>
    
        <div class="col-xs-12 col-md-6">
            <form class="">
            <div class="widget-box">
                <div class="widget-header">
                    <h3>Enrollment Settings</h3>
                </div>
                <div class="widget-body">
                    <div class="widget-main">  
                        
                            <div class="form-group">
                                <label>
                                    <input type="radio" class="ace" name="enrollment_type" value="annual">
                                    <span class="lbl"> Annual Open Enrollment</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="col-md-3 control-label" for="annual_start_date">Start Date:</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control" id="annual_start_date">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="radio" class="ace" name="enrollment_type" value="annual">
                                    <span class="lbl"> Enrollment Periods:</span>
                                </label>
                            </div>
                            <div class="form-group clearfix">
                                <div class="col-md-5">
                                    <label>Start Date: <input type="text" placeholder="mm" size="2" maxlength="2"></label> / <input type="text" placeholder="dd" size="2" maxlength="2">
                                </div>
                                <div class="col-md-5">
                                    <label>End Date: <input type="text" placeholder="mm" size="2" maxlength="2"></label> / <input type="text" placeholder="dd" size="2" maxlength="2">
                                </div>
                            </div>
                            
                            
                    </div>
                    <div class="widget-toolbox clearfix padding-8">
                        <button type="submit" class="btn-primary btn-sm pull-right">Save</button>
                    </div>
                            
                </div>
            </div>
            </form> 
                
        </div>
    
    </div>
    
    <br>
    <div class="hr"></div>
    <br>
    
    <div class="row">
        <div class="col-xs-12">
            <div class="widget-box">
                <div class="widget-header">
                    <h3>Case Census</h3>
                    <button type="button" id="upload-btn" class="btn btn-success pull-right" data-toggle="modal" data-target="#census-upload-modal">Upload Census</button>
                </div>
                <div class="widget-body">
                    <div class="widget-main">  
                        {% if not census_records %}
                            <h4 class="text-center lighter">No Census Data Uploaded</h4>
                        {% else %}
                            <table class="table table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>First</th>
                                        <th>Last</th>
                                        <th>Completed Enrollment</th>
                                        <th>Elected Coverage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for record in census_records %}
                                    <tr>
                                        <td>{{ record.first }}</td>
                                        <td>{{ record.last }}</td>
                                        <td>{{ record.completed_enrollment }}</td>
                                        <td>{{ record.elected_coverage }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
                
    </div>
    
    {# Upload census data modal #}
    <form method="POST" enctype="multipart/form-data" action="{{ url_for("save_case", case_id=case.id) }}">
    <div id="census-upload-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                        aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Upload Census Data</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-12 ">
                            <h4>
                                Select Census CSV File: 
                            </h4>
                            <p class="offset-by-twelve">Download an <a href="#">example census data file</a> for formatting reference.</p>
                            <input type="file" id="csv-file-input" name="csv-file">
                        </div>
                    </div>
                    
                    <br>
                    
                    <div class="row">
                        <div class="col-xs-12">
                            
                            <div class="form-group">
                                <label>
                                    <input type="radio" class="ace" name="upload_type" value="merge" checked>
                                    <span class="lbl"> Merge with Existing Census</span>
                                </label>
                                <div class="row">
                                    <p class="col-xs-10 col-xs-offset-1">
                                        This option adds new records to any existing employee records, and updates the information for records whose SSN match.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="radio" class="ace" name="upload_type" value="replace">
                                    <span class="lbl"> Replace Existing Census</span>
                                </label>
                                <div class="row">
                                    <p class="col-xs-10 col-xs-offset-1">
                                        This option first removes any existing employee records, then replaces them with the new data.
                                    </p>
                                </div>
                            </div>
                            
                            
                        </div>
                    </div>
                    
                </div>
                
                    
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    </form>
{% endblock %}

{% block page_js %}
    <script src="{{ url_for("static", filename="js/5Star/product_state_select.js") }}"></script>
    <script>
    $(function() {
        // Change enabled states when the product is changed
        product_state_select.init("#case_state","#case_product", {{ product_states | tojson | safe }});
        
        $('#csv-file-input').ace_file_input({
            no_file:'No File ...',
            btn_choose:'Choose File',
            btn_change:'Change File',
            droppable:false,
            onchange:null,
            thumbnail:false,
            whitelist:'csv'
        });
        
        
    });
    </script>
{% endblock %}